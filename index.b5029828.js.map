{"mappings":"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","sources":["<anon>","src/main.js","src/constants.js","src/kaboomCtx.js","node_modules/kaboom/dist/kaboom.mjs","node_modules/kaboom/src/math.ts","node_modules/kaboom/src/utils.ts","node_modules/kaboom/src/gamepad.json","node_modules/kaboom/src/app.ts","node_modules/kaboom/src/gfx.ts","node_modules/kaboom/src/assets.ts","node_modules/kaboom/src/easings.ts","node_modules/kaboom/src/texPacker.ts","node_modules/kaboom/src/kaboom.ts","src/utils.js"],"sourcesContent":["const $5cdc329eeebd56d0$export$caead18fddac0ead = 4;\nconst $5cdc329eeebd56d0$export$392f53e92db1c5c1 = {\n    pc: `These are my experiences:<br>\r\n  Software Engineering Fellow, Headstarter AI:As a Software Engineering Fellow at Headstarter AI, I am embarking on a dynamic 7-week journey working on diverse projects across various fields. This immersive experience includes hands-on development in cutting-edge technologies, participating in engaging hackathons, and receiving tailored interview preparation to sharpen my skills.<br> \r\n  Student Ambassador, Viral Fission:In my role as a Student Ambassador at Viral Fission, I organize and host blockchain gaming events to foster community engagement. I create engaging content, including reels and social media posts, to promote products and enhance brand visibility.<br>\r\n   `,\n    \"cs-degree\": `I have certificationS from META in HTML & CSS, and also Version Control.`,\n    \"sofa-table\": `Hello!, I'm Aarcha U, a B.E. student specializing in Artificial Intelligence & Machine Learning at Impact College of Engineering & Applied Sciences. With experience in web development, blockchain event management, and a passion for technology, I bring a creative and analytical approach to every project. Explore my portfolio to see my work in programming and design, and feel free to connect with me for collaboration!`,\n    tv: ` Check out my LinedIn profile:<a href=\"https://www.linkedin.com/in/aarcha-u\" target=\"_blank\">LinkedIn</a>.`,\n    bed: `This where I sleep. Great ideas comes when I'm lying on my bed. When an idea strikes, I often have to write it down or else I won't be able to sleep because my mental energy is consumed by it.`,\n    resume: `This is my desk and on it is my Github Profile: <a href=\"https://github.com/aarch34\" target=\"_blank\">Github</a>,\r\n  Contact me at aarcha.u@yahoo.com if you have any interesting job opportunities!`,\n    projects: `Some projects I've Done:<br>\r\n  I developed a user-friendly website for Bibha, The Event Company, focusing on responsive design and multimedia integration to enhance user engagement.<br>\r\n   Additionally, I created an e-commerce web app for a college project,showcasing a jewellery store using Django and MySQL, featuring a secure user authentication system, a dynamic product catalog, and a comprehensive admin dashboard. These projects showcase my skills in web development and my commitment to delivering functional and visually appealing digital solutions.`,\n    library: `These are my skills:<br>Programming Languages: Python, HTML5, CSS, C.\r\n<br>Web Development: Django, Kaboom.js, Responsive Design, Frontend Development.\r\n<br>Database Management: MySQL,MongoDB.\r\n<br>Version Control: Git, GitHub.`,\n    exit: `If you want to exit Aarcha U's portfolio, just close the tab.`\n};\n\n\nvar $adc7cb3c45508c7c$var$yi = Object.defineProperty;\nvar $adc7cb3c45508c7c$var$i = (n, e)=>$adc7cb3c45508c7c$var$yi(n, \"name\", {\n        value: e,\n        configurable: !0\n    });\nvar $adc7cb3c45508c7c$var$gr = (()=>{\n    for(var n = new Uint8Array(128), e = 0; e < 64; e++)n[e < 26 ? e + 65 : e < 52 ? e + 71 : e < 62 ? e - 4 : e * 4 - 205] = e;\n    return (o)=>{\n        for(var c = o.length, g = new Uint8Array((c - (o[c - 1] == \"=\") - (o[c - 2] == \"=\")) * 3 / 4 | 0), m = 0, P = 0; m < c;){\n            var I = n[o.charCodeAt(m++)], j = n[o.charCodeAt(m++)], y = n[o.charCodeAt(m++)], X = n[o.charCodeAt(m++)];\n            g[P++] = I << 2 | j >> 4, g[P++] = j << 4 | y >> 2, g[P++] = y << 6 | X;\n        }\n        return g;\n    };\n})();\nfunction $adc7cb3c45508c7c$var$Ge(n) {\n    return n * Math.PI / 180;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Ge, \"deg2rad\");\nfunction $adc7cb3c45508c7c$var$ot(n) {\n    return n * 180 / Math.PI;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$ot, \"rad2deg\");\nfunction $adc7cb3c45508c7c$var$Le(n, e, o) {\n    return e > o ? $adc7cb3c45508c7c$var$Le(n, o, e) : Math.min(Math.max(n, e), o);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Le, \"clamp\");\nfunction $adc7cb3c45508c7c$var$Ve(n, e, o) {\n    if (typeof n == \"number\" && typeof e == \"number\") return n + (e - n) * o;\n    if (n instanceof $adc7cb3c45508c7c$var$v && e instanceof $adc7cb3c45508c7c$var$v) return n.lerp(e, o);\n    if (n instanceof $adc7cb3c45508c7c$var$W && e instanceof $adc7cb3c45508c7c$var$W) return n.lerp(e, o);\n    throw new Error(`Bad value for lerp(): ${n}, ${e}. Only number, Vec2 and Color is supported.`);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Ve, \"lerp\");\nfunction $adc7cb3c45508c7c$var$_e(n, e, o, c, g) {\n    return c + (n - e) / (o - e) * (g - c);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$_e, \"map\");\nfunction $adc7cb3c45508c7c$var$br(n, e, o, c, g) {\n    return $adc7cb3c45508c7c$var$Le($adc7cb3c45508c7c$var$_e(n, e, o, c, g), c, g);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$br, \"mapc\");\nvar $adc7cb3c45508c7c$var$v = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Vec2\");\n    }\n    x = 0;\n    y = 0;\n    constructor(e = 0, o = e){\n        this.x = e, this.y = o;\n    }\n    static fromAngle(e) {\n        let o = $adc7cb3c45508c7c$var$Ge(e);\n        return new n(Math.cos(o), Math.sin(o));\n    }\n    static LEFT = new n(-1, 0);\n    static RIGHT = new n(1, 0);\n    static UP = new n(0, -1);\n    static DOWN = new n(0, 1);\n    clone() {\n        return new n(this.x, this.y);\n    }\n    add(...e) {\n        let o = $adc7cb3c45508c7c$var$T(...e);\n        return new n(this.x + o.x, this.y + o.y);\n    }\n    sub(...e) {\n        let o = $adc7cb3c45508c7c$var$T(...e);\n        return new n(this.x - o.x, this.y - o.y);\n    }\n    scale(...e) {\n        let o = $adc7cb3c45508c7c$var$T(...e);\n        return new n(this.x * o.x, this.y * o.y);\n    }\n    dist(...e) {\n        let o = $adc7cb3c45508c7c$var$T(...e);\n        return this.sub(o).len();\n    }\n    sdist(...e) {\n        let o = $adc7cb3c45508c7c$var$T(...e);\n        return this.sub(o).slen();\n    }\n    len() {\n        return Math.sqrt(this.dot(this));\n    }\n    slen() {\n        return this.dot(this);\n    }\n    unit() {\n        let e = this.len();\n        return e === 0 ? new n(0) : this.scale(1 / e);\n    }\n    normal() {\n        return new n(this.y, -this.x);\n    }\n    reflect(e) {\n        return this.sub(e.scale(2 * this.dot(e)));\n    }\n    project(e) {\n        return e.scale(e.dot(this) / e.len());\n    }\n    reject(e) {\n        return this.sub(this.project(e));\n    }\n    dot(e) {\n        return this.x * e.x + this.y * e.y;\n    }\n    cross(e) {\n        return this.x * e.y - this.y * e.x;\n    }\n    angle(...e) {\n        let o = $adc7cb3c45508c7c$var$T(...e);\n        return $adc7cb3c45508c7c$var$ot(Math.atan2(this.y - o.y, this.x - o.x));\n    }\n    angleBetween(...e) {\n        let o = $adc7cb3c45508c7c$var$T(...e);\n        return $adc7cb3c45508c7c$var$ot(Math.atan2(this.cross(o), this.dot(o)));\n    }\n    lerp(e, o) {\n        return new n($adc7cb3c45508c7c$var$Ve(this.x, e.x, o), $adc7cb3c45508c7c$var$Ve(this.y, e.y, o));\n    }\n    slerp(e, o) {\n        let c = this.dot(e), g = this.cross(e), m = Math.atan2(g, c);\n        return this.scale(Math.sin((1 - o) * m)).add(e.scale(Math.sin(o * m))).scale(1 / g);\n    }\n    isZero() {\n        return this.x === 0 && this.y === 0;\n    }\n    toFixed(e) {\n        return new n(Number(this.x.toFixed(e)), Number(this.y.toFixed(e)));\n    }\n    transform(e) {\n        return e.multVec2(this);\n    }\n    eq(e) {\n        return this.x === e.x && this.y === e.y;\n    }\n    bbox() {\n        return new $adc7cb3c45508c7c$var$de(this, 0, 0);\n    }\n    toString() {\n        return `vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`;\n    }\n};\nfunction $adc7cb3c45508c7c$var$T(...n) {\n    if (n.length === 1) {\n        if (n[0] instanceof $adc7cb3c45508c7c$var$v) return new $adc7cb3c45508c7c$var$v(n[0].x, n[0].y);\n        if (Array.isArray(n[0]) && n[0].length === 2) return new $adc7cb3c45508c7c$var$v(...n[0]);\n    }\n    return new $adc7cb3c45508c7c$var$v(...n);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$T, \"vec2\");\nvar $adc7cb3c45508c7c$var$W = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Color\");\n    }\n    r = 255;\n    g = 255;\n    b = 255;\n    constructor(e, o, c){\n        this.r = $adc7cb3c45508c7c$var$Le(e, 0, 255), this.g = $adc7cb3c45508c7c$var$Le(o, 0, 255), this.b = $adc7cb3c45508c7c$var$Le(c, 0, 255);\n    }\n    static fromArray(e) {\n        return new n(e[0], e[1], e[2]);\n    }\n    static fromHex(e) {\n        if (typeof e == \"number\") return new n(e >> 16 & 255, e >> 8 & 255, e >> 0 & 255);\n        if (typeof e == \"string\") {\n            let o = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(e);\n            return new n(parseInt(o[1], 16), parseInt(o[2], 16), parseInt(o[3], 16));\n        } else throw new Error(\"Invalid hex color format\");\n    }\n    static fromHSL(e, o, c) {\n        if (o == 0) return new n(255 * c, 255 * c, 255 * c);\n        let g = $adc7cb3c45508c7c$var$i((X, S, q)=>(q < 0 && (q += 1), q > 1 && (q -= 1), q < 1 / 6 ? X + (S - X) * 6 * q : q < 0.5 ? S : q < 2 / 3 ? X + (S - X) * (2 / 3 - q) * 6 : X), \"hue2rgb\"), m = c < .5 ? c * (1 + o) : c + o - c * o, P = 2 * c - m, I = g(P, m, e + 1 / 3), j = g(P, m, e), y = g(P, m, e - 1 / 3);\n        return new n(Math.round(I * 255), Math.round(j * 255), Math.round(y * 255));\n    }\n    static RED = new n(255, 0, 0);\n    static GREEN = new n(0, 255, 0);\n    static BLUE = new n(0, 0, 255);\n    static YELLOW = new n(255, 255, 0);\n    static MAGENTA = new n(255, 0, 255);\n    static CYAN = new n(0, 255, 255);\n    static WHITE = new n(255, 255, 255);\n    static BLACK = new n(0, 0, 0);\n    clone() {\n        return new n(this.r, this.g, this.b);\n    }\n    lighten(e) {\n        return new n(this.r + e, this.g + e, this.b + e);\n    }\n    darken(e) {\n        return this.lighten(-e);\n    }\n    invert() {\n        return new n(255 - this.r, 255 - this.g, 255 - this.b);\n    }\n    mult(e) {\n        return new n(this.r * e.r / 255, this.g * e.g / 255, this.b * e.b / 255);\n    }\n    lerp(e, o) {\n        return new n($adc7cb3c45508c7c$var$Ve(this.r, e.r, o), $adc7cb3c45508c7c$var$Ve(this.g, e.g, o), $adc7cb3c45508c7c$var$Ve(this.b, e.b, o));\n    }\n    toHSL() {\n        let e = this.r / 255, o = this.g / 255, c = this.b / 255, g = Math.max(e, o, c), m = Math.min(e, o, c), P = (g + m) / 2, I = P, j = P;\n        if (g == m) P = I = 0;\n        else {\n            let y = g - m;\n            switch(I = j > .5 ? y / (2 - g - m) : y / (g + m), g){\n                case e:\n                    P = (o - c) / y + (o < c ? 6 : 0);\n                    break;\n                case o:\n                    P = (c - e) / y + 2;\n                    break;\n                case c:\n                    P = (e - o) / y + 4;\n                    break;\n            }\n            P /= 6;\n        }\n        return [\n            P,\n            I,\n            j\n        ];\n    }\n    eq(e) {\n        return this.r === e.r && this.g === e.g && this.b === e.b;\n    }\n    toString() {\n        return `rgb(${this.r}, ${this.g}, ${this.b})`;\n    }\n    toHex() {\n        return \"#\" + (16777216 + (this.r << 16) + (this.g << 8) + this.b).toString(16).slice(1);\n    }\n};\nfunction $adc7cb3c45508c7c$var$J(...n) {\n    if (n.length === 0) return new $adc7cb3c45508c7c$var$W(255, 255, 255);\n    if (n.length === 1) {\n        if (n[0] instanceof $adc7cb3c45508c7c$var$W) return n[0].clone();\n        if (typeof n[0] == \"string\") return $adc7cb3c45508c7c$var$W.fromHex(n[0]);\n        if (Array.isArray(n[0]) && n[0].length === 3) return $adc7cb3c45508c7c$var$W.fromArray(n[0]);\n    }\n    return new $adc7cb3c45508c7c$var$W(...n);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$J, \"rgb\");\nvar $adc7cb3c45508c7c$var$vr = $adc7cb3c45508c7c$var$i((n, e, o)=>$adc7cb3c45508c7c$var$W.fromHSL(n, e, o), \"hsl2rgb\"), $adc7cb3c45508c7c$var$oe = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Quad\");\n    }\n    x = 0;\n    y = 0;\n    w = 1;\n    h = 1;\n    constructor(e, o, c, g){\n        this.x = e, this.y = o, this.w = c, this.h = g;\n    }\n    scale(e) {\n        return new n(this.x + this.w * e.x, this.y + this.h * e.y, this.w * e.w, this.h * e.h);\n    }\n    pos() {\n        return new $adc7cb3c45508c7c$var$v(this.x, this.y);\n    }\n    clone() {\n        return new n(this.x, this.y, this.w, this.h);\n    }\n    eq(e) {\n        return this.x === e.x && this.y === e.y && this.w === e.w && this.h === e.h;\n    }\n    toString() {\n        return `quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`;\n    }\n};\nfunction $adc7cb3c45508c7c$var$ce(n, e, o, c) {\n    return new $adc7cb3c45508c7c$var$oe(n, e, o, c);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$ce, \"quad\");\nvar $adc7cb3c45508c7c$var$Ue = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Mat4\");\n    }\n    m = [\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1\n    ];\n    constructor(e){\n        e && (this.m = e);\n    }\n    static translate(e) {\n        return new n([\n            1,\n            0,\n            0,\n            0,\n            0,\n            1,\n            0,\n            0,\n            0,\n            0,\n            1,\n            0,\n            e.x,\n            e.y,\n            0,\n            1\n        ]);\n    }\n    static scale(e) {\n        return new n([\n            e.x,\n            0,\n            0,\n            0,\n            0,\n            e.y,\n            0,\n            0,\n            0,\n            0,\n            1,\n            0,\n            0,\n            0,\n            0,\n            1\n        ]);\n    }\n    static rotateX(e) {\n        e = $adc7cb3c45508c7c$var$Ge(-e);\n        let o = Math.cos(e), c = Math.sin(e);\n        return new n([\n            1,\n            0,\n            0,\n            0,\n            0,\n            o,\n            -c,\n            0,\n            0,\n            c,\n            o,\n            0,\n            0,\n            0,\n            0,\n            1\n        ]);\n    }\n    static rotateY(e) {\n        e = $adc7cb3c45508c7c$var$Ge(-e);\n        let o = Math.cos(e), c = Math.sin(e);\n        return new n([\n            o,\n            0,\n            c,\n            0,\n            0,\n            1,\n            0,\n            0,\n            -c,\n            0,\n            o,\n            0,\n            0,\n            0,\n            0,\n            1\n        ]);\n    }\n    static rotateZ(e) {\n        e = $adc7cb3c45508c7c$var$Ge(-e);\n        let o = Math.cos(e), c = Math.sin(e);\n        return new n([\n            o,\n            -c,\n            0,\n            0,\n            c,\n            o,\n            0,\n            0,\n            0,\n            0,\n            1,\n            0,\n            0,\n            0,\n            0,\n            1\n        ]);\n    }\n    translate(e) {\n        return this.m[12] += this.m[0] * e.x + this.m[4] * e.y, this.m[13] += this.m[1] * e.x + this.m[5] * e.y, this.m[14] += this.m[2] * e.x + this.m[6] * e.y, this.m[15] += this.m[3] * e.x + this.m[7] * e.y, this;\n    }\n    scale(e) {\n        return this.m[0] *= e.x, this.m[4] *= e.y, this.m[1] *= e.x, this.m[5] *= e.y, this.m[2] *= e.x, this.m[6] *= e.y, this.m[3] *= e.x, this.m[7] *= e.y, this;\n    }\n    rotate(e) {\n        e = $adc7cb3c45508c7c$var$Ge(-e);\n        let o = Math.cos(e), c = Math.sin(e), g = this.m[0], m = this.m[1], P = this.m[4], I = this.m[5];\n        return this.m[0] = g * o + m * c, this.m[1] = -g * c + m * o, this.m[4] = P * o + I * c, this.m[5] = -P * c + I * o, this;\n    }\n    mult(e) {\n        let o = [];\n        for(let c = 0; c < 4; c++)for(let g = 0; g < 4; g++)o[c * 4 + g] = this.m[0 + g] * e.m[c * 4 + 0] + this.m[4 + g] * e.m[c * 4 + 1] + this.m[8 + g] * e.m[c * 4 + 2] + this.m[12 + g] * e.m[c * 4 + 3];\n        return new n(o);\n    }\n    multVec2(e) {\n        return new $adc7cb3c45508c7c$var$v(e.x * this.m[0] + e.y * this.m[4] + this.m[12], e.x * this.m[1] + e.y * this.m[5] + this.m[13]);\n    }\n    getTranslation() {\n        return new $adc7cb3c45508c7c$var$v(this.m[12], this.m[13]);\n    }\n    getScale() {\n        if (this.m[0] != 0 || this.m[1] != 0) {\n            let e = this.m[0] * this.m[5] - this.m[1] * this.m[4], o = Math.sqrt(this.m[0] * this.m[0] + this.m[1] * this.m[1]);\n            return new $adc7cb3c45508c7c$var$v(o, e / o);\n        } else if (this.m[4] != 0 || this.m[5] != 0) {\n            let e = this.m[0] * this.m[5] - this.m[1] * this.m[4], o = Math.sqrt(this.m[4] * this.m[4] + this.m[5] * this.m[5]);\n            return new $adc7cb3c45508c7c$var$v(e / o, o);\n        } else return new $adc7cb3c45508c7c$var$v(0, 0);\n    }\n    getRotation() {\n        if (this.m[0] != 0 || this.m[1] != 0) {\n            let e = Math.sqrt(this.m[0] * this.m[0] + this.m[1] * this.m[1]);\n            return $adc7cb3c45508c7c$var$ot(this.m[1] > 0 ? Math.acos(this.m[0] / e) : -Math.acos(this.m[0] / e));\n        } else if (this.m[4] != 0 || this.m[5] != 0) {\n            let e = Math.sqrt(this.m[4] * this.m[4] + this.m[5] * this.m[5]);\n            return $adc7cb3c45508c7c$var$ot(Math.PI / 2 - (this.m[5] > 0 ? Math.acos(-this.m[4] / e) : -Math.acos(this.m[4] / e)));\n        } else return 0;\n    }\n    getSkew() {\n        if (this.m[0] != 0 || this.m[1] != 0) {\n            let e = Math.sqrt(this.m[0] * this.m[0] + this.m[1] * this.m[1]);\n            return new $adc7cb3c45508c7c$var$v(Math.atan(this.m[0] * this.m[4] + this.m[1] * this.m[5]) / (e * e), 0);\n        } else if (this.m[4] != 0 || this.m[5] != 0) {\n            let e = Math.sqrt(this.m[4] * this.m[4] + this.m[5] * this.m[5]);\n            return new $adc7cb3c45508c7c$var$v(0, Math.atan(this.m[0] * this.m[4] + this.m[1] * this.m[5]) / (e * e));\n        } else return new $adc7cb3c45508c7c$var$v(0, 0);\n    }\n    invert() {\n        let e = [], o = this.m[10] * this.m[15] - this.m[14] * this.m[11], c = this.m[9] * this.m[15] - this.m[13] * this.m[11], g = this.m[9] * this.m[14] - this.m[13] * this.m[10], m = this.m[8] * this.m[15] - this.m[12] * this.m[11], P = this.m[8] * this.m[14] - this.m[12] * this.m[10], I = this.m[8] * this.m[13] - this.m[12] * this.m[9], j = this.m[6] * this.m[15] - this.m[14] * this.m[7], y = this.m[5] * this.m[15] - this.m[13] * this.m[7], X = this.m[5] * this.m[14] - this.m[13] * this.m[6], S = this.m[4] * this.m[15] - this.m[12] * this.m[7], q = this.m[4] * this.m[14] - this.m[12] * this.m[6], E = this.m[5] * this.m[15] - this.m[13] * this.m[7], K = this.m[4] * this.m[13] - this.m[12] * this.m[5], Q = this.m[6] * this.m[11] - this.m[10] * this.m[7], te = this.m[5] * this.m[11] - this.m[9] * this.m[7], k = this.m[5] * this.m[10] - this.m[9] * this.m[6], pe = this.m[4] * this.m[11] - this.m[8] * this.m[7], C = this.m[4] * this.m[10] - this.m[8] * this.m[6], Ae = this.m[4] * this.m[9] - this.m[8] * this.m[5];\n        e[0] = this.m[5] * o - this.m[6] * c + this.m[7] * g, e[4] = -(this.m[4] * o - this.m[6] * m + this.m[7] * P), e[8] = this.m[4] * c - this.m[5] * m + this.m[7] * I, e[12] = -(this.m[4] * g - this.m[5] * P + this.m[6] * I), e[1] = -(this.m[1] * o - this.m[2] * c + this.m[3] * g), e[5] = this.m[0] * o - this.m[2] * m + this.m[3] * P, e[9] = -(this.m[0] * c - this.m[1] * m + this.m[3] * I), e[13] = this.m[0] * g - this.m[1] * P + this.m[2] * I, e[2] = this.m[1] * j - this.m[2] * y + this.m[3] * X, e[6] = -(this.m[0] * j - this.m[2] * S + this.m[3] * q), e[10] = this.m[0] * E - this.m[1] * S + this.m[3] * K, e[14] = -(this.m[0] * X - this.m[1] * q + this.m[2] * K), e[3] = -(this.m[1] * Q - this.m[2] * te + this.m[3] * k), e[7] = this.m[0] * Q - this.m[2] * pe + this.m[3] * C, e[11] = -(this.m[0] * te - this.m[1] * pe + this.m[3] * Ae), e[15] = this.m[0] * k - this.m[1] * C + this.m[2] * Ae;\n        let $ = this.m[0] * e[0] + this.m[1] * e[4] + this.m[2] * e[8] + this.m[3] * e[12];\n        for(let Te = 0; Te < 4; Te++)for(let ye = 0; ye < 4; ye++)e[Te * 4 + ye] *= 1 / $;\n        return new n(e);\n    }\n    clone() {\n        return new n([\n            ...this.m\n        ]);\n    }\n    toString() {\n        return this.m.toString();\n    }\n};\nfunction $adc7cb3c45508c7c$var$In(n, e, o, c = (g)=>-Math.cos(g)) {\n    return n + (c(o) + 1) / 2 * (e - n);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$In, \"wave\");\nvar $adc7cb3c45508c7c$var$xi = 1103515245, $adc7cb3c45508c7c$var$Ui = 12345, $adc7cb3c45508c7c$var$wr = 2147483648, $adc7cb3c45508c7c$var$bt = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"RNG\");\n    }\n    seed;\n    constructor(e){\n        this.seed = e;\n    }\n    gen() {\n        return this.seed = ($adc7cb3c45508c7c$var$xi * this.seed + $adc7cb3c45508c7c$var$Ui) % $adc7cb3c45508c7c$var$wr, this.seed / $adc7cb3c45508c7c$var$wr;\n    }\n    genNumber(e, o) {\n        return e + this.gen() * (o - e);\n    }\n    genVec2(e, o) {\n        return new $adc7cb3c45508c7c$var$v(this.genNumber(e.x, o.x), this.genNumber(e.y, o.y));\n    }\n    genColor(e, o) {\n        return new $adc7cb3c45508c7c$var$W(this.genNumber(e.r, o.r), this.genNumber(e.g, o.g), this.genNumber(e.b, o.b));\n    }\n    genAny(...e) {\n        if (e.length === 0) return this.gen();\n        if (e.length === 1) {\n            if (typeof e[0] == \"number\") return this.genNumber(0, e[0]);\n            if (e[0] instanceof $adc7cb3c45508c7c$var$v) return this.genVec2($adc7cb3c45508c7c$var$T(0, 0), e[0]);\n            if (e[0] instanceof $adc7cb3c45508c7c$var$W) return this.genColor($adc7cb3c45508c7c$var$J(0, 0, 0), e[0]);\n        } else if (e.length === 2) {\n            if (typeof e[0] == \"number\" && typeof e[1] == \"number\") return this.genNumber(e[0], e[1]);\n            if (e[0] instanceof $adc7cb3c45508c7c$var$v && e[1] instanceof $adc7cb3c45508c7c$var$v) return this.genVec2(e[0], e[1]);\n            if (e[0] instanceof $adc7cb3c45508c7c$var$W && e[1] instanceof $adc7cb3c45508c7c$var$W) return this.genColor(e[0], e[1]);\n        }\n    }\n}, $adc7cb3c45508c7c$var$Bn = new $adc7cb3c45508c7c$var$bt(Date.now());\nfunction $adc7cb3c45508c7c$var$yr(n) {\n    return n != null && ($adc7cb3c45508c7c$var$Bn.seed = n), $adc7cb3c45508c7c$var$Bn.seed;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$yr, \"randSeed\");\nfunction $adc7cb3c45508c7c$var$xt(...n) {\n    return $adc7cb3c45508c7c$var$Bn.genAny(...n);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$xt, \"rand\");\nfunction $adc7cb3c45508c7c$var$Ln(...n) {\n    return Math.floor($adc7cb3c45508c7c$var$xt(...n));\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Ln, \"randi\");\nfunction $adc7cb3c45508c7c$var$xr(n) {\n    return $adc7cb3c45508c7c$var$xt() <= n;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$xr, \"chance\");\nfunction $adc7cb3c45508c7c$var$Ur(n) {\n    return n[$adc7cb3c45508c7c$var$Ln(n.length)];\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Ur, \"choose\");\nfunction $adc7cb3c45508c7c$var$Er(n, e) {\n    return n.pos.x + n.width > e.pos.x && n.pos.x < e.pos.x + e.width && n.pos.y + n.height > e.pos.y && n.pos.y < e.pos.y + e.height;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Er, \"testRectRect\");\nfunction $adc7cb3c45508c7c$var$Ei(n, e) {\n    if (n.p1.x === n.p2.x && n.p1.y === n.p2.y || e.p1.x === e.p2.x && e.p1.y === e.p2.y) return null;\n    let o = (e.p2.y - e.p1.y) * (n.p2.x - n.p1.x) - (e.p2.x - e.p1.x) * (n.p2.y - n.p1.y);\n    if (o === 0) return null;\n    let c = ((e.p2.x - e.p1.x) * (n.p1.y - e.p1.y) - (e.p2.y - e.p1.y) * (n.p1.x - e.p1.x)) / o, g = ((n.p2.x - n.p1.x) * (n.p1.y - e.p1.y) - (n.p2.y - n.p1.y) * (n.p1.x - e.p1.x)) / o;\n    return c < 0 || c > 1 || g < 0 || g > 1 ? null : c;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Ei, \"testLineLineT\");\nfunction $adc7cb3c45508c7c$var$it(n, e) {\n    let o = $adc7cb3c45508c7c$var$Ei(n, e);\n    return o ? $adc7cb3c45508c7c$var$T(n.p1.x + o * (n.p2.x - n.p1.x), n.p1.y + o * (n.p2.y - n.p1.y)) : null;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$it, \"testLineLine\");\nfunction $adc7cb3c45508c7c$var$Sr(n, e) {\n    if ($adc7cb3c45508c7c$var$vt(n, e.p1) || $adc7cb3c45508c7c$var$vt(n, e.p2)) return !0;\n    let o = n.points();\n    return !!$adc7cb3c45508c7c$var$it(e, new $adc7cb3c45508c7c$var$Ie(o[0], o[1])) || !!$adc7cb3c45508c7c$var$it(e, new $adc7cb3c45508c7c$var$Ie(o[1], o[2])) || !!$adc7cb3c45508c7c$var$it(e, new $adc7cb3c45508c7c$var$Ie(o[2], o[3])) || !!$adc7cb3c45508c7c$var$it(e, new $adc7cb3c45508c7c$var$Ie(o[3], o[0]));\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Sr, \"testRectLine\");\nfunction $adc7cb3c45508c7c$var$vt(n, e) {\n    return e.x > n.pos.x && e.x < n.pos.x + n.width && e.y > n.pos.y && e.y < n.pos.y + n.height;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$vt, \"testRectPoint\");\nfunction $adc7cb3c45508c7c$var$Cr(n, e) {\n    let o = e.sub(n.p1), c = n.p2.sub(n.p1);\n    if (Math.abs(o.cross(c)) > Number.EPSILON) return !1;\n    let g = o.dot(c) / c.dot(c);\n    return g >= 0 && g <= 1;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Cr, \"testLinePoint\");\nfunction $adc7cb3c45508c7c$var$Vn(n, e) {\n    let o = n.p2.sub(n.p1), c = o.dot(o), g = n.p1.sub(e.center), m = 2 * o.dot(g), P = g.dot(g) - e.radius * e.radius, I = m * m - 4 * c * P;\n    if (c <= Number.EPSILON || I < 0) return !1;\n    if (I == 0) {\n        let j = -m / (2 * c);\n        if (j >= 0 && j <= 1) return !0;\n    } else {\n        let j = (-m + Math.sqrt(I)) / (2 * c), y = (-m - Math.sqrt(I)) / (2 * c);\n        if (j >= 0 && j <= 1 || y >= 0 && y <= 1) return !0;\n    }\n    return $adc7cb3c45508c7c$var$Ar(e, n.p1);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Vn, \"testLineCircle\");\nfunction $adc7cb3c45508c7c$var$Ar(n, e) {\n    return n.center.sdist(e) < n.radius * n.radius;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Ar, \"testCirclePoint\");\nfunction $adc7cb3c45508c7c$var$Tr(n, e) {\n    let o = e.pts[e.pts.length - 1];\n    for (let c of e.pts){\n        if ($adc7cb3c45508c7c$var$Vn(new $adc7cb3c45508c7c$var$Ie(o, c), n)) return !0;\n        o = c;\n    }\n    return $adc7cb3c45508c7c$var$Ar(n, e.pts[0]) ? !0 : $adc7cb3c45508c7c$var$_n(e, n.center);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Tr, \"testCirclePolygon\");\nfunction $adc7cb3c45508c7c$var$_n(n, e) {\n    let o = !1, c = n.pts;\n    for(let g = 0, m = c.length - 1; g < c.length; m = g++)c[g].y > e.y != c[m].y > e.y && e.x < (c[m].x - c[g].x) * (e.y - c[g].y) / (c[m].y - c[g].y) + c[g].x && (o = !o);\n    return o;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$_n, \"testPolygonPoint\");\nvar $adc7cb3c45508c7c$var$Ie = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Line\");\n    }\n    p1;\n    p2;\n    constructor(e, o){\n        this.p1 = e.clone(), this.p2 = o.clone();\n    }\n    transform(e) {\n        return new n(e.multVec2(this.p1), e.multVec2(this.p2));\n    }\n    bbox() {\n        return $adc7cb3c45508c7c$var$de.fromPoints(this.p1, this.p2);\n    }\n    area() {\n        return this.p1.dist(this.p2);\n    }\n    clone() {\n        return new n(this.p1, this.p2);\n    }\n}, $adc7cb3c45508c7c$var$de = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Rect\");\n    }\n    pos;\n    width;\n    height;\n    constructor(e, o, c){\n        this.pos = e.clone(), this.width = o, this.height = c;\n    }\n    static fromPoints(e, o) {\n        return new n(e.clone(), o.x - e.x, o.y - e.y);\n    }\n    center() {\n        return new $adc7cb3c45508c7c$var$v(this.pos.x + this.width / 2, this.pos.y + this.height / 2);\n    }\n    points() {\n        return [\n            this.pos,\n            this.pos.add(this.width, 0),\n            this.pos.add(this.width, this.height),\n            this.pos.add(0, this.height)\n        ];\n    }\n    transform(e) {\n        return new $adc7cb3c45508c7c$var$Ke(this.points().map((o)=>e.multVec2(o)));\n    }\n    bbox() {\n        return this.clone();\n    }\n    area() {\n        return this.width * this.height;\n    }\n    clone() {\n        return new n(this.pos.clone(), this.width, this.height);\n    }\n    distToPoint(e) {\n        return Math.sqrt(this.sdistToPoint(e));\n    }\n    sdistToPoint(e) {\n        let o = this.pos, c = this.pos.add(this.width, this.height), g = Math.max(o.x - e.x, 0, e.x - c.x), m = Math.max(o.y - e.y, 0, e.y - c.y);\n        return g * g + m * m;\n    }\n}, $adc7cb3c45508c7c$var$yt = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Circle\");\n    }\n    center;\n    radius;\n    constructor(e, o){\n        this.center = e.clone(), this.radius = o;\n    }\n    transform(e) {\n        return new $adc7cb3c45508c7c$var$Fn(this.center, this.radius, this.radius).transform(e);\n    }\n    bbox() {\n        return $adc7cb3c45508c7c$var$de.fromPoints(this.center.sub($adc7cb3c45508c7c$var$T(this.radius)), this.center.add($adc7cb3c45508c7c$var$T(this.radius)));\n    }\n    area() {\n        return this.radius * this.radius * Math.PI;\n    }\n    clone() {\n        return new n(this.center, this.radius);\n    }\n}, $adc7cb3c45508c7c$var$Fn = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Ellipse\");\n    }\n    center;\n    radiusX;\n    radiusY;\n    constructor(e, o, c){\n        this.center = e.clone(), this.radiusX = o, this.radiusY = c;\n    }\n    transform(e) {\n        return new n(e.multVec2(this.center), e.m[0] * this.radiusX, e.m[5] * this.radiusY);\n    }\n    bbox() {\n        return $adc7cb3c45508c7c$var$de.fromPoints(this.center.sub($adc7cb3c45508c7c$var$T(this.radiusX, this.radiusY)), this.center.add($adc7cb3c45508c7c$var$T(this.radiusX, this.radiusY)));\n    }\n    area() {\n        return this.radiusX * this.radiusY * Math.PI;\n    }\n    clone() {\n        return new n(this.center, this.radiusX, this.radiusY);\n    }\n}, $adc7cb3c45508c7c$var$Ke = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Polygon\");\n    }\n    pts;\n    constructor(e){\n        if (e.length < 3) throw new Error(\"Polygons should have at least 3 vertices\");\n        this.pts = e;\n    }\n    transform(e) {\n        return new n(this.pts.map((o)=>e.multVec2(o)));\n    }\n    bbox() {\n        let e = $adc7cb3c45508c7c$var$T(Number.MAX_VALUE), o = $adc7cb3c45508c7c$var$T(-Number.MAX_VALUE);\n        for (let c of this.pts)e.x = Math.min(e.x, c.x), o.x = Math.max(o.x, c.x), e.y = Math.min(e.y, c.y), o.y = Math.max(o.y, c.y);\n        return $adc7cb3c45508c7c$var$de.fromPoints(e, o);\n    }\n    area() {\n        let e = 0, o = this.pts.length;\n        for(let c = 0; c < o; c++){\n            let g = this.pts[c], m = this.pts[(c + 1) % o];\n            e += g.x * m.y * .5, e -= m.x * g.y * .5;\n        }\n        return Math.abs(e);\n    }\n    clone() {\n        return new n(this.pts.map((e)=>e.clone()));\n    }\n};\nfunction $adc7cb3c45508c7c$var$Or(n, e) {\n    let o = Number.MAX_VALUE, c = $adc7cb3c45508c7c$var$T(0);\n    for (let g of [\n        n,\n        e\n    ])for(let m = 0; m < g.pts.length; m++){\n        let P = g.pts[m], j = g.pts[(m + 1) % g.pts.length].sub(P).normal().unit(), y = Number.MAX_VALUE, X = -Number.MAX_VALUE;\n        for(let K = 0; K < n.pts.length; K++){\n            let Q = n.pts[K].dot(j);\n            y = Math.min(y, Q), X = Math.max(X, Q);\n        }\n        let S = Number.MAX_VALUE, q = -Number.MAX_VALUE;\n        for(let K = 0; K < e.pts.length; K++){\n            let Q = e.pts[K].dot(j);\n            S = Math.min(S, Q), q = Math.max(q, Q);\n        }\n        let E = Math.min(X, q) - Math.max(y, S);\n        if (E < 0) return null;\n        if (E < Math.abs(o)) {\n            let K = q - y, Q = S - X;\n            o = Math.abs(K) < Math.abs(Q) ? K : Q, c = j.scale(o);\n        }\n    }\n    return c;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Or, \"sat\");\nvar $adc7cb3c45508c7c$var$Ut = class extends Map {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Registry\");\n    }\n    lastID;\n    constructor(...e){\n        super(...e), this.lastID = 0;\n    }\n    push(e) {\n        let o = this.lastID;\n        return this.set(o, e), this.lastID++, o;\n    }\n    pushd(e) {\n        let o = this.push(e);\n        return ()=>this.delete(o);\n    }\n}, $adc7cb3c45508c7c$var$ke = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"EventController\");\n    }\n    paused = !1;\n    cancel;\n    constructor(e){\n        this.cancel = e;\n    }\n    static join(e) {\n        let o = new n(()=>e.forEach((c)=>c.cancel()));\n        return Object.defineProperty(o, \"paused\", {\n            get: ()=>e[0].paused,\n            set: (c)=>e.forEach((g)=>g.paused = c)\n        }), o.paused = !1, o;\n    }\n}, $adc7cb3c45508c7c$var$be = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Event\");\n    }\n    handlers = new $adc7cb3c45508c7c$var$Ut;\n    add(e) {\n        let o = this.handlers.pushd((...g)=>{\n            c.paused || e(...g);\n        }), c = new $adc7cb3c45508c7c$var$ke(o);\n        return c;\n    }\n    addOnce(e) {\n        let o = this.add((...c)=>{\n            o.cancel(), e(...c);\n        });\n        return o;\n    }\n    next() {\n        return new Promise((e)=>this.addOnce(e));\n    }\n    trigger(...e) {\n        this.handlers.forEach((o)=>o(...e));\n    }\n    numListeners() {\n        return this.handlers.size;\n    }\n    clear() {\n        this.handlers.clear();\n    }\n}, $adc7cb3c45508c7c$var$Ne = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"EventHandler\");\n    }\n    handlers = {};\n    on(e, o) {\n        return this.handlers[e] || (this.handlers[e] = new $adc7cb3c45508c7c$var$be), this.handlers[e].add(o);\n    }\n    onOnce(e, o) {\n        let c = this.on(e, (...g)=>{\n            c.cancel(), o(...g);\n        });\n        return c;\n    }\n    next(e) {\n        return new Promise((o)=>{\n            this.onOnce(e, (...c)=>o(c[0]));\n        });\n    }\n    trigger(e, ...o) {\n        this.handlers[e] && this.handlers[e].trigger(...o);\n    }\n    remove(e) {\n        delete this.handlers[e];\n    }\n    clear() {\n        this.handlers = {};\n    }\n    numListeners(e) {\n        return this.handlers[e]?.numListeners() ?? 0;\n    }\n};\nfunction $adc7cb3c45508c7c$var$Wt(n, e) {\n    if (n === e) return !0;\n    let o = typeof n, c = typeof e;\n    if (o !== c) return !1;\n    if (o === \"object\" && c === \"object\" && n !== null && e !== null) {\n        if (Array.isArray(n) !== Array.isArray(e)) return !1;\n        let g = Object.keys(n), m = Object.keys(e);\n        if (g.length !== m.length) return !1;\n        for (let P of g){\n            let I = n[P], j = e[P];\n            if (!$adc7cb3c45508c7c$var$Wt(I, j)) return !1;\n        }\n        return !0;\n    }\n    return !1;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Wt, \"deepEq\");\nfunction $adc7cb3c45508c7c$var$Si(n) {\n    let e = window.atob(n), o = e.length, c = new Uint8Array(o);\n    for(let g = 0; g < o; g++)c[g] = e.charCodeAt(g);\n    return c.buffer;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Si, \"base64ToArrayBuffer\");\nfunction $adc7cb3c45508c7c$var$Pr(n) {\n    return $adc7cb3c45508c7c$var$Si(n.split(\",\")[1]);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Pr, \"dataURLToArrayBuffer\");\nfunction $adc7cb3c45508c7c$var$Xt(n, e) {\n    let o = document.createElement(\"a\");\n    o.href = e, o.download = n, o.click();\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Xt, \"download\");\nfunction $adc7cb3c45508c7c$var$kn(n, e) {\n    $adc7cb3c45508c7c$var$Xt(n, \"data:text/plain;charset=utf-8,\" + e);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$kn, \"downloadText\");\nfunction $adc7cb3c45508c7c$var$Dr(n, e) {\n    $adc7cb3c45508c7c$var$kn(n, JSON.stringify(e));\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Dr, \"downloadJSON\");\nfunction $adc7cb3c45508c7c$var$Nn(n, e) {\n    let o = URL.createObjectURL(e);\n    $adc7cb3c45508c7c$var$Xt(n, o), URL.revokeObjectURL(o);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Nn, \"downloadBlob\");\nvar $adc7cb3c45508c7c$var$jn = $adc7cb3c45508c7c$var$i((n)=>n.match(/^data:\\w+\\/\\w+;base64,.+/), \"isDataURL\");\nvar $adc7cb3c45508c7c$var$Mr = $adc7cb3c45508c7c$var$i((n)=>n.split(\".\").slice(0, -1).join(\".\"), \"getFileName\");\nfunction $adc7cb3c45508c7c$var$Ee(n, e) {\n    return (...o)=>{\n        let c = o.length;\n        if (c === n.length) return n(...o);\n        if (c === e.length) return e(...o);\n    };\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Ee, \"overload2\");\nvar $adc7cb3c45508c7c$var$Gr = (()=>{\n    let n = 0;\n    return ()=>n++;\n})(), $adc7cb3c45508c7c$var$Br = $adc7cb3c45508c7c$var$i((n)=>n instanceof Error ? n.message : String(n), \"getErrorMessage\");\nvar $adc7cb3c45508c7c$var$Yt = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"BinaryHeap\");\n    }\n    _items;\n    _compareFn;\n    constructor(e = (o, c)=>o < c){\n        this._compareFn = e, this._items = [];\n    }\n    insert(e) {\n        this._items.push(e), this.moveUp(this._items.length - 1);\n    }\n    remove() {\n        if (this._items.length === 0) return null;\n        let e = this._items[0], o = this._items.pop();\n        return this._items.length !== 0 && (this._items[0] = o, this.moveDown(0)), e;\n    }\n    clear() {\n        this._items.splice(0, this._items.length);\n    }\n    moveUp(e) {\n        for(; e > 0;){\n            let o = Math.floor((e - 1) / 2);\n            if (!this._compareFn(this._items[e], this._items[o]) && this._items[e] >= this._items[o]) break;\n            this.swap(e, o), e = o;\n        }\n    }\n    moveDown(e) {\n        for(; e < Math.floor(this._items.length / 2);){\n            let o = 2 * e + 1;\n            if (o < this._items.length - 1 && !this._compareFn(this._items[o], this._items[o + 1]) && ++o, this._compareFn(this._items[e], this._items[o])) break;\n            this.swap(e, o), e = o;\n        }\n    }\n    swap(e, o) {\n        [this._items[e], this._items[o]] = [\n            this._items[o],\n            this._items[e]\n        ];\n    }\n    get length() {\n        return this._items.length;\n    }\n};\nvar $adc7cb3c45508c7c$var$Ci = Object.freeze([\n    776,\n    2359,\n    2367,\n    2984,\n    3007,\n    3021,\n    3633,\n    3635,\n    3648,\n    3657,\n    4352,\n    4449,\n    4520\n]);\nfunction $adc7cb3c45508c7c$var$Fr(n) {\n    if (typeof n != \"string\") throw new TypeError(\"string cannot be undefined or null\");\n    let e = [], o = 0, c = 0;\n    for(; o < n.length;){\n        if (c += $adc7cb3c45508c7c$var$Ai(o + c, n), $adc7cb3c45508c7c$var$Gi(n[o + c]) && c++, $adc7cb3c45508c7c$var$Pi(n[o + c]) && c++, $adc7cb3c45508c7c$var$Di(n[o + c]) && c++, $adc7cb3c45508c7c$var$Bi(n[o + c])) {\n            c++;\n            continue;\n        }\n        e.push(n.substring(o, o + c)), o += c, c = 0;\n    }\n    return e;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Fr, \"runes\");\nfunction $adc7cb3c45508c7c$var$Ai(n, e) {\n    let o = e[n];\n    if (!$adc7cb3c45508c7c$var$Ti(o) || n === e.length - 1) return 1;\n    let c = o + e[n + 1], g = e.substring(n + 2, n + 5);\n    return $adc7cb3c45508c7c$var$Rr(c) && $adc7cb3c45508c7c$var$Rr(g) ? 4 : $adc7cb3c45508c7c$var$Oi(c) && $adc7cb3c45508c7c$var$Mi(g) ? e.slice(n).indexOf(String.fromCodePoint(917631)) + 2 : $adc7cb3c45508c7c$var$Ri(g) ? 4 : 2;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Ai, \"nextUnits\");\nfunction $adc7cb3c45508c7c$var$Ti(n) {\n    return n && $adc7cb3c45508c7c$var$tt(n[0].charCodeAt(0), 55296, 56319);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Ti, \"isFirstOfSurrogatePair\");\nfunction $adc7cb3c45508c7c$var$Rr(n) {\n    return $adc7cb3c45508c7c$var$tt($adc7cb3c45508c7c$var$Hn(n), 127462, 127487);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Rr, \"isRegionalIndicator\");\nfunction $adc7cb3c45508c7c$var$Oi(n) {\n    return $adc7cb3c45508c7c$var$tt($adc7cb3c45508c7c$var$Hn(n), 127988, 127988);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Oi, \"isSubdivisionFlag\");\nfunction $adc7cb3c45508c7c$var$Ri(n) {\n    return $adc7cb3c45508c7c$var$tt($adc7cb3c45508c7c$var$Hn(n), 127995, 127999);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Ri, \"isFitzpatrickModifier\");\nfunction $adc7cb3c45508c7c$var$Pi(n) {\n    return typeof n == \"string\" && $adc7cb3c45508c7c$var$tt(n.charCodeAt(0), 65024, 65039);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Pi, \"isVariationSelector\");\nfunction $adc7cb3c45508c7c$var$Di(n) {\n    return typeof n == \"string\" && $adc7cb3c45508c7c$var$tt(n.charCodeAt(0), 8400, 8447);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Di, \"isDiacriticalMark\");\nfunction $adc7cb3c45508c7c$var$Mi(n) {\n    let e = n.codePointAt(0);\n    return typeof n == \"string\" && typeof e == \"number\" && $adc7cb3c45508c7c$var$tt(e, 917504, 917631);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Mi, \"isSupplementarySpecialpurposePlane\");\nfunction $adc7cb3c45508c7c$var$Gi(n) {\n    return typeof n == \"string\" && $adc7cb3c45508c7c$var$Ci.includes(n.charCodeAt(0));\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Gi, \"isGrapheme\");\nfunction $adc7cb3c45508c7c$var$Bi(n) {\n    return typeof n == \"string\" && n.charCodeAt(0) === 8205;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Bi, \"isZeroWidthJoiner\");\nfunction $adc7cb3c45508c7c$var$Hn(n) {\n    let e = n.charCodeAt(0) - 55296, o = n.charCodeAt(1) - 56320;\n    return (e << 10) + o + 65536;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Hn, \"codePointFromSurrogatePair\");\nfunction $adc7cb3c45508c7c$var$tt(n, e, o) {\n    return n >= e && n <= o;\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$tt, \"betweenInclusive\");\nvar $adc7cb3c45508c7c$var$qn = {\n    \"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)\": {\n        buttons: {\n            \"0\": \"south\",\n            \"1\": \"east\",\n            \"2\": \"west\",\n            \"3\": \"north\",\n            \"4\": \"lshoulder\",\n            \"5\": \"rshoulder\",\n            \"6\": \"ltrigger\",\n            \"7\": \"rtrigger\",\n            \"8\": \"select\",\n            \"9\": \"start\",\n            \"10\": \"lstick\",\n            \"11\": \"rstick\",\n            \"12\": \"dpad-up\",\n            \"13\": \"dpad-down\",\n            \"14\": \"dpad-left\",\n            \"15\": \"dpad-right\",\n            \"16\": \"home\",\n            \"17\": \"capture\"\n        },\n        sticks: {\n            left: {\n                x: 0,\n                y: 1\n            },\n            right: {\n                x: 2,\n                y: 3\n            }\n        }\n    },\n    \"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)\": {\n        buttons: {\n            \"0\": \"south\",\n            \"1\": \"east\",\n            \"2\": \"west\",\n            \"3\": \"north\",\n            \"4\": \"lshoulder\",\n            \"5\": \"rshoulder\",\n            \"9\": \"select\",\n            \"10\": \"lstick\",\n            \"16\": \"start\"\n        },\n        sticks: {\n            left: {\n                x: 0,\n                y: 1\n            }\n        }\n    },\n    \"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)\": {\n        buttons: {\n            \"0\": \"south\",\n            \"1\": \"east\",\n            \"2\": \"west\",\n            \"3\": \"north\",\n            \"4\": \"lshoulder\",\n            \"5\": \"rshoulder\",\n            \"9\": \"start\",\n            \"10\": \"lstick\",\n            \"16\": \"select\"\n        },\n        sticks: {\n            left: {\n                x: 0,\n                y: 1\n            }\n        }\n    },\n    \"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)\": {\n        buttons: {\n            \"0\": \"south\",\n            \"1\": \"east\",\n            \"2\": \"west\",\n            \"3\": \"north\",\n            \"4\": \"lshoulder\",\n            \"5\": \"rshoulder\",\n            \"6\": \"ltrigger\",\n            \"7\": \"rtrigger\",\n            \"8\": \"select\",\n            \"9\": \"start\",\n            \"10\": \"lstick\",\n            \"11\": \"rstick\",\n            \"12\": \"dpad-up\",\n            \"13\": \"dpad-down\",\n            \"14\": \"dpad-left\",\n            \"15\": \"dpad-right\",\n            \"16\": \"home\",\n            \"17\": \"capture\"\n        },\n        sticks: {\n            left: {\n                x: 0,\n                y: 1\n            },\n            right: {\n                x: 2,\n                y: 3\n            }\n        }\n    },\n    default: {\n        buttons: {\n            \"0\": \"south\",\n            \"1\": \"east\",\n            \"2\": \"west\",\n            \"3\": \"north\",\n            \"4\": \"lshoulder\",\n            \"5\": \"rshoulder\",\n            \"6\": \"ltrigger\",\n            \"7\": \"rtrigger\",\n            \"8\": \"select\",\n            \"9\": \"start\",\n            \"10\": \"lstick\",\n            \"11\": \"rstick\",\n            \"12\": \"dpad-up\",\n            \"13\": \"dpad-down\",\n            \"14\": \"dpad-left\",\n            \"15\": \"dpad-right\",\n            \"16\": \"home\"\n        },\n        sticks: {\n            left: {\n                x: 0,\n                y: 1\n            },\n            right: {\n                x: 2,\n                y: 3\n            }\n        }\n    }\n};\nvar $adc7cb3c45508c7c$var$at = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"ButtonState\");\n    }\n    pressed = new Set([]);\n    pressedRepeat = new Set([]);\n    released = new Set([]);\n    down = new Set([]);\n    update() {\n        this.pressed.clear(), this.released.clear(), this.pressedRepeat.clear();\n    }\n    press(e) {\n        this.pressed.add(e), this.pressedRepeat.add(e), this.down.add(e);\n    }\n    pressRepeat(e) {\n        this.pressedRepeat.add(e);\n    }\n    release(e) {\n        this.down.delete(e), this.pressed.delete(e), this.released.add(e);\n    }\n}, $adc7cb3c45508c7c$var$$n = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"GamepadState\");\n    }\n    buttonState = new $adc7cb3c45508c7c$var$at;\n    stickState = new Map;\n}, $adc7cb3c45508c7c$var$zn = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"FPSCounter\");\n    }\n    dts = [];\n    timer = 0;\n    fps = 0;\n    tick(e) {\n        this.dts.push(e), this.timer += e, this.timer >= 1 && (this.timer = 0, this.fps = Math.round(1 / (this.dts.reduce((o, c)=>o + c) / this.dts.length)), this.dts = []);\n    }\n}, $adc7cb3c45508c7c$var$Ir = $adc7cb3c45508c7c$var$i((n)=>{\n    if (!n.canvas) throw new Error(\"Please provide a canvas\");\n    let e = {\n        canvas: n.canvas,\n        loopID: null,\n        stopped: !1,\n        dt: 0,\n        time: 0,\n        realTime: 0,\n        fpsCounter: new $adc7cb3c45508c7c$var$zn,\n        timeScale: 1,\n        skipTime: !1,\n        numFrames: 0,\n        mousePos: new $adc7cb3c45508c7c$var$v(0),\n        mouseDeltaPos: new $adc7cb3c45508c7c$var$v(0),\n        keyState: new $adc7cb3c45508c7c$var$at,\n        mouseState: new $adc7cb3c45508c7c$var$at,\n        mergedGamepadState: new $adc7cb3c45508c7c$var$$n,\n        gamepadStates: new Map,\n        gamepads: [],\n        charInputted: [],\n        isMouseMoved: !1,\n        lastWidth: n.canvas.offsetWidth,\n        lastHeight: n.canvas.offsetHeight,\n        events: new $adc7cb3c45508c7c$var$Ne\n    };\n    function o() {\n        return e.dt * e.timeScale;\n    }\n    $adc7cb3c45508c7c$var$i(o, \"dt\");\n    function c() {\n        return e.time;\n    }\n    $adc7cb3c45508c7c$var$i(c, \"time\");\n    function g() {\n        return e.fpsCounter.fps;\n    }\n    $adc7cb3c45508c7c$var$i(g, \"fps\");\n    function m() {\n        return e.numFrames;\n    }\n    $adc7cb3c45508c7c$var$i(m, \"numFrames\");\n    function P() {\n        return e.canvas.toDataURL();\n    }\n    $adc7cb3c45508c7c$var$i(P, \"screenshot\");\n    function I(l) {\n        e.canvas.style.cursor = l;\n    }\n    $adc7cb3c45508c7c$var$i(I, \"setCursor\");\n    function j() {\n        return e.canvas.style.cursor;\n    }\n    $adc7cb3c45508c7c$var$i(j, \"getCursor\");\n    function y(l) {\n        if (l) try {\n            let x = e.canvas.requestPointerLock();\n            x.catch && x.catch((R)=>console.error(R));\n        } catch (x) {\n            console.error(x);\n        }\n        else document.exitPointerLock();\n    }\n    $adc7cb3c45508c7c$var$i(y, \"setCursorLocked\");\n    function X() {\n        return !!document.pointerLockElement;\n    }\n    $adc7cb3c45508c7c$var$i(X, \"isCursorLocked\");\n    function S(l) {\n        l.requestFullscreen ? l.requestFullscreen() : l.webkitRequestFullscreen && l.webkitRequestFullscreen();\n    }\n    $adc7cb3c45508c7c$var$i(S, \"enterFullscreen\");\n    function q() {\n        document.exitFullscreen ? document.exitFullscreen() : document.webkitExitFullScreen && document.webkitExitFullScreen();\n    }\n    $adc7cb3c45508c7c$var$i(q, \"exitFullscreen\");\n    function E() {\n        return document.fullscreenElement || document.webkitFullscreenElement;\n    }\n    $adc7cb3c45508c7c$var$i(E, \"getFullscreenElement\");\n    function K(l = !0) {\n        l ? S(e.canvas) : q();\n    }\n    $adc7cb3c45508c7c$var$i(K, \"setFullscreen\");\n    function Q() {\n        return !!E();\n    }\n    $adc7cb3c45508c7c$var$i(Q, \"isFullscreen\");\n    function te() {\n        e.stopped = !0;\n        for(let l in se)e.canvas.removeEventListener(l, se[l]);\n        for(let l in le)document.removeEventListener(l, le[l]);\n        for(let l in ae)window.removeEventListener(l, ae[l]);\n        ge.disconnect();\n    }\n    $adc7cb3c45508c7c$var$i(te, \"quit\");\n    function k(l) {\n        e.loopID !== null && cancelAnimationFrame(e.loopID);\n        let x = 0, R = $adc7cb3c45508c7c$var$i((L)=>{\n            if (e.stopped) return;\n            if (document.visibilityState !== \"visible\") {\n                e.loopID = requestAnimationFrame(R);\n                return;\n            }\n            let he = L / 1e3, z = he - e.realTime, Oe = n.maxFPS ? 1 / n.maxFPS : 0;\n            e.realTime = he, x += z, x > Oe && (e.skipTime || (e.dt = x, e.time += o(), e.fpsCounter.tick(e.dt)), x = 0, e.skipTime = !1, e.numFrames++, ft(), l(), vn()), e.loopID = requestAnimationFrame(R);\n        }, \"frame\");\n        R(0);\n    }\n    $adc7cb3c45508c7c$var$i(k, \"run\");\n    function pe() {\n        return \"ontouchstart\" in window || navigator.maxTouchPoints > 0;\n    }\n    $adc7cb3c45508c7c$var$i(pe, \"isTouchscreen\");\n    function C() {\n        return e.mousePos.clone();\n    }\n    $adc7cb3c45508c7c$var$i(C, \"mousePos\");\n    function Ae() {\n        return e.mouseDeltaPos.clone();\n    }\n    $adc7cb3c45508c7c$var$i(Ae, \"mouseDeltaPos\");\n    function $(l = \"left\") {\n        return e.mouseState.pressed.has(l);\n    }\n    $adc7cb3c45508c7c$var$i($, \"isMousePressed\");\n    function Te(l = \"left\") {\n        return e.mouseState.down.has(l);\n    }\n    $adc7cb3c45508c7c$var$i(Te, \"isMouseDown\");\n    function ye(l = \"left\") {\n        return e.mouseState.released.has(l);\n    }\n    $adc7cb3c45508c7c$var$i(ye, \"isMouseReleased\");\n    function Se() {\n        return e.isMouseMoved;\n    }\n    $adc7cb3c45508c7c$var$i(Se, \"isMouseMoved\");\n    function st(l) {\n        return l === void 0 ? e.keyState.pressed.size > 0 : e.keyState.pressed.has(l);\n    }\n    $adc7cb3c45508c7c$var$i(st, \"isKeyPressed\");\n    function on(l) {\n        return l === void 0 ? e.keyState.pressedRepeat.size > 0 : e.keyState.pressedRepeat.has(l);\n    }\n    $adc7cb3c45508c7c$var$i(on, \"isKeyPressedRepeat\");\n    function Tt(l) {\n        return l === void 0 ? e.keyState.down.size > 0 : e.keyState.down.has(l);\n    }\n    $adc7cb3c45508c7c$var$i(Tt, \"isKeyDown\");\n    function Ot(l) {\n        return l === void 0 ? e.keyState.released.size > 0 : e.keyState.released.has(l);\n    }\n    $adc7cb3c45508c7c$var$i(Ot, \"isKeyReleased\");\n    function Rt(l) {\n        return l === void 0 ? e.mergedGamepadState.buttonState.pressed.size > 0 : e.mergedGamepadState.buttonState.pressed.has(l);\n    }\n    $adc7cb3c45508c7c$var$i(Rt, \"isGamepadButtonPressed\");\n    function Ye(l) {\n        return l === void 0 ? e.mergedGamepadState.buttonState.down.size > 0 : e.mergedGamepadState.buttonState.down.has(l);\n    }\n    $adc7cb3c45508c7c$var$i(Ye, \"isGamepadButtonDown\");\n    function an(l) {\n        return l === void 0 ? e.mergedGamepadState.buttonState.released.size > 0 : e.mergedGamepadState.buttonState.released.has(l);\n    }\n    $adc7cb3c45508c7c$var$i(an, \"isGamepadButtonReleased\");\n    function un(l) {\n        return e.events.on(\"resize\", l);\n    }\n    $adc7cb3c45508c7c$var$i(un, \"onResize\");\n    let cn = $adc7cb3c45508c7c$var$Ee((l)=>e.events.on(\"keyDown\", l), (l, x)=>e.events.on(\"keyDown\", (R)=>R === l && x(l))), hn = $adc7cb3c45508c7c$var$Ee((l)=>e.events.on(\"keyPress\", l), (l, x)=>e.events.on(\"keyPress\", (R)=>R === l && x(l))), ln = $adc7cb3c45508c7c$var$Ee((l)=>e.events.on(\"keyPressRepeat\", l), (l, x)=>e.events.on(\"keyPressRepeat\", (R)=>R === l && x(l))), dn = $adc7cb3c45508c7c$var$Ee((l)=>e.events.on(\"keyRelease\", l), (l, x)=>e.events.on(\"keyRelease\", (R)=>R === l && x(l))), Pt = $adc7cb3c45508c7c$var$Ee((l)=>e.events.on(\"mouseDown\", (x)=>l(x)), (l, x)=>e.events.on(\"mouseDown\", (R)=>R === l && x(R))), Dt = $adc7cb3c45508c7c$var$Ee((l)=>e.events.on(\"mousePress\", (x)=>l(x)), (l, x)=>e.events.on(\"mousePress\", (R)=>R === l && x(R))), Mt = $adc7cb3c45508c7c$var$Ee((l)=>e.events.on(\"mouseRelease\", (x)=>l(x)), (l, x)=>e.events.on(\"mouseRelease\", (R)=>R === l && x(R)));\n    function Gt(l) {\n        return e.events.on(\"mouseMove\", ()=>l(C(), Ae()));\n    }\n    $adc7cb3c45508c7c$var$i(Gt, \"onMouseMove\");\n    function Bt(l) {\n        return e.events.on(\"charInput\", l);\n    }\n    $adc7cb3c45508c7c$var$i(Bt, \"onCharInput\");\n    function fn(l) {\n        return e.events.on(\"touchStart\", l);\n    }\n    $adc7cb3c45508c7c$var$i(fn, \"onTouchStart\");\n    function ct(l) {\n        return e.events.on(\"touchMove\", l);\n    }\n    $adc7cb3c45508c7c$var$i(ct, \"onTouchMove\");\n    function mn(l) {\n        return e.events.on(\"touchEnd\", l);\n    }\n    $adc7cb3c45508c7c$var$i(mn, \"onTouchEnd\");\n    function pn(l) {\n        return e.events.on(\"scroll\", l);\n    }\n    $adc7cb3c45508c7c$var$i(pn, \"onScroll\");\n    function Ft(l) {\n        return e.events.on(\"hide\", l);\n    }\n    $adc7cb3c45508c7c$var$i(Ft, \"onHide\");\n    function gn(l) {\n        return e.events.on(\"show\", l);\n    }\n    $adc7cb3c45508c7c$var$i(gn, \"onShow\");\n    function It(l, x) {\n        if (typeof l == \"function\") return e.events.on(\"gamepadButtonDown\", l);\n        if (typeof l == \"string\" && typeof x == \"function\") return e.events.on(\"gamepadButtonDown\", (R)=>R === l && x(l));\n    }\n    $adc7cb3c45508c7c$var$i(It, \"onGamepadButtonDown\");\n    function Lt(l, x) {\n        if (typeof l == \"function\") return e.events.on(\"gamepadButtonPress\", l);\n        if (typeof l == \"string\" && typeof x == \"function\") return e.events.on(\"gamepadButtonPress\", (R)=>R === l && x(l));\n    }\n    $adc7cb3c45508c7c$var$i(Lt, \"onGamepadButtonPress\");\n    function wn(l, x) {\n        if (typeof l == \"function\") return e.events.on(\"gamepadButtonRelease\", l);\n        if (typeof l == \"string\" && typeof x == \"function\") return e.events.on(\"gamepadButtonRelease\", (R)=>R === l && x(l));\n    }\n    $adc7cb3c45508c7c$var$i(wn, \"onGamepadButtonRelease\");\n    function ht(l, x) {\n        return e.events.on(\"gamepadStick\", (R, L)=>R === l && x(L));\n    }\n    $adc7cb3c45508c7c$var$i(ht, \"onGamepadStick\");\n    function bn(l) {\n        e.events.on(\"gamepadConnect\", l);\n    }\n    $adc7cb3c45508c7c$var$i(bn, \"onGamepadConnect\");\n    function lt(l) {\n        e.events.on(\"gamepadDisconnect\", l);\n    }\n    $adc7cb3c45508c7c$var$i(lt, \"onGamepadDisconnect\");\n    function Pe(l) {\n        return e.mergedGamepadState.stickState.get(l) || new $adc7cb3c45508c7c$var$v(0);\n    }\n    $adc7cb3c45508c7c$var$i(Pe, \"getGamepadStick\");\n    function dt() {\n        return [\n            ...e.charInputted\n        ];\n    }\n    $adc7cb3c45508c7c$var$i(dt, \"charInputted\");\n    function Vt() {\n        return [\n            ...e.gamepads\n        ];\n    }\n    $adc7cb3c45508c7c$var$i(Vt, \"getGamepads\");\n    function ft() {\n        e.events.trigger(\"input\"), e.keyState.down.forEach((l)=>e.events.trigger(\"keyDown\", l)), e.mouseState.down.forEach((l)=>e.events.trigger(\"mouseDown\", l)), He();\n    }\n    $adc7cb3c45508c7c$var$i(ft, \"processInput\");\n    function vn() {\n        e.keyState.update(), e.mouseState.update(), e.mergedGamepadState.buttonState.update(), e.mergedGamepadState.stickState.forEach((l, x)=>{\n            e.mergedGamepadState.stickState.set(x, new $adc7cb3c45508c7c$var$v(0));\n        }), e.charInputted = [], e.isMouseMoved = !1, e.gamepadStates.forEach((l)=>{\n            l.buttonState.update(), l.stickState.forEach((x, R)=>{\n                l.stickState.set(R, new $adc7cb3c45508c7c$var$v(0));\n            });\n        });\n    }\n    $adc7cb3c45508c7c$var$i(vn, \"resetInput\");\n    function _t(l) {\n        let x = {\n            index: l.index,\n            isPressed: (R)=>e.gamepadStates.get(l.index).buttonState.pressed.has(R),\n            isDown: (R)=>e.gamepadStates.get(l.index).buttonState.down.has(R),\n            isReleased: (R)=>e.gamepadStates.get(l.index).buttonState.released.has(R),\n            getStick: (R)=>e.gamepadStates.get(l.index).stickState.get(R)\n        };\n        return e.gamepads.push(x), e.gamepadStates.set(l.index, {\n            buttonState: new $adc7cb3c45508c7c$var$at,\n            stickState: new Map([\n                [\n                    \"left\",\n                    new $adc7cb3c45508c7c$var$v(0)\n                ],\n                [\n                    \"right\",\n                    new $adc7cb3c45508c7c$var$v(0)\n                ]\n            ])\n        }), x;\n    }\n    $adc7cb3c45508c7c$var$i(_t, \"registerGamepad\");\n    function ne(l) {\n        e.gamepads = e.gamepads.filter((x)=>x.index !== l.index), e.gamepadStates.delete(l.index);\n    }\n    $adc7cb3c45508c7c$var$i(ne, \"removeGamepad\");\n    function He() {\n        for (let l of navigator.getGamepads())l && !e.gamepadStates.has(l.index) && _t(l);\n        for (let l of e.gamepads){\n            let x = navigator.getGamepads()[l.index], L = (n.gamepads ?? {})[x.id] ?? $adc7cb3c45508c7c$var$qn[x.id] ?? $adc7cb3c45508c7c$var$qn.default, he = e.gamepadStates.get(l.index);\n            for(let z = 0; z < x.buttons.length; z++)x.buttons[z].pressed ? (he.buttonState.down.has(L.buttons[z]) || (e.mergedGamepadState.buttonState.press(L.buttons[z]), he.buttonState.press(L.buttons[z]), e.events.trigger(\"gamepadButtonPress\", L.buttons[z])), e.events.trigger(\"gamepadButtonDown\", L.buttons[z])) : he.buttonState.down.has(L.buttons[z]) && (e.mergedGamepadState.buttonState.release(L.buttons[z]), he.buttonState.release(L.buttons[z]), e.events.trigger(\"gamepadButtonRelease\", L.buttons[z]));\n            for(let z in L.sticks){\n                let Oe = L.sticks[z], $e = new $adc7cb3c45508c7c$var$v(x.axes[Oe.x], x.axes[Oe.y]);\n                he.stickState.set(z, $e), e.mergedGamepadState.stickState.set(z, $e), e.events.trigger(\"gamepadStick\", z, $e);\n            }\n        }\n    }\n    $adc7cb3c45508c7c$var$i(He, \"processGamepad\");\n    let se = {}, le = {}, ae = {}, Be = n.pixelDensity || window.devicePixelRatio || 1;\n    se.mousemove = (l)=>{\n        let x = new $adc7cb3c45508c7c$var$v(l.offsetX, l.offsetY), R = new $adc7cb3c45508c7c$var$v(l.movementX, l.movementY);\n        if (Q()) {\n            let L = e.canvas.width / Be, he = e.canvas.height / Be, z = window.innerWidth, Oe = window.innerHeight, $e = z / Oe, kt = L / he;\n            if ($e > kt) {\n                let De = Oe / he, Ce = (z - L * De) / 2;\n                x.x = $adc7cb3c45508c7c$var$_e(l.offsetX - Ce, 0, L * De, 0, L), x.y = $adc7cb3c45508c7c$var$_e(l.offsetY, 0, he * De, 0, he);\n            } else {\n                let De = z / L, Ce = (Oe - he * De) / 2;\n                x.x = $adc7cb3c45508c7c$var$_e(l.offsetX, 0, L * De, 0, L), x.y = $adc7cb3c45508c7c$var$_e(l.offsetY - Ce, 0, he * De, 0, he);\n            }\n        }\n        e.events.onOnce(\"input\", ()=>{\n            e.isMouseMoved = !0, e.mousePos = x, e.mouseDeltaPos = R, e.events.trigger(\"mouseMove\");\n        });\n    };\n    let We = [\n        \"left\",\n        \"middle\",\n        \"right\",\n        \"back\",\n        \"forward\"\n    ];\n    se.mousedown = (l)=>{\n        e.events.onOnce(\"input\", ()=>{\n            let x = We[l.button];\n            x && (e.mouseState.press(x), e.events.trigger(\"mousePress\", x));\n        });\n    }, se.mouseup = (l)=>{\n        e.events.onOnce(\"input\", ()=>{\n            let x = We[l.button];\n            x && (e.mouseState.release(x), e.events.trigger(\"mouseRelease\", x));\n        });\n    };\n    let yn = new Set([\n        \" \",\n        \"ArrowLeft\",\n        \"ArrowRight\",\n        \"ArrowUp\",\n        \"ArrowDown\",\n        \"Tab\"\n    ]), qe = {\n        ArrowLeft: \"left\",\n        ArrowRight: \"right\",\n        ArrowUp: \"up\",\n        ArrowDown: \"down\",\n        \" \": \"space\"\n    };\n    se.keydown = (l)=>{\n        yn.has(l.key) && l.preventDefault(), e.events.onOnce(\"input\", ()=>{\n            let x = qe[l.key] || l.key.toLowerCase();\n            x.length === 1 ? (e.events.trigger(\"charInput\", x), e.charInputted.push(x)) : x === \"space\" && (e.events.trigger(\"charInput\", \" \"), e.charInputted.push(\" \")), l.repeat ? (e.keyState.pressRepeat(x), e.events.trigger(\"keyPressRepeat\", x)) : (e.keyState.press(x), e.events.trigger(\"keyPressRepeat\", x), e.events.trigger(\"keyPress\", x));\n        });\n    }, se.keyup = (l)=>{\n        e.events.onOnce(\"input\", ()=>{\n            let x = qe[l.key] || l.key.toLowerCase();\n            e.keyState.release(x), e.events.trigger(\"keyRelease\", x);\n        });\n    }, se.touchstart = (l)=>{\n        l.preventDefault(), e.events.onOnce(\"input\", ()=>{\n            let x = [\n                ...l.changedTouches\n            ], R = e.canvas.getBoundingClientRect();\n            n.touchToMouse !== !1 && (e.mousePos = new $adc7cb3c45508c7c$var$v(x[0].clientX - R.x, x[0].clientY - R.y), e.mouseState.press(\"left\"), e.events.trigger(\"mousePress\", \"left\")), x.forEach((L)=>{\n                e.events.trigger(\"touchStart\", new $adc7cb3c45508c7c$var$v(L.clientX - R.x, L.clientY - R.y), L);\n            });\n        });\n    }, se.touchmove = (l)=>{\n        l.preventDefault(), e.events.onOnce(\"input\", ()=>{\n            let x = [\n                ...l.changedTouches\n            ], R = e.canvas.getBoundingClientRect();\n            n.touchToMouse !== !1 && (e.mousePos = new $adc7cb3c45508c7c$var$v(x[0].clientX - R.x, x[0].clientY - R.y), e.events.trigger(\"mouseMove\")), x.forEach((L)=>{\n                e.events.trigger(\"touchMove\", new $adc7cb3c45508c7c$var$v(L.clientX - R.x, L.clientY - R.y), L);\n            });\n        });\n    }, se.touchend = (l)=>{\n        e.events.onOnce(\"input\", ()=>{\n            let x = [\n                ...l.changedTouches\n            ], R = e.canvas.getBoundingClientRect();\n            n.touchToMouse !== !1 && (e.mousePos = new $adc7cb3c45508c7c$var$v(x[0].clientX - R.x, x[0].clientY - R.y), e.mouseState.release(\"left\"), e.events.trigger(\"mouseRelease\", \"left\")), x.forEach((L)=>{\n                e.events.trigger(\"touchEnd\", new $adc7cb3c45508c7c$var$v(L.clientX - R.x, L.clientY - R.y), L);\n            });\n        });\n    }, se.touchcancel = (l)=>{\n        e.events.onOnce(\"input\", ()=>{\n            let x = [\n                ...l.changedTouches\n            ], R = e.canvas.getBoundingClientRect();\n            n.touchToMouse !== !1 && (e.mousePos = new $adc7cb3c45508c7c$var$v(x[0].clientX - R.x, x[0].clientY - R.y), e.mouseState.release(\"left\"), e.events.trigger(\"mouseRelease\", \"left\")), x.forEach((L)=>{\n                e.events.trigger(\"touchEnd\", new $adc7cb3c45508c7c$var$v(L.clientX - R.x, L.clientY - R.y), L);\n            });\n        });\n    }, se.wheel = (l)=>{\n        l.preventDefault(), e.events.onOnce(\"input\", ()=>{\n            e.events.trigger(\"scroll\", new $adc7cb3c45508c7c$var$v(l.deltaX, l.deltaY));\n        });\n    }, se.contextmenu = (l)=>l.preventDefault(), le.visibilitychange = ()=>{\n        document.visibilityState === \"visible\" ? (e.skipTime = !0, e.events.trigger(\"show\")) : e.events.trigger(\"hide\");\n    }, ae.gamepadconnected = (l)=>{\n        let x = _t(l.gamepad);\n        e.events.onOnce(\"input\", ()=>{\n            e.events.trigger(\"gamepadConnect\", x);\n        });\n    }, ae.gamepaddisconnected = (l)=>{\n        let x = Vt().filter((R)=>R.index === l.gamepad.index)[0];\n        ne(l.gamepad), e.events.onOnce(\"input\", ()=>{\n            e.events.trigger(\"gamepadDisconnect\", x);\n        });\n    };\n    for(let l in se)e.canvas.addEventListener(l, se[l]);\n    for(let l in le)document.addEventListener(l, le[l]);\n    for(let l in ae)window.addEventListener(l, ae[l]);\n    let ge = new ResizeObserver((l)=>{\n        for (let x of l)if (x.target === e.canvas) {\n            if (e.lastWidth === e.canvas.offsetWidth && e.lastHeight === e.canvas.offsetHeight) return;\n            e.lastWidth = e.canvas.offsetWidth, e.lastHeight = e.canvas.offsetHeight, e.events.onOnce(\"input\", ()=>{\n                e.events.trigger(\"resize\");\n            });\n        }\n    });\n    return ge.observe(e.canvas), {\n        dt: o,\n        time: c,\n        run: k,\n        canvas: e.canvas,\n        fps: g,\n        numFrames: m,\n        quit: te,\n        setFullscreen: K,\n        isFullscreen: Q,\n        setCursor: I,\n        screenshot: P,\n        getGamepads: Vt,\n        getCursor: j,\n        setCursorLocked: y,\n        isCursorLocked: X,\n        isTouchscreen: pe,\n        mousePos: C,\n        mouseDeltaPos: Ae,\n        isKeyDown: Tt,\n        isKeyPressed: st,\n        isKeyPressedRepeat: on,\n        isKeyReleased: Ot,\n        isMouseDown: Te,\n        isMousePressed: $,\n        isMouseReleased: ye,\n        isMouseMoved: Se,\n        isGamepadButtonPressed: Rt,\n        isGamepadButtonDown: Ye,\n        isGamepadButtonReleased: an,\n        getGamepadStick: Pe,\n        charInputted: dt,\n        onResize: un,\n        onKeyDown: cn,\n        onKeyPress: hn,\n        onKeyPressRepeat: ln,\n        onKeyRelease: dn,\n        onMouseDown: Pt,\n        onMousePress: Dt,\n        onMouseRelease: Mt,\n        onMouseMove: Gt,\n        onCharInput: Bt,\n        onTouchStart: fn,\n        onTouchMove: ct,\n        onTouchEnd: mn,\n        onScroll: pn,\n        onHide: Ft,\n        onShow: gn,\n        onGamepadButtonDown: It,\n        onGamepadButtonPress: Lt,\n        onGamepadButtonRelease: wn,\n        onGamepadStick: ht,\n        onGamepadConnect: bn,\n        onGamepadDisconnect: lt,\n        events: e.events\n    };\n}, \"default\");\nvar $adc7cb3c45508c7c$var$Re = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Texture\");\n    }\n    ctx;\n    src = null;\n    glTex;\n    width;\n    height;\n    constructor(e, o, c, g = {}){\n        this.ctx = e;\n        let m = e.gl;\n        this.glTex = e.gl.createTexture(), e.onDestroy(()=>this.free()), this.width = o, this.height = c;\n        let P = {\n            linear: m.LINEAR,\n            nearest: m.NEAREST\n        }[g.filter ?? e.opts.texFilter] ?? m.NEAREST, I = {\n            repeat: m.REPEAT,\n            clampToEadge: m.CLAMP_TO_EDGE\n        }[g.wrap] ?? m.CLAMP_TO_EDGE;\n        this.bind(), o && c && m.texImage2D(m.TEXTURE_2D, 0, m.RGBA, o, c, 0, m.RGBA, m.UNSIGNED_BYTE, null), m.texParameteri(m.TEXTURE_2D, m.TEXTURE_MIN_FILTER, P), m.texParameteri(m.TEXTURE_2D, m.TEXTURE_MAG_FILTER, P), m.texParameteri(m.TEXTURE_2D, m.TEXTURE_WRAP_S, I), m.texParameteri(m.TEXTURE_2D, m.TEXTURE_WRAP_T, I), this.unbind();\n    }\n    static fromImage(e, o, c = {}) {\n        let g = new n(e, o.width, o.height, c);\n        return g.update(o), g.src = o, g;\n    }\n    update(e, o = 0, c = 0) {\n        let g = this.ctx.gl;\n        this.bind(), g.texSubImage2D(g.TEXTURE_2D, 0, o, c, g.RGBA, g.UNSIGNED_BYTE, e), this.unbind();\n    }\n    bind() {\n        this.ctx.pushTexture2D(this.glTex);\n    }\n    unbind() {\n        this.ctx.popTexture2D();\n    }\n    free() {\n        this.ctx.gl.deleteTexture(this.glTex);\n    }\n}, $adc7cb3c45508c7c$var$rt = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"FrameBuffer\");\n    }\n    ctx;\n    tex;\n    glFramebuffer;\n    glRenderbuffer;\n    constructor(e, o, c, g = {}){\n        this.ctx = e;\n        let m = e.gl;\n        e.onDestroy(()=>this.free()), this.tex = new $adc7cb3c45508c7c$var$Re(e, o, c, g), this.glFramebuffer = m.createFramebuffer(), this.glRenderbuffer = m.createRenderbuffer(), this.bind(), m.renderbufferStorage(m.RENDERBUFFER, m.DEPTH_STENCIL, o, c), m.framebufferTexture2D(m.FRAMEBUFFER, m.COLOR_ATTACHMENT0, m.TEXTURE_2D, this.tex.glTex, 0), m.framebufferRenderbuffer(m.FRAMEBUFFER, m.DEPTH_STENCIL_ATTACHMENT, m.RENDERBUFFER, this.glRenderbuffer), this.unbind();\n    }\n    get width() {\n        return this.tex.width;\n    }\n    get height() {\n        return this.tex.height;\n    }\n    toImageData() {\n        let e = this.ctx.gl, o = new Uint8ClampedArray(this.width * this.height * 4);\n        this.bind(), e.readPixels(0, 0, this.width, this.height, e.RGBA, e.UNSIGNED_BYTE, o), this.unbind();\n        let c = this.width * 4, g = new Uint8Array(c);\n        for(let m = 0; m < (this.height / 2 | 0); m++){\n            let P = m * c, I = (this.height - m - 1) * c;\n            g.set(o.subarray(P, P + c)), o.copyWithin(P, I, I + c), o.set(g, I);\n        }\n        return new ImageData(o, this.width, this.height);\n    }\n    toDataURL() {\n        let e = document.createElement(\"canvas\"), o = e.getContext(\"2d\");\n        return e.width = this.width, e.height = this.height, o.putImageData(this.toImageData(), 0, 0), e.toDataURL();\n    }\n    draw(e) {\n        this.bind(), e(), this.unbind();\n    }\n    bind() {\n        this.ctx.pushFramebuffer(this.glFramebuffer), this.ctx.pushRenderbuffer(this.glRenderbuffer), this.ctx.pushViewport({\n            x: 0,\n            y: 0,\n            w: this.width,\n            h: this.height\n        });\n    }\n    unbind() {\n        this.ctx.popFramebuffer(), this.ctx.popRenderbuffer(), this.ctx.popViewport();\n    }\n    free() {\n        let e = this.ctx.gl;\n        e.deleteFramebuffer(this.glFramebuffer), e.deleteRenderbuffer(this.glRenderbuffer), this.tex.free();\n    }\n}, $adc7cb3c45508c7c$var$Jt = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Shader\");\n    }\n    ctx;\n    glProgram;\n    constructor(e, o, c, g){\n        this.ctx = e, e.onDestroy(()=>this.free());\n        let m = e.gl, P = m.createShader(m.VERTEX_SHADER), I = m.createShader(m.FRAGMENT_SHADER);\n        m.shaderSource(P, o), m.shaderSource(I, c), m.compileShader(P), m.compileShader(I);\n        let j = m.createProgram();\n        if (this.glProgram = j, m.attachShader(j, P), m.attachShader(j, I), g.forEach((y, X)=>m.bindAttribLocation(j, X, y)), m.linkProgram(j), !m.getProgramParameter(j, m.LINK_STATUS)) {\n            let y = m.getShaderInfoLog(P);\n            if (y) throw new Error(\"VERTEX SHADER \" + y);\n            let X = m.getShaderInfoLog(I);\n            if (X) throw new Error(\"FRAGMENT SHADER \" + X);\n        }\n        m.deleteShader(P), m.deleteShader(I);\n    }\n    bind() {\n        this.ctx.pushProgram(this.glProgram);\n    }\n    unbind() {\n        this.ctx.popProgram();\n    }\n    send(e) {\n        let o = this.ctx.gl;\n        for(let c in e){\n            let g = e[c], m = o.getUniformLocation(this.glProgram, c);\n            typeof g == \"number\" ? o.uniform1f(m, g) : g instanceof $adc7cb3c45508c7c$var$Ue ? o.uniformMatrix4fv(m, !1, new Float32Array(g.m)) : g instanceof $adc7cb3c45508c7c$var$W ? o.uniform3f(m, g.r, g.g, g.b) : g instanceof $adc7cb3c45508c7c$var$v && o.uniform2f(m, g.x, g.y);\n        }\n    }\n    free() {\n        this.ctx.gl.deleteProgram(this.glProgram);\n    }\n}, $adc7cb3c45508c7c$var$Qt = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"BatchRenderer\");\n    }\n    ctx;\n    glVBuf;\n    glIBuf;\n    vqueue = [];\n    iqueue = [];\n    stride;\n    maxVertices;\n    maxIndices;\n    vertexFormat;\n    numDraws = 0;\n    curPrimitive = null;\n    curTex = null;\n    curShader = null;\n    curUniform = {};\n    constructor(e, o, c, g){\n        let m = e.gl;\n        this.vertexFormat = o, this.ctx = e, this.stride = o.reduce((P, I)=>P + I.size, 0), this.maxVertices = c, this.maxIndices = g, this.glVBuf = m.createBuffer(), e.pushArrayBuffer(this.glVBuf), m.bufferData(m.ARRAY_BUFFER, c * 4, m.DYNAMIC_DRAW), e.popArrayBuffer(), this.glIBuf = m.createBuffer(), e.pushElementArrayBuffer(this.glIBuf), m.bufferData(m.ELEMENT_ARRAY_BUFFER, g * 4, m.DYNAMIC_DRAW), e.popElementArrayBuffer();\n    }\n    push(e, o, c, g, m = null, P = {}) {\n        (e !== this.curPrimitive || m !== this.curTex || g !== this.curShader || !$adc7cb3c45508c7c$var$Wt(this.curUniform, P) || this.vqueue.length + o.length * this.stride > this.maxVertices || this.iqueue.length + c.length > this.maxIndices) && this.flush();\n        let I = this.vqueue.length / this.stride;\n        for (let j of o)this.vqueue.push(j);\n        for (let j of c)this.iqueue.push(j + I);\n        this.curPrimitive = e, this.curShader = g, this.curTex = m, this.curUniform = P;\n    }\n    flush() {\n        if (!this.curPrimitive || !this.curShader || this.vqueue.length === 0 || this.iqueue.length === 0) return;\n        let e = this.ctx.gl;\n        this.ctx.pushArrayBuffer(this.glVBuf), e.bufferSubData(e.ARRAY_BUFFER, 0, new Float32Array(this.vqueue)), this.ctx.pushElementArrayBuffer(this.glIBuf), e.bufferSubData(e.ELEMENT_ARRAY_BUFFER, 0, new Uint16Array(this.iqueue)), this.ctx.setVertexFormat(this.vertexFormat), this.curShader.bind(), this.curShader.send(this.curUniform), this.curTex?.bind(), e.drawElements(this.curPrimitive, this.iqueue.length, e.UNSIGNED_SHORT, 0), this.curTex?.unbind(), this.curShader.unbind(), this.ctx.popArrayBuffer(), this.ctx.popElementArrayBuffer(), this.vqueue = [], this.iqueue = [], this.numDraws++;\n    }\n    free() {\n        let e = this.ctx.gl;\n        e.deleteBuffer(this.glVBuf), e.deleteBuffer(this.glIBuf);\n    }\n};\nfunction $adc7cb3c45508c7c$var$nt(n) {\n    let e = [], o = $adc7cb3c45508c7c$var$i((m)=>{\n        e.push(m), n(m);\n    }, \"push\"), c = $adc7cb3c45508c7c$var$i(()=>{\n        e.pop(), n(g() ?? null);\n    }, \"pop\"), g = $adc7cb3c45508c7c$var$i(()=>e[e.length - 1], \"cur\");\n    return [\n        o,\n        c,\n        g\n    ];\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$nt, \"genStack\");\nfunction $adc7cb3c45508c7c$var$Kn(n, e = {}) {\n    let o = [];\n    function c($) {\n        o.push($);\n    }\n    $adc7cb3c45508c7c$var$i(c, \"onDestroy\");\n    function g() {\n        o.forEach(($)=>$()), n.getExtension(\"WEBGL_lose_context\").loseContext();\n    }\n    $adc7cb3c45508c7c$var$i(g, \"destroy\");\n    let m = null;\n    function P($) {\n        if ($adc7cb3c45508c7c$var$Wt($, m)) return;\n        m = $;\n        let Te = $.reduce((ye, Se)=>ye + Se.size, 0);\n        $.reduce((ye, Se, st)=>(n.vertexAttribPointer(st, Se.size, n.FLOAT, !1, Te * 4, ye), n.enableVertexAttribArray(st), ye + Se.size * 4), 0);\n    }\n    $adc7cb3c45508c7c$var$i(P, \"setVertexFormat\");\n    let [I, j] = $adc7cb3c45508c7c$var$nt(($)=>n.bindTexture(n.TEXTURE_2D, $)), [y, X] = $adc7cb3c45508c7c$var$nt(($)=>n.bindBuffer(n.ARRAY_BUFFER, $)), [S, q] = $adc7cb3c45508c7c$var$nt(($)=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER, $)), [E, K] = $adc7cb3c45508c7c$var$nt(($)=>n.bindFramebuffer(n.FRAMEBUFFER, $)), [Q, te] = $adc7cb3c45508c7c$var$nt(($)=>n.bindRenderbuffer(n.RENDERBUFFER, $)), [k, pe] = $adc7cb3c45508c7c$var$nt(({ x: $, y: Te, w: ye, h: Se })=>{\n        n.viewport($, Te, ye, Se);\n    }), [C, Ae] = $adc7cb3c45508c7c$var$nt(($)=>n.useProgram($));\n    return k({\n        x: 0,\n        y: 0,\n        w: n.drawingBufferWidth,\n        h: n.drawingBufferHeight\n    }), {\n        gl: n,\n        opts: e,\n        onDestroy: c,\n        destroy: g,\n        pushTexture2D: I,\n        popTexture2D: j,\n        pushArrayBuffer: y,\n        popArrayBuffer: X,\n        pushElementArrayBuffer: S,\n        popElementArrayBuffer: q,\n        pushFramebuffer: E,\n        popFramebuffer: K,\n        pushRenderbuffer: Q,\n        popRenderbuffer: te,\n        pushViewport: k,\n        popViewport: pe,\n        pushProgram: C,\n        popProgram: Ae,\n        setVertexFormat: P\n    };\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Kn, \"initGfx\");\nvar $adc7cb3c45508c7c$var$ve = class n {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"Asset\");\n    }\n    loaded = !1;\n    data = null;\n    error = null;\n    onLoadEvents = new $adc7cb3c45508c7c$var$be;\n    onErrorEvents = new $adc7cb3c45508c7c$var$be;\n    onFinishEvents = new $adc7cb3c45508c7c$var$be;\n    constructor(e){\n        e.then((o)=>{\n            this.data = o, this.onLoadEvents.trigger(o);\n        }).catch((o)=>{\n            if (this.error = o, this.onErrorEvents.numListeners() > 0) this.onErrorEvents.trigger(o);\n            else throw o;\n        }).finally(()=>{\n            this.onFinishEvents.trigger(), this.loaded = !0;\n        });\n    }\n    static loaded(e) {\n        let o = new n(Promise.resolve(e));\n        return o.data = e, o.loaded = !0, o;\n    }\n    onLoad(e) {\n        return this.loaded && this.data ? e(this.data) : this.onLoadEvents.add(e), this;\n    }\n    onError(e) {\n        return this.loaded && this.error ? e(this.error) : this.onErrorEvents.add(e), this;\n    }\n    onFinish(e) {\n        return this.loaded ? e() : this.onFinishEvents.add(e), this;\n    }\n    then(e) {\n        return this.onLoad(e);\n    }\n    catch(e) {\n        return this.onError(e);\n    }\n    finally(e) {\n        return this.onFinish(e);\n    }\n}, $adc7cb3c45508c7c$var$je = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"AssetBucket\");\n    }\n    assets = new Map;\n    lastUID = 0;\n    add(e, o) {\n        let c = e ?? this.lastUID++ + \"\", g = new $adc7cb3c45508c7c$var$ve(o);\n        return this.assets.set(c, g), g;\n    }\n    addLoaded(e, o) {\n        let c = e ?? this.lastUID++ + \"\", g = $adc7cb3c45508c7c$var$ve.loaded(o);\n        return this.assets.set(c, g), g;\n    }\n    get(e) {\n        return this.assets.get(e);\n    }\n    progress() {\n        if (this.assets.size === 0) return 1;\n        let e = 0;\n        return this.assets.forEach((o)=>{\n            o.loaded && e++;\n        }), e / this.assets.size;\n    }\n};\nfunction $adc7cb3c45508c7c$var$Yn(n) {\n    return fetch(n).then((e)=>{\n        if (!e.ok) throw new Error(`Failed to fetch \"${n}\"`);\n        return e;\n    });\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Yn, \"fetchURL\");\nfunction $adc7cb3c45508c7c$var$Et(n) {\n    return $adc7cb3c45508c7c$var$Yn(n).then((e)=>e.json());\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Et, \"fetchJSON\");\nfunction $adc7cb3c45508c7c$var$Lr(n) {\n    return $adc7cb3c45508c7c$var$Yn(n).then((e)=>e.text());\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Lr, \"fetchText\");\nfunction $adc7cb3c45508c7c$var$Vr(n) {\n    return $adc7cb3c45508c7c$var$Yn(n).then((e)=>e.arrayBuffer());\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Vr, \"fetchArrayBuffer\");\nfunction $adc7cb3c45508c7c$var$St(n) {\n    let e = new Image;\n    return e.crossOrigin = \"anonymous\", e.src = n, new Promise((o, c)=>{\n        e.onload = ()=>o(e), e.onerror = ()=>c(new Error(`Failed to load image from \"${n}\"`));\n    });\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$St, \"loadImg\");\nvar $adc7cb3c45508c7c$var$Zt = 2.5949095, $adc7cb3c45508c7c$var$_r = 2.70158, $adc7cb3c45508c7c$var$kr = 2 * Math.PI / 3, $adc7cb3c45508c7c$var$Nr = 2 * Math.PI / 4.5, $adc7cb3c45508c7c$var$en = {\n    linear: (n)=>n,\n    easeInSine: (n)=>1 - Math.cos(n * Math.PI / 2),\n    easeOutSine: (n)=>Math.sin(n * Math.PI / 2),\n    easeInOutSine: (n)=>-(Math.cos(Math.PI * n) - 1) / 2,\n    easeInQuad: (n)=>n * n,\n    easeOutQuad: (n)=>1 - (1 - n) * (1 - n),\n    easeInOutQuad: (n)=>n < .5 ? 2 * n * n : 1 - Math.pow(-2 * n + 2, 2) / 2,\n    easeInCubic: (n)=>n * n * n,\n    easeOutCubic: (n)=>1 - Math.pow(1 - n, 3),\n    easeInOutCubic: (n)=>n < .5 ? 4 * n * n * n : 1 - Math.pow(-2 * n + 2, 3) / 2,\n    easeInQuart: (n)=>n * n * n * n,\n    easeOutQuart: (n)=>1 - Math.pow(1 - n, 4),\n    easeInOutQuart: (n)=>n < .5 ? 8 * n * n * n * n : 1 - Math.pow(-2 * n + 2, 4) / 2,\n    easeInQuint: (n)=>n * n * n * n * n,\n    easeOutQuint: (n)=>1 - Math.pow(1 - n, 5),\n    easeInOutQuint: (n)=>n < .5 ? 16 * n * n * n * n * n : 1 - Math.pow(-2 * n + 2, 5) / 2,\n    easeInExpo: (n)=>n === 0 ? 0 : Math.pow(2, 10 * n - 10),\n    easeOutExpo: (n)=>n === 1 ? 1 : 1 - Math.pow(2, -10 * n),\n    easeInOutExpo: (n)=>n === 0 ? 0 : n === 1 ? 1 : n < .5 ? Math.pow(2, 20 * n - 10) / 2 : (2 - Math.pow(2, -20 * n + 10)) / 2,\n    easeInCirc: (n)=>1 - Math.sqrt(1 - Math.pow(n, 2)),\n    easeOutCirc: (n)=>Math.sqrt(1 - Math.pow(n - 1, 2)),\n    easeInOutCirc: (n)=>n < .5 ? (1 - Math.sqrt(1 - Math.pow(2 * n, 2))) / 2 : (Math.sqrt(1 - Math.pow(-2 * n + 2, 2)) + 1) / 2,\n    easeInBack: (n)=>$adc7cb3c45508c7c$var$_r * n * n * n - 1.70158 * n * n,\n    easeOutBack: (n)=>1 + $adc7cb3c45508c7c$var$_r * Math.pow(n - 1, 3) + 1.70158 * Math.pow(n - 1, 2),\n    easeInOutBack: (n)=>n < .5 ? Math.pow(2 * n, 2) * (($adc7cb3c45508c7c$var$Zt + 1) * 2 * n - $adc7cb3c45508c7c$var$Zt) / 2 : (Math.pow(2 * n - 2, 2) * (($adc7cb3c45508c7c$var$Zt + 1) * (n * 2 - 2) + $adc7cb3c45508c7c$var$Zt) + 2) / 2,\n    easeInElastic: (n)=>n === 0 ? 0 : n === 1 ? 1 : -Math.pow(2, 10 * n - 10) * Math.sin((n * 10 - 10.75) * $adc7cb3c45508c7c$var$kr),\n    easeOutElastic: (n)=>n === 0 ? 0 : n === 1 ? 1 : Math.pow(2, -10 * n) * Math.sin((n * 10 - .75) * $adc7cb3c45508c7c$var$kr) + 1,\n    easeInOutElastic: (n)=>n === 0 ? 0 : n === 1 ? 1 : n < .5 ? -(Math.pow(2, 20 * n - 10) * Math.sin((20 * n - 11.125) * $adc7cb3c45508c7c$var$Nr)) / 2 : Math.pow(2, -20 * n + 10) * Math.sin((20 * n - 11.125) * $adc7cb3c45508c7c$var$Nr) / 2 + 1,\n    easeInBounce: (n)=>1 - $adc7cb3c45508c7c$var$en.easeOutBounce(1 - n),\n    easeOutBounce: (n)=>n < 1 / 2.75 ? 7.5625 * n * n : n < 2 / 2.75 ? 7.5625 * (n -= 1.5 / 2.75) * n + .75 : n < 2.5 / 2.75 ? 7.5625 * (n -= 2.25 / 2.75) * n + .9375 : 7.5625 * (n -= 2.625 / 2.75) * n + .984375,\n    easeInOutBounce: (n)=>n < .5 ? (1 - $adc7cb3c45508c7c$var$en.easeOutBounce(1 - 2 * n)) / 2 : (1 + $adc7cb3c45508c7c$var$en.easeOutBounce(2 * n - 1)) / 2\n}, $adc7cb3c45508c7c$var$Ct = $adc7cb3c45508c7c$var$en;\nvar $adc7cb3c45508c7c$var$At = class {\n    static{\n        $adc7cb3c45508c7c$var$i(this, \"TexPacker\");\n    }\n    textures = [];\n    canvas;\n    c2d;\n    x = 0;\n    y = 0;\n    curHeight = 0;\n    gfx;\n    constructor(e, o, c){\n        this.gfx = e, this.canvas = document.createElement(\"canvas\"), this.canvas.width = o, this.canvas.height = c, this.textures = [\n            $adc7cb3c45508c7c$var$Re.fromImage(e, this.canvas)\n        ], this.c2d = this.canvas.getContext(\"2d\");\n    }\n    add(e) {\n        if (e.width > this.canvas.width || e.height > this.canvas.height) throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);\n        this.x + e.width > this.canvas.width && (this.x = 0, this.y += this.curHeight, this.curHeight = 0), this.y + e.height > this.canvas.height && (this.c2d.clearRect(0, 0, this.canvas.width, this.canvas.height), this.textures.push($adc7cb3c45508c7c$var$Re.fromImage(this.gfx, this.canvas)), this.x = 0, this.y = 0, this.curHeight = 0);\n        let o = this.textures[this.textures.length - 1], c = new $adc7cb3c45508c7c$var$v(this.x, this.y);\n        return this.x += e.width, e.height > this.curHeight && (this.curHeight = e.height), e instanceof ImageData ? this.c2d.putImageData(e, c.x, c.y) : this.c2d.drawImage(e, c.x, c.y), o.update(this.canvas), [\n            o,\n            new $adc7cb3c45508c7c$var$oe(c.x / this.canvas.width, c.y / this.canvas.height, e.width / this.canvas.width, e.height / this.canvas.height)\n        ];\n    }\n    free() {\n        for (let e of this.textures)e.free();\n    }\n};\nvar $adc7cb3c45508c7c$var$jr = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==\";\nvar $adc7cb3c45508c7c$var$Hr = $adc7cb3c45508c7c$var$gr(\"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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV\");\nvar $adc7cb3c45508c7c$var$qr = \"data:image/png;base64,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\";\nvar $adc7cb3c45508c7c$var$$r = \"data:image/png;base64,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\";\nvar $adc7cb3c45508c7c$var$ki = \"3000.1.17\", $adc7cb3c45508c7c$var$zr = \" !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\", $adc7cb3c45508c7c$var$tn = \"topleft\", $adc7cb3c45508c7c$var$Kr = 64, $adc7cb3c45508c7c$var$Ni = \"monospace\", $adc7cb3c45508c7c$var$nn = \"monospace\", $adc7cb3c45508c7c$var$ji = 36, $adc7cb3c45508c7c$var$rn = 64, $adc7cb3c45508c7c$var$sn = 256, $adc7cb3c45508c7c$var$Yr = 2048, $adc7cb3c45508c7c$var$Wr = 2048, $adc7cb3c45508c7c$var$Xr = 2048, $adc7cb3c45508c7c$var$Jr = 2048, $adc7cb3c45508c7c$var$Qr = .1, $adc7cb3c45508c7c$var$Hi = 64, $adc7cb3c45508c7c$var$Wn = \"linear\", $adc7cb3c45508c7c$var$qi = 8, $adc7cb3c45508c7c$var$$i = 4, $adc7cb3c45508c7c$var$Qn = [\n    {\n        name: \"a_pos\",\n        size: 2\n    },\n    {\n        name: \"a_uv\",\n        size: 2\n    },\n    {\n        name: \"a_color\",\n        size: 4\n    }\n], $adc7cb3c45508c7c$var$zi = $adc7cb3c45508c7c$var$Qn.reduce((n, e)=>n + e.size, 0), $adc7cb3c45508c7c$var$Zr = 2048, $adc7cb3c45508c7c$var$Ki = $adc7cb3c45508c7c$var$Zr * 4 * $adc7cb3c45508c7c$var$zi, $adc7cb3c45508c7c$var$Yi = $adc7cb3c45508c7c$var$Zr * 6, $adc7cb3c45508c7c$var$Wi = `\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n`, $adc7cb3c45508c7c$var$Xi = `\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n`, $adc7cb3c45508c7c$var$Xn = `\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n`, $adc7cb3c45508c7c$var$Jn = `\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n`, $adc7cb3c45508c7c$var$Ji = new Set([\n    \"id\",\n    \"require\"\n]), $adc7cb3c45508c7c$var$Qi = new Set([\n    \"add\",\n    \"update\",\n    \"draw\",\n    \"destroy\",\n    \"inspect\",\n    \"drawInspect\"\n]);\nfunction $adc7cb3c45508c7c$var$ut(n) {\n    switch(n){\n        case \"topleft\":\n            return new $adc7cb3c45508c7c$var$v(-1, -1);\n        case \"top\":\n            return new $adc7cb3c45508c7c$var$v(0, -1);\n        case \"topright\":\n            return new $adc7cb3c45508c7c$var$v(1, -1);\n        case \"left\":\n            return new $adc7cb3c45508c7c$var$v(-1, 0);\n        case \"center\":\n            return new $adc7cb3c45508c7c$var$v(0, 0);\n        case \"right\":\n            return new $adc7cb3c45508c7c$var$v(1, 0);\n        case \"botleft\":\n            return new $adc7cb3c45508c7c$var$v(-1, 1);\n        case \"bot\":\n            return new $adc7cb3c45508c7c$var$v(0, 1);\n        case \"botright\":\n            return new $adc7cb3c45508c7c$var$v(1, 1);\n        default:\n            return n;\n    }\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$ut, \"anchorPt\");\nfunction $adc7cb3c45508c7c$var$Zi(n) {\n    switch(n){\n        case \"left\":\n            return 0;\n        case \"center\":\n            return .5;\n        case \"right\":\n            return 1;\n        default:\n            return 0;\n    }\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$Zi, \"alignPt\");\nfunction $adc7cb3c45508c7c$var$eo(n) {\n    return n.createBuffer(1, 1, 44100);\n}\n$adc7cb3c45508c7c$var$i($adc7cb3c45508c7c$var$eo, \"createEmptyAudioBuffer\");\nvar $adc7cb3c45508c7c$export$2e2bcd8739ae039 = $adc7cb3c45508c7c$var$i((n = {})=>{\n    let e = n.root ?? document.body;\n    e === document.body && (document.body.style.width = \"100%\", document.body.style.height = \"100%\", document.body.style.margin = \"0px\", document.documentElement.style.width = \"100%\", document.documentElement.style.height = \"100%\");\n    let o = n.canvas ?? (()=>{\n        let t1 = document.createElement(\"canvas\");\n        return e.appendChild(t1), t1;\n    })(), c = n.scale ?? 1, g = n.width && n.height && !n.stretch && !n.letterbox;\n    g ? (o.width = n.width * c, o.height = n.height * c) : (o.width = o.parentElement.offsetWidth, o.height = o.parentElement.offsetHeight);\n    let m = [\n        \"outline: none\",\n        \"cursor: default\"\n    ];\n    if (g) {\n        let t1 = o.width, r = o.height;\n        m.push(`width: ${t1}px`), m.push(`height: ${r}px`);\n    } else m.push(\"width: 100%\"), m.push(\"height: 100%\");\n    n.crisp && (m.push(\"image-rendering: pixelated\"), m.push(\"image-rendering: crisp-edges\")), o.style.cssText = m.join(\";\");\n    let P = n.pixelDensity || window.devicePixelRatio;\n    o.width *= P, o.height *= P, o.tabIndex = 0;\n    let I = document.createElement(\"canvas\");\n    I.width = $adc7cb3c45508c7c$var$sn, I.height = $adc7cb3c45508c7c$var$sn;\n    let j = I.getContext(\"2d\", {\n        willReadFrequently: !0\n    }), y = $adc7cb3c45508c7c$var$Ir({\n        canvas: o,\n        touchToMouse: n.touchToMouse,\n        gamepads: n.gamepads,\n        pixelDensity: n.pixelDensity,\n        maxFPS: n.maxFPS\n    }), X = [], S = y.canvas.getContext(\"webgl\", {\n        antialias: !0,\n        depth: !0,\n        stencil: !0,\n        alpha: !0,\n        preserveDrawingBuffer: !0\n    }), q = $adc7cb3c45508c7c$var$Kn(S, {\n        texFilter: n.texFilter\n    }), E = (()=>{\n        let t1 = ht($adc7cb3c45508c7c$var$Xn, $adc7cb3c45508c7c$var$Jn), r = $adc7cb3c45508c7c$var$Re.fromImage(q, new ImageData(new Uint8ClampedArray([\n            255,\n            255,\n            255,\n            255\n        ]), 1, 1)), s1 = n.width && n.height ? new $adc7cb3c45508c7c$var$rt(q, n.width * P * c, n.height * P * c) : new $adc7cb3c45508c7c$var$rt(q, S.drawingBufferWidth, S.drawingBufferHeight), u = null, a1 = 1;\n        n.background && (u = $adc7cb3c45508c7c$var$J(n.background), a1 = Array.isArray(n.background) ? n.background[3] : 1, S.clearColor(u.r / 255, u.g / 255, u.b / 255, a1 ?? 1)), S.enable(S.BLEND), S.blendFuncSeparate(S.SRC_ALPHA, S.ONE_MINUS_SRC_ALPHA, S.ONE, S.ONE_MINUS_SRC_ALPHA);\n        let h1 = new $adc7cb3c45508c7c$var$Qt(q, $adc7cb3c45508c7c$var$Qn, $adc7cb3c45508c7c$var$Ki, $adc7cb3c45508c7c$var$Yi), f = $adc7cb3c45508c7c$var$Re.fromImage(q, new ImageData(new Uint8ClampedArray([\n            128,\n            128,\n            128,\n            255,\n            190,\n            190,\n            190,\n            255,\n            190,\n            190,\n            190,\n            255,\n            128,\n            128,\n            128,\n            255\n        ]), 2, 2), {\n            wrap: \"repeat\",\n            filter: \"nearest\"\n        });\n        return {\n            lastDrawCalls: 0,\n            defShader: t1,\n            defTex: r,\n            frameBuffer: s1,\n            postShader: null,\n            postShaderUniform: null,\n            renderer: h1,\n            transform: new $adc7cb3c45508c7c$var$Ue,\n            transformStack: [],\n            bgTex: f,\n            bgColor: u,\n            bgAlpha: a1,\n            width: n.width ?? S.drawingBufferWidth / P / c,\n            height: n.height ?? S.drawingBufferHeight / P / c,\n            viewport: {\n                x: 0,\n                y: 0,\n                width: S.drawingBufferWidth,\n                height: S.drawingBufferHeight\n            },\n            fixed: !1\n        };\n    })();\n    class K {\n        static{\n            $adc7cb3c45508c7c$var$i(this, \"SpriteData\");\n        }\n        tex;\n        frames = [\n            new $adc7cb3c45508c7c$var$oe(0, 0, 1, 1)\n        ];\n        anims = {};\n        slice9 = null;\n        constructor(r, s1, u = {}, a1 = null){\n            this.tex = r, s1 && (this.frames = s1), this.anims = u, this.slice9 = a1;\n        }\n        get width() {\n            return this.tex.width * this.frames[0].w;\n        }\n        get height() {\n            return this.tex.height * this.frames[0].h;\n        }\n        static from(r, s1 = {}) {\n            return typeof r == \"string\" ? K.fromURL(r, s1) : Promise.resolve(K.fromImage(r, s1));\n        }\n        static fromImage(r, s1 = {}) {\n            let [u, a1] = k.packer.add(r), h1 = s1.frames ? s1.frames.map((f)=>new $adc7cb3c45508c7c$var$oe(a1.x + f.x * a1.w, a1.y + f.y * a1.h, f.w * a1.w, f.h * a1.h)) : Tt(s1.sliceX || 1, s1.sliceY || 1, a1.x, a1.y, a1.w, a1.h);\n            return new K(u, h1, s1.anims, s1.slice9);\n        }\n        static fromURL(r, s1 = {}) {\n            return $adc7cb3c45508c7c$var$St(r).then((u)=>K.fromImage(u, s1));\n        }\n    }\n    class Q {\n        static{\n            $adc7cb3c45508c7c$var$i(this, \"SoundData\");\n        }\n        buf;\n        constructor(r){\n            this.buf = r;\n        }\n        static fromArrayBuffer(r) {\n            return new Promise((s1, u)=>te.ctx.decodeAudioData(r, s1, u)).then((s1)=>new Q(s1));\n        }\n        static fromURL(r) {\n            return $adc7cb3c45508c7c$var$jn(r) ? Q.fromArrayBuffer($adc7cb3c45508c7c$var$Pr(r)) : $adc7cb3c45508c7c$var$Vr(r).then((s1)=>Q.fromArrayBuffer(s1));\n        }\n    }\n    let te = (()=>{\n        let t1 = new (window.AudioContext || window.webkitAudioContext), r = t1.createGain();\n        r.connect(t1.destination);\n        let s1 = new Q($adc7cb3c45508c7c$var$eo(t1));\n        return t1.decodeAudioData($adc7cb3c45508c7c$var$Hr.buffer.slice(0)).then((u)=>{\n            s1.buf = u;\n        }).catch((u)=>{\n            console.error(\"Failed to load burp: \", u);\n        }), {\n            ctx: t1,\n            masterNode: r,\n            burpSnd: s1\n        };\n    })(), k = {\n        urlPrefix: \"\",\n        sprites: new $adc7cb3c45508c7c$var$je,\n        fonts: new $adc7cb3c45508c7c$var$je,\n        bitmapFonts: new $adc7cb3c45508c7c$var$je,\n        sounds: new $adc7cb3c45508c7c$var$je,\n        shaders: new $adc7cb3c45508c7c$var$je,\n        custom: new $adc7cb3c45508c7c$var$je,\n        packer: new $adc7cb3c45508c7c$var$At(q, $adc7cb3c45508c7c$var$Xr, $adc7cb3c45508c7c$var$Jr),\n        loaded: !1\n    };\n    function pe(t1) {\n        return typeof t1 != \"string\" || $adc7cb3c45508c7c$var$jn(t1) ? t1 : k.urlPrefix + t1;\n    }\n    $adc7cb3c45508c7c$var$i(pe, \"fixURL\");\n    let C = {\n        events: new $adc7cb3c45508c7c$var$Ne,\n        objEvents: new $adc7cb3c45508c7c$var$Ne,\n        root: Un([]),\n        gravity: 0,\n        scenes: {},\n        logs: [],\n        cam: {\n            pos: null,\n            scale: new $adc7cb3c45508c7c$var$v(1),\n            angle: 0,\n            shake: 0,\n            transform: new $adc7cb3c45508c7c$var$Ue\n        }\n    };\n    C.root.use(An());\n    function Ae(t1) {\n        return k.custom.add(null, t1);\n    }\n    $adc7cb3c45508c7c$var$i(Ae, \"load\");\n    function $() {\n        let t1 = [\n            k.sprites,\n            k.sounds,\n            k.shaders,\n            k.fonts,\n            k.bitmapFonts,\n            k.custom\n        ];\n        return t1.reduce((r, s1)=>r + s1.progress(), 0) / t1.length;\n    }\n    $adc7cb3c45508c7c$var$i($, \"loadProgress\");\n    function Te(t1) {\n        return t1 !== void 0 && (k.urlPrefix = t1), k.urlPrefix;\n    }\n    $adc7cb3c45508c7c$var$i(Te, \"loadRoot\");\n    function ye(t1, r) {\n        return k.custom.add(t1, $adc7cb3c45508c7c$var$Et(r));\n    }\n    $adc7cb3c45508c7c$var$i(ye, \"loadJSON\");\n    class Se {\n        static{\n            $adc7cb3c45508c7c$var$i(this, \"FontData\");\n        }\n        fontface;\n        filter = $adc7cb3c45508c7c$var$Wn;\n        outline = null;\n        size = $adc7cb3c45508c7c$var$rn;\n        constructor(r, s1 = {}){\n            if (this.fontface = r, this.filter = s1.filter ?? $adc7cb3c45508c7c$var$Wn, this.size = s1.size ?? $adc7cb3c45508c7c$var$rn, this.size > $adc7cb3c45508c7c$var$sn) throw new Error(`Max font size: ${$adc7cb3c45508c7c$var$sn}`);\n            s1.outline && (this.outline = {\n                width: 1,\n                color: $adc7cb3c45508c7c$var$J(0, 0, 0)\n            }, typeof s1.outline == \"number\" ? this.outline.width = s1.outline : typeof s1.outline == \"object\" && (s1.outline.width && (this.outline.width = s1.outline.width), s1.outline.color && (this.outline.color = s1.outline.color)));\n        }\n    }\n    function st(t1, r, s1 = {}) {\n        let u = new FontFace(t1, typeof r == \"string\" ? `url(${r})` : r);\n        return document.fonts.add(u), k.fonts.add(t1, u.load().catch((a1)=>{\n            throw new Error(`Failed to load font from \"${r}\": ${a1}`);\n        }).then((a1)=>new Se(a1, s1)));\n    }\n    $adc7cb3c45508c7c$var$i(st, \"loadFont\");\n    function on(t1, r, s1, u, a1 = {}) {\n        return k.bitmapFonts.add(t1, $adc7cb3c45508c7c$var$St(r).then((h1)=>bn($adc7cb3c45508c7c$var$Re.fromImage(q, h1, a1), s1, u, a1.chars ?? $adc7cb3c45508c7c$var$zr)));\n    }\n    $adc7cb3c45508c7c$var$i(on, \"loadBitmapFont\");\n    function Tt(t1 = 1, r = 1, s1 = 0, u = 0, a1 = 1, h1 = 1) {\n        let f = [], b1 = a1 / t1, p1 = h1 / r;\n        for(let d1 = 0; d1 < r; d1++)for(let w = 0; w < t1; w++)f.push(new $adc7cb3c45508c7c$var$oe(s1 + w * b1, u + d1 * p1, b1, p1));\n        return f;\n    }\n    $adc7cb3c45508c7c$var$i(Tt, \"slice\");\n    function Ot(t1, r) {\n        return t1 = pe(t1), Ae(typeof r == \"string\" ? new Promise((s1, u)=>{\n            $adc7cb3c45508c7c$var$Et(r).then((a1)=>{\n                Ot(t1, a1).then(s1).catch(u);\n            });\n        }) : K.from(t1).then((s1)=>{\n            let u = {};\n            for(let a1 in r){\n                let h1 = r[a1], f = s1.frames[0], b1 = $adc7cb3c45508c7c$var$Xr * f.w, p1 = $adc7cb3c45508c7c$var$Jr * f.h, d1 = h1.frames ? h1.frames.map((A)=>new $adc7cb3c45508c7c$var$oe(f.x + (h1.x + A.x) / b1 * f.w, f.y + (h1.y + A.y) / p1 * f.h, A.w / b1 * f.w, A.h / p1 * f.h)) : Tt(h1.sliceX || 1, h1.sliceY || 1, f.x + h1.x / b1 * f.w, f.y + h1.y / p1 * f.h, h1.width / b1 * f.w, h1.height / p1 * f.h), w = new K(s1.tex, d1, h1.anims);\n                k.sprites.addLoaded(a1, w), u[a1] = w;\n            }\n            return u;\n        }));\n    }\n    $adc7cb3c45508c7c$var$i(Ot, \"loadSpriteAtlas\");\n    function Rt(t1, r = {}) {\n        let s1 = document.createElement(\"canvas\"), u = t1[0].width, a1 = t1[0].height;\n        s1.width = u * t1.length, s1.height = a1;\n        let h1 = s1.getContext(\"2d\");\n        t1.forEach((b1, p1)=>{\n            b1 instanceof ImageData ? h1.putImageData(b1, p1 * u, 0) : h1.drawImage(b1, p1 * u, 0);\n        });\n        let f = h1.getImageData(0, 0, t1.length * u, a1);\n        return K.fromImage(f, {\n            ...r,\n            sliceX: t1.length,\n            sliceY: 1\n        });\n    }\n    $adc7cb3c45508c7c$var$i(Rt, \"createSpriteSheet\");\n    function Ye(t1, r, s1 = {\n        sliceX: 1,\n        sliceY: 1,\n        anims: {}\n    }) {\n        return r = pe(r), Array.isArray(r) ? r.some((u)=>typeof u == \"string\") ? k.sprites.add(t1, Promise.all(r.map((u)=>typeof u == \"string\" ? $adc7cb3c45508c7c$var$St(u) : Promise.resolve(u))).then((u)=>Rt(u, s1))) : k.sprites.addLoaded(t1, Rt(r, s1)) : typeof r == \"string\" ? k.sprites.add(t1, K.from(r, s1)) : k.sprites.addLoaded(t1, K.fromImage(r, s1));\n    }\n    $adc7cb3c45508c7c$var$i(Ye, \"loadSprite\");\n    function an(t1, r) {\n        return r = pe(r), k.sprites.add(t1, new Promise(async (s1)=>{\n            let u = typeof r == \"string\" ? await $adc7cb3c45508c7c$var$Et(r) : r, a1 = await Promise.all(u.frames.map($adc7cb3c45508c7c$var$St)), h1 = document.createElement(\"canvas\");\n            h1.width = u.width, h1.height = u.height * u.frames.length;\n            let f = h1.getContext(\"2d\");\n            a1.forEach((p1, d1)=>{\n                f.drawImage(p1, 0, d1 * u.height);\n            });\n            let b1 = await Ye(null, h1, {\n                sliceY: u.frames.length,\n                anims: u.anims\n            });\n            s1(b1);\n        }));\n    }\n    $adc7cb3c45508c7c$var$i(an, \"loadPedit\");\n    function un(t1, r, s1) {\n        r = pe(r), s1 = pe(s1), typeof r == \"string\" && !s1 && (s1 = $adc7cb3c45508c7c$var$Mr(r) + \".json\");\n        let u = typeof s1 == \"string\" ? $adc7cb3c45508c7c$var$Et(s1) : Promise.resolve(s1);\n        return k.sprites.add(t1, u.then((a1)=>{\n            let h1 = a1.meta.size, f = a1.frames.map((p1)=>new $adc7cb3c45508c7c$var$oe(p1.frame.x / h1.w, p1.frame.y / h1.h, p1.frame.w / h1.w, p1.frame.h / h1.h)), b1 = {};\n            for (let p1 of a1.meta.frameTags)p1.from === p1.to ? b1[p1.name] = p1.from : b1[p1.name] = {\n                from: p1.from,\n                to: p1.to,\n                speed: 10,\n                loop: !0,\n                pingpong: p1.direction === \"pingpong\"\n            };\n            return K.from(r, {\n                frames: f,\n                anims: b1\n            });\n        }));\n    }\n    $adc7cb3c45508c7c$var$i(un, \"loadAseprite\");\n    function cn(t1, r, s1) {\n        return k.shaders.addLoaded(t1, ht(r, s1));\n    }\n    $adc7cb3c45508c7c$var$i(cn, \"loadShader\");\n    function hn(t1, r, s1) {\n        r = pe(r), s1 = pe(s1);\n        let u = $adc7cb3c45508c7c$var$i((h1)=>h1 ? $adc7cb3c45508c7c$var$Lr(h1) : Promise.resolve(null), \"resolveUrl\"), a1 = Promise.all([\n            u(r),\n            u(s1)\n        ]).then(([h1, f])=>ht(h1, f));\n        return k.shaders.add(t1, a1);\n    }\n    $adc7cb3c45508c7c$var$i(hn, \"loadShaderURL\");\n    function ln(t1, r) {\n        return r = pe(r), k.sounds.add(t1, typeof r == \"string\" ? Q.fromURL(r) : Q.fromArrayBuffer(r));\n    }\n    $adc7cb3c45508c7c$var$i(ln, \"loadSound\");\n    function dn(t1 = \"bean\") {\n        return Ye(t1, $adc7cb3c45508c7c$var$jr);\n    }\n    $adc7cb3c45508c7c$var$i(dn, \"loadBean\");\n    function Pt(t1) {\n        return k.sprites.get(t1);\n    }\n    $adc7cb3c45508c7c$var$i(Pt, \"getSprite\");\n    function Dt(t1) {\n        return k.sounds.get(t1);\n    }\n    $adc7cb3c45508c7c$var$i(Dt, \"getSound\");\n    function Mt(t1) {\n        return k.fonts.get(t1);\n    }\n    $adc7cb3c45508c7c$var$i(Mt, \"getFont\");\n    function Gt(t1) {\n        return k.bitmapFonts.get(t1);\n    }\n    $adc7cb3c45508c7c$var$i(Gt, \"getBitmapFont\");\n    function Bt(t1) {\n        return k.shaders.get(t1);\n    }\n    $adc7cb3c45508c7c$var$i(Bt, \"getShader\");\n    function fn(t1) {\n        return k.custom.get(t1);\n    }\n    $adc7cb3c45508c7c$var$i(fn, \"getAsset\");\n    function ct(t1) {\n        if (typeof t1 == \"string\") {\n            let r = Pt(t1);\n            if (r) return r;\n            if ($() < 1) return null;\n            throw new Error(`Sprite not found: ${t1}`);\n        } else {\n            if (t1 instanceof K) return $adc7cb3c45508c7c$var$ve.loaded(t1);\n            if (t1 instanceof $adc7cb3c45508c7c$var$ve) return t1;\n            throw new Error(`Invalid sprite: ${t1}`);\n        }\n    }\n    $adc7cb3c45508c7c$var$i(ct, \"resolveSprite\");\n    function mn(t1) {\n        if (typeof t1 == \"string\") {\n            let r = Dt(t1);\n            if (r) return r;\n            if ($() < 1) return null;\n            throw new Error(`Sound not found: ${t1}`);\n        } else {\n            if (t1 instanceof Q) return $adc7cb3c45508c7c$var$ve.loaded(t1);\n            if (t1 instanceof $adc7cb3c45508c7c$var$ve) return t1;\n            throw new Error(`Invalid sound: ${t1}`);\n        }\n    }\n    $adc7cb3c45508c7c$var$i(mn, \"resolveSound\");\n    function pn(t1) {\n        if (!t1) return E.defShader;\n        if (typeof t1 == \"string\") {\n            let r = Bt(t1);\n            if (r) return r.data ?? r;\n            if ($() < 1) return null;\n            throw new Error(`Shader not found: ${t1}`);\n        } else if (t1 instanceof $adc7cb3c45508c7c$var$ve) return t1.data ? t1.data : t1;\n        return t1;\n    }\n    $adc7cb3c45508c7c$var$i(pn, \"resolveShader\");\n    function Ft(t1) {\n        if (!t1) return Ft(n.font ?? $adc7cb3c45508c7c$var$Ni);\n        if (typeof t1 == \"string\") {\n            let r = Gt(t1), s1 = Mt(t1);\n            if (r) return r.data ?? r;\n            if (s1) return s1.data ?? s1;\n            if (document.fonts.check(`${$adc7cb3c45508c7c$var$rn}px ${t1}`)) return t1;\n            if ($() < 1) return null;\n            throw new Error(`Font not found: ${t1}`);\n        } else if (t1 instanceof $adc7cb3c45508c7c$var$ve) return t1.data ? t1.data : t1;\n        return t1;\n    }\n    $adc7cb3c45508c7c$var$i(Ft, \"resolveFont\");\n    function gn(t1) {\n        return t1 !== void 0 && (te.masterNode.gain.value = t1), te.masterNode.gain.value;\n    }\n    $adc7cb3c45508c7c$var$i(gn, \"volume\");\n    function It(t1, r = {}) {\n        let s1 = te.ctx, u = r.paused ?? !1, a1 = s1.createBufferSource(), h1 = new $adc7cb3c45508c7c$var$be, f = s1.createGain(), b1 = r.seek ?? 0, p1 = 0, d1 = 0, w = !1;\n        a1.loop = !!r.loop, a1.detune.value = r.detune ?? 0, a1.playbackRate.value = r.speed ?? 1, a1.connect(f), a1.onended = ()=>{\n            N() >= a1.buffer?.duration && h1.trigger();\n        }, f.connect(te.masterNode), f.gain.value = r.volume ?? 1;\n        let A = $adc7cb3c45508c7c$var$i((M1)=>{\n            a1.buffer = M1.buf, u || (p1 = s1.currentTime, a1.start(0, b1), w = !0);\n        }, \"start\"), D = mn(t1);\n        D instanceof $adc7cb3c45508c7c$var$ve && D.onLoad(A);\n        let N = $adc7cb3c45508c7c$var$i(()=>{\n            if (!a1.buffer) return 0;\n            let M1 = u ? d1 - p1 : s1.currentTime - p1, O = a1.buffer.duration;\n            return a1.loop ? M1 % O : Math.min(M1, O);\n        }, \"getTime\"), _ = $adc7cb3c45508c7c$var$i((M1)=>{\n            let O = s1.createBufferSource();\n            return O.buffer = M1.buffer, O.loop = M1.loop, O.playbackRate.value = M1.playbackRate.value, O.detune.value = M1.detune.value, O.onended = M1.onended, O.connect(f), O;\n        }, \"cloneNode\");\n        return {\n            stop () {\n                this.paused = !0, this.seek(0);\n            },\n            set paused (M){\n                if (u !== M) {\n                    if (u = M, M) w && (a1.stop(), w = !1), d1 = s1.currentTime;\n                    else {\n                        a1 = _(a1);\n                        let O = d1 - p1;\n                        a1.start(0, O), w = !0, p1 = s1.currentTime - O, d1 = 0;\n                    }\n                }\n            },\n            get paused () {\n                return u;\n            },\n            play (M1 = 0) {\n                this.seek(M1), this.paused = !1;\n            },\n            seek (M1) {\n                a1.buffer?.duration && (M1 > a1.buffer.duration || (u ? (a1 = _(a1), p1 = d1 - M1) : (a1.stop(), a1 = _(a1), p1 = s1.currentTime - M1, a1.start(0, M1), w = !0, d1 = 0)));\n            },\n            set speed (M){\n                a1.playbackRate.value = M;\n            },\n            get speed () {\n                return a1.playbackRate.value;\n            },\n            set detune (M){\n                a1.detune.value = M;\n            },\n            get detune () {\n                return a1.detune.value;\n            },\n            set volume (M){\n                f.gain.value = Math.max(M, 0);\n            },\n            get volume () {\n                return f.gain.value;\n            },\n            set loop (M){\n                a1.loop = M;\n            },\n            get loop () {\n                return a1.loop;\n            },\n            duration () {\n                return a1.buffer?.duration ?? 0;\n            },\n            time () {\n                return N() % this.duration();\n            },\n            onEnd (M1) {\n                return h1.add(M1);\n            },\n            then (M1) {\n                return this.onEnd(M1);\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(It, \"play\");\n    function Lt(t1) {\n        return It(te.burpSnd, t1);\n    }\n    $adc7cb3c45508c7c$var$i(Lt, \"burp\");\n    function wn(t1, r) {\n        return new $adc7cb3c45508c7c$var$rt(q, t1, r);\n    }\n    $adc7cb3c45508c7c$var$i(wn, \"makeCanvas\");\n    function ht(t1 = $adc7cb3c45508c7c$var$Xn, r = $adc7cb3c45508c7c$var$Jn) {\n        let s1 = $adc7cb3c45508c7c$var$Wi.replace(\"{{user}}\", t1 ?? $adc7cb3c45508c7c$var$Xn), u = $adc7cb3c45508c7c$var$Xi.replace(\"{{user}}\", r ?? $adc7cb3c45508c7c$var$Jn);\n        try {\n            return new $adc7cb3c45508c7c$var$Jt(q, s1, u, $adc7cb3c45508c7c$var$Qn.map((a1)=>a1.name));\n        } catch (a1) {\n            let f = /(?<type>^\\w+) SHADER ERROR: 0:(?<line>\\d+): (?<msg>.+)/, b1 = $adc7cb3c45508c7c$var$Br(a1).match(f), p1 = Number(b1.groups.line) - 14, d1 = b1.groups.msg.trim(), w = b1.groups.type.toLowerCase();\n            throw new Error(`${w} shader line ${p1}: ${d1}`);\n        }\n    }\n    $adc7cb3c45508c7c$var$i(ht, \"makeShader\");\n    function bn(t1, r, s1, u) {\n        let a1 = t1.width / r, h1 = {}, f = u.split(\"\").entries();\n        for (let [b1, p1] of f)h1[p1] = new $adc7cb3c45508c7c$var$oe(b1 % a1 * r, Math.floor(b1 / a1) * s1, r, s1);\n        return {\n            tex: t1,\n            map: h1,\n            size: s1\n        };\n    }\n    $adc7cb3c45508c7c$var$i(bn, \"makeFont\");\n    function lt(t1, r, s1, u = E.defTex, a1 = E.defShader, h1 = {}) {\n        let f = pn(a1);\n        if (!f || f instanceof $adc7cb3c45508c7c$var$ve) return;\n        let b1 = E.fixed || s1 ? E.transform : C.cam.transform.mult(E.transform), p1 = [];\n        for (let d1 of t1){\n            let w = vn(b1.multVec2(d1.pos));\n            p1.push(w.x, w.y, d1.uv.x, d1.uv.y, d1.color.r / 255, d1.color.g / 255, d1.color.b / 255, d1.opacity);\n        }\n        E.renderer.push(S.TRIANGLES, p1, r, f, u, h1);\n    }\n    $adc7cb3c45508c7c$var$i(lt, \"drawRaw\");\n    function Pe() {\n        E.renderer.flush();\n    }\n    $adc7cb3c45508c7c$var$i(Pe, \"flush\");\n    function dt() {\n        S.clear(S.COLOR_BUFFER_BIT), E.frameBuffer.bind(), S.clear(S.COLOR_BUFFER_BIT), E.bgColor || Ce(()=>{\n            Be({\n                width: we(),\n                height: xe(),\n                quad: new $adc7cb3c45508c7c$var$oe(0, 0, we() / $adc7cb3c45508c7c$var$Kr, xe() / $adc7cb3c45508c7c$var$Kr),\n                tex: E.bgTex,\n                fixed: !0\n            });\n        }), E.renderer.numDraws = 0, E.fixed = !1, E.transformStack.length = 0, E.transform = new $adc7cb3c45508c7c$var$Ue;\n    }\n    $adc7cb3c45508c7c$var$i(dt, \"frameStart\");\n    function Vt(t1, r) {\n        E.postShader = t1, E.postShaderUniform = r ?? null;\n    }\n    $adc7cb3c45508c7c$var$i(Vt, \"usePostEffect\");\n    function ft() {\n        Pe(), E.lastDrawCalls = E.renderer.numDraws, E.frameBuffer.unbind(), S.viewport(0, 0, S.drawingBufferWidth, S.drawingBufferHeight);\n        let t1 = E.width, r = E.height;\n        E.width = S.drawingBufferWidth / P, E.height = S.drawingBufferHeight / P, We({\n            flipY: !0,\n            tex: E.frameBuffer.tex,\n            pos: new $adc7cb3c45508c7c$var$v(E.viewport.x, E.viewport.y),\n            width: E.viewport.width,\n            height: E.viewport.height,\n            shader: E.postShader,\n            uniform: typeof E.postShaderUniform == \"function\" ? E.postShaderUniform() : E.postShaderUniform,\n            fixed: !0\n        }), Pe(), E.width = t1, E.height = r;\n    }\n    $adc7cb3c45508c7c$var$i(ft, \"frameEnd\");\n    function vn(t1) {\n        return new $adc7cb3c45508c7c$var$v(t1.x / we() * 2 - 1, -t1.y / xe() * 2 + 1);\n    }\n    $adc7cb3c45508c7c$var$i(vn, \"screen2ndc\");\n    function _t(t1) {\n        E.transform = t1.clone();\n    }\n    $adc7cb3c45508c7c$var$i(_t, \"pushMatrix\");\n    function ne(...t1) {\n        if (t1[0] === void 0) return;\n        let r = $adc7cb3c45508c7c$var$T(...t1);\n        r.x === 0 && r.y === 0 || E.transform.translate(r);\n    }\n    $adc7cb3c45508c7c$var$i(ne, \"pushTranslate\");\n    function He(...t1) {\n        if (t1[0] === void 0) return;\n        let r = $adc7cb3c45508c7c$var$T(...t1);\n        r.x === 1 && r.y === 1 || E.transform.scale(r);\n    }\n    $adc7cb3c45508c7c$var$i(He, \"pushScale\");\n    function se(t1) {\n        t1 && E.transform.rotate(t1);\n    }\n    $adc7cb3c45508c7c$var$i(se, \"pushRotate\");\n    function le() {\n        E.transformStack.push(E.transform.clone());\n    }\n    $adc7cb3c45508c7c$var$i(le, \"pushTransform\");\n    function ae() {\n        E.transformStack.length > 0 && (E.transform = E.transformStack.pop());\n    }\n    $adc7cb3c45508c7c$var$i(ae, \"popTransform\");\n    function Be(t1) {\n        if (t1.width === void 0 || t1.height === void 0) throw new Error('drawUVQuad() requires property \"width\" and \"height\".');\n        if (t1.width <= 0 || t1.height <= 0) return;\n        let r = t1.width, s1 = t1.height, a1 = $adc7cb3c45508c7c$var$ut(t1.anchor || $adc7cb3c45508c7c$var$tn).scale(new $adc7cb3c45508c7c$var$v(r, s1).scale(-0.5)), h1 = t1.quad || new $adc7cb3c45508c7c$var$oe(0, 0, 1, 1), f = t1.color || $adc7cb3c45508c7c$var$J(255, 255, 255), b1 = t1.opacity ?? 1, p1 = t1.tex ? $adc7cb3c45508c7c$var$Qr / t1.tex.width : 0, d1 = t1.tex ? $adc7cb3c45508c7c$var$Qr / t1.tex.height : 0, w = h1.x + p1, A = h1.y + d1, D = h1.w - p1 * 2, N = h1.h - d1 * 2;\n        le(), ne(t1.pos), se(t1.angle), He(t1.scale), ne(a1), lt([\n            {\n                pos: new $adc7cb3c45508c7c$var$v(-r / 2, s1 / 2),\n                uv: new $adc7cb3c45508c7c$var$v(t1.flipX ? w + D : w, t1.flipY ? A : A + N),\n                color: f,\n                opacity: b1\n            },\n            {\n                pos: new $adc7cb3c45508c7c$var$v(-r / 2, -s1 / 2),\n                uv: new $adc7cb3c45508c7c$var$v(t1.flipX ? w + D : w, t1.flipY ? A + N : A),\n                color: f,\n                opacity: b1\n            },\n            {\n                pos: new $adc7cb3c45508c7c$var$v(r / 2, -s1 / 2),\n                uv: new $adc7cb3c45508c7c$var$v(t1.flipX ? w : w + D, t1.flipY ? A + N : A),\n                color: f,\n                opacity: b1\n            },\n            {\n                pos: new $adc7cb3c45508c7c$var$v(r / 2, s1 / 2),\n                uv: new $adc7cb3c45508c7c$var$v(t1.flipX ? w : w + D, t1.flipY ? A : A + N),\n                color: f,\n                opacity: b1\n            }\n        ], [\n            0,\n            1,\n            3,\n            1,\n            2,\n            3\n        ], t1.fixed, t1.tex, t1.shader, t1.uniform), ae();\n    }\n    $adc7cb3c45508c7c$var$i(Be, \"drawUVQuad\");\n    function We(t1) {\n        if (!t1.tex) throw new Error('drawTexture() requires property \"tex\".');\n        let r = t1.quad ?? new $adc7cb3c45508c7c$var$oe(0, 0, 1, 1), s1 = t1.tex.width * r.w, u = t1.tex.height * r.h, a1 = new $adc7cb3c45508c7c$var$v(1);\n        if (t1.tiled) {\n            let h1 = Math.ceil((t1.width || s1) / s1), f = Math.ceil((t1.height || u) / u), p1 = $adc7cb3c45508c7c$var$ut(t1.anchor || $adc7cb3c45508c7c$var$tn).add(new $adc7cb3c45508c7c$var$v(1, 1)).scale(.5).scale(h1 * s1, f * u);\n            for(let d1 = 0; d1 < h1; d1++)for(let w = 0; w < f; w++)Be(Object.assign({}, t1, {\n                pos: (t1.pos || new $adc7cb3c45508c7c$var$v(0)).add(new $adc7cb3c45508c7c$var$v(s1 * d1, u * w)).sub(p1),\n                scale: a1.scale(t1.scale || new $adc7cb3c45508c7c$var$v(1)),\n                tex: t1.tex,\n                quad: r,\n                width: s1,\n                height: u,\n                anchor: \"topleft\"\n            }));\n        } else t1.width && t1.height ? (a1.x = t1.width / s1, a1.y = t1.height / u) : t1.width ? (a1.x = t1.width / s1, a1.y = a1.x) : t1.height && (a1.y = t1.height / u, a1.x = a1.y), Be(Object.assign({}, t1, {\n            scale: a1.scale(t1.scale || new $adc7cb3c45508c7c$var$v(1)),\n            tex: t1.tex,\n            quad: r,\n            width: s1,\n            height: u\n        }));\n    }\n    $adc7cb3c45508c7c$var$i(We, \"drawTexture\");\n    function yn(t1) {\n        if (!t1.sprite) throw new Error('drawSprite() requires property \"sprite\"');\n        let r = ct(t1.sprite);\n        if (!r || !r.data) return;\n        let s1 = r.data.frames[t1.frame ?? 0];\n        if (!s1) throw new Error(`Frame not found: ${t1.frame ?? 0}`);\n        We(Object.assign({}, t1, {\n            tex: r.data.tex,\n            quad: s1.scale(t1.quad ?? new $adc7cb3c45508c7c$var$oe(0, 0, 1, 1))\n        }));\n    }\n    $adc7cb3c45508c7c$var$i(yn, \"drawSprite\");\n    function qe(t1, r, s1, u, a1, h1 = 1) {\n        u = $adc7cb3c45508c7c$var$Ge(u % 360), a1 = $adc7cb3c45508c7c$var$Ge(a1 % 360), a1 <= u && (a1 += Math.PI * 2);\n        let f = [], b1 = Math.ceil((a1 - u) / $adc7cb3c45508c7c$var$Ge(8) * h1), p1 = (a1 - u) / b1;\n        for(let d1 = u; d1 < a1; d1 += p1)f.push(t1.add(r * Math.cos(d1), s1 * Math.sin(d1)));\n        return f.push(t1.add(r * Math.cos(a1), s1 * Math.sin(a1))), f;\n    }\n    $adc7cb3c45508c7c$var$i(qe, \"getArcPts\");\n    function ge(t1) {\n        if (t1.width === void 0 || t1.height === void 0) throw new Error('drawRect() requires property \"width\" and \"height\".');\n        if (t1.width <= 0 || t1.height <= 0) return;\n        let r = t1.width, s1 = t1.height, a1 = $adc7cb3c45508c7c$var$ut(t1.anchor || $adc7cb3c45508c7c$var$tn).add(1, 1).scale(new $adc7cb3c45508c7c$var$v(r, s1).scale(-0.5)), h1 = [\n            new $adc7cb3c45508c7c$var$v(0, 0),\n            new $adc7cb3c45508c7c$var$v(r, 0),\n            new $adc7cb3c45508c7c$var$v(r, s1),\n            new $adc7cb3c45508c7c$var$v(0, s1)\n        ];\n        if (t1.radius) {\n            let f = Math.min(Math.min(r, s1) / 2, t1.radius);\n            h1 = [\n                new $adc7cb3c45508c7c$var$v(f, 0),\n                new $adc7cb3c45508c7c$var$v(r - f, 0),\n                ...qe(new $adc7cb3c45508c7c$var$v(r - f, f), f, f, 270, 360),\n                new $adc7cb3c45508c7c$var$v(r, f),\n                new $adc7cb3c45508c7c$var$v(r, s1 - f),\n                ...qe(new $adc7cb3c45508c7c$var$v(r - f, s1 - f), f, f, 0, 90),\n                new $adc7cb3c45508c7c$var$v(r - f, s1),\n                new $adc7cb3c45508c7c$var$v(f, s1),\n                ...qe(new $adc7cb3c45508c7c$var$v(f, s1 - f), f, f, 90, 180),\n                new $adc7cb3c45508c7c$var$v(0, s1 - f),\n                new $adc7cb3c45508c7c$var$v(0, f),\n                ...qe(new $adc7cb3c45508c7c$var$v(f, f), f, f, 180, 270)\n            ];\n        }\n        z(Object.assign({}, t1, {\n            offset: a1,\n            pts: h1,\n            ...t1.gradient ? {\n                colors: t1.horizontal ? [\n                    t1.gradient[0],\n                    t1.gradient[1],\n                    t1.gradient[1],\n                    t1.gradient[0]\n                ] : [\n                    t1.gradient[0],\n                    t1.gradient[0],\n                    t1.gradient[1],\n                    t1.gradient[1]\n                ]\n            } : {}\n        }));\n    }\n    $adc7cb3c45508c7c$var$i(ge, \"drawRect\");\n    function l(t1) {\n        let { p1: r, p2: s1 } = t1;\n        if (!r || !s1) throw new Error('drawLine() requires properties \"p1\" and \"p2\".');\n        let u = t1.width || 1, a1 = s1.sub(r).unit().normal().scale(u * .5), h1 = [\n            r.sub(a1),\n            r.add(a1),\n            s1.add(a1),\n            s1.sub(a1)\n        ].map((f)=>({\n                pos: new $adc7cb3c45508c7c$var$v(f.x, f.y),\n                uv: new $adc7cb3c45508c7c$var$v(0),\n                color: t1.color ?? $adc7cb3c45508c7c$var$W.WHITE,\n                opacity: t1.opacity ?? 1\n            }));\n        lt(h1, [\n            0,\n            1,\n            3,\n            1,\n            2,\n            3\n        ], t1.fixed, E.defTex, t1.shader, t1.uniform);\n    }\n    $adc7cb3c45508c7c$var$i(l, \"drawLine\");\n    function x(t1) {\n        let r = t1.pts;\n        if (!r) throw new Error('drawLines() requires property \"pts\".');\n        if (!(r.length < 2)) {\n            if (t1.radius && r.length >= 3) {\n                let s1 = r[0].sdist(r[1]);\n                for(let a1 = 1; a1 < r.length - 1; a1++)s1 = Math.min(r[a1].sdist(r[a1 + 1]), s1);\n                let u = Math.min(t1.radius, Math.sqrt(s1) / 2);\n                l(Object.assign({}, t1, {\n                    p1: r[0],\n                    p2: r[1]\n                }));\n                for(let a1 = 1; a1 < r.length - 2; a1++){\n                    let h1 = r[a1], f = r[a1 + 1];\n                    l(Object.assign({}, t1, {\n                        p1: h1,\n                        p2: f\n                    }));\n                }\n                l(Object.assign({}, t1, {\n                    p1: r[r.length - 2],\n                    p2: r[r.length - 1]\n                }));\n            } else for(let s1 = 0; s1 < r.length - 1; s1++)l(Object.assign({}, t1, {\n                p1: r[s1],\n                p2: r[s1 + 1]\n            })), t1.join !== \"none\" && L(Object.assign({}, t1, {\n                pos: r[s1],\n                radius: t1.width / 2\n            }));\n        }\n    }\n    $adc7cb3c45508c7c$var$i(x, \"drawLines\");\n    function R(t1) {\n        if (!t1.p1 || !t1.p2 || !t1.p3) throw new Error('drawTriangle() requires properties \"p1\", \"p2\" and \"p3\".');\n        return z(Object.assign({}, t1, {\n            pts: [\n                t1.p1,\n                t1.p2,\n                t1.p3\n            ]\n        }));\n    }\n    $adc7cb3c45508c7c$var$i(R, \"drawTriangle\");\n    function L(t1) {\n        if (typeof t1.radius != \"number\") throw new Error('drawCircle() requires property \"radius\".');\n        t1.radius !== 0 && he(Object.assign({}, t1, {\n            radiusX: t1.radius,\n            radiusY: t1.radius,\n            angle: 0\n        }));\n    }\n    $adc7cb3c45508c7c$var$i(L, \"drawCircle\");\n    function he(t1) {\n        if (t1.radiusX === void 0 || t1.radiusY === void 0) throw new Error('drawEllipse() requires properties \"radiusX\" and \"radiusY\".');\n        if (t1.radiusX === 0 || t1.radiusY === 0) return;\n        let r = t1.start ?? 0, s1 = t1.end ?? 360, u = $adc7cb3c45508c7c$var$ut(t1.anchor ?? \"center\").scale(new $adc7cb3c45508c7c$var$v(-t1.radiusX, -t1.radiusY)), a1 = qe(u, t1.radiusX, t1.radiusY, r, s1, t1.resolution);\n        a1.unshift(u);\n        let h1 = Object.assign({}, t1, {\n            pts: a1,\n            radius: 0,\n            ...t1.gradient ? {\n                colors: [\n                    t1.gradient[0],\n                    ...Array(a1.length - 1).fill(t1.gradient[1])\n                ]\n            } : {}\n        });\n        if (s1 - r >= 360 && t1.outline) {\n            t1.fill !== !1 && z(Object.assign(h1, {\n                outline: null\n            })), z(Object.assign(h1, {\n                pts: a1.slice(1),\n                fill: !1\n            }));\n            return;\n        }\n        z(h1);\n    }\n    $adc7cb3c45508c7c$var$i(he, \"drawEllipse\");\n    function z(t1) {\n        if (!t1.pts) throw new Error('drawPolygon() requires property \"pts\".');\n        let r = t1.pts.length;\n        if (!(r < 3)) {\n            if (le(), ne(t1.pos), He(t1.scale), se(t1.angle), ne(t1.offset), t1.fill !== !1) {\n                let s1 = t1.color ?? $adc7cb3c45508c7c$var$W.WHITE, u = t1.pts.map((h1, f)=>({\n                        pos: new $adc7cb3c45508c7c$var$v(h1.x, h1.y),\n                        uv: new $adc7cb3c45508c7c$var$v(0, 0),\n                        color: t1.colors && t1.colors[f] ? t1.colors[f].mult(s1) : s1,\n                        opacity: t1.opacity ?? 1\n                    })), a1 = [\n                    ...Array(r - 2).keys()\n                ].map((h1)=>[\n                        0,\n                        h1 + 1,\n                        h1 + 2\n                    ]).flat();\n                lt(u, t1.indices ?? a1, t1.fixed, E.defTex, t1.shader, t1.uniform);\n            }\n            t1.outline && x({\n                pts: [\n                    ...t1.pts,\n                    t1.pts[0]\n                ],\n                radius: t1.radius,\n                width: t1.outline.width,\n                color: t1.outline.color,\n                join: t1.outline.join,\n                uniform: t1.uniform,\n                fixed: t1.fixed,\n                opacity: t1.opacity\n            }), ae();\n        }\n    }\n    $adc7cb3c45508c7c$var$i(z, \"drawPolygon\");\n    function Oe(t1, r, s1) {\n        Pe(), S.clear(S.STENCIL_BUFFER_BIT), S.enable(S.STENCIL_TEST), S.stencilFunc(S.NEVER, 1, 255), S.stencilOp(S.REPLACE, S.REPLACE, S.REPLACE), r(), Pe(), S.stencilFunc(s1, 1, 255), S.stencilOp(S.KEEP, S.KEEP, S.KEEP), t1(), Pe(), S.disable(S.STENCIL_TEST);\n    }\n    $adc7cb3c45508c7c$var$i(Oe, \"drawStenciled\");\n    function $e(t1, r) {\n        Oe(t1, r, S.EQUAL);\n    }\n    $adc7cb3c45508c7c$var$i($e, \"drawMasked\");\n    function kt(t1, r) {\n        Oe(t1, r, S.NOTEQUAL);\n    }\n    $adc7cb3c45508c7c$var$i(kt, \"drawSubtracted\");\n    function De() {\n        return (E.viewport.width + E.viewport.height) / (E.width + E.height);\n    }\n    $adc7cb3c45508c7c$var$i(De, \"getViewportScale\");\n    function Ce(t1) {\n        Pe();\n        let r = E.width, s1 = E.height;\n        E.width = E.viewport.width, E.height = E.viewport.height, t1(), Pe(), E.width = r, E.height = s1;\n    }\n    $adc7cb3c45508c7c$var$i(Ce, \"drawUnscaled\");\n    function Zn(t1, r) {\n        r.pos && (t1.pos = t1.pos.add(r.pos)), r.scale && (t1.scale = t1.scale.scale($adc7cb3c45508c7c$var$T(r.scale))), r.angle && (t1.angle += r.angle), r.color && t1.ch.length === 1 && (t1.color = t1.color.mult(r.color)), r.opacity && (t1.opacity *= r.opacity);\n    }\n    $adc7cb3c45508c7c$var$i(Zn, \"applyCharTransform\");\n    let er = /\\[(?<style>\\w+)\\](?<text>.*?)\\[\\/\\k<style>\\]/g;\n    function es(t1) {\n        let r = {}, s1 = t1.replace(er, \"$2\"), u = 0;\n        for (let a1 of t1.matchAll(er)){\n            let h1 = a1.index - u;\n            for(let f = 0; f < a1.groups.text.length; f++)r[f + h1] = [\n                a1.groups.style\n            ];\n            u += a1[0].length - a1.groups.text.length;\n        }\n        return {\n            charStyleMap: r,\n            text: s1\n        };\n    }\n    $adc7cb3c45508c7c$var$i(es, \"compileStyledText\");\n    let xn = {};\n    function Xe(t1) {\n        if (t1.text === void 0) throw new Error('formatText() requires property \"text\".');\n        let r = Ft(t1.font);\n        if (t1.text === \"\" || r instanceof $adc7cb3c45508c7c$var$ve || !r) return {\n            width: 0,\n            height: 0,\n            chars: [],\n            opt: t1\n        };\n        let { charStyleMap: s1, text: u } = es(t1.text + \"\"), a1 = $adc7cb3c45508c7c$var$Fr(u);\n        if (r instanceof Se || typeof r == \"string\") {\n            let Z = r instanceof Se ? r.fontface.family : r, H = r instanceof Se ? {\n                outline: r.outline,\n                filter: r.filter\n            } : {\n                outline: null,\n                filter: $adc7cb3c45508c7c$var$Wn\n            }, V = xn[Z] ?? {\n                font: {\n                    tex: new $adc7cb3c45508c7c$var$Re(q, $adc7cb3c45508c7c$var$Yr, $adc7cb3c45508c7c$var$Wr, {\n                        filter: H.filter\n                    }),\n                    map: {},\n                    size: $adc7cb3c45508c7c$var$rn\n                },\n                cursor: new $adc7cb3c45508c7c$var$v(0),\n                outline: H.outline\n            };\n            xn[Z] || (xn[Z] = V), r = V.font;\n            for (let fe of a1)if (!V.font.map[fe]) {\n                let U = j;\n                U.clearRect(0, 0, I.width, I.height), U.font = `${r.size}px ${Z}`, U.textBaseline = \"top\", U.textAlign = \"left\", U.fillStyle = \"#ffffff\";\n                let G = U.measureText(fe), B = Math.ceil(G.width), F = r.size;\n                V.outline && (U.lineJoin = \"round\", U.lineWidth = V.outline.width * 2, U.strokeStyle = V.outline.color.toHex(), U.strokeText(fe, V.outline.width, V.outline.width), B += V.outline.width * 2, F += V.outline.width * 3), U.fillText(fe, V.outline?.width ?? 0, V.outline?.width ?? 0);\n                let Y = U.getImageData(0, 0, B, F);\n                if (V.cursor.x + B > $adc7cb3c45508c7c$var$Yr && (V.cursor.x = 0, V.cursor.y += F, V.cursor.y > $adc7cb3c45508c7c$var$Wr)) throw new Error(\"Font atlas exceeds character limit\");\n                r.tex.update(Y, V.cursor.x, V.cursor.y), r.map[fe] = new $adc7cb3c45508c7c$var$oe(V.cursor.x, V.cursor.y, B, F), V.cursor.x += B;\n            }\n        }\n        let h1 = t1.size || r.size, f = $adc7cb3c45508c7c$var$T(t1.scale ?? 1).scale(h1 / r.size), b1 = t1.lineSpacing ?? 0, p1 = t1.letterSpacing ?? 0, d1 = 0, w = 0, A = 0, D = [], N = [], _ = 0, M1 = null, O = null;\n        for(; _ < a1.length;){\n            let Z = a1[_];\n            if (Z === `\n`) A += h1 + b1, D.push({\n                width: d1 - p1,\n                chars: N\n            }), M1 = null, O = null, d1 = 0, N = [];\n            else {\n                let H = r.map[Z];\n                if (H) {\n                    let V = H.w * f.x;\n                    t1.width && d1 + V > t1.width && (A += h1 + b1, M1 != null && (_ -= N.length - M1, Z = a1[_], H = r.map[Z], V = H.w * f.x, N = N.slice(0, M1 - 1), d1 = O), M1 = null, O = null, D.push({\n                        width: d1 - p1,\n                        chars: N\n                    }), d1 = 0, N = []), N.push({\n                        tex: r.tex,\n                        width: H.w,\n                        height: H.h,\n                        quad: new $adc7cb3c45508c7c$var$oe(H.x / r.tex.width, H.y / r.tex.height, H.w / r.tex.width, H.h / r.tex.height),\n                        ch: Z,\n                        pos: new $adc7cb3c45508c7c$var$v(d1, A),\n                        opacity: t1.opacity ?? 1,\n                        color: t1.color ?? $adc7cb3c45508c7c$var$W.WHITE,\n                        scale: $adc7cb3c45508c7c$var$T(f),\n                        angle: 0\n                    }), Z === \" \" && (M1 = N.length, O = d1), d1 += V, w = Math.max(w, d1), d1 += p1;\n                }\n            }\n            _++;\n        }\n        D.push({\n            width: d1 - p1,\n            chars: N\n        }), A += h1, t1.width && (w = t1.width);\n        let ie = [];\n        for (let Z of D){\n            let H = (w - Z.width) * $adc7cb3c45508c7c$var$Zi(t1.align ?? \"left\");\n            for (let V of Z.chars){\n                let fe = r.map[V.ch], U = ie.length;\n                if (V.pos = V.pos.add(H, 0).add(fe.w * f.x * .5, fe.h * f.y * .5), t1.transform) {\n                    let G = typeof t1.transform == \"function\" ? t1.transform(U, V.ch) : t1.transform;\n                    G && Zn(V, G);\n                }\n                if (s1[U]) {\n                    let G = s1[U];\n                    for (let B of G){\n                        let F = t1.styles[B], Y = typeof F == \"function\" ? F(U, V.ch) : F;\n                        Y && Zn(V, Y);\n                    }\n                }\n                ie.push(V);\n            }\n        }\n        return {\n            width: w,\n            height: A,\n            chars: ie,\n            opt: t1\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Xe, \"formatText\");\n    function tr(t1) {\n        Je(Xe(t1));\n    }\n    $adc7cb3c45508c7c$var$i(tr, \"drawText\");\n    function Je(t1) {\n        le(), ne(t1.opt.pos), se(t1.opt.angle), ne($adc7cb3c45508c7c$var$ut(t1.opt.anchor ?? \"topleft\").add(1, 1).scale(t1.width, t1.height).scale(-0.5)), t1.chars.forEach((r)=>{\n            Be({\n                tex: r.tex,\n                width: r.width,\n                height: r.height,\n                pos: r.pos,\n                scale: r.scale,\n                angle: r.angle,\n                color: r.color,\n                opacity: r.opacity,\n                quad: r.quad,\n                anchor: \"center\",\n                uniform: t1.opt.uniform,\n                shader: t1.opt.shader,\n                fixed: t1.opt.fixed\n            });\n        }), ae();\n    }\n    $adc7cb3c45508c7c$var$i(Je, \"drawFormattedText\");\n    function we() {\n        return E.width;\n    }\n    $adc7cb3c45508c7c$var$i(we, \"width\");\n    function xe() {\n        return E.height;\n    }\n    $adc7cb3c45508c7c$var$i(xe, \"height\");\n    function ts(t1) {\n        return new $adc7cb3c45508c7c$var$v((t1.x - E.viewport.x) * we() / E.viewport.width, (t1.y - E.viewport.y) * xe() / E.viewport.height);\n    }\n    $adc7cb3c45508c7c$var$i(ts, \"windowToContent\");\n    function ns(t1) {\n        return new $adc7cb3c45508c7c$var$v(t1.x * E.viewport.width / E.width, t1.y * E.viewport.height / E.height);\n    }\n    $adc7cb3c45508c7c$var$i(ns, \"contentToView\");\n    function Nt() {\n        return ts(y.mousePos());\n    }\n    $adc7cb3c45508c7c$var$i(Nt, \"mousePos\");\n    let nr = !1, re = {\n        inspect: !1,\n        timeScale: 1,\n        showLog: !0,\n        fps: ()=>y.fps(),\n        numFrames: ()=>y.numFrames(),\n        stepFrame: dr,\n        drawCalls: ()=>E.lastDrawCalls,\n        clearLog: ()=>C.logs = [],\n        log: (t1)=>{\n            let r = n.logMax ?? $adc7cb3c45508c7c$var$qi;\n            C.logs.unshift({\n                msg: t1,\n                time: y.time()\n            }), C.logs.length > r && (C.logs = C.logs.slice(0, r));\n        },\n        error: (t1)=>re.log(new Error(t1.toString ? t1.toString() : t1)),\n        curRecording: null,\n        numObjects: ()=>On(\"*\", {\n                recursive: !0\n            }).length,\n        get paused () {\n            return nr;\n        },\n        set paused (t){\n            nr = t, t ? te.ctx.suspend() : te.ctx.resume();\n        }\n    };\n    function Me() {\n        return y.dt() * re.timeScale;\n    }\n    $adc7cb3c45508c7c$var$i(Me, \"dt\");\n    function rs(...t1) {\n        return t1.length > 0 && (C.cam.pos = $adc7cb3c45508c7c$var$T(...t1)), C.cam.pos ? C.cam.pos.clone() : zt();\n    }\n    $adc7cb3c45508c7c$var$i(rs, \"camPos\");\n    function ss(...t1) {\n        return t1.length > 0 && (C.cam.scale = $adc7cb3c45508c7c$var$T(...t1)), C.cam.scale.clone();\n    }\n    $adc7cb3c45508c7c$var$i(ss, \"camScale\");\n    function is(t1) {\n        return t1 !== void 0 && (C.cam.angle = t1), C.cam.angle;\n    }\n    $adc7cb3c45508c7c$var$i(is, \"camRot\");\n    function os(t1 = 12) {\n        C.cam.shake += t1;\n    }\n    $adc7cb3c45508c7c$var$i(os, \"shake\");\n    function rr(t1) {\n        return C.cam.transform.multVec2(t1);\n    }\n    $adc7cb3c45508c7c$var$i(rr, \"toScreen\");\n    function sr(t1) {\n        return C.cam.transform.invert().multVec2(t1);\n    }\n    $adc7cb3c45508c7c$var$i(sr, \"toWorld\");\n    function jt(t1) {\n        let r = new $adc7cb3c45508c7c$var$Ue;\n        return t1.pos && r.translate(t1.pos), t1.scale && r.scale(t1.scale), t1.angle && r.rotate(t1.angle), t1.parent ? r.mult(t1.parent.transform) : r;\n    }\n    $adc7cb3c45508c7c$var$i(jt, \"calcTransform\");\n    function Un(t1 = []) {\n        let r = new Map, s1 = {}, u = new $adc7cb3c45508c7c$var$Ne, a1 = [], h1 = null, f = !1, b1 = {\n            id: $adc7cb3c45508c7c$var$Gr(),\n            hidden: !1,\n            transform: new $adc7cb3c45508c7c$var$Ue,\n            children: [],\n            parent: null,\n            set paused (d){\n                if (d !== f) {\n                    f = d;\n                    for (let w of a1)w.paused = d;\n                }\n            },\n            get paused () {\n                return f;\n            },\n            add (d1 = []) {\n                let w = Array.isArray(d1) ? Un(d1) : d1;\n                if (w.parent) throw new Error(\"Cannot add a game obj that already has a parent.\");\n                return w.parent = this, w.transform = jt(w), this.children.push(w), w.trigger(\"add\", w), C.events.trigger(\"add\", w), w;\n            },\n            readd (d1) {\n                let w = this.children.indexOf(d1);\n                return w !== -1 && (this.children.splice(w, 1), this.children.push(d1)), d1;\n            },\n            remove (d1) {\n                let w = this.children.indexOf(d1);\n                if (w !== -1) {\n                    d1.parent = null, this.children.splice(w, 1);\n                    let A = $adc7cb3c45508c7c$var$i((D)=>{\n                        D.trigger(\"destroy\"), C.events.trigger(\"destroy\", D), D.children.forEach((N)=>A(N));\n                    }, \"trigger\");\n                    A(d1);\n                }\n            },\n            removeAll (d1) {\n                if (d1) this.get(d1).forEach((w)=>this.remove(w));\n                else for (let w of [\n                    ...this.children\n                ])this.remove(w);\n            },\n            update () {\n                this.paused || (this.children.sort((d1, w)=>(d1.z ?? 0) - (w.z ?? 0)).forEach((d1)=>d1.update()), this.trigger(\"update\"));\n            },\n            draw () {\n                if (this.hidden) return;\n                this.canvas && this.canvas.bind();\n                let d1 = E.fixed;\n                this.fixed && (E.fixed = !0), le(), ne(this.pos), He(this.scale), se(this.angle);\n                let w = this.children.sort((A, D)=>(A.z ?? 0) - (D.z ?? 0));\n                if (this.mask) {\n                    let A = {\n                        intersect: $e,\n                        subtract: kt\n                    }[this.mask];\n                    if (!A) throw new Error(`Invalid mask func: \"${this.mask}\"`);\n                    A(()=>{\n                        w.forEach((D)=>D.draw());\n                    }, ()=>{\n                        this.trigger(\"draw\");\n                    });\n                } else this.trigger(\"draw\"), w.forEach((A)=>A.draw());\n                ae(), E.fixed = d1, this.canvas && this.canvas.unbind();\n            },\n            drawInspect () {\n                this.hidden || (le(), ne(this.pos), He(this.scale), se(this.angle), this.children.sort((d1, w)=>(d1.z ?? 0) - (w.z ?? 0)).forEach((d1)=>d1.drawInspect()), this.trigger(\"drawInspect\"), ae());\n            },\n            use (d1) {\n                if (!d1) return;\n                if (typeof d1 == \"string\") return this.use({\n                    id: d1\n                });\n                let w = [];\n                d1.id && (this.unuse(d1.id), s1[d1.id] = [], w = s1[d1.id], r.set(d1.id, d1));\n                for(let D in d1){\n                    if ($adc7cb3c45508c7c$var$Ji.has(D)) continue;\n                    let N = Object.getOwnPropertyDescriptor(d1, D);\n                    if (typeof N.value == \"function\" && (d1[D] = d1[D].bind(this)), N.set && Object.defineProperty(d1, D, {\n                        set: N.set.bind(this)\n                    }), N.get && Object.defineProperty(d1, D, {\n                        get: N.get.bind(this)\n                    }), $adc7cb3c45508c7c$var$Qi.has(D)) {\n                        let _ = D === \"add\" ? ()=>{\n                            h1 = $adc7cb3c45508c7c$var$i((M1)=>w.push(M1), \"onCurCompCleanup\"), d1[D](), h1 = null;\n                        } : d1[D];\n                        w.push(this.on(D, _).cancel);\n                    } else if (this[D] === void 0) Object.defineProperty(this, D, {\n                        get: ()=>d1[D],\n                        set: (_)=>d1[D] = _,\n                        configurable: !0,\n                        enumerable: !0\n                    }), w.push(()=>delete this[D]);\n                    else throw new Error(`Duplicate component property: \"${D}\"`);\n                }\n                let A = $adc7cb3c45508c7c$var$i(()=>{\n                    if (d1.require) {\n                        for (let D of d1.require)if (!this.c(D)) throw new Error(`Component \"${d1.id}\" requires component \"${D}\"`);\n                    }\n                }, \"checkDeps\");\n                d1.destroy && w.push(d1.destroy.bind(this)), this.exists() ? (A(), d1.add && (h1 = $adc7cb3c45508c7c$var$i((D)=>w.push(D), \"onCurCompCleanup\"), d1.add.call(this), h1 = null)) : d1.require && w.push(this.on(\"add\", A).cancel);\n            },\n            unuse (d1) {\n                s1[d1] && (s1[d1].forEach((w)=>w()), delete s1[d1]), r.has(d1) && r.delete(d1);\n            },\n            c (d1) {\n                return r.get(d1);\n            },\n            get (d1, w = {}) {\n                let A = w.recursive ? this.children.flatMap($adc7cb3c45508c7c$var$i(function D(N) {\n                    return [\n                        N,\n                        ...N.children.flatMap(D)\n                    ];\n                }, \"recurse\")) : this.children;\n                if (A = A.filter((D)=>d1 ? D.is(d1) : !0), w.liveUpdate) {\n                    let D = $adc7cb3c45508c7c$var$i((_)=>w.recursive ? this.isAncestorOf(_) : _.parent === this, \"isChild\"), N = [];\n                    N.push(En((_)=>{\n                        D(_) && _.is(d1) && A.push(_);\n                    })), N.push(ir((_)=>{\n                        if (D(_) && _.is(d1)) {\n                            let M1 = A.findIndex((O)=>O.id === _.id);\n                            M1 !== -1 && A.splice(M1, 1);\n                        }\n                    })), this.onDestroy(()=>{\n                        for (let _ of N)_.cancel();\n                    });\n                }\n                return A;\n            },\n            isAncestorOf (d1) {\n                return d1.parent ? d1.parent === this || this.isAncestorOf(d1.parent) : !1;\n            },\n            exists () {\n                return C.root.isAncestorOf(this);\n            },\n            is (d1) {\n                if (d1 === \"*\") return !0;\n                if (Array.isArray(d1)) {\n                    for (let w of d1)if (!this.c(w)) return !1;\n                    return !0;\n                } else return this.c(d1) != null;\n            },\n            on (d1, w) {\n                let A = u.on(d1, w.bind(this));\n                return h1 && h1(()=>A.cancel()), A;\n            },\n            trigger (d1, ...w) {\n                u.trigger(d1, ...w), C.objEvents.trigger(d1, this, ...w);\n            },\n            destroy () {\n                this.parent && this.parent.remove(this);\n            },\n            inspect () {\n                let d1 = {};\n                for (let [w, A] of r)d1[w] = A.inspect ? A.inspect() : null;\n                return d1;\n            },\n            onAdd (d1) {\n                return this.on(\"add\", d1);\n            },\n            onUpdate (d1) {\n                return this.on(\"update\", d1);\n            },\n            onDraw (d1) {\n                return this.on(\"draw\", d1);\n            },\n            onDestroy (d1) {\n                return this.on(\"destroy\", d1);\n            },\n            clearEvents () {\n                u.clear();\n            }\n        }, p1 = [\n            \"onKeyPress\",\n            \"onKeyPressRepeat\",\n            \"onKeyDown\",\n            \"onKeyRelease\",\n            \"onMousePress\",\n            \"onMouseDown\",\n            \"onMouseRelease\",\n            \"onMouseMove\",\n            \"onCharInput\",\n            \"onMouseMove\",\n            \"onTouchStart\",\n            \"onTouchMove\",\n            \"onTouchEnd\",\n            \"onScroll\",\n            \"onGamepadButtonPress\",\n            \"onGamepadButtonDown\",\n            \"onGamepadButtonRelease\",\n            \"onGamepadStick\"\n        ];\n        for (let d1 of p1)b1[d1] = (...w)=>{\n            let A = y[d1](...w);\n            return a1.push(A), b1.onDestroy(()=>A.cancel()), A;\n        };\n        for (let d1 of t1)b1.use(d1);\n        return b1;\n    }\n    $adc7cb3c45508c7c$var$i(Un, \"make\");\n    function ze(t1, r, s1) {\n        return C.objEvents[t1] || (C.objEvents[t1] = new $adc7cb3c45508c7c$var$Ut), C.objEvents.on(t1, (u, ...a1)=>{\n            u.is(r) && s1(u, ...a1);\n        });\n    }\n    $adc7cb3c45508c7c$var$i(ze, \"on\");\n    let as = $adc7cb3c45508c7c$var$Ee((t1)=>{\n        let r = gt([\n            {\n                update: t1\n            }\n        ]);\n        return {\n            get paused () {\n                return r.paused;\n            },\n            set paused (s){\n                r.paused = s;\n            },\n            cancel: ()=>r.destroy()\n        };\n    }, (t1, r)=>ze(\"update\", t1, r)), us = $adc7cb3c45508c7c$var$Ee((t1)=>{\n        let r = gt([\n            {\n                draw: t1\n            }\n        ]);\n        return {\n            get paused () {\n                return r.hidden;\n            },\n            set paused (s){\n                r.hidden = s;\n            },\n            cancel: ()=>r.destroy()\n        };\n    }, (t1, r)=>ze(\"draw\", t1, r)), En = $adc7cb3c45508c7c$var$Ee((t1)=>C.events.on(\"add\", t1), (t1, r)=>ze(\"add\", t1, r)), ir = $adc7cb3c45508c7c$var$Ee((t1)=>C.events.on(\"destroy\", t1), (t1, r)=>ze(\"destroy\", t1, r));\n    function cs(t1, r, s1) {\n        return ze(\"collide\", t1, (u, a1, h1)=>a1.is(r) && s1(u, a1, h1));\n    }\n    $adc7cb3c45508c7c$var$i(cs, \"onCollide\");\n    function hs(t1, r, s1) {\n        return ze(\"collideUpdate\", t1, (u, a1, h1)=>a1.is(r) && s1(u, a1, h1));\n    }\n    $adc7cb3c45508c7c$var$i(hs, \"onCollideUpdate\");\n    function ls(t1, r, s1) {\n        return ze(\"collideEnd\", t1, (u, a1, h1)=>a1.is(r) && s1(u, a1, h1));\n    }\n    $adc7cb3c45508c7c$var$i(ls, \"onCollideEnd\");\n    function Ht(t1, r) {\n        On(t1, {\n            recursive: !0\n        }).forEach(r), En(t1, r);\n    }\n    $adc7cb3c45508c7c$var$i(Ht, \"forAllCurrentAndFuture\");\n    let ds = $adc7cb3c45508c7c$var$Ee((t1)=>y.onMousePress(t1), (t1, r)=>{\n        let s1 = [];\n        return Ht(t1, (u)=>{\n            if (!u.area) throw new Error(\"onClick() requires the object to have area() component\");\n            s1.push(u.onClick(()=>r(u)));\n        }), $adc7cb3c45508c7c$var$ke.join(s1);\n    });\n    function fs(t1, r) {\n        let s1 = [];\n        return Ht(t1, (u)=>{\n            if (!u.area) throw new Error(\"onHover() requires the object to have area() component\");\n            s1.push(u.onHover(()=>r(u)));\n        }), $adc7cb3c45508c7c$var$ke.join(s1);\n    }\n    $adc7cb3c45508c7c$var$i(fs, \"onHover\");\n    function ms(t1, r) {\n        let s1 = [];\n        return Ht(t1, (u)=>{\n            if (!u.area) throw new Error(\"onHoverUpdate() requires the object to have area() component\");\n            s1.push(u.onHoverUpdate(()=>r(u)));\n        }), $adc7cb3c45508c7c$var$ke.join(s1);\n    }\n    $adc7cb3c45508c7c$var$i(ms, \"onHoverUpdate\");\n    function ps(t1, r) {\n        let s1 = [];\n        return Ht(t1, (u)=>{\n            if (!u.area) throw new Error(\"onHoverEnd() requires the object to have area() component\");\n            s1.push(u.onHoverEnd(()=>r(u)));\n        }), $adc7cb3c45508c7c$var$ke.join(s1);\n    }\n    $adc7cb3c45508c7c$var$i(ps, \"onHoverEnd\");\n    function gs(t1) {\n        C.gravity = t1;\n    }\n    $adc7cb3c45508c7c$var$i(gs, \"setGravity\");\n    function ws() {\n        return C.gravity;\n    }\n    $adc7cb3c45508c7c$var$i(ws, \"getGravity\");\n    function bs(...t1) {\n        t1.length === 1 || t1.length === 2 ? (E.bgColor = $adc7cb3c45508c7c$var$J(t1[0]), t1[1] && (E.bgAlpha = t1[1])) : (t1.length === 3 || t1.length === 4) && (E.bgColor = $adc7cb3c45508c7c$var$J(t1[0], t1[1], t1[2]), t1[3] && (E.bgAlpha = t1[3])), S.clearColor(E.bgColor.r / 255, E.bgColor.g / 255, E.bgColor.b / 255, E.bgAlpha);\n    }\n    $adc7cb3c45508c7c$var$i(bs, \"setBackground\");\n    function vs() {\n        return E.bgColor.clone();\n    }\n    $adc7cb3c45508c7c$var$i(vs, \"getBackground\");\n    function qt(...t1) {\n        return {\n            id: \"pos\",\n            pos: $adc7cb3c45508c7c$var$T(...t1),\n            moveBy (...r) {\n                this.pos = this.pos.add($adc7cb3c45508c7c$var$T(...r));\n            },\n            move (...r) {\n                this.moveBy($adc7cb3c45508c7c$var$T(...r).scale(Me()));\n            },\n            moveTo (...r) {\n                if (typeof r[0] == \"number\" && typeof r[1] == \"number\") return this.moveTo($adc7cb3c45508c7c$var$T(r[0], r[1]), r[2]);\n                let s1 = r[0], u = r[1];\n                if (u === void 0) {\n                    this.pos = $adc7cb3c45508c7c$var$T(s1);\n                    return;\n                }\n                let a1 = s1.sub(this.pos);\n                if (a1.len() <= u * Me()) {\n                    this.pos = $adc7cb3c45508c7c$var$T(s1);\n                    return;\n                }\n                this.move(a1.unit().scale(u));\n            },\n            worldPos () {\n                return this.parent ? this.parent.transform.multVec2(this.pos) : this.pos;\n            },\n            screenPos () {\n                let r = this.worldPos();\n                return pt(this) ? r : rr(r);\n            },\n            inspect () {\n                return `(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`;\n            },\n            drawInspect () {\n                L({\n                    color: $adc7cb3c45508c7c$var$J(255, 0, 0),\n                    radius: 4 / De()\n                });\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(qt, \"pos\");\n    function $t(...t1) {\n        return t1.length === 0 ? $t(1) : {\n            id: \"scale\",\n            scale: $adc7cb3c45508c7c$var$T(...t1),\n            scaleTo (...r) {\n                this.scale = $adc7cb3c45508c7c$var$T(...r);\n            },\n            scaleBy (...r) {\n                this.scale.scale($adc7cb3c45508c7c$var$T(...r));\n            },\n            inspect () {\n                return `(${mt(this.scale.x, 2)}, ${mt(this.scale.y, 2)})`;\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i($t, \"scale\");\n    function ys(t1) {\n        return {\n            id: \"rotate\",\n            angle: t1 ?? 0,\n            rotateBy (r) {\n                this.angle += r;\n            },\n            rotateTo (r) {\n                this.angle = r;\n            },\n            inspect () {\n                return `${Math.round(this.angle)}`;\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(ys, \"rotate\");\n    function xs(...t1) {\n        return {\n            id: \"color\",\n            color: $adc7cb3c45508c7c$var$J(...t1),\n            inspect () {\n                return this.color.toString();\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(xs, \"color\");\n    function mt(t1, r) {\n        return Number(t1.toFixed(r));\n    }\n    $adc7cb3c45508c7c$var$i(mt, \"toFixed\");\n    function Us(t1) {\n        return {\n            id: \"opacity\",\n            opacity: t1 ?? 1,\n            inspect () {\n                return `${mt(this.opacity, 1)}`;\n            },\n            fadeOut (r = 1, s1 = $adc7cb3c45508c7c$var$Ct.linear) {\n                return Rn(this.opacity, 0, r, (u)=>this.opacity = u, s1);\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Us, \"opacity\");\n    function Sn(t1) {\n        if (!t1) throw new Error(\"Please define an anchor\");\n        return {\n            id: \"anchor\",\n            anchor: t1,\n            inspect () {\n                return typeof this.anchor == \"string\" ? this.anchor : this.anchor.toString();\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Sn, \"anchor\");\n    function Es(t1) {\n        return {\n            id: \"z\",\n            z: t1,\n            inspect () {\n                return `${this.z}`;\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Es, \"z\");\n    function Ss(t1, r) {\n        return {\n            id: \"follow\",\n            require: [\n                \"pos\"\n            ],\n            follow: {\n                obj: t1,\n                offset: r ?? $adc7cb3c45508c7c$var$T(0)\n            },\n            add () {\n                t1.exists() && (this.pos = this.follow.obj.pos.add(this.follow.offset));\n            },\n            update () {\n                t1.exists() && (this.pos = this.follow.obj.pos.add(this.follow.offset));\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Ss, \"follow\");\n    function Cs(t1, r) {\n        let s1 = typeof t1 == \"number\" ? $adc7cb3c45508c7c$var$v.fromAngle(t1) : t1.unit();\n        return {\n            id: \"move\",\n            require: [\n                \"pos\"\n            ],\n            update () {\n                this.move(s1.scale(r));\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Cs, \"move\");\n    let As = 200;\n    function Ts(t1 = {}) {\n        let r = t1.distance ?? As, s1 = !1;\n        return {\n            id: \"offscreen\",\n            require: [\n                \"pos\"\n            ],\n            isOffScreen () {\n                let u = this.screenPos(), a1 = new $adc7cb3c45508c7c$var$de($adc7cb3c45508c7c$var$T(0), we(), xe());\n                return !$adc7cb3c45508c7c$var$vt(a1, u) && a1.sdistToPoint(u) > r * r;\n            },\n            onExitScreen (u) {\n                return this.on(\"exitView\", u);\n            },\n            onEnterScreen (u) {\n                return this.on(\"enterView\", u);\n            },\n            update () {\n                this.isOffScreen() ? (s1 || (this.trigger(\"exitView\"), s1 = !0), t1.hide && (this.hidden = !0), t1.pause && (this.paused = !0), t1.destroy && this.destroy()) : (s1 && (this.trigger(\"enterView\"), s1 = !1), t1.hide && (this.hidden = !1), t1.pause && (this.paused = !1));\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Ts, \"offscreen\");\n    function pt(t1) {\n        return t1.fixed ? !0 : t1.parent ? pt(t1.parent) : !1;\n    }\n    $adc7cb3c45508c7c$var$i(pt, \"isFixed\");\n    function Os(t1 = {}) {\n        let r = {}, s1 = new Set;\n        return {\n            id: \"area\",\n            collisionIgnore: t1.collisionIgnore ?? [],\n            add () {\n                this.area.cursor && this.onHover(()=>y.setCursor(this.area.cursor)), this.onCollideUpdate((u, a1)=>{\n                    r[u.id] || this.trigger(\"collide\", u, a1), r[u.id] = a1, s1.add(u.id);\n                });\n            },\n            update () {\n                for(let u in r)s1.has(Number(u)) || (this.trigger(\"collideEnd\", r[u].target), delete r[u]);\n                s1.clear();\n            },\n            drawInspect () {\n                let u = this.localArea();\n                le(), He(this.area.scale), ne(this.area.offset);\n                let a1 = {\n                    outline: {\n                        width: 4 / De(),\n                        color: $adc7cb3c45508c7c$var$J(0, 0, 255)\n                    },\n                    anchor: this.anchor,\n                    fill: !1,\n                    fixed: pt(this)\n                };\n                u instanceof $adc7cb3c45508c7c$var$de ? ge({\n                    ...a1,\n                    pos: u.pos,\n                    width: u.width,\n                    height: u.height\n                }) : u instanceof $adc7cb3c45508c7c$var$Ke ? z({\n                    ...a1,\n                    pts: u.pts\n                }) : u instanceof $adc7cb3c45508c7c$var$yt && L({\n                    ...a1,\n                    pos: u.center,\n                    radius: u.radius\n                }), ae();\n            },\n            area: {\n                shape: t1.shape ?? null,\n                scale: t1.scale ? $adc7cb3c45508c7c$var$T(t1.scale) : $adc7cb3c45508c7c$var$T(1),\n                offset: t1.offset ?? $adc7cb3c45508c7c$var$T(0),\n                cursor: t1.cursor ?? null\n            },\n            isClicked () {\n                return y.isMousePressed() && this.isHovering();\n            },\n            isHovering () {\n                let u = pt(this) ? Nt() : sr(Nt());\n                return this.hasPoint(u);\n            },\n            checkCollision (u) {\n                return r[u.id] ?? null;\n            },\n            getCollisions () {\n                return Object.values(r);\n            },\n            isColliding (u) {\n                return !!r[u.id];\n            },\n            isOverlapping (u) {\n                let a1 = r[u.id];\n                return a1 && a1.hasOverlap();\n            },\n            onClick (u) {\n                let a1 = y.onMousePress(\"left\", ()=>{\n                    this.isHovering() && u();\n                });\n                return this.onDestroy(()=>a1.cancel()), a1;\n            },\n            onHover (u) {\n                let a1 = !1;\n                return this.onUpdate(()=>{\n                    a1 ? a1 = this.isHovering() : this.isHovering() && (a1 = !0, u());\n                });\n            },\n            onHoverUpdate (u) {\n                return this.onUpdate(()=>{\n                    this.isHovering() && u();\n                });\n            },\n            onHoverEnd (u) {\n                let a1 = !1;\n                return this.onUpdate(()=>{\n                    a1 ? this.isHovering() || (a1 = !1, u()) : a1 = this.isHovering();\n                });\n            },\n            onCollide (u, a1) {\n                if (typeof u == \"function\" && a1 === void 0) return this.on(\"collide\", u);\n                if (typeof u == \"string\") return this.onCollide((h1, f)=>{\n                    h1.is(u) && a1(h1, f);\n                });\n            },\n            onCollideUpdate (u, a1) {\n                if (typeof u == \"function\" && a1 === void 0) return this.on(\"collideUpdate\", u);\n                if (typeof u == \"string\") return this.on(\"collideUpdate\", (h1, f)=>h1.is(u) && a1(h1, f));\n            },\n            onCollideEnd (u, a1) {\n                if (typeof u == \"function\" && a1 === void 0) return this.on(\"collideEnd\", u);\n                if (typeof u == \"string\") return this.on(\"collideEnd\", (h1)=>h1.is(u) && a1(h1));\n            },\n            hasPoint (u) {\n                return $adc7cb3c45508c7c$var$_n(this.worldArea(), u);\n            },\n            resolveCollision (u) {\n                let a1 = this.checkCollision(u);\n                a1 && !a1.resolved && (this.pos = this.pos.add(a1.displacement), a1.resolved = !0);\n            },\n            localArea () {\n                return this.area.shape ? this.area.shape : this.renderArea();\n            },\n            worldArea () {\n                let u = this.localArea();\n                if (!(u instanceof $adc7cb3c45508c7c$var$Ke || u instanceof $adc7cb3c45508c7c$var$de)) throw new Error(\"Only support polygon and rect shapes for now\");\n                let a1 = this.transform.clone().scale($adc7cb3c45508c7c$var$T(this.area.scale ?? 1)).translate(this.area.offset);\n                if (u instanceof $adc7cb3c45508c7c$var$de) {\n                    let h1 = $adc7cb3c45508c7c$var$ut(this.anchor || $adc7cb3c45508c7c$var$tn).add(1, 1).scale(-0.5).scale(u.width, u.height);\n                    a1.translate(h1);\n                }\n                return u.transform(a1);\n            },\n            screenArea () {\n                let u = this.worldArea();\n                return pt(this) ? u : u.transform(C.cam.transform);\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Os, \"area\");\n    function Qe(t1) {\n        return {\n            color: t1.color,\n            opacity: t1.opacity,\n            anchor: t1.anchor,\n            outline: t1.outline,\n            shader: t1.shader,\n            uniform: t1.uniform\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Qe, \"getRenderProps\");\n    function Cn(t1, r = {}) {\n        let s1 = null, u = null, a1 = null, h1 = new $adc7cb3c45508c7c$var$be;\n        if (!t1) throw new Error(\"Please pass the resource name or data to sprite()\");\n        let f = $adc7cb3c45508c7c$var$i((b1, p1, d1, w)=>{\n            let A = $adc7cb3c45508c7c$var$T(1, 1);\n            return d1 && w ? (A.x = d1 / (b1.width * p1.w), A.y = w / (b1.height * p1.h)) : d1 ? (A.x = d1 / (b1.width * p1.w), A.y = A.x) : w && (A.y = w / (b1.height * p1.h), A.x = A.y), A;\n        }, \"calcTexScale\");\n        return {\n            id: \"sprite\",\n            width: 0,\n            height: 0,\n            frame: r.frame || 0,\n            quad: r.quad || new $adc7cb3c45508c7c$var$oe(0, 0, 1, 1),\n            animSpeed: r.animSpeed ?? 1,\n            flipX: r.flipX ?? !1,\n            flipY: r.flipY ?? !1,\n            draw () {\n                if (!s1) return;\n                let b1 = s1.frames[this.frame ?? 0];\n                if (!b1) throw new Error(`Frame not found: ${this.frame ?? 0}`);\n                if (s1.slice9) {\n                    let { left: p1, right: d1, top: w, bottom: A } = s1.slice9, D = s1.tex.width * b1.w, N = s1.tex.height * b1.h, _ = this.width - p1 - d1, M1 = this.height - w - A, O = p1 / D, ie = d1 / D, Z = 1 - O - ie, H = w / N, V = A / N, fe = 1 - H - V, U = [\n                        $adc7cb3c45508c7c$var$ce(0, 0, O, H),\n                        $adc7cb3c45508c7c$var$ce(O, 0, Z, H),\n                        $adc7cb3c45508c7c$var$ce(O + Z, 0, ie, H),\n                        $adc7cb3c45508c7c$var$ce(0, H, O, fe),\n                        $adc7cb3c45508c7c$var$ce(O, H, Z, fe),\n                        $adc7cb3c45508c7c$var$ce(O + Z, H, ie, fe),\n                        $adc7cb3c45508c7c$var$ce(0, H + fe, O, V),\n                        $adc7cb3c45508c7c$var$ce(O, H + fe, Z, V),\n                        $adc7cb3c45508c7c$var$ce(O + Z, H + fe, ie, V),\n                        $adc7cb3c45508c7c$var$ce(0, 0, p1, w),\n                        $adc7cb3c45508c7c$var$ce(p1, 0, _, w),\n                        $adc7cb3c45508c7c$var$ce(p1 + _, 0, d1, w),\n                        $adc7cb3c45508c7c$var$ce(0, w, p1, M1),\n                        $adc7cb3c45508c7c$var$ce(p1, w, _, M1),\n                        $adc7cb3c45508c7c$var$ce(p1 + _, w, d1, M1),\n                        $adc7cb3c45508c7c$var$ce(0, w + M1, p1, A),\n                        $adc7cb3c45508c7c$var$ce(p1, w + M1, _, A),\n                        $adc7cb3c45508c7c$var$ce(p1 + _, w + M1, d1, A)\n                    ];\n                    for(let G = 0; G < 9; G++){\n                        let B = U[G], F = U[G + 9];\n                        We(Object.assign(Qe(this), {\n                            pos: F.pos(),\n                            tex: s1.tex,\n                            quad: b1.scale(B),\n                            flipX: this.flipX,\n                            flipY: this.flipY,\n                            tiled: r.tiled,\n                            width: F.w,\n                            height: F.h\n                        }));\n                    }\n                } else We(Object.assign(Qe(this), {\n                    tex: s1.tex,\n                    quad: b1.scale(this.quad ?? new $adc7cb3c45508c7c$var$oe(0, 0, 1, 1)),\n                    flipX: this.flipX,\n                    flipY: this.flipY,\n                    tiled: r.tiled,\n                    width: this.width,\n                    height: this.height\n                }));\n            },\n            add () {\n                let b1 = $adc7cb3c45508c7c$var$i((d1)=>{\n                    let w = d1.frames[0].clone();\n                    r.quad && (w = w.scale(r.quad));\n                    let A = f(d1.tex, w, r.width, r.height);\n                    this.width = d1.tex.width * w.w * A.x, this.height = d1.tex.height * w.h * A.y, r.anim && this.play(r.anim), s1 = d1, h1.trigger(s1);\n                }, \"setSpriteData\"), p1 = ct(t1);\n                p1 ? p1.onLoad(b1) : Tn(()=>b1(ct(t1).data));\n            },\n            update () {\n                if (!u) return;\n                let b1 = s1.anims[u.name];\n                if (typeof b1 == \"number\") {\n                    this.frame = b1;\n                    return;\n                }\n                if (b1.speed === 0) throw new Error(\"Sprite anim speed cannot be 0\");\n                u.timer += Me() * this.animSpeed, u.timer >= 1 / u.speed && (u.timer = 0, this.frame += a1, (this.frame < Math.min(b1.from, b1.to) || this.frame > Math.max(b1.from, b1.to)) && (u.loop ? u.pingpong ? (this.frame -= a1, a1 *= -1, this.frame += a1) : this.frame = b1.from : (this.frame = b1.to, u.onEnd(), this.stop())));\n            },\n            play (b1, p1 = {}) {\n                if (!s1) {\n                    h1.add(()=>this.play(b1, p1));\n                    return;\n                }\n                let d1 = s1.anims[b1];\n                if (d1 === void 0) throw new Error(`Anim not found: ${b1}`);\n                u && this.stop(), u = typeof d1 == \"number\" ? {\n                    name: b1,\n                    timer: 0,\n                    loop: !1,\n                    pingpong: !1,\n                    speed: 0,\n                    onEnd: ()=>{}\n                } : {\n                    name: b1,\n                    timer: 0,\n                    loop: p1.loop ?? d1.loop ?? !1,\n                    pingpong: p1.pingpong ?? d1.pingpong ?? !1,\n                    speed: p1.speed ?? d1.speed ?? 10,\n                    onEnd: p1.onEnd ?? (()=>{})\n                }, a1 = typeof d1 == \"number\" ? null : d1.from < d1.to ? 1 : -1, this.frame = typeof d1 == \"number\" ? d1 : d1.from, this.trigger(\"animStart\", b1);\n            },\n            stop () {\n                if (!u) return;\n                let b1 = u.name;\n                u = null, this.trigger(\"animEnd\", b1);\n            },\n            numFrames () {\n                return s1?.frames.length ?? 0;\n            },\n            curAnim () {\n                return u?.name;\n            },\n            onAnimEnd (b1) {\n                return this.on(\"animEnd\", b1);\n            },\n            onAnimStart (b1) {\n                return this.on(\"animStart\", b1);\n            },\n            renderArea () {\n                return new $adc7cb3c45508c7c$var$de($adc7cb3c45508c7c$var$T(0), this.width, this.height);\n            },\n            inspect () {\n                if (typeof t1 == \"string\") return `\"${t1}\"`;\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Cn, \"sprite\");\n    function Rs(t1, r = {}) {\n        function s1(a1) {\n            let h1 = Xe(Object.assign(Qe(a1), {\n                text: a1.text + \"\",\n                size: a1.textSize,\n                font: a1.font,\n                width: r.width && a1.width,\n                align: a1.align,\n                letterSpacing: a1.letterSpacing,\n                lineSpacing: a1.lineSpacing,\n                transform: a1.textTransform,\n                styles: a1.textStyles\n            }));\n            return r.width || (a1.width = h1.width / (a1.scale?.x || 1)), a1.height = h1.height / (a1.scale?.y || 1), h1;\n        }\n        $adc7cb3c45508c7c$var$i(s1, \"update\");\n        let u = {\n            id: \"text\",\n            set text (a){\n                t1 = a, s1(this);\n            },\n            get text () {\n                return t1;\n            },\n            textSize: r.size ?? $adc7cb3c45508c7c$var$ji,\n            font: r.font,\n            width: r.width ?? 0,\n            height: 0,\n            align: r.align,\n            lineSpacing: r.lineSpacing,\n            letterSpacing: r.letterSpacing,\n            textTransform: r.transform,\n            textStyles: r.styles,\n            add () {\n                Tn(()=>s1(this));\n            },\n            draw () {\n                Je(s1(this));\n            },\n            renderArea () {\n                return new $adc7cb3c45508c7c$var$de($adc7cb3c45508c7c$var$T(0), this.width, this.height);\n            }\n        };\n        return s1(u), u;\n    }\n    $adc7cb3c45508c7c$var$i(Rs, \"text\");\n    function Ps(t1, r = {}) {\n        if (t1.length < 3) throw new Error(`Polygon's need more than two points, ${t1.length} points provided`);\n        return {\n            id: \"polygon\",\n            pts: t1,\n            colors: r.colors,\n            radius: r.radius,\n            draw () {\n                z(Object.assign(Qe(this), {\n                    pts: this.pts,\n                    colors: this.colors,\n                    radius: this.radius,\n                    fill: r.fill\n                }));\n            },\n            renderArea () {\n                return new $adc7cb3c45508c7c$var$Ke(this.pts);\n            },\n            inspect () {\n                return this.pts.map((s1)=>`[${s1.x},${s1.y}]`).join(\",\");\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Ps, \"polygon\");\n    function Ds(t1, r, s1 = {}) {\n        return {\n            id: \"rect\",\n            width: t1,\n            height: r,\n            radius: s1.radius || 0,\n            draw () {\n                ge(Object.assign(Qe(this), {\n                    width: this.width,\n                    height: this.height,\n                    radius: this.radius,\n                    fill: s1.fill\n                }));\n            },\n            renderArea () {\n                return new $adc7cb3c45508c7c$var$de($adc7cb3c45508c7c$var$T(0), this.width, this.height);\n            },\n            inspect () {\n                return `${Math.ceil(this.width)}, ${Math.ceil(this.height)}`;\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Ds, \"rect\");\n    function Ms(t1, r) {\n        return {\n            id: \"rect\",\n            width: t1,\n            height: r,\n            draw () {\n                Be(Object.assign(Qe(this), {\n                    width: this.width,\n                    height: this.height\n                }));\n            },\n            renderArea () {\n                return new $adc7cb3c45508c7c$var$de($adc7cb3c45508c7c$var$T(0), this.width, this.height);\n            },\n            inspect () {\n                return `${Math.ceil(this.width)}, ${Math.ceil(this.height)}`;\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Ms, \"uvquad\");\n    function Gs(t1, r = {}) {\n        return {\n            id: \"circle\",\n            radius: t1,\n            draw () {\n                L(Object.assign(Qe(this), {\n                    radius: this.radius,\n                    fill: r.fill\n                }));\n            },\n            renderArea () {\n                return new $adc7cb3c45508c7c$var$de(new $adc7cb3c45508c7c$var$v(this.anchor ? 0 : -this.radius), this.radius * 2, this.radius * 2);\n            },\n            inspect () {\n                return `${Math.ceil(this.radius)}`;\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Gs, \"circle\");\n    function Bs(t1 = 1, r = $adc7cb3c45508c7c$var$J(0, 0, 0)) {\n        return {\n            id: \"outline\",\n            outline: {\n                width: t1,\n                color: r\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Bs, \"outline\");\n    function An() {\n        return {\n            id: \"timer\",\n            wait (t1, r) {\n                let s1 = [];\n                r && s1.push(r);\n                let u = 0, a1 = this.onUpdate(()=>{\n                    u += Me(), u >= t1 && (s1.forEach((h1)=>h1()), a1.cancel());\n                });\n                return {\n                    get paused () {\n                        return a1.paused;\n                    },\n                    set paused (h){\n                        a1.paused = h;\n                    },\n                    cancel: a1.cancel,\n                    onEnd (h1) {\n                        s1.push(h1);\n                    },\n                    then (h1) {\n                        return this.onEnd(h1), this;\n                    }\n                };\n            },\n            loop (t1, r) {\n                let s1 = null, u = $adc7cb3c45508c7c$var$i(()=>{\n                    s1 = this.wait(t1, u), r();\n                }, \"newAction\");\n                return s1 = this.wait(0, u), {\n                    get paused () {\n                        return s1.paused;\n                    },\n                    set paused (a){\n                        s1.paused = a;\n                    },\n                    cancel: ()=>s1.cancel()\n                };\n            },\n            tween (t1, r, s1, u, a1 = $adc7cb3c45508c7c$var$Ct.linear) {\n                let h1 = 0, f = [], b1 = this.onUpdate(()=>{\n                    h1 += Me();\n                    let p1 = Math.min(h1 / s1, 1);\n                    u($adc7cb3c45508c7c$var$Ve(t1, r, a1(p1))), p1 === 1 && (b1.cancel(), u(r), f.forEach((d1)=>d1()));\n                });\n                return {\n                    get paused () {\n                        return b1.paused;\n                    },\n                    set paused (p){\n                        b1.paused = p;\n                    },\n                    onEnd (p1) {\n                        f.push(p1);\n                    },\n                    then (p1) {\n                        return this.onEnd(p1), this;\n                    },\n                    cancel () {\n                        b1.cancel();\n                    },\n                    finish () {\n                        b1.cancel(), u(r), f.forEach((p1)=>p1());\n                    }\n                };\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(An, \"timer\");\n    let Fs = 640, Is = 65536;\n    function Ls(t1 = {}) {\n        let r = null, s1 = null, u = !1;\n        return {\n            id: \"body\",\n            require: [\n                \"pos\",\n                \"area\"\n            ],\n            vel: new $adc7cb3c45508c7c$var$v(0),\n            jumpForce: t1.jumpForce ?? Fs,\n            gravityScale: t1.gravityScale ?? 1,\n            isStatic: t1.isStatic ?? !1,\n            mass: t1.mass ?? 1,\n            add () {\n                if (this.mass === 0) throw new Error(\"Can't set body mass to 0\");\n                this.onCollideUpdate((a1, h1)=>{\n                    if (a1.is(\"body\") && !h1.resolved && (this.trigger(\"beforePhysicsResolve\", h1), a1.trigger(\"beforePhysicsResolve\", h1.reverse()), !h1.resolved && !(this.isStatic && a1.isStatic))) {\n                        if (!this.isStatic && !a1.isStatic) {\n                            let f = this.mass + a1.mass;\n                            this.pos = this.pos.add(h1.displacement.scale(a1.mass / f)), a1.pos = a1.pos.add(h1.displacement.scale(-this.mass / f)), this.transform = jt(this), a1.transform = jt(a1);\n                        } else {\n                            let f = !this.isStatic && a1.isStatic ? h1 : h1.reverse();\n                            f.source.pos = f.source.pos.add(f.displacement), f.source.transform = jt(f.source);\n                        }\n                        h1.resolved = !0, this.trigger(\"physicsResolve\", h1), a1.trigger(\"physicsResolve\", h1.reverse());\n                    }\n                }), this.onPhysicsResolve((a1)=>{\n                    C.gravity && (a1.isBottom() && this.isFalling() ? (this.vel.y = 0, r = a1.target, s1 = a1.target.pos, u ? u = !1 : this.trigger(\"ground\", r)) : a1.isTop() && this.isJumping() && (this.vel.y = 0, this.trigger(\"headbutt\", a1.target)));\n                });\n            },\n            update () {\n                if (!C.gravity || this.isStatic) return;\n                if (u && (r = null, s1 = null, this.trigger(\"fallOff\"), u = !1), r) {\n                    if (!this.isColliding(r) || !r.exists() || !r.is(\"body\")) u = !0;\n                    else {\n                        !r.pos.eq(s1) && t1.stickToPlatform !== !1 && this.moveBy(r.pos.sub(s1)), s1 = r.pos;\n                        return;\n                    }\n                }\n                let a1 = this.vel.y;\n                this.vel.y += C.gravity * this.gravityScale * Me(), this.vel.y = Math.min(this.vel.y, t1.maxVelocity ?? Is), a1 < 0 && this.vel.y >= 0 && this.trigger(\"fall\"), this.move(this.vel);\n            },\n            onPhysicsResolve (a1) {\n                return this.on(\"physicsResolve\", a1);\n            },\n            onBeforePhysicsResolve (a1) {\n                return this.on(\"beforePhysicsResolve\", a1);\n            },\n            curPlatform () {\n                return r;\n            },\n            isGrounded () {\n                return r !== null;\n            },\n            isFalling () {\n                return this.vel.y > 0;\n            },\n            isJumping () {\n                return this.vel.y < 0;\n            },\n            jump (a1) {\n                r = null, s1 = null, this.vel.y = -a1 || -this.jumpForce;\n            },\n            onGround (a1) {\n                return this.on(\"ground\", a1);\n            },\n            onFall (a1) {\n                return this.on(\"fall\", a1);\n            },\n            onFallOff (a1) {\n                return this.on(\"fallOff\", a1);\n            },\n            onHeadbutt (a1) {\n                return this.on(\"headbutt\", a1);\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Ls, \"body\");\n    function Vs(t1 = 2) {\n        let r = t1;\n        return {\n            id: \"doubleJump\",\n            require: [\n                \"body\"\n            ],\n            numJumps: t1,\n            add () {\n                this.onGround(()=>{\n                    r = this.numJumps;\n                });\n            },\n            doubleJump (s1) {\n                r <= 0 || (r < this.numJumps && this.trigger(\"doubleJump\"), r--, this.jump(s1));\n            },\n            onDoubleJump (s1) {\n                return this.on(\"doubleJump\", s1);\n            },\n            inspect () {\n                return `${r}`;\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Vs, \"doubleJump\");\n    function _s(t1, r) {\n        return {\n            id: \"shader\",\n            shader: t1,\n            ...typeof r == \"function\" ? {\n                uniform: r(),\n                update () {\n                    this.uniform = r();\n                }\n            } : {\n                uniform: r\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(_s, \"shader\");\n    function ks() {\n        return {\n            id: \"fixed\",\n            fixed: !0\n        };\n    }\n    $adc7cb3c45508c7c$var$i(ks, \"fixed\");\n    function or(t1) {\n        return {\n            id: \"stay\",\n            stay: !0,\n            scenesToStay: t1\n        };\n    }\n    $adc7cb3c45508c7c$var$i(or, \"stay\");\n    function Ns(t1, r) {\n        if (t1 == null) throw new Error(\"health() requires the initial amount of hp\");\n        return {\n            id: \"health\",\n            hurt (s1 = 1) {\n                this.setHP(t1 - s1), this.trigger(\"hurt\", s1);\n            },\n            heal (s1 = 1) {\n                let u = t1;\n                this.setHP(t1 + s1), this.trigger(\"heal\", t1 - u);\n            },\n            hp () {\n                return t1;\n            },\n            maxHP () {\n                return r ?? null;\n            },\n            setMaxHP (s1) {\n                r = s1;\n            },\n            setHP (s1) {\n                t1 = r ? Math.min(r, s1) : s1, t1 <= 0 && this.trigger(\"death\");\n            },\n            onHurt (s1) {\n                return this.on(\"hurt\", s1);\n            },\n            onHeal (s1) {\n                return this.on(\"heal\", s1);\n            },\n            onDeath (s1) {\n                return this.on(\"death\", s1);\n            },\n            inspect () {\n                return `${t1}`;\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Ns, \"health\");\n    function js(t1, r = {}) {\n        if (t1 == null) throw new Error(\"lifespan() requires time\");\n        let s1 = r.fade ?? 0;\n        return {\n            id: \"lifespan\",\n            async add () {\n                await hr(t1), s1 > 0 && this.opacity && await Rn(this.opacity, 0, s1, (u)=>this.opacity = u, $adc7cb3c45508c7c$var$Ct.linear), this.destroy();\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(js, \"lifespan\");\n    function Hs(t1, r, s1) {\n        if (!t1) throw new Error(\"state() requires an initial state\");\n        let u = {};\n        function a1(p1) {\n            u[p1] || (u[p1] = {\n                enter: new $adc7cb3c45508c7c$var$be,\n                end: new $adc7cb3c45508c7c$var$be,\n                update: new $adc7cb3c45508c7c$var$be,\n                draw: new $adc7cb3c45508c7c$var$be\n            });\n        }\n        $adc7cb3c45508c7c$var$i(a1, \"initStateEvents\");\n        function h1(p1, d1, w) {\n            return a1(d1), u[d1][p1].add(w);\n        }\n        $adc7cb3c45508c7c$var$i(h1, \"on\");\n        function f(p1, d1, ...w) {\n            a1(d1), u[d1][p1].trigger(...w);\n        }\n        $adc7cb3c45508c7c$var$i(f, \"trigger\");\n        let b1 = !1;\n        return {\n            id: \"state\",\n            state: t1,\n            enterState (p1, ...d1) {\n                if (b1 = !0, r && !r.includes(p1)) throw new Error(`State not found: ${p1}`);\n                let w = this.state;\n                if (s1) {\n                    if (!s1?.[w]) return;\n                    let A = typeof s1[w] == \"string\" ? [\n                        s1[w]\n                    ] : s1[w];\n                    if (!A.includes(p1)) throw new Error(`Cannot transition state from \"${w}\" to \"${p1}\". Available transitions: ${A.map((D)=>`\"${D}\"`).join(\", \")}`);\n                }\n                f(\"end\", w, ...d1), this.state = p1, f(\"enter\", p1, ...d1), f(\"enter\", `${w} -> ${p1}`, ...d1);\n            },\n            onStateTransition (p1, d1, w) {\n                return h1(\"enter\", `${p1} -> ${d1}`, w);\n            },\n            onStateEnter (p1, d1) {\n                return h1(\"enter\", p1, d1);\n            },\n            onStateUpdate (p1, d1) {\n                return h1(\"update\", p1, d1);\n            },\n            onStateDraw (p1, d1) {\n                return h1(\"draw\", p1, d1);\n            },\n            onStateEnd (p1, d1) {\n                return h1(\"end\", p1, d1);\n            },\n            update () {\n                b1 || (f(\"enter\", t1), b1 = !0), f(\"update\", this.state);\n            },\n            draw () {\n                f(\"draw\", this.state);\n            },\n            inspect () {\n                return this.state;\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Hs, \"state\");\n    function qs(t1 = 1) {\n        let r = 0, s1 = !1;\n        return {\n            require: [\n                \"opacity\"\n            ],\n            add () {\n                this.opacity = 0;\n            },\n            update () {\n                s1 || (r += Me(), this.opacity = $adc7cb3c45508c7c$var$_e(r, 0, t1, 0, 1), r >= t1 && (this.opacity = 1, s1 = !0));\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(qs, \"fadeIn\");\n    function $s(t1 = \"intersect\") {\n        return {\n            id: \"mask\",\n            mask: t1\n        };\n    }\n    $adc7cb3c45508c7c$var$i($s, \"mask\");\n    function zs(t1) {\n        return {\n            add () {\n                this.canvas = t1;\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(zs, \"drawon\");\n    function Tn(t1) {\n        k.loaded ? t1() : C.events.on(\"load\", t1);\n    }\n    $adc7cb3c45508c7c$var$i(Tn, \"onLoad\");\n    function Ks(t1, r) {\n        C.scenes[t1] = r;\n    }\n    $adc7cb3c45508c7c$var$i(Ks, \"scene\");\n    function Ys(t1, ...r) {\n        if (!C.scenes[t1]) throw new Error(`Scene not found: ${t1}`);\n        C.events.onOnce(\"frameEnd\", ()=>{\n            C.events.trigger(\"sceneLeave\", t1), y.events.clear(), C.events.clear(), C.objEvents.clear(), [\n                ...C.root.children\n            ].forEach((s1)=>{\n                (!s1.stay || s1.scenesToStay && !s1.scenesToStay.includes(t1)) && C.root.remove(s1);\n            }), C.root.clearEvents(), pr(), C.cam = {\n                pos: null,\n                scale: $adc7cb3c45508c7c$var$T(1),\n                angle: 0,\n                shake: 0,\n                transform: new $adc7cb3c45508c7c$var$Ue\n            }, C.scenes[t1](...r);\n        });\n    }\n    $adc7cb3c45508c7c$var$i(Ys, \"go\");\n    function Ws(t1) {\n        return C.events.on(\"sceneLeave\", t1);\n    }\n    $adc7cb3c45508c7c$var$i(Ws, \"onSceneLeave\");\n    function Xs(t1, r) {\n        try {\n            return JSON.parse(window.localStorage[t1]);\n        } catch  {\n            return r ? (ar(t1, r), r) : null;\n        }\n    }\n    $adc7cb3c45508c7c$var$i(Xs, \"getData\");\n    function ar(t1, r) {\n        window.localStorage[t1] = JSON.stringify(r);\n    }\n    $adc7cb3c45508c7c$var$i(ar, \"setData\");\n    function ur(t1, ...r) {\n        let s1 = t1(Ze), u;\n        typeof s1 == \"function\" ? u = s1(...r)(Ze) : u = s1;\n        for(let a1 in u)Ze[a1] = u[a1], n.global !== !1 && (window[a1] = u[a1]);\n        return Ze;\n    }\n    $adc7cb3c45508c7c$var$i(ur, \"plug\");\n    function zt() {\n        return $adc7cb3c45508c7c$var$T(we() / 2, xe() / 2);\n    }\n    $adc7cb3c45508c7c$var$i(zt, \"center\");\n    let Js;\n    ((O)=>(O[O.None = 0] = \"None\", O[O.Left = 1] = \"Left\", O[O.Top = 2] = \"Top\", O[O.LeftTop = 3] = \"LeftTop\", O[O.Right = 4] = \"Right\", O[O.Horizontal = 5] = \"Horizontal\", O[O.RightTop = 6] = \"RightTop\", O[O.HorizontalTop = 7] = \"HorizontalTop\", O[O.Bottom = 8] = \"Bottom\", O[O.LeftBottom = 9] = \"LeftBottom\", O[O.Vertical = 10] = \"Vertical\", O[O.LeftVertical = 11] = \"LeftVertical\", O[O.RightBottom = 12] = \"RightBottom\", O[O.HorizontalBottom = 13] = \"HorizontalBottom\", O[O.RightVertical = 14] = \"RightVertical\", O[O.All = 15] = \"All\"))(Js ||= {});\n    function cr(t1 = {}) {\n        let r = $adc7cb3c45508c7c$var$T(0), s1 = t1.isObstacle ?? !1, u = t1.cost ?? 0, a1 = t1.edges ?? [], h1 = $adc7cb3c45508c7c$var$i(()=>{\n            let b1 = {\n                left: 1,\n                top: 2,\n                right: 4,\n                bottom: 8\n            };\n            return a1.map((p1)=>b1[p1] || 0).reduce((p1, d1)=>p1 | d1, 0);\n        }, \"getEdgeMask\"), f = h1();\n        return {\n            id: \"tile\",\n            tilePosOffset: t1.offset ?? $adc7cb3c45508c7c$var$T(0),\n            set tilePos (b){\n                let p1 = this.getLevel();\n                r = b.clone(), this.pos = $adc7cb3c45508c7c$var$T(this.tilePos.x * p1.tileWidth(), this.tilePos.y * p1.tileHeight()).add(this.tilePosOffset);\n            },\n            get tilePos () {\n                return r;\n            },\n            set isObstacle (b){\n                s1 !== b && (s1 = b, this.getLevel().invalidateNavigationMap());\n            },\n            get isObstacle () {\n                return s1;\n            },\n            set cost (b){\n                u !== b && (u = b, this.getLevel().invalidateNavigationMap());\n            },\n            get cost () {\n                return u;\n            },\n            set edges (b){\n                a1 = b, f = h1(), this.getLevel().invalidateNavigationMap();\n            },\n            get edges () {\n                return a1;\n            },\n            get edgeMask () {\n                return f;\n            },\n            getLevel () {\n                return this.parent;\n            },\n            moveLeft () {\n                this.tilePos = this.tilePos.add($adc7cb3c45508c7c$var$T(-1, 0));\n            },\n            moveRight () {\n                this.tilePos = this.tilePos.add($adc7cb3c45508c7c$var$T(1, 0));\n            },\n            moveUp () {\n                this.tilePos = this.tilePos.add($adc7cb3c45508c7c$var$T(0, -1));\n            },\n            moveDown () {\n                this.tilePos = this.tilePos.add($adc7cb3c45508c7c$var$T(0, 1));\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(cr, \"tile\");\n    function Qs(t1, r) {\n        if (!r.tileWidth || !r.tileHeight) throw new Error(\"Must provide tileWidth and tileHeight.\");\n        let s1 = gt([\n            qt(r.pos ?? $adc7cb3c45508c7c$var$T(0))\n        ]), u = t1.length, a1 = 0, h1 = null, f = null, b1 = null, p1 = null, d1 = $adc7cb3c45508c7c$var$i((U)=>U.x + U.y * a1, \"tile2Hash\"), w = $adc7cb3c45508c7c$var$i((U)=>$adc7cb3c45508c7c$var$T(Math.floor(U % a1), Math.floor(U / a1)), \"hash2Tile\"), A = $adc7cb3c45508c7c$var$i(()=>{\n            h1 = [];\n            for (let U of s1.children)D(U);\n        }, \"createSpatialMap\"), D = $adc7cb3c45508c7c$var$i((U)=>{\n            let G = d1(U.tilePos);\n            h1[G] ? h1[G].push(U) : h1[G] = [\n                U\n            ];\n        }, \"insertIntoSpatialMap\"), N = $adc7cb3c45508c7c$var$i((U)=>{\n            let G = d1(U.tilePos);\n            if (h1[G]) {\n                let B = h1[G].indexOf(U);\n                B >= 0 && h1[G].splice(B, 1);\n            }\n        }, \"removeFromSpatialMap\"), _ = $adc7cb3c45508c7c$var$i(()=>{\n            let U = !1;\n            for (let G of s1.children){\n                let B = s1.pos2Tile(G.pos);\n                (G.tilePos.x != B.x || G.tilePos.y != B.y) && (U = !0, N(G), G.tilePos.x = B.x, G.tilePos.y = B.y, D(G));\n            }\n            U && s1.trigger(\"spatial_map_changed\");\n        }, \"updateSpatialMap\"), M1 = $adc7cb3c45508c7c$var$i(()=>{\n            let U = s1.getSpatialMap(), G = s1.numRows() * s1.numColumns();\n            f ? f.length = G : f = new Array(G), f.fill(1, 0, G);\n            for(let B = 0; B < U.length; B++){\n                let F = U[B];\n                if (F) {\n                    let Y = 0;\n                    for (let ee of F)if (ee.isObstacle) {\n                        Y = 1 / 0;\n                        break;\n                    } else Y += ee.cost;\n                    f[B] = Y || 1;\n                }\n            }\n        }, \"createCostMap\"), O = $adc7cb3c45508c7c$var$i(()=>{\n            let U = s1.getSpatialMap(), G = s1.numRows() * s1.numColumns();\n            b1 ? b1.length = G : b1 = new Array(G), b1.fill(15, 0, G);\n            for(let B = 0; B < U.length; B++){\n                let F = U[B];\n                if (F) {\n                    let Y = F.length, ee = 15;\n                    for(let ue = 0; ue < Y; ue++)ee |= F[ue].edgeMask;\n                    b1[B] = ee;\n                }\n            }\n        }, \"createEdgeMap\"), ie = $adc7cb3c45508c7c$var$i(()=>{\n            let U = s1.numRows() * s1.numColumns(), G = $adc7cb3c45508c7c$var$i((F, Y)=>{\n                let ee = [];\n                for(ee.push(F); ee.length > 0;){\n                    let ue = ee.pop();\n                    V(ue).forEach((me)=>{\n                        p1[me] < 0 && (p1[me] = Y, ee.push(me));\n                    });\n                }\n            }, \"traverse\");\n            p1 ? p1.length = U : p1 = new Array(U), p1.fill(-1, 0, U);\n            let B = 0;\n            for(let F = 0; F < f.length; F++){\n                if (p1[F] >= 0) {\n                    B++;\n                    continue;\n                }\n                G(F, B), B++;\n            }\n        }, \"createConnectivityMap\"), Z = $adc7cb3c45508c7c$var$i((U, G)=>f[G], \"getCost\"), H = $adc7cb3c45508c7c$var$i((U, G)=>{\n            let B = w(U), F = w(G);\n            return B.dist(F);\n        }, \"getHeuristic\"), V = $adc7cb3c45508c7c$var$i((U, G)=>{\n            let B = [], F = Math.floor(U % a1), Y = F > 0 && b1[U] & 1 && f[U - 1] !== 1 / 0, ee = U >= a1 && b1[U] & 2 && f[U - a1] !== 1 / 0, ue = F < a1 - 1 && b1[U] & 4 && f[U + 1] !== 1 / 0, me = U < a1 * u - a1 - 1 && b1[U] & 8 && f[U + a1] !== 1 / 0;\n            return G ? (Y && (ee && B.push(U - a1 - 1), B.push(U - 1), me && B.push(U + a1 - 1)), ee && B.push(U - a1), ue && (ee && B.push(U - a1 + 1), B.push(U + 1), me && B.push(U + a1 + 1)), me && B.push(U + a1)) : (Y && B.push(U - 1), ee && B.push(U - a1), ue && B.push(U + 1), me && B.push(U + a1)), B;\n        }, \"getNeighbours\"), fe = {\n            id: \"level\",\n            tileWidth () {\n                return r.tileWidth;\n            },\n            tileHeight () {\n                return r.tileHeight;\n            },\n            spawn (U, ...G) {\n                let B = $adc7cb3c45508c7c$var$T(...G), F = (()=>{\n                    if (typeof U == \"string\") {\n                        if (r.tiles[U]) {\n                            if (typeof r.tiles[U] != \"function\") throw new Error(\"Level symbol def must be a function returning a component list\");\n                            return r.tiles[U](B);\n                        } else if (r.wildcardTile) return r.wildcardTile(U, B);\n                    } else {\n                        if (Array.isArray(U)) return U;\n                        throw new Error(\"Expected a symbol or a component list\");\n                    }\n                })();\n                if (!F) return null;\n                let Y = !1, ee = !1;\n                for (let me of F)me.id === \"tile\" && (ee = !0), me.id === \"pos\" && (Y = !0);\n                Y || F.push(qt()), ee || F.push(cr());\n                let ue = s1.add(F);\n                return Y && (ue.tilePosOffset = ue.pos.clone()), ue.tilePos = B, h1 && (D(ue), this.trigger(\"spatial_map_changed\"), this.trigger(\"navigation_map_invalid\")), ue;\n            },\n            numColumns () {\n                return a1;\n            },\n            numRows () {\n                return u;\n            },\n            levelWidth () {\n                return a1 * this.tileWidth();\n            },\n            levelHeight () {\n                return u * this.tileHeight();\n            },\n            tile2Pos (...U) {\n                return $adc7cb3c45508c7c$var$T(...U).scale(this.tileWidth(), this.tileHeight());\n            },\n            pos2Tile (...U) {\n                let G = $adc7cb3c45508c7c$var$T(...U);\n                return $adc7cb3c45508c7c$var$T(Math.floor(G.x / this.tileWidth()), Math.floor(G.y / this.tileHeight()));\n            },\n            getSpatialMap () {\n                return h1 || A(), h1;\n            },\n            onSpatialMapChanged (U) {\n                return this.on(\"spatial_map_changed\", U);\n            },\n            onNavigationMapInvalid (U) {\n                return this.on(\"navigation_map_invalid\", U);\n            },\n            getAt (U) {\n                h1 || A();\n                let G = d1(U);\n                return h1[G] || [];\n            },\n            update () {\n                h1 && _();\n            },\n            invalidateNavigationMap () {\n                f = null, b1 = null, p1 = null;\n            },\n            onNavigationMapChanged (U) {\n                return this.on(\"navigation_map_changed\", U);\n            },\n            getTilePath (U, G, B = {}) {\n                if (f || M1(), b1 || O(), p1 || ie(), U.x < 0 || U.x >= a1 || U.y < 0 || U.y >= u || G.x < 0 || G.x >= a1 || G.y < 0 || G.y >= u) return null;\n                let F = d1(U), Y = d1(G);\n                if (f[Y] === 1 / 0) return null;\n                if (F === Y) return [];\n                if (p1[F] != -1 && p1[F] !== p1[Y]) return null;\n                let ee = new $adc7cb3c45508c7c$var$Yt((Fe, Mn)=>Fe.cost < Mn.cost);\n                ee.insert({\n                    cost: 0,\n                    node: F\n                });\n                let ue = new Map;\n                ue.set(F, F);\n                let me = new Map;\n                for(me.set(F, 0); ee.length !== 0;){\n                    let Fe = ee.remove()?.node;\n                    if (Fe === Y) break;\n                    let Mn = V(Fe, B.allowDiagonals);\n                    for (let et of Mn){\n                        let Gn = (me.get(Fe) || 0) + Z(Fe, et) + H(et, Y);\n                        (!me.has(et) || Gn < me.get(et)) && (me.set(et, Gn), ee.insert({\n                            cost: Gn,\n                            node: et\n                        }), ue.set(et, Fe));\n                    }\n                }\n                let Dn = [], wt = Y, vi = w(wt);\n                for(Dn.push(vi); wt !== F;){\n                    wt = ue.get(wt);\n                    let Fe = w(wt);\n                    Dn.push(Fe);\n                }\n                return Dn.reverse();\n            },\n            getPath (U, G, B = {}) {\n                let F = this.tileWidth(), Y = this.tileHeight(), ee = this.getTilePath(this.pos2Tile(U), this.pos2Tile(G), B);\n                return ee ? [\n                    U,\n                    ...ee.slice(1, -1).map((ue)=>ue.scale(F, Y).add(F / 2, Y / 2)),\n                    G\n                ] : null;\n            }\n        };\n        return s1.use(fe), s1.onNavigationMapInvalid(()=>{\n            s1.invalidateNavigationMap(), s1.trigger(\"navigation_map_changed\");\n        }), t1.forEach((U, G)=>{\n            let B = U.split(\"\");\n            a1 = Math.max(B.length, a1), B.forEach((F, Y)=>{\n                s1.spawn(F, $adc7cb3c45508c7c$var$T(Y, G));\n            });\n        }), s1;\n    }\n    $adc7cb3c45508c7c$var$i(Qs, \"addLevel\");\n    function Zs(t1 = {}) {\n        let r = null, s1 = null, u = null, a1 = null;\n        return {\n            id: \"agent\",\n            require: [\n                \"pos\",\n                \"tile\"\n            ],\n            agentSpeed: t1.speed ?? 100,\n            allowDiagonals: t1.allowDiagonals ?? !0,\n            getDistanceToTarget () {\n                return r ? this.pos.dist(r) : 0;\n            },\n            getNextLocation () {\n                return s1 && u ? s1[u] : null;\n            },\n            getPath () {\n                return s1 ? s1.slice() : null;\n            },\n            getTarget () {\n                return r;\n            },\n            isNavigationFinished () {\n                return s1 ? u === null : !0;\n            },\n            isTargetReachable () {\n                return s1 !== null;\n            },\n            isTargetReached () {\n                return r ? this.pos.eq(r) : !0;\n            },\n            setTarget (h1) {\n                r = h1, s1 = this.getLevel().getPath(this.pos, r, {\n                    allowDiagonals: this.allowDiagonals\n                }), u = s1 ? 0 : null, s1 ? (a1 || (a1 = this.getLevel().onNavigationMapChanged(()=>{\n                    s1 && u !== null && (s1 = this.getLevel().getPath(this.pos, r, {\n                        allowDiagonals: this.allowDiagonals\n                    }), u = s1 ? 0 : null, s1 ? this.trigger(\"navigation-next\", this, s1[u]) : this.trigger(\"navigation-ended\", this));\n                }), this.onDestroy(()=>a1.cancel())), this.trigger(\"navigation-started\", this), this.trigger(\"navigation-next\", this, s1[u])) : this.trigger(\"navigation-ended\", this);\n            },\n            update () {\n                if (s1 && u !== null) {\n                    if (this.pos.sdist(s1[u]) < 2) {\n                        if (u === s1.length - 1) {\n                            this.pos = r.clone(), u = null, this.trigger(\"navigation-ended\", this), this.trigger(\"target-reached\", this);\n                            return;\n                        } else u++, this.trigger(\"navigation-next\", this, s1[u]);\n                    }\n                    this.moveTo(s1[u], this.agentSpeed);\n                }\n            },\n            onNavigationStarted (h1) {\n                return this.on(\"navigation-started\", h1);\n            },\n            onNavigationNext (h1) {\n                return this.on(\"navigation-next\", h1);\n            },\n            onNavigationEnded (h1) {\n                return this.on(\"navigation-ended\", h1);\n            },\n            onTargetReached (h1) {\n                return this.on(\"target-reached\", h1);\n            },\n            inspect () {\n                return JSON.stringify({\n                    target: JSON.stringify(r),\n                    path: JSON.stringify(s1)\n                });\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(Zs, \"agent\");\n    function ei(t1) {\n        let r = y.canvas.captureStream(t1), s1 = te.ctx.createMediaStreamDestination();\n        te.masterNode.connect(s1);\n        let u = new MediaRecorder(r), a1 = [];\n        return u.ondataavailable = (h1)=>{\n            h1.data.size > 0 && a1.push(h1.data);\n        }, u.onerror = ()=>{\n            te.masterNode.disconnect(s1), r.getTracks().forEach((h1)=>h1.stop());\n        }, u.start(), {\n            resume () {\n                u.resume();\n            },\n            pause () {\n                u.pause();\n            },\n            stop () {\n                return u.stop(), te.masterNode.disconnect(s1), r.getTracks().forEach((h1)=>h1.stop()), new Promise((h1)=>{\n                    u.onstop = ()=>{\n                        h1(new Blob(a1, {\n                            type: \"video/mp4\"\n                        }));\n                    };\n                });\n            },\n            download (h1 = \"kaboom.mp4\") {\n                this.stop().then((f)=>$adc7cb3c45508c7c$var$Nn(h1, f));\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(ei, \"record\");\n    function ti() {\n        return document.activeElement === y.canvas;\n    }\n    $adc7cb3c45508c7c$var$i(ti, \"isFocused\");\n    function ni(t1) {\n        t1.destroy();\n    }\n    $adc7cb3c45508c7c$var$i(ni, \"destroy\");\n    let gt = C.root.add.bind(C.root), ri = C.root.readd.bind(C.root), si = C.root.removeAll.bind(C.root), On = C.root.get.bind(C.root), hr = C.root.wait.bind(C.root), ii = C.root.loop.bind(C.root), Rn = C.root.tween.bind(C.root);\n    function lr(t1 = 2, r = 1) {\n        let s1 = 0;\n        return {\n            require: [\n                \"scale\"\n            ],\n            update () {\n                let u = Math.sin(s1 * t1) * r;\n                u < 0 && this.destroy(), this.scale = $adc7cb3c45508c7c$var$T(u), s1 += Me();\n            }\n        };\n    }\n    $adc7cb3c45508c7c$var$i(lr, \"boom\");\n    let oi = Ye(null, $adc7cb3c45508c7c$var$qr), ai = Ye(null, $adc7cb3c45508c7c$var$$r);\n    function ui(t1, r = {}) {\n        let s1 = gt([\n            qt(t1),\n            or()\n        ]), u = (r.speed || 1) * 5, a1 = r.scale || 1;\n        s1.add([\n            Cn(ai),\n            $t(0),\n            Sn(\"center\"),\n            lr(u, a1),\n            ...r.comps ?? []\n        ]);\n        let h1 = s1.add([\n            Cn(oi),\n            $t(0),\n            Sn(\"center\"),\n            An(),\n            ...r.comps ?? []\n        ]);\n        return h1.wait(.4 / u, ()=>h1.use(lr(u, a1))), h1.onDestroy(()=>s1.destroy()), s1;\n    }\n    $adc7cb3c45508c7c$var$i(ui, \"addKaboom\");\n    function dr() {\n        C.root.update();\n    }\n    $adc7cb3c45508c7c$var$i(dr, \"updateFrame\");\n    class Pn {\n        static{\n            $adc7cb3c45508c7c$var$i(this, \"Collision\");\n        }\n        source;\n        target;\n        displacement;\n        resolved = !1;\n        constructor(r, s1, u, a1 = !1){\n            this.source = r, this.target = s1, this.displacement = u, this.resolved = a1;\n        }\n        reverse() {\n            return new Pn(this.target, this.source, this.displacement.scale(-1), this.resolved);\n        }\n        hasOverlap() {\n            return !this.displacement.isZero();\n        }\n        isLeft() {\n            return this.displacement.x > 0;\n        }\n        isRight() {\n            return this.displacement.x < 0;\n        }\n        isTop() {\n            return this.displacement.y > 0;\n        }\n        isBottom() {\n            return this.displacement.y < 0;\n        }\n        preventResolution() {\n            this.resolved = !0;\n        }\n    }\n    function ci() {\n        let t1 = {}, r = n.hashGridSize || $adc7cb3c45508c7c$var$Hi, s1 = new $adc7cb3c45508c7c$var$Ue, u = [];\n        function a1(h1) {\n            if (u.push(s1.clone()), h1.pos && s1.translate(h1.pos), h1.scale && s1.scale(h1.scale), h1.angle && s1.rotate(h1.angle), h1.transform = s1.clone(), h1.c(\"area\") && !h1.paused) {\n                let f = h1, p1 = f.worldArea().bbox(), d1 = Math.floor(p1.pos.x / r), w = Math.floor(p1.pos.y / r), A = Math.ceil((p1.pos.x + p1.width) / r), D = Math.ceil((p1.pos.y + p1.height) / r), N = new Set;\n                for(let _ = d1; _ <= A; _++)for(let M1 = w; M1 <= D; M1++)if (!t1[_]) t1[_] = {}, t1[_][M1] = [\n                    f\n                ];\n                else if (!t1[_][M1]) t1[_][M1] = [\n                    f\n                ];\n                else {\n                    let O = t1[_][M1];\n                    e: for (let ie of O){\n                        if (ie.paused || !ie.exists() || N.has(ie.id)) continue;\n                        for (let H of f.collisionIgnore)if (ie.is(H)) continue e;\n                        for (let H of ie.collisionIgnore)if (f.is(H)) continue e;\n                        let Z = $adc7cb3c45508c7c$var$Or(f.worldArea(), ie.worldArea());\n                        if (Z) {\n                            let H = new Pn(f, ie, Z);\n                            f.trigger(\"collideUpdate\", ie, H);\n                            let V = H.reverse();\n                            V.resolved = H.resolved, ie.trigger(\"collideUpdate\", f, V);\n                        }\n                        N.add(ie.id);\n                    }\n                    O.push(f);\n                }\n            }\n            h1.children.forEach(a1), s1 = u.pop();\n        }\n        $adc7cb3c45508c7c$var$i(a1, \"checkObj\"), a1(C.root);\n    }\n    $adc7cb3c45508c7c$var$i(ci, \"checkFrame\");\n    function hi() {\n        let t1 = C.cam, r = $adc7cb3c45508c7c$var$v.fromAngle($adc7cb3c45508c7c$var$xt(0, 360)).scale(t1.shake);\n        t1.shake = $adc7cb3c45508c7c$var$Ve(t1.shake, 0, 5 * Me()), t1.transform = new $adc7cb3c45508c7c$var$Ue().translate(zt()).scale(t1.scale).rotate(t1.angle).translate((t1.pos ?? zt()).scale(-1).add(r)), C.root.draw(), Pe();\n    }\n    $adc7cb3c45508c7c$var$i(hi, \"drawFrame\");\n    function li() {\n        let t1 = $();\n        C.events.numListeners(\"loading\") > 0 ? C.events.trigger(\"loading\", t1) : Ce(()=>{\n            let r = we() / 2, s1 = 24, u = $adc7cb3c45508c7c$var$T(we() / 2, xe() / 2).sub($adc7cb3c45508c7c$var$T(r / 2, s1 / 2));\n            ge({\n                pos: $adc7cb3c45508c7c$var$T(0),\n                width: we(),\n                height: xe(),\n                color: $adc7cb3c45508c7c$var$J(0, 0, 0)\n            }), ge({\n                pos: u,\n                width: r,\n                height: s1,\n                fill: !1,\n                outline: {\n                    width: 4\n                }\n            }), ge({\n                pos: u,\n                width: r * t1,\n                height: s1\n            });\n        });\n    }\n    $adc7cb3c45508c7c$var$i(li, \"drawLoadScreen\");\n    function fr(t1, r) {\n        Ce(()=>{\n            let s1 = $adc7cb3c45508c7c$var$T(8);\n            le(), ne(t1);\n            let u = Xe({\n                text: r,\n                font: $adc7cb3c45508c7c$var$nn,\n                size: 16,\n                pos: s1,\n                color: $adc7cb3c45508c7c$var$J(255, 255, 255),\n                fixed: !0\n            }), a1 = u.width + s1.x * 2, h1 = u.height + s1.x * 2;\n            t1.x + a1 >= we() && ne($adc7cb3c45508c7c$var$T(-a1, 0)), t1.y + h1 >= xe() && ne($adc7cb3c45508c7c$var$T(0, -h1)), ge({\n                width: a1,\n                height: h1,\n                color: $adc7cb3c45508c7c$var$J(0, 0, 0),\n                radius: 4,\n                opacity: .8,\n                fixed: !0\n            }), Je(u), ae();\n        });\n    }\n    $adc7cb3c45508c7c$var$i(fr, \"drawInspectText\");\n    function di() {\n        if (re.inspect) {\n            let t1 = null;\n            for (let r of C.root.get(\"*\", {\n                recursive: !0\n            }))if (r.c(\"area\") && r.isHovering()) {\n                t1 = r;\n                break;\n            }\n            if (C.root.drawInspect(), t1) {\n                let r = [], s1 = t1.inspect();\n                for(let u in s1)s1[u] ? r.push(`${u}: ${s1[u]}`) : r.push(`${u}`);\n                fr(ns(Nt()), r.join(`\n`));\n            }\n            fr($adc7cb3c45508c7c$var$T(8), `FPS: ${re.fps()}`);\n        }\n        re.paused && Ce(()=>{\n            le(), ne(we(), 0), ne(-8, 8);\n            let t1 = 32;\n            ge({\n                width: t1,\n                height: t1,\n                anchor: \"topright\",\n                color: $adc7cb3c45508c7c$var$J(0, 0, 0),\n                opacity: .8,\n                radius: 4,\n                fixed: !0\n            });\n            for(let r = 1; r <= 2; r++)ge({\n                width: 4,\n                height: t1 * .6,\n                anchor: \"center\",\n                pos: $adc7cb3c45508c7c$var$T(-t1 / 3 * r, t1 * .5),\n                color: $adc7cb3c45508c7c$var$J(255, 255, 255),\n                radius: 2,\n                fixed: !0\n            });\n            ae();\n        }), re.timeScale !== 1 && Ce(()=>{\n            le(), ne(we(), xe()), ne(-8, -8);\n            let t1 = 8, r = Xe({\n                text: re.timeScale.toFixed(1),\n                font: $adc7cb3c45508c7c$var$nn,\n                size: 16,\n                color: $adc7cb3c45508c7c$var$J(255, 255, 255),\n                pos: $adc7cb3c45508c7c$var$T(-t1),\n                anchor: \"botright\",\n                fixed: !0\n            });\n            ge({\n                width: r.width + t1 * 2 + t1 * 4,\n                height: r.height + t1 * 2,\n                anchor: \"botright\",\n                color: $adc7cb3c45508c7c$var$J(0, 0, 0),\n                opacity: .8,\n                radius: 4,\n                fixed: !0\n            });\n            for(let s1 = 0; s1 < 2; s1++){\n                let u = re.timeScale < 1;\n                R({\n                    p1: $adc7cb3c45508c7c$var$T(-r.width - t1 * (u ? 2 : 3.5), -t1),\n                    p2: $adc7cb3c45508c7c$var$T(-r.width - t1 * (u ? 2 : 3.5), -t1 - r.height),\n                    p3: $adc7cb3c45508c7c$var$T(-r.width - t1 * (u ? 3.5 : 2), -t1 - r.height / 2),\n                    pos: $adc7cb3c45508c7c$var$T(-s1 * t1 * 1 + (u ? -t1 * .5 : 0), 0),\n                    color: $adc7cb3c45508c7c$var$J(255, 255, 255),\n                    fixed: !0\n                });\n            }\n            Je(r), ae();\n        }), re.curRecording && Ce(()=>{\n            le(), ne(0, xe()), ne(24, -24), L({\n                radius: 12,\n                color: $adc7cb3c45508c7c$var$J(255, 0, 0),\n                opacity: $adc7cb3c45508c7c$var$In(0, 1, y.time() * 4),\n                fixed: !0\n            }), ae();\n        }), re.showLog && C.logs.length > 0 && Ce(()=>{\n            le(), ne(0, xe()), ne(8, -8);\n            let t1 = 8, r = [];\n            for (let u of C.logs){\n                let a1 = \"\", h1 = u.msg instanceof Error ? \"error\" : \"info\";\n                a1 += `[time]${u.time.toFixed(2)}[/time]`, a1 += \" \", a1 += `[${h1}]${u.msg?.toString ? u.msg.toString() : u.msg}[/${h1}]`, r.push(a1);\n            }\n            C.logs = C.logs.filter((u)=>y.time() - u.time < (n.logTime || $adc7cb3c45508c7c$var$$i));\n            let s1 = Xe({\n                text: r.join(`\n`),\n                font: $adc7cb3c45508c7c$var$nn,\n                pos: $adc7cb3c45508c7c$var$T(t1, -t1),\n                anchor: \"botleft\",\n                size: 16,\n                width: we() * .6,\n                lineSpacing: t1 / 2,\n                fixed: !0,\n                styles: {\n                    time: {\n                        color: $adc7cb3c45508c7c$var$J(127, 127, 127)\n                    },\n                    info: {\n                        color: $adc7cb3c45508c7c$var$J(255, 255, 255)\n                    },\n                    error: {\n                        color: $adc7cb3c45508c7c$var$J(255, 0, 127)\n                    }\n                }\n            });\n            ge({\n                width: s1.width + t1 * 2,\n                height: s1.height + t1 * 2,\n                anchor: \"botleft\",\n                color: $adc7cb3c45508c7c$var$J(0, 0, 0),\n                radius: 4,\n                opacity: .8,\n                fixed: !0\n            }), Je(s1), ae();\n        });\n    }\n    $adc7cb3c45508c7c$var$i(di, \"drawDebug\");\n    function fi(t1) {\n        C.events.on(\"loading\", t1);\n    }\n    $adc7cb3c45508c7c$var$i(fi, \"onLoading\");\n    function mi(t1) {\n        y.onResize(t1);\n    }\n    $adc7cb3c45508c7c$var$i(mi, \"onResize\");\n    function pi(t1) {\n        C.events.on(\"error\", t1);\n    }\n    $adc7cb3c45508c7c$var$i(pi, \"onError\");\n    function gi(t1) {\n        console.error(t1), te.ctx.suspend(), y.run(()=>{\n            dt(), Ce(()=>{\n                let u = we(), a1 = xe(), h1 = {\n                    size: 36,\n                    width: u - 64,\n                    letterSpacing: 4,\n                    lineSpacing: 4,\n                    font: $adc7cb3c45508c7c$var$nn,\n                    fixed: !0\n                };\n                ge({\n                    width: u,\n                    height: a1,\n                    color: $adc7cb3c45508c7c$var$J(0, 0, 255),\n                    fixed: !0\n                });\n                let f = Xe({\n                    ...h1,\n                    text: \"Error\",\n                    pos: $adc7cb3c45508c7c$var$T(32),\n                    color: $adc7cb3c45508c7c$var$J(255, 128, 0),\n                    fixed: !0\n                });\n                Je(f), tr({\n                    ...h1,\n                    text: t1.message,\n                    pos: $adc7cb3c45508c7c$var$T(32, 32 + f.height + 16),\n                    fixed: !0\n                }), ae(), C.events.trigger(\"error\", t1);\n            }), ft();\n        });\n    }\n    $adc7cb3c45508c7c$var$i(gi, \"handleErr\");\n    function wi(t1) {\n        X.push(t1);\n    }\n    $adc7cb3c45508c7c$var$i(wi, \"onCleanup\");\n    function bi() {\n        C.events.onOnce(\"frameEnd\", ()=>{\n            y.quit(), S.clear(S.COLOR_BUFFER_BIT | S.DEPTH_BUFFER_BIT | S.STENCIL_BUFFER_BIT);\n            let t1 = S.getParameter(S.MAX_TEXTURE_IMAGE_UNITS);\n            for(let r = 0; r < t1; r++)S.activeTexture(S.TEXTURE0 + r), S.bindTexture(S.TEXTURE_2D, null), S.bindTexture(S.TEXTURE_CUBE_MAP, null);\n            S.bindBuffer(S.ARRAY_BUFFER, null), S.bindBuffer(S.ELEMENT_ARRAY_BUFFER, null), S.bindRenderbuffer(S.RENDERBUFFER, null), S.bindFramebuffer(S.FRAMEBUFFER, null), q.destroy(), X.forEach((r)=>r());\n        });\n    }\n    $adc7cb3c45508c7c$var$i(bi, \"quit\");\n    let Kt = !0;\n    y.run(()=>{\n        try {\n            k.loaded || $() === 1 && !Kt && (k.loaded = !0, C.events.trigger(\"load\")), !k.loaded && n.loadingScreen !== !1 || Kt ? (dt(), li(), ft()) : (re.paused || dr(), ci(), dt(), hi(), n.debug !== !1 && di(), ft()), Kt && (Kt = !1), C.events.trigger(\"frameEnd\");\n        } catch (t1) {\n            gi(t1);\n        }\n    });\n    function mr() {\n        let t1 = P, r = S.drawingBufferWidth / t1, s1 = S.drawingBufferHeight / t1;\n        if (n.letterbox) {\n            if (!n.width || !n.height) throw new Error(\"Letterboxing requires width and height defined.\");\n            let u = r / s1, a1 = n.width / n.height;\n            if (u > a1) {\n                let h1 = s1 * a1, f = (r - h1) / 2;\n                E.viewport = {\n                    x: f,\n                    y: 0,\n                    width: h1,\n                    height: s1\n                };\n            } else {\n                let h1 = r / a1, f = (s1 - h1) / 2;\n                E.viewport = {\n                    x: 0,\n                    y: f,\n                    width: r,\n                    height: h1\n                };\n            }\n            return;\n        }\n        if (n.stretch && (!n.width || !n.height)) throw new Error(\"Stretching requires width and height defined.\");\n        E.viewport = {\n            x: 0,\n            y: 0,\n            width: r,\n            height: s1\n        };\n    }\n    $adc7cb3c45508c7c$var$i(mr, \"updateViewport\");\n    function pr() {\n        y.onHide(()=>{\n            n.backgroundAudio || te.ctx.suspend();\n        }), y.onShow(()=>{\n            !n.backgroundAudio && !re.paused && te.ctx.resume();\n        }), y.onResize(()=>{\n            if (y.isFullscreen()) return;\n            let t1 = n.width && n.height;\n            t1 && !n.stretch && !n.letterbox || (o.width = o.offsetWidth * P, o.height = o.offsetHeight * P, mr(), t1 || (E.frameBuffer.free(), E.frameBuffer = new $adc7cb3c45508c7c$var$rt(q, S.drawingBufferWidth, S.drawingBufferHeight), E.width = S.drawingBufferWidth / P, E.height = S.drawingBufferHeight / P));\n        }), n.debug !== !1 && (y.onKeyPress(\"f1\", ()=>re.inspect = !re.inspect), y.onKeyPress(\"f2\", ()=>re.clearLog()), y.onKeyPress(\"f8\", ()=>re.paused = !re.paused), y.onKeyPress(\"f7\", ()=>{\n            re.timeScale = mt($adc7cb3c45508c7c$var$Le(re.timeScale - .2, 0, 2), 1);\n        }), y.onKeyPress(\"f9\", ()=>{\n            re.timeScale = mt($adc7cb3c45508c7c$var$Le(re.timeScale + .2, 0, 2), 1);\n        }), y.onKeyPress(\"f10\", ()=>re.stepFrame())), n.burp && y.onKeyPress(\"b\", ()=>Lt());\n    }\n    $adc7cb3c45508c7c$var$i(pr, \"initEvents\"), mr(), pr();\n    let Ze = {\n        VERSION: $adc7cb3c45508c7c$var$ki,\n        loadRoot: Te,\n        loadProgress: $,\n        loadSprite: Ye,\n        loadSpriteAtlas: Ot,\n        loadSound: ln,\n        loadBitmapFont: on,\n        loadFont: st,\n        loadShader: cn,\n        loadShaderURL: hn,\n        loadAseprite: un,\n        loadPedit: an,\n        loadBean: dn,\n        loadJSON: ye,\n        load: Ae,\n        getSprite: Pt,\n        getSound: Dt,\n        getFont: Mt,\n        getBitmapFont: Gt,\n        getShader: Bt,\n        getAsset: fn,\n        Asset: $adc7cb3c45508c7c$var$ve,\n        SpriteData: K,\n        SoundData: Q,\n        width: we,\n        height: xe,\n        center: zt,\n        dt: Me,\n        time: y.time,\n        screenshot: y.screenshot,\n        record: ei,\n        isFocused: ti,\n        setCursor: y.setCursor,\n        getCursor: y.getCursor,\n        setCursorLocked: y.setCursorLocked,\n        isCursorLocked: y.isCursorLocked,\n        setFullscreen: y.setFullscreen,\n        isFullscreen: y.isFullscreen,\n        isTouchscreen: y.isTouchscreen,\n        onLoad: Tn,\n        onLoading: fi,\n        onResize: mi,\n        onGamepadConnect: y.onGamepadConnect,\n        onGamepadDisconnect: y.onGamepadDisconnect,\n        onError: pi,\n        onCleanup: wi,\n        camPos: rs,\n        camScale: ss,\n        camRot: is,\n        shake: os,\n        toScreen: rr,\n        toWorld: sr,\n        setGravity: gs,\n        getGravity: ws,\n        setBackground: bs,\n        getBackground: vs,\n        getGamepads: y.getGamepads,\n        add: gt,\n        make: Un,\n        destroy: ni,\n        destroyAll: si,\n        get: On,\n        readd: ri,\n        pos: qt,\n        scale: $t,\n        rotate: ys,\n        color: xs,\n        opacity: Us,\n        anchor: Sn,\n        area: Os,\n        sprite: Cn,\n        text: Rs,\n        polygon: Ps,\n        rect: Ds,\n        circle: Gs,\n        uvquad: Ms,\n        outline: Bs,\n        body: Ls,\n        doubleJump: Vs,\n        shader: _s,\n        timer: An,\n        fixed: ks,\n        stay: or,\n        health: Ns,\n        lifespan: js,\n        z: Es,\n        move: Cs,\n        offscreen: Ts,\n        follow: Ss,\n        state: Hs,\n        fadeIn: qs,\n        mask: $s,\n        drawon: zs,\n        tile: cr,\n        agent: Zs,\n        on: ze,\n        onUpdate: as,\n        onDraw: us,\n        onAdd: En,\n        onDestroy: ir,\n        onClick: ds,\n        onCollide: cs,\n        onCollideUpdate: hs,\n        onCollideEnd: ls,\n        onHover: fs,\n        onHoverUpdate: ms,\n        onHoverEnd: ps,\n        onKeyDown: y.onKeyDown,\n        onKeyPress: y.onKeyPress,\n        onKeyPressRepeat: y.onKeyPressRepeat,\n        onKeyRelease: y.onKeyRelease,\n        onMouseDown: y.onMouseDown,\n        onMousePress: y.onMousePress,\n        onMouseRelease: y.onMouseRelease,\n        onMouseMove: y.onMouseMove,\n        onCharInput: y.onCharInput,\n        onTouchStart: y.onTouchStart,\n        onTouchMove: y.onTouchMove,\n        onTouchEnd: y.onTouchEnd,\n        onScroll: y.onScroll,\n        onHide: y.onHide,\n        onShow: y.onShow,\n        onGamepadButtonDown: y.onGamepadButtonDown,\n        onGamepadButtonPress: y.onGamepadButtonPress,\n        onGamepadButtonRelease: y.onGamepadButtonRelease,\n        onGamepadStick: y.onGamepadStick,\n        mousePos: Nt,\n        mouseDeltaPos: y.mouseDeltaPos,\n        isKeyDown: y.isKeyDown,\n        isKeyPressed: y.isKeyPressed,\n        isKeyPressedRepeat: y.isKeyPressedRepeat,\n        isKeyReleased: y.isKeyReleased,\n        isMouseDown: y.isMouseDown,\n        isMousePressed: y.isMousePressed,\n        isMouseReleased: y.isMouseReleased,\n        isMouseMoved: y.isMouseMoved,\n        isGamepadButtonPressed: y.isGamepadButtonPressed,\n        isGamepadButtonDown: y.isGamepadButtonDown,\n        isGamepadButtonReleased: y.isGamepadButtonReleased,\n        getGamepadStick: y.getGamepadStick,\n        charInputted: y.charInputted,\n        loop: ii,\n        wait: hr,\n        play: It,\n        volume: gn,\n        burp: Lt,\n        audioCtx: te.ctx,\n        Line: $adc7cb3c45508c7c$var$Ie,\n        Rect: $adc7cb3c45508c7c$var$de,\n        Circle: $adc7cb3c45508c7c$var$yt,\n        Polygon: $adc7cb3c45508c7c$var$Ke,\n        Vec2: $adc7cb3c45508c7c$var$v,\n        Color: $adc7cb3c45508c7c$var$W,\n        Mat4: $adc7cb3c45508c7c$var$Ue,\n        Quad: $adc7cb3c45508c7c$var$oe,\n        RNG: $adc7cb3c45508c7c$var$bt,\n        rand: $adc7cb3c45508c7c$var$xt,\n        randi: $adc7cb3c45508c7c$var$Ln,\n        randSeed: $adc7cb3c45508c7c$var$yr,\n        vec2: $adc7cb3c45508c7c$var$T,\n        rgb: $adc7cb3c45508c7c$var$J,\n        hsl2rgb: $adc7cb3c45508c7c$var$vr,\n        quad: $adc7cb3c45508c7c$var$ce,\n        choose: $adc7cb3c45508c7c$var$Ur,\n        chance: $adc7cb3c45508c7c$var$xr,\n        lerp: $adc7cb3c45508c7c$var$Ve,\n        tween: Rn,\n        easings: $adc7cb3c45508c7c$var$Ct,\n        map: $adc7cb3c45508c7c$var$_e,\n        mapc: $adc7cb3c45508c7c$var$br,\n        wave: $adc7cb3c45508c7c$var$In,\n        deg2rad: $adc7cb3c45508c7c$var$Ge,\n        rad2deg: $adc7cb3c45508c7c$var$ot,\n        clamp: $adc7cb3c45508c7c$var$Le,\n        testLineLine: $adc7cb3c45508c7c$var$it,\n        testRectRect: $adc7cb3c45508c7c$var$Er,\n        testRectLine: $adc7cb3c45508c7c$var$Sr,\n        testRectPoint: $adc7cb3c45508c7c$var$vt,\n        testCirclePolygon: $adc7cb3c45508c7c$var$Tr,\n        testLinePoint: $adc7cb3c45508c7c$var$Cr,\n        testLineCircle: $adc7cb3c45508c7c$var$Vn,\n        drawSprite: yn,\n        drawText: tr,\n        formatText: Xe,\n        drawRect: ge,\n        drawLine: l,\n        drawLines: x,\n        drawTriangle: R,\n        drawCircle: L,\n        drawEllipse: he,\n        drawUVQuad: Be,\n        drawPolygon: z,\n        drawFormattedText: Je,\n        drawMasked: $e,\n        drawSubtracted: kt,\n        pushTransform: le,\n        popTransform: ae,\n        pushTranslate: ne,\n        pushScale: He,\n        pushRotate: se,\n        pushMatrix: _t,\n        usePostEffect: Vt,\n        makeCanvas: wn,\n        debug: re,\n        scene: Ks,\n        go: Ys,\n        onSceneLeave: Ws,\n        addLevel: Qs,\n        getData: Xs,\n        setData: ar,\n        download: $adc7cb3c45508c7c$var$Xt,\n        downloadJSON: $adc7cb3c45508c7c$var$Dr,\n        downloadText: $adc7cb3c45508c7c$var$kn,\n        downloadBlob: $adc7cb3c45508c7c$var$Nn,\n        plug: ur,\n        ASCII_CHARS: $adc7cb3c45508c7c$var$zr,\n        canvas: y.canvas,\n        addKaboom: ui,\n        LEFT: $adc7cb3c45508c7c$var$v.LEFT,\n        RIGHT: $adc7cb3c45508c7c$var$v.RIGHT,\n        UP: $adc7cb3c45508c7c$var$v.UP,\n        DOWN: $adc7cb3c45508c7c$var$v.DOWN,\n        RED: $adc7cb3c45508c7c$var$W.RED,\n        GREEN: $adc7cb3c45508c7c$var$W.GREEN,\n        BLUE: $adc7cb3c45508c7c$var$W.BLUE,\n        YELLOW: $adc7cb3c45508c7c$var$W.YELLOW,\n        MAGENTA: $adc7cb3c45508c7c$var$W.MAGENTA,\n        CYAN: $adc7cb3c45508c7c$var$W.CYAN,\n        WHITE: $adc7cb3c45508c7c$var$W.WHITE,\n        BLACK: $adc7cb3c45508c7c$var$W.BLACK,\n        quit: bi,\n        Event: $adc7cb3c45508c7c$var$be,\n        EventHandler: $adc7cb3c45508c7c$var$Ne,\n        EventController: $adc7cb3c45508c7c$var$ke\n    };\n    if (n.plugins && n.plugins.forEach(ur), n.global !== !1) for(let t1 in Ze)window[t1] = Ze[t1];\n    return n.focus !== !1 && y.canvas.focus(), Ze;\n}, \"default\");\n\n\n\nconst $4be214bf41451d42$export$342063e11d6c3cad = (0, $adc7cb3c45508c7c$export$2e2bcd8739ae039)({\n    global: false,\n    touchToMouse: true,\n    canvas: document.getElementById(\"game\"),\n    debug: false\n});\n\n\nfunction $820877bea407f5fe$export$5eeac27ed3caf0e(text, onDisplayEnd) {\n    const dialogueUI = document.getElementById(\"textbox-container\");\n    const dialogue = document.getElementById(\"dialogue\");\n    dialogueUI.style.display = \"block\";\n    let index = 0;\n    let currentText = \"\";\n    const intervalRef = setInterval(()=>{\n        if (index < text.length) {\n            currentText += text[index];\n            dialogue.innerHTML = currentText;\n            index++;\n            return;\n        }\n        clearInterval(intervalRef);\n    }, 1);\n    const closeBtn = document.getElementById(\"close\");\n    function onCloseBtnClick() {\n        onDisplayEnd();\n        dialogueUI.style.display = \"none\";\n        dialogue.innerHTML = \"\";\n        clearInterval(intervalRef);\n        closeBtn.removeEventListener(\"click\", onCloseBtnClick);\n    }\n    closeBtn.addEventListener(\"click\", onCloseBtnClick);\n    addEventListener(\"keypress\", (key)=>{\n        if (key.code === \"Enter\") closeBtn.click();\n    });\n}\nfunction $820877bea407f5fe$export$b4f6f748c3874b15(k) {\n    const resizeFactor = k.width() / k.height();\n    if (resizeFactor < 1) k.camScale(k.vec2(1));\n    else k.camScale(k.vec2(1.5));\n}\n\n\n(0, $4be214bf41451d42$export$342063e11d6c3cad).loadSprite(\"spritesheet\", \"./spritesheet.png\", {\n    sliceX: 39,\n    sliceY: 31,\n    anims: {\n        \"idle-down\": 964,\n        \"walk-down\": {\n            from: 964,\n            to: 967,\n            loop: true,\n            speed: 8\n        },\n        \"idle-side\": 1003,\n        \"walk-side\": {\n            from: 1003,\n            to: 1006,\n            loop: true,\n            speed: 8\n        },\n        \"idle-up\": 1042,\n        \"walk-up\": {\n            from: 1042,\n            to: 1045,\n            loop: true,\n            speed: 8\n        }\n    }\n});\n(0, $4be214bf41451d42$export$342063e11d6c3cad).loadSprite(\"map\", \"./map.png\");\n(0, $4be214bf41451d42$export$342063e11d6c3cad).setBackground((0, $4be214bf41451d42$export$342063e11d6c3cad).Color.fromHex(\"#311047\"));\n(0, $4be214bf41451d42$export$342063e11d6c3cad).scene(\"main\", async ()=>{\n    const mapData = await (await fetch(\"./map.json\")).json();\n    const layers = mapData.layers;\n    const map = (0, $4be214bf41451d42$export$342063e11d6c3cad).add([\n        (0, $4be214bf41451d42$export$342063e11d6c3cad).sprite(\"map\"),\n        (0, $4be214bf41451d42$export$342063e11d6c3cad).pos(0),\n        (0, $4be214bf41451d42$export$342063e11d6c3cad).scale((0, $5cdc329eeebd56d0$export$caead18fddac0ead))\n    ]);\n    const player = (0, $4be214bf41451d42$export$342063e11d6c3cad).make([\n        (0, $4be214bf41451d42$export$342063e11d6c3cad).sprite(\"spritesheet\", {\n            anim: \"idle-down\"\n        }),\n        (0, $4be214bf41451d42$export$342063e11d6c3cad).area({\n            shape: new (0, $4be214bf41451d42$export$342063e11d6c3cad).Rect((0, $4be214bf41451d42$export$342063e11d6c3cad).vec2(0, 3), 10, 10)\n        }),\n        (0, $4be214bf41451d42$export$342063e11d6c3cad).body(),\n        (0, $4be214bf41451d42$export$342063e11d6c3cad).anchor(\"center\"),\n        (0, $4be214bf41451d42$export$342063e11d6c3cad).pos(),\n        (0, $4be214bf41451d42$export$342063e11d6c3cad).scale((0, $5cdc329eeebd56d0$export$caead18fddac0ead)),\n        {\n            speed: 250,\n            direction: \"down\",\n            isInDialogue: false\n        },\n        \"player\"\n    ]);\n    for (const layer of layers){\n        if (layer.name === \"boundaries\") {\n            for (const boundary of layer.objects){\n                map.add([\n                    (0, $4be214bf41451d42$export$342063e11d6c3cad).area({\n                        shape: new (0, $4be214bf41451d42$export$342063e11d6c3cad).Rect((0, $4be214bf41451d42$export$342063e11d6c3cad).vec2(0), boundary.width, boundary.height)\n                    }),\n                    (0, $4be214bf41451d42$export$342063e11d6c3cad).body({\n                        isStatic: true\n                    }),\n                    (0, $4be214bf41451d42$export$342063e11d6c3cad).pos(boundary.x, boundary.y),\n                    boundary.name\n                ]);\n                if (boundary.name) player.onCollide(boundary.name, ()=>{\n                    player.isInDialogue = true;\n                    (0, $820877bea407f5fe$export$5eeac27ed3caf0e)((0, $5cdc329eeebd56d0$export$392f53e92db1c5c1)[boundary.name], ()=>player.isInDialogue = false);\n                });\n            }\n            continue;\n        }\n        if (layer.name === \"spawnpoints\") {\n            for (const entity of layer.objects)if (entity.name === \"player\") {\n                player.pos = (0, $4be214bf41451d42$export$342063e11d6c3cad).vec2((map.pos.x + entity.x) * (0, $5cdc329eeebd56d0$export$caead18fddac0ead), (map.pos.y + entity.y) * (0, $5cdc329eeebd56d0$export$caead18fddac0ead));\n                (0, $4be214bf41451d42$export$342063e11d6c3cad).add(player);\n                continue;\n            }\n        }\n    }\n    (0, $820877bea407f5fe$export$b4f6f748c3874b15)((0, $4be214bf41451d42$export$342063e11d6c3cad));\n    (0, $4be214bf41451d42$export$342063e11d6c3cad).onResize(()=>{\n        (0, $820877bea407f5fe$export$b4f6f748c3874b15)((0, $4be214bf41451d42$export$342063e11d6c3cad));\n    });\n    (0, $4be214bf41451d42$export$342063e11d6c3cad).onUpdate(()=>{\n        (0, $4be214bf41451d42$export$342063e11d6c3cad).camPos(player.worldPos().x, player.worldPos().y - 100);\n    });\n    (0, $4be214bf41451d42$export$342063e11d6c3cad).onMouseDown((mouseBtn)=>{\n        if (mouseBtn !== \"left\" || player.isInDialogue) return;\n        const worldMousePos = (0, $4be214bf41451d42$export$342063e11d6c3cad).toWorld((0, $4be214bf41451d42$export$342063e11d6c3cad).mousePos());\n        player.moveTo(worldMousePos, player.speed);\n        const mouseAngle = player.pos.angle(worldMousePos);\n        const lowerBound = 50;\n        const upperBound = 125;\n        if (mouseAngle > lowerBound && mouseAngle < upperBound && player.curAnim() !== \"walk-up\") {\n            player.play(\"walk-up\");\n            player.direction = \"up\";\n            return;\n        }\n        if (mouseAngle < -lowerBound && mouseAngle > -upperBound && player.curAnim() !== \"walk-down\") {\n            player.play(\"walk-down\");\n            player.direction = \"down\";\n            return;\n        }\n        if (Math.abs(mouseAngle) > upperBound) {\n            player.flipX = false;\n            if (player.curAnim() !== \"walk-side\") player.play(\"walk-side\");\n            player.direction = \"right\";\n            return;\n        }\n        if (Math.abs(mouseAngle) < lowerBound) {\n            player.flipX = true;\n            if (player.curAnim() !== \"walk-side\") player.play(\"walk-side\");\n            player.direction = \"left\";\n            return;\n        }\n    });\n    function stopAnims() {\n        if (player.direction === \"down\") {\n            player.play(\"idle-down\");\n            return;\n        }\n        if (player.direction === \"up\") {\n            player.play(\"idle-up\");\n            return;\n        }\n        player.play(\"idle-side\");\n    }\n    (0, $4be214bf41451d42$export$342063e11d6c3cad).onMouseRelease(stopAnims);\n    (0, $4be214bf41451d42$export$342063e11d6c3cad).onKeyRelease(()=>{\n        stopAnims();\n    });\n    (0, $4be214bf41451d42$export$342063e11d6c3cad).onKeyDown((key)=>{\n        const keyMap = [\n            (0, $4be214bf41451d42$export$342063e11d6c3cad).isKeyDown(\"right\"),\n            (0, $4be214bf41451d42$export$342063e11d6c3cad).isKeyDown(\"left\"),\n            (0, $4be214bf41451d42$export$342063e11d6c3cad).isKeyDown(\"up\"),\n            (0, $4be214bf41451d42$export$342063e11d6c3cad).isKeyDown(\"down\")\n        ];\n        let nbOfKeyPressed = 0;\n        for (const key of keyMap)if (key) nbOfKeyPressed++;\n        if (nbOfKeyPressed > 1) return;\n        if (player.isInDialogue) return;\n        if (keyMap[0]) {\n            player.flipX = false;\n            if (player.curAnim() !== \"walk-side\") player.play(\"walk-side\");\n            player.direction = \"right\";\n            player.move(player.speed, 0);\n            return;\n        }\n        if (keyMap[1]) {\n            player.flipX = true;\n            if (player.curAnim() !== \"walk-side\") player.play(\"walk-side\");\n            player.direction = \"left\";\n            player.move(-player.speed, 0);\n            return;\n        }\n        if (keyMap[2]) {\n            if (player.curAnim() !== \"walk-up\") player.play(\"walk-up\");\n            player.direction = \"up\";\n            player.move(0, -player.speed);\n            return;\n        }\n        if (keyMap[3]) {\n            if (player.curAnim() !== \"walk-down\") player.play(\"walk-down\");\n            player.direction = \"down\";\n            player.move(0, player.speed);\n        }\n    });\n});\n(0, $4be214bf41451d42$export$342063e11d6c3cad).go(\"main\");\n\n\n//# sourceMappingURL=index.b5029828.js.map\n","\r\n        import { dialogueData, scaleFactor } from \"./constants\";\r\n        import { k } from \"./kaboomCtx\";\r\n        import { displayDialogue, setCamScale } from \"./utils\";\r\n        \r\n        k.loadSprite(\"spritesheet\", \"./spritesheet.png\", {\r\n          sliceX: 39,\r\n          sliceY: 31,\r\n          anims: {\r\n            \"idle-down\": 964,\r\n            \"walk-down\": { from: 964, to: 967, loop: true, speed: 8 },\r\n            \"idle-side\": 1003,\r\n            \"walk-side\": { from: 1003, to: 1006, loop: true, speed: 8 },\r\n            \"idle-up\": 1042,\r\n            \"walk-up\": { from: 1042, to: 1045, loop: true, speed: 8 },\r\n          },\r\n        });\r\n        \r\n        k.loadSprite(\"map\", \"./map.png\");\r\n        \r\n        k.setBackground(k.Color.fromHex(\"#311047\"));\r\n        \r\n        k.scene(\"main\", async () => {\r\n          const mapData = await (await fetch(\"./map.json\")).json();\r\n          const layers = mapData.layers;\r\n        \r\n          const map = k.add([k.sprite(\"map\"), k.pos(0), k.scale(scaleFactor)]);\r\n        \r\n          const player = k.make([\r\n            k.sprite(\"spritesheet\", { anim: \"idle-down\" }),\r\n            k.area({\r\n              shape: new k.Rect(k.vec2(0, 3), 10, 10),\r\n            }),\r\n            k.body(),\r\n            k.anchor(\"center\"),\r\n            k.pos(),\r\n            k.scale(scaleFactor),\r\n            {\r\n              speed: 250,\r\n              direction: \"down\",\r\n              isInDialogue: false,\r\n            },\r\n            \"player\",\r\n          ]);\r\n        \r\n          for (const layer of layers) {\r\n            if (layer.name === \"boundaries\") {\r\n              for (const boundary of layer.objects) {\r\n                map.add([\r\n                  k.area({\r\n                    shape: new k.Rect(k.vec2(0), boundary.width, boundary.height),\r\n                  }),\r\n                  k.body({ isStatic: true }),\r\n                  k.pos(boundary.x, boundary.y),\r\n                  boundary.name,\r\n                ]);\r\n        \r\n                if (boundary.name) {\r\n                  player.onCollide(boundary.name, () => {\r\n                    player.isInDialogue = true;\r\n                    displayDialogue(\r\n                      dialogueData[boundary.name],\r\n                      () => (player.isInDialogue = false)\r\n                    );\r\n                  });\r\n                }\r\n              }\r\n        \r\n              continue;\r\n            }\r\n        \r\n            if (layer.name === \"spawnpoints\") {\r\n              for (const entity of layer.objects) {\r\n                if (entity.name === \"player\") {\r\n                  player.pos = k.vec2(\r\n                    (map.pos.x + entity.x) * scaleFactor,\r\n                    (map.pos.y + entity.y) * scaleFactor\r\n                  );\r\n                  k.add(player);\r\n                  continue;\r\n                }\r\n              }\r\n            }\r\n          }\r\n        \r\n          setCamScale(k);\r\n        \r\n          k.onResize(() => {\r\n            setCamScale(k);\r\n          });\r\n        \r\n          k.onUpdate(() => {\r\n            k.camPos(player.worldPos().x, player.worldPos().y - 100);\r\n          });\r\n        \r\n          k.onMouseDown((mouseBtn) => {\r\n            if (mouseBtn !== \"left\" || player.isInDialogue) return;\r\n        \r\n            const worldMousePos = k.toWorld(k.mousePos());\r\n            player.moveTo(worldMousePos, player.speed);\r\n        \r\n            const mouseAngle = player.pos.angle(worldMousePos);\r\n        \r\n            const lowerBound = 50;\r\n            const upperBound = 125;\r\n        \r\n            if (\r\n              mouseAngle > lowerBound &&\r\n              mouseAngle < upperBound &&\r\n              player.curAnim() !== \"walk-up\"\r\n            ) {\r\n              player.play(\"walk-up\");\r\n              player.direction = \"up\";\r\n              return;\r\n            }\r\n        \r\n            if (\r\n              mouseAngle < -lowerBound &&\r\n              mouseAngle > -upperBound &&\r\n              player.curAnim() !== \"walk-down\"\r\n            ) {\r\n              player.play(\"walk-down\");\r\n              player.direction = \"down\";\r\n              return;\r\n            }\r\n        \r\n            if (Math.abs(mouseAngle) > upperBound) {\r\n              player.flipX = false;\r\n              if (player.curAnim() !== \"walk-side\") player.play(\"walk-side\");\r\n              player.direction = \"right\";\r\n              return;\r\n            }\r\n        \r\n            if (Math.abs(mouseAngle) < lowerBound) {\r\n              player.flipX = true;\r\n              if (player.curAnim() !== \"walk-side\") player.play(\"walk-side\");\r\n              player.direction = \"left\";\r\n              return;\r\n            }\r\n          });\r\n        \r\n          function stopAnims() {\r\n            if (player.direction === \"down\") {\r\n              player.play(\"idle-down\");\r\n              return;\r\n            }\r\n            if (player.direction === \"up\") {\r\n              player.play(\"idle-up\");\r\n              return;\r\n            }\r\n        \r\n            player.play(\"idle-side\");\r\n          }\r\n        \r\n          k.onMouseRelease(stopAnims);\r\n        \r\n          k.onKeyRelease(() => {\r\n            stopAnims();\r\n          });\r\n          k.onKeyDown((key) => {\r\n            const keyMap = [\r\n              k.isKeyDown(\"right\"),\r\n              k.isKeyDown(\"left\"),\r\n              k.isKeyDown(\"up\"),\r\n              k.isKeyDown(\"down\"),\r\n            ];\r\n        \r\n            let nbOfKeyPressed = 0;\r\n            for (const key of keyMap) {\r\n              if (key) {\r\n                nbOfKeyPressed++;\r\n              }\r\n            }\r\n        \r\n            if (nbOfKeyPressed > 1) return;\r\n        \r\n            if (player.isInDialogue) return;\r\n            if (keyMap[0]) {\r\n              player.flipX = false;\r\n              if (player.curAnim() !== \"walk-side\") player.play(\"walk-side\");\r\n              player.direction = \"right\";\r\n              player.move(player.speed, 0);\r\n              return;\r\n            }\r\n        \r\n            if (keyMap[1]) {\r\n              player.flipX = true;\r\n              if (player.curAnim() !== \"walk-side\") player.play(\"walk-side\");\r\n              player.direction = \"left\";\r\n              player.move(-player.speed, 0);\r\n              return;\r\n            }\r\n        \r\n            if (keyMap[2]) {\r\n              if (player.curAnim() !== \"walk-up\") player.play(\"walk-up\");\r\n              player.direction = \"up\";\r\n              player.move(0, -player.speed);\r\n              return;\r\n            }\r\n        \r\n            if (keyMap[3]) {\r\n              if (player.curAnim() !== \"walk-down\") player.play(\"walk-down\");\r\n              player.direction = \"down\";\r\n              player.move(0, player.speed);\r\n            }\r\n          });\r\n        });\r\n        \r\n        k.go(\"main\");","export const scaleFactor = 4;\r\n\r\nexport const dialogueData = {\r\n  pc: `These are my experiences:<br>\r\n  Software Engineering Fellow, Headstarter AI:As a Software Engineering Fellow at Headstarter AI, I am embarking on a dynamic 7-week journey working on diverse projects across various fields. This immersive experience includes hands-on development in cutting-edge technologies, participating in engaging hackathons, and receiving tailored interview preparation to sharpen my skills.<br> \r\n  Student Ambassador, Viral Fission:In my role as a Student Ambassador at Viral Fission, I organize and host blockchain gaming events to foster community engagement. I create engaging content, including reels and social media posts, to promote products and enhance brand visibility.<br>\r\n   `,\r\n  \"cs-degree\": `I have certificationS from META in HTML & CSS, and also Version Control.`,\r\n  \"sofa-table\": `Hello!, I'm Aarcha U, a B.E. student specializing in Artificial Intelligence & Machine Learning at Impact College of Engineering & Applied Sciences. With experience in web development, blockchain event management, and a passion for technology, I bring a creative and analytical approach to every project. Explore my portfolio to see my work in programming and design, and feel free to connect with me for collaboration!`,\r\n  tv: ` Check out my LinedIn profile:<a href=\"https://www.linkedin.com/in/aarcha-u\" target=\"_blank\">LinkedIn</a>.`,\r\n  bed: `This where I sleep. Great ideas comes when I'm lying on my bed. When an idea strikes, I often have to write it down or else I won't be able to sleep because my mental energy is consumed by it.`,\r\n  resume: `This is my desk and on it is my Github Profile: <a href=\"https://github.com/aarch34\" target=\"_blank\">Github</a>,\r\n  Contact me at aarcha.u@yahoo.com if you have any interesting job opportunities!`,\r\n  projects: `Some projects I've Done:<br>\r\n  I developed a user-friendly website for Bibha, The Event Company, focusing on responsive design and multimedia integration to enhance user engagement.<br>\r\n   Additionally, I created an e-commerce web app for a college project,showcasing a jewellery store using Django and MySQL, featuring a secure user authentication system, a dynamic product catalog, and a comprehensive admin dashboard. These projects showcase my skills in web development and my commitment to delivering functional and visually appealing digital solutions.`,\r\n  library: `These are my skills:<br>Programming Languages: Python, HTML5, CSS, C.\r\n<br>Web Development: Django, Kaboom.js, Responsive Design, Frontend Development.\r\n<br>Database Management: MySQL,MongoDB.\r\n<br>Version Control: Git, GitHub.`,\r\n  exit: `If you want to exit Aarcha U's portfolio, just close the tab.`,\r\n};","import kaboom from \"kaboom\";\r\nimport { scaleFactor } from \"./constants\";\r\n\r\nexport const k = kaboom({\r\n  global: false,\r\n  touchToMouse: true,\r\n  canvas: document.getElementById(\"game\"),\r\n  debug: false, // set to false once ready for production\r\n});","var yi=Object.defineProperty;var i=(n,e)=>yi(n,\"name\",{value:e,configurable:!0});var gr=(()=>{for(var n=new Uint8Array(128),e=0;e<64;e++)n[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return o=>{for(var c=o.length,g=new Uint8Array((c-(o[c-1]==\"=\")-(o[c-2]==\"=\"))*3/4|0),m=0,P=0;m<c;){var I=n[o.charCodeAt(m++)],j=n[o.charCodeAt(m++)],y=n[o.charCodeAt(m++)],X=n[o.charCodeAt(m++)];g[P++]=I<<2|j>>4,g[P++]=j<<4|y>>2,g[P++]=y<<6|X}return g}})();function Ge(n){return n*Math.PI/180}i(Ge,\"deg2rad\");function ot(n){return n*180/Math.PI}i(ot,\"rad2deg\");function Le(n,e,o){return e>o?Le(n,o,e):Math.min(Math.max(n,e),o)}i(Le,\"clamp\");function Ve(n,e,o){if(typeof n==\"number\"&&typeof e==\"number\")return n+(e-n)*o;if(n instanceof v&&e instanceof v)return n.lerp(e,o);if(n instanceof W&&e instanceof W)return n.lerp(e,o);throw new Error(`Bad value for lerp(): ${n}, ${e}. Only number, Vec2 and Color is supported.`)}i(Ve,\"lerp\");function _e(n,e,o,c,g){return c+(n-e)/(o-e)*(g-c)}i(_e,\"map\");function br(n,e,o,c,g){return Le(_e(n,e,o,c,g),c,g)}i(br,\"mapc\");var v=class n{static{i(this,\"Vec2\")}x=0;y=0;constructor(e=0,o=e){this.x=e,this.y=o}static fromAngle(e){let o=Ge(e);return new n(Math.cos(o),Math.sin(o))}static LEFT=new n(-1,0);static RIGHT=new n(1,0);static UP=new n(0,-1);static DOWN=new n(0,1);clone(){return new n(this.x,this.y)}add(...e){let o=T(...e);return new n(this.x+o.x,this.y+o.y)}sub(...e){let o=T(...e);return new n(this.x-o.x,this.y-o.y)}scale(...e){let o=T(...e);return new n(this.x*o.x,this.y*o.y)}dist(...e){let o=T(...e);return this.sub(o).len()}sdist(...e){let o=T(...e);return this.sub(o).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new n(0):this.scale(1/e)}normal(){return new n(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let o=T(...e);return ot(Math.atan2(this.y-o.y,this.x-o.x))}angleBetween(...e){let o=T(...e);return ot(Math.atan2(this.cross(o),this.dot(o)))}lerp(e,o){return new n(Ve(this.x,e.x,o),Ve(this.y,e.y,o))}slerp(e,o){let c=this.dot(e),g=this.cross(e),m=Math.atan2(g,c);return this.scale(Math.sin((1-o)*m)).add(e.scale(Math.sin(o*m))).scale(1/g)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new n(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new de(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}};function T(...n){if(n.length===1){if(n[0]instanceof v)return new v(n[0].x,n[0].y);if(Array.isArray(n[0])&&n[0].length===2)return new v(...n[0])}return new v(...n)}i(T,\"vec2\");var W=class n{static{i(this,\"Color\")}r=255;g=255;b=255;constructor(e,o,c){this.r=Le(e,0,255),this.g=Le(o,0,255),this.b=Le(c,0,255)}static fromArray(e){return new n(e[0],e[1],e[2])}static fromHex(e){if(typeof e==\"number\")return new n(e>>16&255,e>>8&255,e>>0&255);if(typeof e==\"string\"){let o=/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(e);return new n(parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16))}else throw new Error(\"Invalid hex color format\")}static fromHSL(e,o,c){if(o==0)return new n(255*c,255*c,255*c);let g=i((X,S,q)=>(q<0&&(q+=1),q>1&&(q-=1),q<1/6?X+(S-X)*6*q:q<1/2?S:q<2/3?X+(S-X)*(2/3-q)*6:X),\"hue2rgb\"),m=c<.5?c*(1+o):c+o-c*o,P=2*c-m,I=g(P,m,e+1/3),j=g(P,m,e),y=g(P,m,e-1/3);return new n(Math.round(I*255),Math.round(j*255),Math.round(y*255))}static RED=new n(255,0,0);static GREEN=new n(0,255,0);static BLUE=new n(0,0,255);static YELLOW=new n(255,255,0);static MAGENTA=new n(255,0,255);static CYAN=new n(0,255,255);static WHITE=new n(255,255,255);static BLACK=new n(0,0,0);clone(){return new n(this.r,this.g,this.b)}lighten(e){return new n(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new n(255-this.r,255-this.g,255-this.b)}mult(e){return new n(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,o){return new n(Ve(this.r,e.r,o),Ve(this.g,e.g,o),Ve(this.b,e.b,o))}toHSL(){let e=this.r/255,o=this.g/255,c=this.b/255,g=Math.max(e,o,c),m=Math.min(e,o,c),P=(g+m)/2,I=P,j=P;if(g==m)P=I=0;else{let y=g-m;switch(I=j>.5?y/(2-g-m):y/(g+m),g){case e:P=(o-c)/y+(o<c?6:0);break;case o:P=(c-e)/y+2;break;case c:P=(e-o)/y+4;break}P/=6}return[P,I,j]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return\"#\"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}};function J(...n){if(n.length===0)return new W(255,255,255);if(n.length===1){if(n[0]instanceof W)return n[0].clone();if(typeof n[0]==\"string\")return W.fromHex(n[0]);if(Array.isArray(n[0])&&n[0].length===3)return W.fromArray(n[0])}return new W(...n)}i(J,\"rgb\");var vr=i((n,e,o)=>W.fromHSL(n,e,o),\"hsl2rgb\"),oe=class n{static{i(this,\"Quad\")}x=0;y=0;w=1;h=1;constructor(e,o,c,g){this.x=e,this.y=o,this.w=c,this.h=g}scale(e){return new n(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new v(this.x,this.y)}clone(){return new n(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function ce(n,e,o,c){return new oe(n,e,o,c)}i(ce,\"quad\");var Ue=class n{static{i(this,\"Mat4\")}m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new n([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new n([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=Ge(-e);let o=Math.cos(e),c=Math.sin(e);return new n([1,0,0,0,0,o,-c,0,0,c,o,0,0,0,0,1])}static rotateY(e){e=Ge(-e);let o=Math.cos(e),c=Math.sin(e);return new n([o,0,c,0,0,1,0,0,-c,0,o,0,0,0,0,1])}static rotateZ(e){e=Ge(-e);let o=Math.cos(e),c=Math.sin(e);return new n([o,-c,0,0,c,o,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=Ge(-e);let o=Math.cos(e),c=Math.sin(e),g=this.m[0],m=this.m[1],P=this.m[4],I=this.m[5];return this.m[0]=g*o+m*c,this.m[1]=-g*c+m*o,this.m[4]=P*o+I*c,this.m[5]=-P*c+I*o,this}mult(e){let o=[];for(let c=0;c<4;c++)for(let g=0;g<4;g++)o[c*4+g]=this.m[0*4+g]*e.m[c*4+0]+this.m[1*4+g]*e.m[c*4+1]+this.m[2*4+g]*e.m[c*4+2]+this.m[3*4+g]*e.m[c*4+3];return new n(o)}multVec2(e){return new v(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new v(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],o=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new v(o,e/o)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],o=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new v(e/o,o)}else return new v(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return ot(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return ot(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new v(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new v(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new v(0,0)}invert(){let e=[],o=this.m[10]*this.m[15]-this.m[14]*this.m[11],c=this.m[9]*this.m[15]-this.m[13]*this.m[11],g=this.m[9]*this.m[14]-this.m[13]*this.m[10],m=this.m[8]*this.m[15]-this.m[12]*this.m[11],P=this.m[8]*this.m[14]-this.m[12]*this.m[10],I=this.m[8]*this.m[13]-this.m[12]*this.m[9],j=this.m[6]*this.m[15]-this.m[14]*this.m[7],y=this.m[5]*this.m[15]-this.m[13]*this.m[7],X=this.m[5]*this.m[14]-this.m[13]*this.m[6],S=this.m[4]*this.m[15]-this.m[12]*this.m[7],q=this.m[4]*this.m[14]-this.m[12]*this.m[6],E=this.m[5]*this.m[15]-this.m[13]*this.m[7],K=this.m[4]*this.m[13]-this.m[12]*this.m[5],Q=this.m[6]*this.m[11]-this.m[10]*this.m[7],te=this.m[5]*this.m[11]-this.m[9]*this.m[7],k=this.m[5]*this.m[10]-this.m[9]*this.m[6],pe=this.m[4]*this.m[11]-this.m[8]*this.m[7],C=this.m[4]*this.m[10]-this.m[8]*this.m[6],Ae=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*o-this.m[6]*c+this.m[7]*g,e[4]=-(this.m[4]*o-this.m[6]*m+this.m[7]*P),e[8]=this.m[4]*c-this.m[5]*m+this.m[7]*I,e[12]=-(this.m[4]*g-this.m[5]*P+this.m[6]*I),e[1]=-(this.m[1]*o-this.m[2]*c+this.m[3]*g),e[5]=this.m[0]*o-this.m[2]*m+this.m[3]*P,e[9]=-(this.m[0]*c-this.m[1]*m+this.m[3]*I),e[13]=this.m[0]*g-this.m[1]*P+this.m[2]*I,e[2]=this.m[1]*j-this.m[2]*y+this.m[3]*X,e[6]=-(this.m[0]*j-this.m[2]*S+this.m[3]*q),e[10]=this.m[0]*E-this.m[1]*S+this.m[3]*K,e[14]=-(this.m[0]*X-this.m[1]*q+this.m[2]*K),e[3]=-(this.m[1]*Q-this.m[2]*te+this.m[3]*k),e[7]=this.m[0]*Q-this.m[2]*pe+this.m[3]*C,e[11]=-(this.m[0]*te-this.m[1]*pe+this.m[3]*Ae),e[15]=this.m[0]*k-this.m[1]*C+this.m[2]*Ae;let $=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let Te=0;Te<4;Te++)for(let ye=0;ye<4;ye++)e[Te*4+ye]*=1/$;return new n(e)}clone(){return new n([...this.m])}toString(){return this.m.toString()}};function In(n,e,o,c=g=>-Math.cos(g)){return n+(c(o)+1)/2*(e-n)}i(In,\"wave\");var xi=1103515245,Ui=12345,wr=2147483648,bt=class{static{i(this,\"RNG\")}seed;constructor(e){this.seed=e}gen(){return this.seed=(xi*this.seed+Ui)%wr,this.seed/wr}genNumber(e,o){return e+this.gen()*(o-e)}genVec2(e,o){return new v(this.genNumber(e.x,o.x),this.genNumber(e.y,o.y))}genColor(e,o){return new W(this.genNumber(e.r,o.r),this.genNumber(e.g,o.g),this.genNumber(e.b,o.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]==\"number\")return this.genNumber(0,e[0]);if(e[0]instanceof v)return this.genVec2(T(0,0),e[0]);if(e[0]instanceof W)return this.genColor(J(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]==\"number\"&&typeof e[1]==\"number\")return this.genNumber(e[0],e[1]);if(e[0]instanceof v&&e[1]instanceof v)return this.genVec2(e[0],e[1]);if(e[0]instanceof W&&e[1]instanceof W)return this.genColor(e[0],e[1])}}},Bn=new bt(Date.now());function yr(n){return n!=null&&(Bn.seed=n),Bn.seed}i(yr,\"randSeed\");function xt(...n){return Bn.genAny(...n)}i(xt,\"rand\");function Ln(...n){return Math.floor(xt(...n))}i(Ln,\"randi\");function xr(n){return xt()<=n}i(xr,\"chance\");function Ur(n){return n[Ln(n.length)]}i(Ur,\"choose\");function Er(n,e){return n.pos.x+n.width>e.pos.x&&n.pos.x<e.pos.x+e.width&&n.pos.y+n.height>e.pos.y&&n.pos.y<e.pos.y+e.height}i(Er,\"testRectRect\");function Ei(n,e){if(n.p1.x===n.p2.x&&n.p1.y===n.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let o=(e.p2.y-e.p1.y)*(n.p2.x-n.p1.x)-(e.p2.x-e.p1.x)*(n.p2.y-n.p1.y);if(o===0)return null;let c=((e.p2.x-e.p1.x)*(n.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(n.p1.x-e.p1.x))/o,g=((n.p2.x-n.p1.x)*(n.p1.y-e.p1.y)-(n.p2.y-n.p1.y)*(n.p1.x-e.p1.x))/o;return c<0||c>1||g<0||g>1?null:c}i(Ei,\"testLineLineT\");function it(n,e){let o=Ei(n,e);return o?T(n.p1.x+o*(n.p2.x-n.p1.x),n.p1.y+o*(n.p2.y-n.p1.y)):null}i(it,\"testLineLine\");function Sr(n,e){if(vt(n,e.p1)||vt(n,e.p2))return!0;let o=n.points();return!!it(e,new Ie(o[0],o[1]))||!!it(e,new Ie(o[1],o[2]))||!!it(e,new Ie(o[2],o[3]))||!!it(e,new Ie(o[3],o[0]))}i(Sr,\"testRectLine\");function vt(n,e){return e.x>n.pos.x&&e.x<n.pos.x+n.width&&e.y>n.pos.y&&e.y<n.pos.y+n.height}i(vt,\"testRectPoint\");function Cr(n,e){let o=e.sub(n.p1),c=n.p2.sub(n.p1);if(Math.abs(o.cross(c))>Number.EPSILON)return!1;let g=o.dot(c)/c.dot(c);return g>=0&&g<=1}i(Cr,\"testLinePoint\");function Vn(n,e){let o=n.p2.sub(n.p1),c=o.dot(o),g=n.p1.sub(e.center),m=2*o.dot(g),P=g.dot(g)-e.radius*e.radius,I=m*m-4*c*P;if(c<=Number.EPSILON||I<0)return!1;if(I==0){let j=-m/(2*c);if(j>=0&&j<=1)return!0}else{let j=(-m+Math.sqrt(I))/(2*c),y=(-m-Math.sqrt(I))/(2*c);if(j>=0&&j<=1||y>=0&&y<=1)return!0}return Ar(e,n.p1)}i(Vn,\"testLineCircle\");function Ar(n,e){return n.center.sdist(e)<n.radius*n.radius}i(Ar,\"testCirclePoint\");function Tr(n,e){let o=e.pts[e.pts.length-1];for(let c of e.pts){if(Vn(new Ie(o,c),n))return!0;o=c}return Ar(n,e.pts[0])?!0:_n(e,n.center)}i(Tr,\"testCirclePolygon\");function _n(n,e){let o=!1,c=n.pts;for(let g=0,m=c.length-1;g<c.length;m=g++)c[g].y>e.y!=c[m].y>e.y&&e.x<(c[m].x-c[g].x)*(e.y-c[g].y)/(c[m].y-c[g].y)+c[g].x&&(o=!o);return o}i(_n,\"testPolygonPoint\");var Ie=class n{static{i(this,\"Line\")}p1;p2;constructor(e,o){this.p1=e.clone(),this.p2=o.clone()}transform(e){return new n(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return de.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new n(this.p1,this.p2)}},de=class n{static{i(this,\"Rect\")}pos;width;height;constructor(e,o,c){this.pos=e.clone(),this.width=o,this.height=c}static fromPoints(e,o){return new n(e.clone(),o.x-e.x,o.y-e.y)}center(){return new v(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new Ke(this.points().map(o=>e.multVec2(o)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new n(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let o=this.pos,c=this.pos.add(this.width,this.height),g=Math.max(o.x-e.x,0,e.x-c.x),m=Math.max(o.y-e.y,0,e.y-c.y);return g*g+m*m}},yt=class n{static{i(this,\"Circle\")}center;radius;constructor(e,o){this.center=e.clone(),this.radius=o}transform(e){return new Fn(this.center,this.radius,this.radius).transform(e)}bbox(){return de.fromPoints(this.center.sub(T(this.radius)),this.center.add(T(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new n(this.center,this.radius)}},Fn=class n{static{i(this,\"Ellipse\")}center;radiusX;radiusY;constructor(e,o,c){this.center=e.clone(),this.radiusX=o,this.radiusY=c}transform(e){return new n(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY)}bbox(){return de.fromPoints(this.center.sub(T(this.radiusX,this.radiusY)),this.center.add(T(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new n(this.center,this.radiusX,this.radiusY)}},Ke=class n{static{i(this,\"Polygon\")}pts;constructor(e){if(e.length<3)throw new Error(\"Polygons should have at least 3 vertices\");this.pts=e}transform(e){return new n(this.pts.map(o=>e.multVec2(o)))}bbox(){let e=T(Number.MAX_VALUE),o=T(-Number.MAX_VALUE);for(let c of this.pts)e.x=Math.min(e.x,c.x),o.x=Math.max(o.x,c.x),e.y=Math.min(e.y,c.y),o.y=Math.max(o.y,c.y);return de.fromPoints(e,o)}area(){let e=0,o=this.pts.length;for(let c=0;c<o;c++){let g=this.pts[c],m=this.pts[(c+1)%o];e+=g.x*m.y*.5,e-=m.x*g.y*.5}return Math.abs(e)}clone(){return new n(this.pts.map(e=>e.clone()))}};function Or(n,e){let o=Number.MAX_VALUE,c=T(0);for(let g of[n,e])for(let m=0;m<g.pts.length;m++){let P=g.pts[m],j=g.pts[(m+1)%g.pts.length].sub(P).normal().unit(),y=Number.MAX_VALUE,X=-Number.MAX_VALUE;for(let K=0;K<n.pts.length;K++){let Q=n.pts[K].dot(j);y=Math.min(y,Q),X=Math.max(X,Q)}let S=Number.MAX_VALUE,q=-Number.MAX_VALUE;for(let K=0;K<e.pts.length;K++){let Q=e.pts[K].dot(j);S=Math.min(S,Q),q=Math.max(q,Q)}let E=Math.min(X,q)-Math.max(y,S);if(E<0)return null;if(E<Math.abs(o)){let K=q-y,Q=S-X;o=Math.abs(K)<Math.abs(Q)?K:Q,c=j.scale(o)}}return c}i(Or,\"sat\");var Ut=class extends Map{static{i(this,\"Registry\")}lastID;constructor(...e){super(...e),this.lastID=0}push(e){let o=this.lastID;return this.set(o,e),this.lastID++,o}pushd(e){let o=this.push(e);return()=>this.delete(o)}},ke=class n{static{i(this,\"EventController\")}paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let o=new n(()=>e.forEach(c=>c.cancel()));return Object.defineProperty(o,\"paused\",{get:()=>e[0].paused,set:c=>e.forEach(g=>g.paused=c)}),o.paused=!1,o}},be=class{static{i(this,\"Event\")}handlers=new Ut;add(e){let o=this.handlers.pushd((...g)=>{c.paused||e(...g)}),c=new ke(o);return c}addOnce(e){let o=this.add((...c)=>{o.cancel(),e(...c)});return o}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(o=>o(...e))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},Ne=class{static{i(this,\"EventHandler\")}handlers={};on(e,o){return this.handlers[e]||(this.handlers[e]=new be),this.handlers[e].add(o)}onOnce(e,o){let c=this.on(e,(...g)=>{c.cancel(),o(...g)});return c}next(e){return new Promise(o=>{this.onOnce(e,(...c)=>o(c[0]))})}trigger(e,...o){this.handlers[e]&&this.handlers[e].trigger(...o)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};function Wt(n,e){if(n===e)return!0;let o=typeof n,c=typeof e;if(o!==c)return!1;if(o===\"object\"&&c===\"object\"&&n!==null&&e!==null){if(Array.isArray(n)!==Array.isArray(e))return!1;let g=Object.keys(n),m=Object.keys(e);if(g.length!==m.length)return!1;for(let P of g){let I=n[P],j=e[P];if(!Wt(I,j))return!1}return!0}return!1}i(Wt,\"deepEq\");function Si(n){let e=window.atob(n),o=e.length,c=new Uint8Array(o);for(let g=0;g<o;g++)c[g]=e.charCodeAt(g);return c.buffer}i(Si,\"base64ToArrayBuffer\");function Pr(n){return Si(n.split(\",\")[1])}i(Pr,\"dataURLToArrayBuffer\");function Xt(n,e){let o=document.createElement(\"a\");o.href=e,o.download=n,o.click()}i(Xt,\"download\");function kn(n,e){Xt(n,\"data:text/plain;charset=utf-8,\"+e)}i(kn,\"downloadText\");function Dr(n,e){kn(n,JSON.stringify(e))}i(Dr,\"downloadJSON\");function Nn(n,e){let o=URL.createObjectURL(e);Xt(n,o),URL.revokeObjectURL(o)}i(Nn,\"downloadBlob\");var jn=i(n=>n.match(/^data:\\w+\\/\\w+;base64,.+/),\"isDataURL\");var Mr=i(n=>n.split(\".\").slice(0,-1).join(\".\"),\"getFileName\");function Ee(n,e){return(...o)=>{let c=o.length;if(c===n.length)return n(...o);if(c===e.length)return e(...o)}}i(Ee,\"overload2\");var Gr=(()=>{let n=0;return()=>n++})(),Br=i(n=>n instanceof Error?n.message:String(n),\"getErrorMessage\");var Yt=class{static{i(this,\"BinaryHeap\")}_items;_compareFn;constructor(e=(o,c)=>o<c){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],o=this._items.pop();return this._items.length!==0&&(this._items[0]=o,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let o=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[o])&&this._items[e]>=this._items[o])break;this.swap(e,o),e=o}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let o=2*e+1;if(o<this._items.length-1&&!this._compareFn(this._items[o],this._items[o+1])&&++o,this._compareFn(this._items[e],this._items[o]))break;this.swap(e,o),e=o}}swap(e,o){[this._items[e],this._items[o]]=[this._items[o],this._items[e]]}get length(){return this._items.length}};var Ci=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Fr(n){if(typeof n!=\"string\")throw new TypeError(\"string cannot be undefined or null\");let e=[],o=0,c=0;for(;o<n.length;){if(c+=Ai(o+c,n),Gi(n[o+c])&&c++,Pi(n[o+c])&&c++,Di(n[o+c])&&c++,Bi(n[o+c])){c++;continue}e.push(n.substring(o,o+c)),o+=c,c=0}return e}i(Fr,\"runes\");function Ai(n,e){let o=e[n];if(!Ti(o)||n===e.length-1)return 1;let c=o+e[n+1],g=e.substring(n+2,n+5);return Rr(c)&&Rr(g)?4:Oi(c)&&Mi(g)?e.slice(n).indexOf(String.fromCodePoint(917631))+2:Ri(g)?4:2}i(Ai,\"nextUnits\");function Ti(n){return n&&tt(n[0].charCodeAt(0),55296,56319)}i(Ti,\"isFirstOfSurrogatePair\");function Rr(n){return tt(Hn(n),127462,127487)}i(Rr,\"isRegionalIndicator\");function Oi(n){return tt(Hn(n),127988,127988)}i(Oi,\"isSubdivisionFlag\");function Ri(n){return tt(Hn(n),127995,127999)}i(Ri,\"isFitzpatrickModifier\");function Pi(n){return typeof n==\"string\"&&tt(n.charCodeAt(0),65024,65039)}i(Pi,\"isVariationSelector\");function Di(n){return typeof n==\"string\"&&tt(n.charCodeAt(0),8400,8447)}i(Di,\"isDiacriticalMark\");function Mi(n){let e=n.codePointAt(0);return typeof n==\"string\"&&typeof e==\"number\"&&tt(e,917504,917631)}i(Mi,\"isSupplementarySpecialpurposePlane\");function Gi(n){return typeof n==\"string\"&&Ci.includes(n.charCodeAt(0))}i(Gi,\"isGrapheme\");function Bi(n){return typeof n==\"string\"&&n.charCodeAt(0)===8205}i(Bi,\"isZeroWidthJoiner\");function Hn(n){let e=n.charCodeAt(0)-55296,o=n.charCodeAt(1)-56320;return(e<<10)+o+65536}i(Hn,\"codePointFromSurrogatePair\");function tt(n,e,o){return n>=e&&n<=o}i(tt,\"betweenInclusive\");var qn={\"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"6\":\"ltrigger\",\"7\":\"rtrigger\",\"8\":\"select\",\"9\":\"start\",\"10\":\"lstick\",\"11\":\"rstick\",\"12\":\"dpad-up\",\"13\":\"dpad-down\",\"14\":\"dpad-left\",\"15\":\"dpad-right\",\"16\":\"home\",\"17\":\"capture\"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},\"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"9\":\"select\",\"10\":\"lstick\",\"16\":\"start\"},sticks:{left:{x:0,y:1}}},\"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"9\":\"start\",\"10\":\"lstick\",\"16\":\"select\"},sticks:{left:{x:0,y:1}}},\"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"6\":\"ltrigger\",\"7\":\"rtrigger\",\"8\":\"select\",\"9\":\"start\",\"10\":\"lstick\",\"11\":\"rstick\",\"12\":\"dpad-up\",\"13\":\"dpad-down\",\"14\":\"dpad-left\",\"15\":\"dpad-right\",\"16\":\"home\",\"17\":\"capture\"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"6\":\"ltrigger\",\"7\":\"rtrigger\",\"8\":\"select\",\"9\":\"start\",\"10\":\"lstick\",\"11\":\"rstick\",\"12\":\"dpad-up\",\"13\":\"dpad-down\",\"14\":\"dpad-left\",\"15\":\"dpad-right\",\"16\":\"home\"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}};var at=class{static{i(this,\"ButtonState\")}pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},$n=class{static{i(this,\"GamepadState\")}buttonState=new at;stickState=new Map},zn=class{static{i(this,\"FPSCounter\")}dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((o,c)=>o+c)/this.dts.length)),this.dts=[])}},Ir=i(n=>{if(!n.canvas)throw new Error(\"Please provide a canvas\");let e={canvas:n.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new zn,timeScale:1,skipTime:!1,numFrames:0,mousePos:new v(0),mouseDeltaPos:new v(0),keyState:new at,mouseState:new at,mergedGamepadState:new $n,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:n.canvas.offsetWidth,lastHeight:n.canvas.offsetHeight,events:new Ne};function o(){return e.dt*e.timeScale}i(o,\"dt\");function c(){return e.time}i(c,\"time\");function g(){return e.fpsCounter.fps}i(g,\"fps\");function m(){return e.numFrames}i(m,\"numFrames\");function P(){return e.canvas.toDataURL()}i(P,\"screenshot\");function I(l){e.canvas.style.cursor=l}i(I,\"setCursor\");function j(){return e.canvas.style.cursor}i(j,\"getCursor\");function y(l){if(l)try{let x=e.canvas.requestPointerLock();x.catch&&x.catch(R=>console.error(R))}catch(x){console.error(x)}else document.exitPointerLock()}i(y,\"setCursorLocked\");function X(){return!!document.pointerLockElement}i(X,\"isCursorLocked\");function S(l){l.requestFullscreen?l.requestFullscreen():l.webkitRequestFullscreen&&l.webkitRequestFullscreen()}i(S,\"enterFullscreen\");function q(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}i(q,\"exitFullscreen\");function E(){return document.fullscreenElement||document.webkitFullscreenElement}i(E,\"getFullscreenElement\");function K(l=!0){l?S(e.canvas):q()}i(K,\"setFullscreen\");function Q(){return!!E()}i(Q,\"isFullscreen\");function te(){e.stopped=!0;for(let l in se)e.canvas.removeEventListener(l,se[l]);for(let l in le)document.removeEventListener(l,le[l]);for(let l in ae)window.removeEventListener(l,ae[l]);ge.disconnect()}i(te,\"quit\");function k(l){e.loopID!==null&&cancelAnimationFrame(e.loopID);let x=0,R=i(L=>{if(e.stopped)return;if(document.visibilityState!==\"visible\"){e.loopID=requestAnimationFrame(R);return}let he=L/1e3,z=he-e.realTime,Oe=n.maxFPS?1/n.maxFPS:0;e.realTime=he,x+=z,x>Oe&&(e.skipTime||(e.dt=x,e.time+=o(),e.fpsCounter.tick(e.dt)),x=0,e.skipTime=!1,e.numFrames++,ft(),l(),vn()),e.loopID=requestAnimationFrame(R)},\"frame\");R(0)}i(k,\"run\");function pe(){return\"ontouchstart\"in window||navigator.maxTouchPoints>0}i(pe,\"isTouchscreen\");function C(){return e.mousePos.clone()}i(C,\"mousePos\");function Ae(){return e.mouseDeltaPos.clone()}i(Ae,\"mouseDeltaPos\");function $(l=\"left\"){return e.mouseState.pressed.has(l)}i($,\"isMousePressed\");function Te(l=\"left\"){return e.mouseState.down.has(l)}i(Te,\"isMouseDown\");function ye(l=\"left\"){return e.mouseState.released.has(l)}i(ye,\"isMouseReleased\");function Se(){return e.isMouseMoved}i(Se,\"isMouseMoved\");function st(l){return l===void 0?e.keyState.pressed.size>0:e.keyState.pressed.has(l)}i(st,\"isKeyPressed\");function on(l){return l===void 0?e.keyState.pressedRepeat.size>0:e.keyState.pressedRepeat.has(l)}i(on,\"isKeyPressedRepeat\");function Tt(l){return l===void 0?e.keyState.down.size>0:e.keyState.down.has(l)}i(Tt,\"isKeyDown\");function Ot(l){return l===void 0?e.keyState.released.size>0:e.keyState.released.has(l)}i(Ot,\"isKeyReleased\");function Rt(l){return l===void 0?e.mergedGamepadState.buttonState.pressed.size>0:e.mergedGamepadState.buttonState.pressed.has(l)}i(Rt,\"isGamepadButtonPressed\");function Ye(l){return l===void 0?e.mergedGamepadState.buttonState.down.size>0:e.mergedGamepadState.buttonState.down.has(l)}i(Ye,\"isGamepadButtonDown\");function an(l){return l===void 0?e.mergedGamepadState.buttonState.released.size>0:e.mergedGamepadState.buttonState.released.has(l)}i(an,\"isGamepadButtonReleased\");function un(l){return e.events.on(\"resize\",l)}i(un,\"onResize\");let cn=Ee(l=>e.events.on(\"keyDown\",l),(l,x)=>e.events.on(\"keyDown\",R=>R===l&&x(l))),hn=Ee(l=>e.events.on(\"keyPress\",l),(l,x)=>e.events.on(\"keyPress\",R=>R===l&&x(l))),ln=Ee(l=>e.events.on(\"keyPressRepeat\",l),(l,x)=>e.events.on(\"keyPressRepeat\",R=>R===l&&x(l))),dn=Ee(l=>e.events.on(\"keyRelease\",l),(l,x)=>e.events.on(\"keyRelease\",R=>R===l&&x(l))),Pt=Ee(l=>e.events.on(\"mouseDown\",x=>l(x)),(l,x)=>e.events.on(\"mouseDown\",R=>R===l&&x(R))),Dt=Ee(l=>e.events.on(\"mousePress\",x=>l(x)),(l,x)=>e.events.on(\"mousePress\",R=>R===l&&x(R))),Mt=Ee(l=>e.events.on(\"mouseRelease\",x=>l(x)),(l,x)=>e.events.on(\"mouseRelease\",R=>R===l&&x(R)));function Gt(l){return e.events.on(\"mouseMove\",()=>l(C(),Ae()))}i(Gt,\"onMouseMove\");function Bt(l){return e.events.on(\"charInput\",l)}i(Bt,\"onCharInput\");function fn(l){return e.events.on(\"touchStart\",l)}i(fn,\"onTouchStart\");function ct(l){return e.events.on(\"touchMove\",l)}i(ct,\"onTouchMove\");function mn(l){return e.events.on(\"touchEnd\",l)}i(mn,\"onTouchEnd\");function pn(l){return e.events.on(\"scroll\",l)}i(pn,\"onScroll\");function Ft(l){return e.events.on(\"hide\",l)}i(Ft,\"onHide\");function gn(l){return e.events.on(\"show\",l)}i(gn,\"onShow\");function It(l,x){if(typeof l==\"function\")return e.events.on(\"gamepadButtonDown\",l);if(typeof l==\"string\"&&typeof x==\"function\")return e.events.on(\"gamepadButtonDown\",R=>R===l&&x(l))}i(It,\"onGamepadButtonDown\");function Lt(l,x){if(typeof l==\"function\")return e.events.on(\"gamepadButtonPress\",l);if(typeof l==\"string\"&&typeof x==\"function\")return e.events.on(\"gamepadButtonPress\",R=>R===l&&x(l))}i(Lt,\"onGamepadButtonPress\");function wn(l,x){if(typeof l==\"function\")return e.events.on(\"gamepadButtonRelease\",l);if(typeof l==\"string\"&&typeof x==\"function\")return e.events.on(\"gamepadButtonRelease\",R=>R===l&&x(l))}i(wn,\"onGamepadButtonRelease\");function ht(l,x){return e.events.on(\"gamepadStick\",(R,L)=>R===l&&x(L))}i(ht,\"onGamepadStick\");function bn(l){e.events.on(\"gamepadConnect\",l)}i(bn,\"onGamepadConnect\");function lt(l){e.events.on(\"gamepadDisconnect\",l)}i(lt,\"onGamepadDisconnect\");function Pe(l){return e.mergedGamepadState.stickState.get(l)||new v(0)}i(Pe,\"getGamepadStick\");function dt(){return[...e.charInputted]}i(dt,\"charInputted\");function Vt(){return[...e.gamepads]}i(Vt,\"getGamepads\");function ft(){e.events.trigger(\"input\"),e.keyState.down.forEach(l=>e.events.trigger(\"keyDown\",l)),e.mouseState.down.forEach(l=>e.events.trigger(\"mouseDown\",l)),He()}i(ft,\"processInput\");function vn(){e.keyState.update(),e.mouseState.update(),e.mergedGamepadState.buttonState.update(),e.mergedGamepadState.stickState.forEach((l,x)=>{e.mergedGamepadState.stickState.set(x,new v(0))}),e.charInputted=[],e.isMouseMoved=!1,e.gamepadStates.forEach(l=>{l.buttonState.update(),l.stickState.forEach((x,R)=>{l.stickState.set(R,new v(0))})})}i(vn,\"resetInput\");function _t(l){let x={index:l.index,isPressed:R=>e.gamepadStates.get(l.index).buttonState.pressed.has(R),isDown:R=>e.gamepadStates.get(l.index).buttonState.down.has(R),isReleased:R=>e.gamepadStates.get(l.index).buttonState.released.has(R),getStick:R=>e.gamepadStates.get(l.index).stickState.get(R)};return e.gamepads.push(x),e.gamepadStates.set(l.index,{buttonState:new at,stickState:new Map([[\"left\",new v(0)],[\"right\",new v(0)]])}),x}i(_t,\"registerGamepad\");function ne(l){e.gamepads=e.gamepads.filter(x=>x.index!==l.index),e.gamepadStates.delete(l.index)}i(ne,\"removeGamepad\");function He(){for(let l of navigator.getGamepads())l&&!e.gamepadStates.has(l.index)&&_t(l);for(let l of e.gamepads){let x=navigator.getGamepads()[l.index],L=(n.gamepads??{})[x.id]??qn[x.id]??qn.default,he=e.gamepadStates.get(l.index);for(let z=0;z<x.buttons.length;z++)x.buttons[z].pressed?(he.buttonState.down.has(L.buttons[z])||(e.mergedGamepadState.buttonState.press(L.buttons[z]),he.buttonState.press(L.buttons[z]),e.events.trigger(\"gamepadButtonPress\",L.buttons[z])),e.events.trigger(\"gamepadButtonDown\",L.buttons[z])):he.buttonState.down.has(L.buttons[z])&&(e.mergedGamepadState.buttonState.release(L.buttons[z]),he.buttonState.release(L.buttons[z]),e.events.trigger(\"gamepadButtonRelease\",L.buttons[z]));for(let z in L.sticks){let Oe=L.sticks[z],$e=new v(x.axes[Oe.x],x.axes[Oe.y]);he.stickState.set(z,$e),e.mergedGamepadState.stickState.set(z,$e),e.events.trigger(\"gamepadStick\",z,$e)}}}i(He,\"processGamepad\");let se={},le={},ae={},Be=n.pixelDensity||window.devicePixelRatio||1;se.mousemove=l=>{let x=new v(l.offsetX,l.offsetY),R=new v(l.movementX,l.movementY);if(Q()){let L=e.canvas.width/Be,he=e.canvas.height/Be,z=window.innerWidth,Oe=window.innerHeight,$e=z/Oe,kt=L/he;if($e>kt){let De=Oe/he,Ce=(z-L*De)/2;x.x=_e(l.offsetX-Ce,0,L*De,0,L),x.y=_e(l.offsetY,0,he*De,0,he)}else{let De=z/L,Ce=(Oe-he*De)/2;x.x=_e(l.offsetX,0,L*De,0,L),x.y=_e(l.offsetY-Ce,0,he*De,0,he)}}e.events.onOnce(\"input\",()=>{e.isMouseMoved=!0,e.mousePos=x,e.mouseDeltaPos=R,e.events.trigger(\"mouseMove\")})};let We=[\"left\",\"middle\",\"right\",\"back\",\"forward\"];se.mousedown=l=>{e.events.onOnce(\"input\",()=>{let x=We[l.button];x&&(e.mouseState.press(x),e.events.trigger(\"mousePress\",x))})},se.mouseup=l=>{e.events.onOnce(\"input\",()=>{let x=We[l.button];x&&(e.mouseState.release(x),e.events.trigger(\"mouseRelease\",x))})};let yn=new Set([\" \",\"ArrowLeft\",\"ArrowRight\",\"ArrowUp\",\"ArrowDown\",\"Tab\"]),qe={ArrowLeft:\"left\",ArrowRight:\"right\",ArrowUp:\"up\",ArrowDown:\"down\",\" \":\"space\"};se.keydown=l=>{yn.has(l.key)&&l.preventDefault(),e.events.onOnce(\"input\",()=>{let x=qe[l.key]||l.key.toLowerCase();x.length===1?(e.events.trigger(\"charInput\",x),e.charInputted.push(x)):x===\"space\"&&(e.events.trigger(\"charInput\",\" \"),e.charInputted.push(\" \")),l.repeat?(e.keyState.pressRepeat(x),e.events.trigger(\"keyPressRepeat\",x)):(e.keyState.press(x),e.events.trigger(\"keyPressRepeat\",x),e.events.trigger(\"keyPress\",x))})},se.keyup=l=>{e.events.onOnce(\"input\",()=>{let x=qe[l.key]||l.key.toLowerCase();e.keyState.release(x),e.events.trigger(\"keyRelease\",x)})},se.touchstart=l=>{l.preventDefault(),e.events.onOnce(\"input\",()=>{let x=[...l.changedTouches],R=e.canvas.getBoundingClientRect();n.touchToMouse!==!1&&(e.mousePos=new v(x[0].clientX-R.x,x[0].clientY-R.y),e.mouseState.press(\"left\"),e.events.trigger(\"mousePress\",\"left\")),x.forEach(L=>{e.events.trigger(\"touchStart\",new v(L.clientX-R.x,L.clientY-R.y),L)})})},se.touchmove=l=>{l.preventDefault(),e.events.onOnce(\"input\",()=>{let x=[...l.changedTouches],R=e.canvas.getBoundingClientRect();n.touchToMouse!==!1&&(e.mousePos=new v(x[0].clientX-R.x,x[0].clientY-R.y),e.events.trigger(\"mouseMove\")),x.forEach(L=>{e.events.trigger(\"touchMove\",new v(L.clientX-R.x,L.clientY-R.y),L)})})},se.touchend=l=>{e.events.onOnce(\"input\",()=>{let x=[...l.changedTouches],R=e.canvas.getBoundingClientRect();n.touchToMouse!==!1&&(e.mousePos=new v(x[0].clientX-R.x,x[0].clientY-R.y),e.mouseState.release(\"left\"),e.events.trigger(\"mouseRelease\",\"left\")),x.forEach(L=>{e.events.trigger(\"touchEnd\",new v(L.clientX-R.x,L.clientY-R.y),L)})})},se.touchcancel=l=>{e.events.onOnce(\"input\",()=>{let x=[...l.changedTouches],R=e.canvas.getBoundingClientRect();n.touchToMouse!==!1&&(e.mousePos=new v(x[0].clientX-R.x,x[0].clientY-R.y),e.mouseState.release(\"left\"),e.events.trigger(\"mouseRelease\",\"left\")),x.forEach(L=>{e.events.trigger(\"touchEnd\",new v(L.clientX-R.x,L.clientY-R.y),L)})})},se.wheel=l=>{l.preventDefault(),e.events.onOnce(\"input\",()=>{e.events.trigger(\"scroll\",new v(l.deltaX,l.deltaY))})},se.contextmenu=l=>l.preventDefault(),le.visibilitychange=()=>{document.visibilityState===\"visible\"?(e.skipTime=!0,e.events.trigger(\"show\")):e.events.trigger(\"hide\")},ae.gamepadconnected=l=>{let x=_t(l.gamepad);e.events.onOnce(\"input\",()=>{e.events.trigger(\"gamepadConnect\",x)})},ae.gamepaddisconnected=l=>{let x=Vt().filter(R=>R.index===l.gamepad.index)[0];ne(l.gamepad),e.events.onOnce(\"input\",()=>{e.events.trigger(\"gamepadDisconnect\",x)})};for(let l in se)e.canvas.addEventListener(l,se[l]);for(let l in le)document.addEventListener(l,le[l]);for(let l in ae)window.addEventListener(l,ae[l]);let ge=new ResizeObserver(l=>{for(let x of l)if(x.target===e.canvas){if(e.lastWidth===e.canvas.offsetWidth&&e.lastHeight===e.canvas.offsetHeight)return;e.lastWidth=e.canvas.offsetWidth,e.lastHeight=e.canvas.offsetHeight,e.events.onOnce(\"input\",()=>{e.events.trigger(\"resize\")})}});return ge.observe(e.canvas),{dt:o,time:c,run:k,canvas:e.canvas,fps:g,numFrames:m,quit:te,setFullscreen:K,isFullscreen:Q,setCursor:I,screenshot:P,getGamepads:Vt,getCursor:j,setCursorLocked:y,isCursorLocked:X,isTouchscreen:pe,mousePos:C,mouseDeltaPos:Ae,isKeyDown:Tt,isKeyPressed:st,isKeyPressedRepeat:on,isKeyReleased:Ot,isMouseDown:Te,isMousePressed:$,isMouseReleased:ye,isMouseMoved:Se,isGamepadButtonPressed:Rt,isGamepadButtonDown:Ye,isGamepadButtonReleased:an,getGamepadStick:Pe,charInputted:dt,onResize:un,onKeyDown:cn,onKeyPress:hn,onKeyPressRepeat:ln,onKeyRelease:dn,onMouseDown:Pt,onMousePress:Dt,onMouseRelease:Mt,onMouseMove:Gt,onCharInput:Bt,onTouchStart:fn,onTouchMove:ct,onTouchEnd:mn,onScroll:pn,onHide:Ft,onShow:gn,onGamepadButtonDown:It,onGamepadButtonPress:Lt,onGamepadButtonRelease:wn,onGamepadStick:ht,onGamepadConnect:bn,onGamepadDisconnect:lt,events:e.events}},\"default\");var Re=class n{static{i(this,\"Texture\")}ctx;src=null;glTex;width;height;constructor(e,o,c,g={}){this.ctx=e;let m=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy(()=>this.free()),this.width=o,this.height=c;let P={linear:m.LINEAR,nearest:m.NEAREST}[g.filter??e.opts.texFilter]??m.NEAREST,I={repeat:m.REPEAT,clampToEadge:m.CLAMP_TO_EDGE}[g.wrap]??m.CLAMP_TO_EDGE;this.bind(),o&&c&&m.texImage2D(m.TEXTURE_2D,0,m.RGBA,o,c,0,m.RGBA,m.UNSIGNED_BYTE,null),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,P),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,P),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,I),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,I),this.unbind()}static fromImage(e,o,c={}){let g=new n(e,o.width,o.height,c);return g.update(o),g.src=o,g}update(e,o=0,c=0){let g=this.ctx.gl;this.bind(),g.texSubImage2D(g.TEXTURE_2D,0,o,c,g.RGBA,g.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},rt=class{static{i(this,\"FrameBuffer\")}ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,o,c,g={}){this.ctx=e;let m=e.gl;e.onDestroy(()=>this.free()),this.tex=new Re(e,o,c,g),this.glFramebuffer=m.createFramebuffer(),this.glRenderbuffer=m.createRenderbuffer(),this.bind(),m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_STENCIL,o,c),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,this.tex.glTex,0),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,o=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,o),this.unbind();let c=this.width*4,g=new Uint8Array(c);for(let m=0;m<(this.height/2|0);m++){let P=m*c,I=(this.height-m-1)*c;g.set(o.subarray(P,P+c)),o.copyWithin(P,I,I+c),o.set(g,I)}return new ImageData(o,this.width,this.height)}toDataURL(){let e=document.createElement(\"canvas\"),o=e.getContext(\"2d\");return e.width=this.width,e.height=this.height,o.putImageData(this.toImageData(),0,0),e.toDataURL()}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},Jt=class{static{i(this,\"Shader\")}ctx;glProgram;constructor(e,o,c,g){this.ctx=e,e.onDestroy(()=>this.free());let m=e.gl,P=m.createShader(m.VERTEX_SHADER),I=m.createShader(m.FRAGMENT_SHADER);m.shaderSource(P,o),m.shaderSource(I,c),m.compileShader(P),m.compileShader(I);let j=m.createProgram();if(this.glProgram=j,m.attachShader(j,P),m.attachShader(j,I),g.forEach((y,X)=>m.bindAttribLocation(j,X,y)),m.linkProgram(j),!m.getProgramParameter(j,m.LINK_STATUS)){let y=m.getShaderInfoLog(P);if(y)throw new Error(\"VERTEX SHADER \"+y);let X=m.getShaderInfoLog(I);if(X)throw new Error(\"FRAGMENT SHADER \"+X)}m.deleteShader(P),m.deleteShader(I)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let o=this.ctx.gl;for(let c in e){let g=e[c],m=o.getUniformLocation(this.glProgram,c);typeof g==\"number\"?o.uniform1f(m,g):g instanceof Ue?o.uniformMatrix4fv(m,!1,new Float32Array(g.m)):g instanceof W?o.uniform3f(m,g.r,g.g,g.b):g instanceof v&&o.uniform2f(m,g.x,g.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},Qt=class{static{i(this,\"BatchRenderer\")}ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(e,o,c,g){let m=e.gl;this.vertexFormat=o,this.ctx=e,this.stride=o.reduce((P,I)=>P+I.size,0),this.maxVertices=c,this.maxIndices=g,this.glVBuf=m.createBuffer(),e.pushArrayBuffer(this.glVBuf),m.bufferData(m.ARRAY_BUFFER,c*4,m.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=m.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),m.bufferData(m.ELEMENT_ARRAY_BUFFER,g*4,m.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,o,c,g,m=null,P={}){(e!==this.curPrimitive||m!==this.curTex||g!==this.curShader||!Wt(this.curUniform,P)||this.vqueue.length+o.length*this.stride>this.maxVertices||this.iqueue.length+c.length>this.maxIndices)&&this.flush();let I=this.vqueue.length/this.stride;for(let j of o)this.vqueue.push(j);for(let j of c)this.iqueue.push(j+I);this.curPrimitive=e,this.curShader=g,this.curTex=m,this.curUniform=P}flush(){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function nt(n){let e=[],o=i(m=>{e.push(m),n(m)},\"push\"),c=i(()=>{e.pop(),n(g()??null)},\"pop\"),g=i(()=>e[e.length-1],\"cur\");return[o,c,g]}i(nt,\"genStack\");function Kn(n,e={}){let o=[];function c($){o.push($)}i(c,\"onDestroy\");function g(){o.forEach($=>$()),n.getExtension(\"WEBGL_lose_context\").loseContext()}i(g,\"destroy\");let m=null;function P($){if(Wt($,m))return;m=$;let Te=$.reduce((ye,Se)=>ye+Se.size,0);$.reduce((ye,Se,st)=>(n.vertexAttribPointer(st,Se.size,n.FLOAT,!1,Te*4,ye),n.enableVertexAttribArray(st),ye+Se.size*4),0)}i(P,\"setVertexFormat\");let[I,j]=nt($=>n.bindTexture(n.TEXTURE_2D,$)),[y,X]=nt($=>n.bindBuffer(n.ARRAY_BUFFER,$)),[S,q]=nt($=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,$)),[E,K]=nt($=>n.bindFramebuffer(n.FRAMEBUFFER,$)),[Q,te]=nt($=>n.bindRenderbuffer(n.RENDERBUFFER,$)),[k,pe]=nt(({x:$,y:Te,w:ye,h:Se})=>{n.viewport($,Te,ye,Se)}),[C,Ae]=nt($=>n.useProgram($));return k({x:0,y:0,w:n.drawingBufferWidth,h:n.drawingBufferHeight}),{gl:n,opts:e,onDestroy:c,destroy:g,pushTexture2D:I,popTexture2D:j,pushArrayBuffer:y,popArrayBuffer:X,pushElementArrayBuffer:S,popElementArrayBuffer:q,pushFramebuffer:E,popFramebuffer:K,pushRenderbuffer:Q,popRenderbuffer:te,pushViewport:k,popViewport:pe,pushProgram:C,popProgram:Ae,setVertexFormat:P}}i(Kn,\"initGfx\");var ve=class n{static{i(this,\"Asset\")}loaded=!1;data=null;error=null;onLoadEvents=new be;onErrorEvents=new be;onFinishEvents=new be;constructor(e){e.then(o=>{this.data=o,this.onLoadEvents.trigger(o)}).catch(o=>{if(this.error=o,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(o);else throw o}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let o=new n(Promise.resolve(e));return o.data=e,o.loaded=!0,o}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},je=class{static{i(this,\"AssetBucket\")}assets=new Map;lastUID=0;add(e,o){let c=e??this.lastUID+++\"\",g=new ve(o);return this.assets.set(c,g),g}addLoaded(e,o){let c=e??this.lastUID+++\"\",g=ve.loaded(o);return this.assets.set(c,g),g}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(o=>{o.loaded&&e++}),e/this.assets.size}};function Yn(n){return fetch(n).then(e=>{if(!e.ok)throw new Error(`Failed to fetch \"${n}\"`);return e})}i(Yn,\"fetchURL\");function Et(n){return Yn(n).then(e=>e.json())}i(Et,\"fetchJSON\");function Lr(n){return Yn(n).then(e=>e.text())}i(Lr,\"fetchText\");function Vr(n){return Yn(n).then(e=>e.arrayBuffer())}i(Vr,\"fetchArrayBuffer\");function St(n){let e=new Image;return e.crossOrigin=\"anonymous\",e.src=n,new Promise((o,c)=>{e.onload=()=>o(e),e.onerror=()=>c(new Error(`Failed to load image from \"${n}\"`))})}i(St,\"loadImg\");var Zt=2.5949095,_r=1.70158+1,kr=2*Math.PI/3,Nr=2*Math.PI/4.5,en={linear:n=>n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInQuad:n=>n*n,easeOutQuad:n=>1-(1-n)*(1-n),easeInOutQuad:n=>n<.5?2*n*n:1-Math.pow(-2*n+2,2)/2,easeInCubic:n=>n*n*n,easeOutCubic:n=>1-Math.pow(1-n,3),easeInOutCubic:n=>n<.5?4*n*n*n:1-Math.pow(-2*n+2,3)/2,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1-Math.pow(1-n,4),easeInOutQuart:n=>n<.5?8*n*n*n*n:1-Math.pow(-2*n+2,4)/2,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1-Math.pow(1-n,5),easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1-Math.pow(-2*n+2,5)/2,easeInExpo:n=>n===0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n===1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n===0?0:n===1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2,easeInCirc:n=>1-Math.sqrt(1-Math.pow(n,2)),easeOutCirc:n=>Math.sqrt(1-Math.pow(n-1,2)),easeInOutCirc:n=>n<.5?(1-Math.sqrt(1-Math.pow(2*n,2)))/2:(Math.sqrt(1-Math.pow(-2*n+2,2))+1)/2,easeInBack:n=>_r*n*n*n-1.70158*n*n,easeOutBack:n=>1+_r*Math.pow(n-1,3)+1.70158*Math.pow(n-1,2),easeInOutBack:n=>n<.5?Math.pow(2*n,2)*((Zt+1)*2*n-Zt)/2:(Math.pow(2*n-2,2)*((Zt+1)*(n*2-2)+Zt)+2)/2,easeInElastic:n=>n===0?0:n===1?1:-Math.pow(2,10*n-10)*Math.sin((n*10-10.75)*kr),easeOutElastic:n=>n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n*10-.75)*kr)+1,easeInOutElastic:n=>n===0?0:n===1?1:n<.5?-(Math.pow(2,20*n-10)*Math.sin((20*n-11.125)*Nr))/2:Math.pow(2,-20*n+10)*Math.sin((20*n-11.125)*Nr)/2+1,easeInBounce:n=>1-en.easeOutBounce(1-n),easeOutBounce:n=>n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375,easeInOutBounce:n=>n<.5?(1-en.easeOutBounce(1-2*n))/2:(1+en.easeOutBounce(2*n-1))/2},Ct=en;var At=class{static{i(this,\"TexPacker\")}textures=[];canvas;c2d;x=0;y=0;curHeight=0;gfx;constructor(e,o,c){this.gfx=e,this.canvas=document.createElement(\"canvas\"),this.canvas.width=o,this.canvas.height=c,this.textures=[Re.fromImage(e,this.canvas)],this.c2d=this.canvas.getContext(\"2d\")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Re.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let o=this.textures[this.textures.length-1],c=new v(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,c.x,c.y):this.c2d.drawImage(e,c.x,c.y),o.update(this.canvas),[o,new oe(c.x/this.canvas.width,c.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free()}};var jr=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==\";var Hr=gr(\"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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV\");var qr=\"data:image/png;base64,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\";var $r=\"data:image/png;base64,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\";var ki=\"3000.1.17\",zr=\" !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\",tn=\"topleft\",Kr=64,Ni=\"monospace\",nn=\"monospace\",ji=36,rn=64,sn=256,Yr=2048,Wr=2048,Xr=2048,Jr=2048,Qr=.1,Hi=64,Wn=\"linear\",qi=8,$i=4,Qn=[{name:\"a_pos\",size:2},{name:\"a_uv\",size:2},{name:\"a_color\",size:4}],zi=Qn.reduce((n,e)=>n+e.size,0),Zr=2048,Ki=Zr*4*zi,Yi=Zr*6,Wi=`\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n`,Xi=`\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n`,Xn=`\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n`,Jn=`\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n`,Ji=new Set([\"id\",\"require\"]),Qi=new Set([\"add\",\"update\",\"draw\",\"destroy\",\"inspect\",\"drawInspect\"]);function ut(n){switch(n){case\"topleft\":return new v(-1,-1);case\"top\":return new v(0,-1);case\"topright\":return new v(1,-1);case\"left\":return new v(-1,0);case\"center\":return new v(0,0);case\"right\":return new v(1,0);case\"botleft\":return new v(-1,1);case\"bot\":return new v(0,1);case\"botright\":return new v(1,1);default:return n}}i(ut,\"anchorPt\");function Zi(n){switch(n){case\"left\":return 0;case\"center\":return .5;case\"right\":return 1;default:return 0}}i(Zi,\"alignPt\");function eo(n){return n.createBuffer(1,1,44100)}i(eo,\"createEmptyAudioBuffer\");var zo=i((n={})=>{let e=n.root??document.body;e===document.body&&(document.body.style.width=\"100%\",document.body.style.height=\"100%\",document.body.style.margin=\"0px\",document.documentElement.style.width=\"100%\",document.documentElement.style.height=\"100%\");let o=n.canvas??(()=>{let t=document.createElement(\"canvas\");return e.appendChild(t),t})(),c=n.scale??1,g=n.width&&n.height&&!n.stretch&&!n.letterbox;g?(o.width=n.width*c,o.height=n.height*c):(o.width=o.parentElement.offsetWidth,o.height=o.parentElement.offsetHeight);let m=[\"outline: none\",\"cursor: default\"];if(g){let t=o.width,r=o.height;m.push(`width: ${t}px`),m.push(`height: ${r}px`)}else m.push(\"width: 100%\"),m.push(\"height: 100%\");n.crisp&&(m.push(\"image-rendering: pixelated\"),m.push(\"image-rendering: crisp-edges\")),o.style.cssText=m.join(\";\");let P=n.pixelDensity||window.devicePixelRatio;o.width*=P,o.height*=P,o.tabIndex=0;let I=document.createElement(\"canvas\");I.width=sn,I.height=sn;let j=I.getContext(\"2d\",{willReadFrequently:!0}),y=Ir({canvas:o,touchToMouse:n.touchToMouse,gamepads:n.gamepads,pixelDensity:n.pixelDensity,maxFPS:n.maxFPS}),X=[],S=y.canvas.getContext(\"webgl\",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),q=Kn(S,{texFilter:n.texFilter}),E=(()=>{let t=ht(Xn,Jn),r=Re.fromImage(q,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),s=n.width&&n.height?new rt(q,n.width*P*c,n.height*P*c):new rt(q,S.drawingBufferWidth,S.drawingBufferHeight),u=null,a=1;n.background&&(u=J(n.background),a=Array.isArray(n.background)?n.background[3]:1,S.clearColor(u.r/255,u.g/255,u.b/255,a??1)),S.enable(S.BLEND),S.blendFuncSeparate(S.SRC_ALPHA,S.ONE_MINUS_SRC_ALPHA,S.ONE,S.ONE_MINUS_SRC_ALPHA);let h=new Qt(q,Qn,Ki,Yi),f=Re.fromImage(q,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:\"repeat\",filter:\"nearest\"});return{lastDrawCalls:0,defShader:t,defTex:r,frameBuffer:s,postShader:null,postShaderUniform:null,renderer:h,transform:new Ue,transformStack:[],bgTex:f,bgColor:u,bgAlpha:a,width:n.width??S.drawingBufferWidth/P/c,height:n.height??S.drawingBufferHeight/P/c,viewport:{x:0,y:0,width:S.drawingBufferWidth,height:S.drawingBufferHeight},fixed:!1}})();class K{static{i(this,\"SpriteData\")}tex;frames=[new oe(0,0,1,1)];anims={};slice9=null;constructor(r,s,u={},a=null){this.tex=r,s&&(this.frames=s),this.anims=u,this.slice9=a}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(r,s={}){return typeof r==\"string\"?K.fromURL(r,s):Promise.resolve(K.fromImage(r,s))}static fromImage(r,s={}){let[u,a]=k.packer.add(r),h=s.frames?s.frames.map(f=>new oe(a.x+f.x*a.w,a.y+f.y*a.h,f.w*a.w,f.h*a.h)):Tt(s.sliceX||1,s.sliceY||1,a.x,a.y,a.w,a.h);return new K(u,h,s.anims,s.slice9)}static fromURL(r,s={}){return St(r).then(u=>K.fromImage(u,s))}}class Q{static{i(this,\"SoundData\")}buf;constructor(r){this.buf=r}static fromArrayBuffer(r){return new Promise((s,u)=>te.ctx.decodeAudioData(r,s,u)).then(s=>new Q(s))}static fromURL(r){return jn(r)?Q.fromArrayBuffer(Pr(r)):Vr(r).then(s=>Q.fromArrayBuffer(s))}}let te=(()=>{let t=new(window.AudioContext||window.webkitAudioContext),r=t.createGain();r.connect(t.destination);let s=new Q(eo(t));return t.decodeAudioData(Hr.buffer.slice(0)).then(u=>{s.buf=u}).catch(u=>{console.error(\"Failed to load burp: \",u)}),{ctx:t,masterNode:r,burpSnd:s}})(),k={urlPrefix:\"\",sprites:new je,fonts:new je,bitmapFonts:new je,sounds:new je,shaders:new je,custom:new je,packer:new At(q,Xr,Jr),loaded:!1};function pe(t){return typeof t!=\"string\"||jn(t)?t:k.urlPrefix+t}i(pe,\"fixURL\");let C={events:new Ne,objEvents:new Ne,root:Un([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new v(1),angle:0,shake:0,transform:new Ue}};C.root.use(An());function Ae(t){return k.custom.add(null,t)}i(Ae,\"load\");function $(){let t=[k.sprites,k.sounds,k.shaders,k.fonts,k.bitmapFonts,k.custom];return t.reduce((r,s)=>r+s.progress(),0)/t.length}i($,\"loadProgress\");function Te(t){return t!==void 0&&(k.urlPrefix=t),k.urlPrefix}i(Te,\"loadRoot\");function ye(t,r){return k.custom.add(t,Et(r))}i(ye,\"loadJSON\");class Se{static{i(this,\"FontData\")}fontface;filter=Wn;outline=null;size=rn;constructor(r,s={}){if(this.fontface=r,this.filter=s.filter??Wn,this.size=s.size??rn,this.size>sn)throw new Error(`Max font size: ${sn}`);s.outline&&(this.outline={width:1,color:J(0,0,0)},typeof s.outline==\"number\"?this.outline.width=s.outline:typeof s.outline==\"object\"&&(s.outline.width&&(this.outline.width=s.outline.width),s.outline.color&&(this.outline.color=s.outline.color)))}}function st(t,r,s={}){let u=new FontFace(t,typeof r==\"string\"?`url(${r})`:r);return document.fonts.add(u),k.fonts.add(t,u.load().catch(a=>{throw new Error(`Failed to load font from \"${r}\": ${a}`)}).then(a=>new Se(a,s)))}i(st,\"loadFont\");function on(t,r,s,u,a={}){return k.bitmapFonts.add(t,St(r).then(h=>bn(Re.fromImage(q,h,a),s,u,a.chars??zr)))}i(on,\"loadBitmapFont\");function Tt(t=1,r=1,s=0,u=0,a=1,h=1){let f=[],b=a/t,p=h/r;for(let d=0;d<r;d++)for(let w=0;w<t;w++)f.push(new oe(s+w*b,u+d*p,b,p));return f}i(Tt,\"slice\");function Ot(t,r){return t=pe(t),Ae(typeof r==\"string\"?new Promise((s,u)=>{Et(r).then(a=>{Ot(t,a).then(s).catch(u)})}):K.from(t).then(s=>{let u={};for(let a in r){let h=r[a],f=s.frames[0],b=Xr*f.w,p=Jr*f.h,d=h.frames?h.frames.map(A=>new oe(f.x+(h.x+A.x)/b*f.w,f.y+(h.y+A.y)/p*f.h,A.w/b*f.w,A.h/p*f.h)):Tt(h.sliceX||1,h.sliceY||1,f.x+h.x/b*f.w,f.y+h.y/p*f.h,h.width/b*f.w,h.height/p*f.h),w=new K(s.tex,d,h.anims);k.sprites.addLoaded(a,w),u[a]=w}return u}))}i(Ot,\"loadSpriteAtlas\");function Rt(t,r={}){let s=document.createElement(\"canvas\"),u=t[0].width,a=t[0].height;s.width=u*t.length,s.height=a;let h=s.getContext(\"2d\");t.forEach((b,p)=>{b instanceof ImageData?h.putImageData(b,p*u,0):h.drawImage(b,p*u,0)});let f=h.getImageData(0,0,t.length*u,a);return K.fromImage(f,{...r,sliceX:t.length,sliceY:1})}i(Rt,\"createSpriteSheet\");function Ye(t,r,s={sliceX:1,sliceY:1,anims:{}}){return r=pe(r),Array.isArray(r)?r.some(u=>typeof u==\"string\")?k.sprites.add(t,Promise.all(r.map(u=>typeof u==\"string\"?St(u):Promise.resolve(u))).then(u=>Rt(u,s))):k.sprites.addLoaded(t,Rt(r,s)):typeof r==\"string\"?k.sprites.add(t,K.from(r,s)):k.sprites.addLoaded(t,K.fromImage(r,s))}i(Ye,\"loadSprite\");function an(t,r){return r=pe(r),k.sprites.add(t,new Promise(async s=>{let u=typeof r==\"string\"?await Et(r):r,a=await Promise.all(u.frames.map(St)),h=document.createElement(\"canvas\");h.width=u.width,h.height=u.height*u.frames.length;let f=h.getContext(\"2d\");a.forEach((p,d)=>{f.drawImage(p,0,d*u.height)});let b=await Ye(null,h,{sliceY:u.frames.length,anims:u.anims});s(b)}))}i(an,\"loadPedit\");function un(t,r,s){r=pe(r),s=pe(s),typeof r==\"string\"&&!s&&(s=Mr(r)+\".json\");let u=typeof s==\"string\"?Et(s):Promise.resolve(s);return k.sprites.add(t,u.then(a=>{let h=a.meta.size,f=a.frames.map(p=>new oe(p.frame.x/h.w,p.frame.y/h.h,p.frame.w/h.w,p.frame.h/h.h)),b={};for(let p of a.meta.frameTags)p.from===p.to?b[p.name]=p.from:b[p.name]={from:p.from,to:p.to,speed:10,loop:!0,pingpong:p.direction===\"pingpong\"};return K.from(r,{frames:f,anims:b})}))}i(un,\"loadAseprite\");function cn(t,r,s){return k.shaders.addLoaded(t,ht(r,s))}i(cn,\"loadShader\");function hn(t,r,s){r=pe(r),s=pe(s);let u=i(h=>h?Lr(h):Promise.resolve(null),\"resolveUrl\"),a=Promise.all([u(r),u(s)]).then(([h,f])=>ht(h,f));return k.shaders.add(t,a)}i(hn,\"loadShaderURL\");function ln(t,r){return r=pe(r),k.sounds.add(t,typeof r==\"string\"?Q.fromURL(r):Q.fromArrayBuffer(r))}i(ln,\"loadSound\");function dn(t=\"bean\"){return Ye(t,jr)}i(dn,\"loadBean\");function Pt(t){return k.sprites.get(t)}i(Pt,\"getSprite\");function Dt(t){return k.sounds.get(t)}i(Dt,\"getSound\");function Mt(t){return k.fonts.get(t)}i(Mt,\"getFont\");function Gt(t){return k.bitmapFonts.get(t)}i(Gt,\"getBitmapFont\");function Bt(t){return k.shaders.get(t)}i(Bt,\"getShader\");function fn(t){return k.custom.get(t)}i(fn,\"getAsset\");function ct(t){if(typeof t==\"string\"){let r=Pt(t);if(r)return r;if($()<1)return null;throw new Error(`Sprite not found: ${t}`)}else{if(t instanceof K)return ve.loaded(t);if(t instanceof ve)return t;throw new Error(`Invalid sprite: ${t}`)}}i(ct,\"resolveSprite\");function mn(t){if(typeof t==\"string\"){let r=Dt(t);if(r)return r;if($()<1)return null;throw new Error(`Sound not found: ${t}`)}else{if(t instanceof Q)return ve.loaded(t);if(t instanceof ve)return t;throw new Error(`Invalid sound: ${t}`)}}i(mn,\"resolveSound\");function pn(t){if(!t)return E.defShader;if(typeof t==\"string\"){let r=Bt(t);if(r)return r.data??r;if($()<1)return null;throw new Error(`Shader not found: ${t}`)}else if(t instanceof ve)return t.data?t.data:t;return t}i(pn,\"resolveShader\");function Ft(t){if(!t)return Ft(n.font??Ni);if(typeof t==\"string\"){let r=Gt(t),s=Mt(t);if(r)return r.data??r;if(s)return s.data??s;if(document.fonts.check(`${rn}px ${t}`))return t;if($()<1)return null;throw new Error(`Font not found: ${t}`)}else if(t instanceof ve)return t.data?t.data:t;return t}i(Ft,\"resolveFont\");function gn(t){return t!==void 0&&(te.masterNode.gain.value=t),te.masterNode.gain.value}i(gn,\"volume\");function It(t,r={}){let s=te.ctx,u=r.paused??!1,a=s.createBufferSource(),h=new be,f=s.createGain(),b=r.seek??0,p=0,d=0,w=!1;a.loop=!!r.loop,a.detune.value=r.detune??0,a.playbackRate.value=r.speed??1,a.connect(f),a.onended=()=>{N()>=a.buffer?.duration&&h.trigger()},f.connect(te.masterNode),f.gain.value=r.volume??1;let A=i(M=>{a.buffer=M.buf,u||(p=s.currentTime,a.start(0,b),w=!0)},\"start\"),D=mn(t);D instanceof ve&&D.onLoad(A);let N=i(()=>{if(!a.buffer)return 0;let M=u?d-p:s.currentTime-p,O=a.buffer.duration;return a.loop?M%O:Math.min(M,O)},\"getTime\"),_=i(M=>{let O=s.createBufferSource();return O.buffer=M.buffer,O.loop=M.loop,O.playbackRate.value=M.playbackRate.value,O.detune.value=M.detune.value,O.onended=M.onended,O.connect(f),O},\"cloneNode\");return{stop(){this.paused=!0,this.seek(0)},set paused(M){if(u!==M)if(u=M,M)w&&(a.stop(),w=!1),d=s.currentTime;else{a=_(a);let O=d-p;a.start(0,O),w=!0,p=s.currentTime-O,d=0}},get paused(){return u},play(M=0){this.seek(M),this.paused=!1},seek(M){a.buffer?.duration&&(M>a.buffer.duration||(u?(a=_(a),p=d-M):(a.stop(),a=_(a),p=s.currentTime-M,a.start(0,M),w=!0,d=0)))},set speed(M){a.playbackRate.value=M},get speed(){return a.playbackRate.value},set detune(M){a.detune.value=M},get detune(){return a.detune.value},set volume(M){f.gain.value=Math.max(M,0)},get volume(){return f.gain.value},set loop(M){a.loop=M},get loop(){return a.loop},duration(){return a.buffer?.duration??0},time(){return N()%this.duration()},onEnd(M){return h.add(M)},then(M){return this.onEnd(M)}}}i(It,\"play\");function Lt(t){return It(te.burpSnd,t)}i(Lt,\"burp\");function wn(t,r){return new rt(q,t,r)}i(wn,\"makeCanvas\");function ht(t=Xn,r=Jn){let s=Wi.replace(\"{{user}}\",t??Xn),u=Xi.replace(\"{{user}}\",r??Jn);try{return new Jt(q,s,u,Qn.map(a=>a.name))}catch(a){let f=/(?<type>^\\w+) SHADER ERROR: 0:(?<line>\\d+): (?<msg>.+)/,b=Br(a).match(f),p=Number(b.groups.line)-14,d=b.groups.msg.trim(),w=b.groups.type.toLowerCase();throw new Error(`${w} shader line ${p}: ${d}`)}}i(ht,\"makeShader\");function bn(t,r,s,u){let a=t.width/r,h={},f=u.split(\"\").entries();for(let[b,p]of f)h[p]=new oe(b%a*r,Math.floor(b/a)*s,r,s);return{tex:t,map:h,size:s}}i(bn,\"makeFont\");function lt(t,r,s,u=E.defTex,a=E.defShader,h={}){let f=pn(a);if(!f||f instanceof ve)return;let b=E.fixed||s?E.transform:C.cam.transform.mult(E.transform),p=[];for(let d of t){let w=vn(b.multVec2(d.pos));p.push(w.x,w.y,d.uv.x,d.uv.y,d.color.r/255,d.color.g/255,d.color.b/255,d.opacity)}E.renderer.push(S.TRIANGLES,p,r,f,u,h)}i(lt,\"drawRaw\");function Pe(){E.renderer.flush()}i(Pe,\"flush\");function dt(){S.clear(S.COLOR_BUFFER_BIT),E.frameBuffer.bind(),S.clear(S.COLOR_BUFFER_BIT),E.bgColor||Ce(()=>{Be({width:we(),height:xe(),quad:new oe(0,0,we()/Kr,xe()/Kr),tex:E.bgTex,fixed:!0})}),E.renderer.numDraws=0,E.fixed=!1,E.transformStack.length=0,E.transform=new Ue}i(dt,\"frameStart\");function Vt(t,r){E.postShader=t,E.postShaderUniform=r??null}i(Vt,\"usePostEffect\");function ft(){Pe(),E.lastDrawCalls=E.renderer.numDraws,E.frameBuffer.unbind(),S.viewport(0,0,S.drawingBufferWidth,S.drawingBufferHeight);let t=E.width,r=E.height;E.width=S.drawingBufferWidth/P,E.height=S.drawingBufferHeight/P,We({flipY:!0,tex:E.frameBuffer.tex,pos:new v(E.viewport.x,E.viewport.y),width:E.viewport.width,height:E.viewport.height,shader:E.postShader,uniform:typeof E.postShaderUniform==\"function\"?E.postShaderUniform():E.postShaderUniform,fixed:!0}),Pe(),E.width=t,E.height=r}i(ft,\"frameEnd\");function vn(t){return new v(t.x/we()*2-1,-t.y/xe()*2+1)}i(vn,\"screen2ndc\");function _t(t){E.transform=t.clone()}i(_t,\"pushMatrix\");function ne(...t){if(t[0]===void 0)return;let r=T(...t);r.x===0&&r.y===0||E.transform.translate(r)}i(ne,\"pushTranslate\");function He(...t){if(t[0]===void 0)return;let r=T(...t);r.x===1&&r.y===1||E.transform.scale(r)}i(He,\"pushScale\");function se(t){t&&E.transform.rotate(t)}i(se,\"pushRotate\");function le(){E.transformStack.push(E.transform.clone())}i(le,\"pushTransform\");function ae(){E.transformStack.length>0&&(E.transform=E.transformStack.pop())}i(ae,\"popTransform\");function Be(t){if(t.width===void 0||t.height===void 0)throw new Error('drawUVQuad() requires property \"width\" and \"height\".');if(t.width<=0||t.height<=0)return;let r=t.width,s=t.height,a=ut(t.anchor||tn).scale(new v(r,s).scale(-.5)),h=t.quad||new oe(0,0,1,1),f=t.color||J(255,255,255),b=t.opacity??1,p=t.tex?Qr/t.tex.width:0,d=t.tex?Qr/t.tex.height:0,w=h.x+p,A=h.y+d,D=h.w-p*2,N=h.h-d*2;le(),ne(t.pos),se(t.angle),He(t.scale),ne(a),lt([{pos:new v(-r/2,s/2),uv:new v(t.flipX?w+D:w,t.flipY?A:A+N),color:f,opacity:b},{pos:new v(-r/2,-s/2),uv:new v(t.flipX?w+D:w,t.flipY?A+N:A),color:f,opacity:b},{pos:new v(r/2,-s/2),uv:new v(t.flipX?w:w+D,t.flipY?A+N:A),color:f,opacity:b},{pos:new v(r/2,s/2),uv:new v(t.flipX?w:w+D,t.flipY?A:A+N),color:f,opacity:b}],[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform),ae()}i(Be,\"drawUVQuad\");function We(t){if(!t.tex)throw new Error('drawTexture() requires property \"tex\".');let r=t.quad??new oe(0,0,1,1),s=t.tex.width*r.w,u=t.tex.height*r.h,a=new v(1);if(t.tiled){let h=Math.ceil((t.width||s)/s),f=Math.ceil((t.height||u)/u),p=ut(t.anchor||tn).add(new v(1,1)).scale(.5).scale(h*s,f*u);for(let d=0;d<h;d++)for(let w=0;w<f;w++)Be(Object.assign({},t,{pos:(t.pos||new v(0)).add(new v(s*d,u*w)).sub(p),scale:a.scale(t.scale||new v(1)),tex:t.tex,quad:r,width:s,height:u,anchor:\"topleft\"}))}else t.width&&t.height?(a.x=t.width/s,a.y=t.height/u):t.width?(a.x=t.width/s,a.y=a.x):t.height&&(a.y=t.height/u,a.x=a.y),Be(Object.assign({},t,{scale:a.scale(t.scale||new v(1)),tex:t.tex,quad:r,width:s,height:u}))}i(We,\"drawTexture\");function yn(t){if(!t.sprite)throw new Error('drawSprite() requires property \"sprite\"');let r=ct(t.sprite);if(!r||!r.data)return;let s=r.data.frames[t.frame??0];if(!s)throw new Error(`Frame not found: ${t.frame??0}`);We(Object.assign({},t,{tex:r.data.tex,quad:s.scale(t.quad??new oe(0,0,1,1))}))}i(yn,\"drawSprite\");function qe(t,r,s,u,a,h=1){u=Ge(u%360),a=Ge(a%360),a<=u&&(a+=Math.PI*2);let f=[],b=Math.ceil((a-u)/Ge(8)*h),p=(a-u)/b;for(let d=u;d<a;d+=p)f.push(t.add(r*Math.cos(d),s*Math.sin(d)));return f.push(t.add(r*Math.cos(a),s*Math.sin(a))),f}i(qe,\"getArcPts\");function ge(t){if(t.width===void 0||t.height===void 0)throw new Error('drawRect() requires property \"width\" and \"height\".');if(t.width<=0||t.height<=0)return;let r=t.width,s=t.height,a=ut(t.anchor||tn).add(1,1).scale(new v(r,s).scale(-.5)),h=[new v(0,0),new v(r,0),new v(r,s),new v(0,s)];if(t.radius){let f=Math.min(Math.min(r,s)/2,t.radius);h=[new v(f,0),new v(r-f,0),...qe(new v(r-f,f),f,f,270,360),new v(r,f),new v(r,s-f),...qe(new v(r-f,s-f),f,f,0,90),new v(r-f,s),new v(f,s),...qe(new v(f,s-f),f,f,90,180),new v(0,s-f),new v(0,f),...qe(new v(f,f),f,f,180,270)]}z(Object.assign({},t,{offset:a,pts:h,...t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{}}))}i(ge,\"drawRect\");function l(t){let{p1:r,p2:s}=t;if(!r||!s)throw new Error('drawLine() requires properties \"p1\" and \"p2\".');let u=t.width||1,a=s.sub(r).unit().normal().scale(u*.5),h=[r.sub(a),r.add(a),s.add(a),s.sub(a)].map(f=>({pos:new v(f.x,f.y),uv:new v(0),color:t.color??W.WHITE,opacity:t.opacity??1}));lt(h,[0,1,3,1,2,3],t.fixed,E.defTex,t.shader,t.uniform)}i(l,\"drawLine\");function x(t){let r=t.pts;if(!r)throw new Error('drawLines() requires property \"pts\".');if(!(r.length<2))if(t.radius&&r.length>=3){let s=r[0].sdist(r[1]);for(let a=1;a<r.length-1;a++)s=Math.min(r[a].sdist(r[a+1]),s);let u=Math.min(t.radius,Math.sqrt(s)/2);l(Object.assign({},t,{p1:r[0],p2:r[1]}));for(let a=1;a<r.length-2;a++){let h=r[a],f=r[a+1];l(Object.assign({},t,{p1:h,p2:f}))}l(Object.assign({},t,{p1:r[r.length-2],p2:r[r.length-1]}))}else for(let s=0;s<r.length-1;s++)l(Object.assign({},t,{p1:r[s],p2:r[s+1]})),t.join!==\"none\"&&L(Object.assign({},t,{pos:r[s],radius:t.width/2}))}i(x,\"drawLines\");function R(t){if(!t.p1||!t.p2||!t.p3)throw new Error('drawTriangle() requires properties \"p1\", \"p2\" and \"p3\".');return z(Object.assign({},t,{pts:[t.p1,t.p2,t.p3]}))}i(R,\"drawTriangle\");function L(t){if(typeof t.radius!=\"number\")throw new Error('drawCircle() requires property \"radius\".');t.radius!==0&&he(Object.assign({},t,{radiusX:t.radius,radiusY:t.radius,angle:0}))}i(L,\"drawCircle\");function he(t){if(t.radiusX===void 0||t.radiusY===void 0)throw new Error('drawEllipse() requires properties \"radiusX\" and \"radiusY\".');if(t.radiusX===0||t.radiusY===0)return;let r=t.start??0,s=t.end??360,u=ut(t.anchor??\"center\").scale(new v(-t.radiusX,-t.radiusY)),a=qe(u,t.radiusX,t.radiusY,r,s,t.resolution);a.unshift(u);let h=Object.assign({},t,{pts:a,radius:0,...t.gradient?{colors:[t.gradient[0],...Array(a.length-1).fill(t.gradient[1])]}:{}});if(s-r>=360&&t.outline){t.fill!==!1&&z(Object.assign(h,{outline:null})),z(Object.assign(h,{pts:a.slice(1),fill:!1}));return}z(h)}i(he,\"drawEllipse\");function z(t){if(!t.pts)throw new Error('drawPolygon() requires property \"pts\".');let r=t.pts.length;if(!(r<3)){if(le(),ne(t.pos),He(t.scale),se(t.angle),ne(t.offset),t.fill!==!1){let s=t.color??W.WHITE,u=t.pts.map((h,f)=>({pos:new v(h.x,h.y),uv:new v(0,0),color:t.colors&&t.colors[f]?t.colors[f].mult(s):s,opacity:t.opacity??1})),a=[...Array(r-2).keys()].map(h=>[0,h+1,h+2]).flat();lt(u,t.indices??a,t.fixed,E.defTex,t.shader,t.uniform)}t.outline&&x({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,join:t.outline.join,uniform:t.uniform,fixed:t.fixed,opacity:t.opacity}),ae()}}i(z,\"drawPolygon\");function Oe(t,r,s){Pe(),S.clear(S.STENCIL_BUFFER_BIT),S.enable(S.STENCIL_TEST),S.stencilFunc(S.NEVER,1,255),S.stencilOp(S.REPLACE,S.REPLACE,S.REPLACE),r(),Pe(),S.stencilFunc(s,1,255),S.stencilOp(S.KEEP,S.KEEP,S.KEEP),t(),Pe(),S.disable(S.STENCIL_TEST)}i(Oe,\"drawStenciled\");function $e(t,r){Oe(t,r,S.EQUAL)}i($e,\"drawMasked\");function kt(t,r){Oe(t,r,S.NOTEQUAL)}i(kt,\"drawSubtracted\");function De(){return(E.viewport.width+E.viewport.height)/(E.width+E.height)}i(De,\"getViewportScale\");function Ce(t){Pe();let r=E.width,s=E.height;E.width=E.viewport.width,E.height=E.viewport.height,t(),Pe(),E.width=r,E.height=s}i(Ce,\"drawUnscaled\");function Zn(t,r){r.pos&&(t.pos=t.pos.add(r.pos)),r.scale&&(t.scale=t.scale.scale(T(r.scale))),r.angle&&(t.angle+=r.angle),r.color&&t.ch.length===1&&(t.color=t.color.mult(r.color)),r.opacity&&(t.opacity*=r.opacity)}i(Zn,\"applyCharTransform\");let er=/\\[(?<style>\\w+)\\](?<text>.*?)\\[\\/\\k<style>\\]/g;function es(t){let r={},s=t.replace(er,\"$2\"),u=0;for(let a of t.matchAll(er)){let h=a.index-u;for(let f=0;f<a.groups.text.length;f++)r[f+h]=[a.groups.style];u+=a[0].length-a.groups.text.length}return{charStyleMap:r,text:s}}i(es,\"compileStyledText\");let xn={};function Xe(t){if(t.text===void 0)throw new Error('formatText() requires property \"text\".');let r=Ft(t.font);if(t.text===\"\"||r instanceof ve||!r)return{width:0,height:0,chars:[],opt:t};let{charStyleMap:s,text:u}=es(t.text+\"\"),a=Fr(u);if(r instanceof Se||typeof r==\"string\"){let Z=r instanceof Se?r.fontface.family:r,H=r instanceof Se?{outline:r.outline,filter:r.filter}:{outline:null,filter:Wn},V=xn[Z]??{font:{tex:new Re(q,Yr,Wr,{filter:H.filter}),map:{},size:rn},cursor:new v(0),outline:H.outline};xn[Z]||(xn[Z]=V),r=V.font;for(let fe of a)if(!V.font.map[fe]){let U=j;U.clearRect(0,0,I.width,I.height),U.font=`${r.size}px ${Z}`,U.textBaseline=\"top\",U.textAlign=\"left\",U.fillStyle=\"#ffffff\";let G=U.measureText(fe),B=Math.ceil(G.width),F=r.size;V.outline&&(U.lineJoin=\"round\",U.lineWidth=V.outline.width*2,U.strokeStyle=V.outline.color.toHex(),U.strokeText(fe,V.outline.width,V.outline.width),B+=V.outline.width*2,F+=V.outline.width*3),U.fillText(fe,V.outline?.width??0,V.outline?.width??0);let Y=U.getImageData(0,0,B,F);if(V.cursor.x+B>Yr&&(V.cursor.x=0,V.cursor.y+=F,V.cursor.y>Wr))throw new Error(\"Font atlas exceeds character limit\");r.tex.update(Y,V.cursor.x,V.cursor.y),r.map[fe]=new oe(V.cursor.x,V.cursor.y,B,F),V.cursor.x+=B}}let h=t.size||r.size,f=T(t.scale??1).scale(h/r.size),b=t.lineSpacing??0,p=t.letterSpacing??0,d=0,w=0,A=0,D=[],N=[],_=0,M=null,O=null;for(;_<a.length;){let Z=a[_];if(Z===`\n`)A+=h+b,D.push({width:d-p,chars:N}),M=null,O=null,d=0,N=[];else{let H=r.map[Z];if(H){let V=H.w*f.x;t.width&&d+V>t.width&&(A+=h+b,M!=null&&(_-=N.length-M,Z=a[_],H=r.map[Z],V=H.w*f.x,N=N.slice(0,M-1),d=O),M=null,O=null,D.push({width:d-p,chars:N}),d=0,N=[]),N.push({tex:r.tex,width:H.w,height:H.h,quad:new oe(H.x/r.tex.width,H.y/r.tex.height,H.w/r.tex.width,H.h/r.tex.height),ch:Z,pos:new v(d,A),opacity:t.opacity??1,color:t.color??W.WHITE,scale:T(f),angle:0}),Z===\" \"&&(M=N.length,O=d),d+=V,w=Math.max(w,d),d+=p}}_++}D.push({width:d-p,chars:N}),A+=h,t.width&&(w=t.width);let ie=[];for(let Z of D){let H=(w-Z.width)*Zi(t.align??\"left\");for(let V of Z.chars){let fe=r.map[V.ch],U=ie.length;if(V.pos=V.pos.add(H,0).add(fe.w*f.x*.5,fe.h*f.y*.5),t.transform){let G=typeof t.transform==\"function\"?t.transform(U,V.ch):t.transform;G&&Zn(V,G)}if(s[U]){let G=s[U];for(let B of G){let F=t.styles[B],Y=typeof F==\"function\"?F(U,V.ch):F;Y&&Zn(V,Y)}}ie.push(V)}}return{width:w,height:A,chars:ie,opt:t}}i(Xe,\"formatText\");function tr(t){Je(Xe(t))}i(tr,\"drawText\");function Je(t){le(),ne(t.opt.pos),se(t.opt.angle),ne(ut(t.opt.anchor??\"topleft\").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach(r=>{Be({tex:r.tex,width:r.width,height:r.height,pos:r.pos,scale:r.scale,angle:r.angle,color:r.color,opacity:r.opacity,quad:r.quad,anchor:\"center\",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})}),ae()}i(Je,\"drawFormattedText\");function we(){return E.width}i(we,\"width\");function xe(){return E.height}i(xe,\"height\");function ts(t){return new v((t.x-E.viewport.x)*we()/E.viewport.width,(t.y-E.viewport.y)*xe()/E.viewport.height)}i(ts,\"windowToContent\");function ns(t){return new v(t.x*E.viewport.width/E.width,t.y*E.viewport.height/E.height)}i(ns,\"contentToView\");function Nt(){return ts(y.mousePos())}i(Nt,\"mousePos\");let nr=!1,re={inspect:!1,timeScale:1,showLog:!0,fps:()=>y.fps(),numFrames:()=>y.numFrames(),stepFrame:dr,drawCalls:()=>E.lastDrawCalls,clearLog:()=>C.logs=[],log:t=>{let r=n.logMax??qi;C.logs.unshift({msg:t,time:y.time()}),C.logs.length>r&&(C.logs=C.logs.slice(0,r))},error:t=>re.log(new Error(t.toString?t.toString():t)),curRecording:null,numObjects:()=>On(\"*\",{recursive:!0}).length,get paused(){return nr},set paused(t){nr=t,t?te.ctx.suspend():te.ctx.resume()}};function Me(){return y.dt()*re.timeScale}i(Me,\"dt\");function rs(...t){return t.length>0&&(C.cam.pos=T(...t)),C.cam.pos?C.cam.pos.clone():zt()}i(rs,\"camPos\");function ss(...t){return t.length>0&&(C.cam.scale=T(...t)),C.cam.scale.clone()}i(ss,\"camScale\");function is(t){return t!==void 0&&(C.cam.angle=t),C.cam.angle}i(is,\"camRot\");function os(t=12){C.cam.shake+=t}i(os,\"shake\");function rr(t){return C.cam.transform.multVec2(t)}i(rr,\"toScreen\");function sr(t){return C.cam.transform.invert().multVec2(t)}i(sr,\"toWorld\");function jt(t){let r=new Ue;return t.pos&&r.translate(t.pos),t.scale&&r.scale(t.scale),t.angle&&r.rotate(t.angle),t.parent?r.mult(t.parent.transform):r}i(jt,\"calcTransform\");function Un(t=[]){let r=new Map,s={},u=new Ne,a=[],h=null,f=!1,b={id:Gr(),hidden:!1,transform:new Ue,children:[],parent:null,set paused(d){if(d!==f){f=d;for(let w of a)w.paused=d}},get paused(){return f},add(d=[]){let w=Array.isArray(d)?Un(d):d;if(w.parent)throw new Error(\"Cannot add a game obj that already has a parent.\");return w.parent=this,w.transform=jt(w),this.children.push(w),w.trigger(\"add\",w),C.events.trigger(\"add\",w),w},readd(d){let w=this.children.indexOf(d);return w!==-1&&(this.children.splice(w,1),this.children.push(d)),d},remove(d){let w=this.children.indexOf(d);if(w!==-1){d.parent=null,this.children.splice(w,1);let A=i(D=>{D.trigger(\"destroy\"),C.events.trigger(\"destroy\",D),D.children.forEach(N=>A(N))},\"trigger\");A(d)}},removeAll(d){if(d)this.get(d).forEach(w=>this.remove(w));else for(let w of[...this.children])this.remove(w)},update(){this.paused||(this.children.sort((d,w)=>(d.z??0)-(w.z??0)).forEach(d=>d.update()),this.trigger(\"update\"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let d=E.fixed;this.fixed&&(E.fixed=!0),le(),ne(this.pos),He(this.scale),se(this.angle);let w=this.children.sort((A,D)=>(A.z??0)-(D.z??0));if(this.mask){let A={intersect:$e,subtract:kt}[this.mask];if(!A)throw new Error(`Invalid mask func: \"${this.mask}\"`);A(()=>{w.forEach(D=>D.draw())},()=>{this.trigger(\"draw\")})}else this.trigger(\"draw\"),w.forEach(A=>A.draw());ae(),E.fixed=d,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(le(),ne(this.pos),He(this.scale),se(this.angle),this.children.sort((d,w)=>(d.z??0)-(w.z??0)).forEach(d=>d.drawInspect()),this.trigger(\"drawInspect\"),ae())},use(d){if(!d)return;if(typeof d==\"string\")return this.use({id:d});let w=[];d.id&&(this.unuse(d.id),s[d.id]=[],w=s[d.id],r.set(d.id,d));for(let D in d){if(Ji.has(D))continue;let N=Object.getOwnPropertyDescriptor(d,D);if(typeof N.value==\"function\"&&(d[D]=d[D].bind(this)),N.set&&Object.defineProperty(d,D,{set:N.set.bind(this)}),N.get&&Object.defineProperty(d,D,{get:N.get.bind(this)}),Qi.has(D)){let _=D===\"add\"?()=>{h=i(M=>w.push(M),\"onCurCompCleanup\"),d[D](),h=null}:d[D];w.push(this.on(D,_).cancel)}else if(this[D]===void 0)Object.defineProperty(this,D,{get:()=>d[D],set:_=>d[D]=_,configurable:!0,enumerable:!0}),w.push(()=>delete this[D]);else throw new Error(`Duplicate component property: \"${D}\"`)}let A=i(()=>{if(d.require){for(let D of d.require)if(!this.c(D))throw new Error(`Component \"${d.id}\" requires component \"${D}\"`)}},\"checkDeps\");d.destroy&&w.push(d.destroy.bind(this)),this.exists()?(A(),d.add&&(h=i(D=>w.push(D),\"onCurCompCleanup\"),d.add.call(this),h=null)):d.require&&w.push(this.on(\"add\",A).cancel)},unuse(d){s[d]&&(s[d].forEach(w=>w()),delete s[d]),r.has(d)&&r.delete(d)},c(d){return r.get(d)},get(d,w={}){let A=w.recursive?this.children.flatMap(i(function D(N){return[N,...N.children.flatMap(D)]},\"recurse\")):this.children;if(A=A.filter(D=>d?D.is(d):!0),w.liveUpdate){let D=i(_=>w.recursive?this.isAncestorOf(_):_.parent===this,\"isChild\"),N=[];N.push(En(_=>{D(_)&&_.is(d)&&A.push(_)})),N.push(ir(_=>{if(D(_)&&_.is(d)){let M=A.findIndex(O=>O.id===_.id);M!==-1&&A.splice(M,1)}})),this.onDestroy(()=>{for(let _ of N)_.cancel()})}return A},isAncestorOf(d){return d.parent?d.parent===this||this.isAncestorOf(d.parent):!1},exists(){return C.root.isAncestorOf(this)},is(d){if(d===\"*\")return!0;if(Array.isArray(d)){for(let w of d)if(!this.c(w))return!1;return!0}else return this.c(d)!=null},on(d,w){let A=u.on(d,w.bind(this));return h&&h(()=>A.cancel()),A},trigger(d,...w){u.trigger(d,...w),C.objEvents.trigger(d,this,...w)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let d={};for(let[w,A]of r)d[w]=A.inspect?A.inspect():null;return d},onAdd(d){return this.on(\"add\",d)},onUpdate(d){return this.on(\"update\",d)},onDraw(d){return this.on(\"draw\",d)},onDestroy(d){return this.on(\"destroy\",d)},clearEvents(){u.clear()}},p=[\"onKeyPress\",\"onKeyPressRepeat\",\"onKeyDown\",\"onKeyRelease\",\"onMousePress\",\"onMouseDown\",\"onMouseRelease\",\"onMouseMove\",\"onCharInput\",\"onMouseMove\",\"onTouchStart\",\"onTouchMove\",\"onTouchEnd\",\"onScroll\",\"onGamepadButtonPress\",\"onGamepadButtonDown\",\"onGamepadButtonRelease\",\"onGamepadStick\"];for(let d of p)b[d]=(...w)=>{let A=y[d](...w);return a.push(A),b.onDestroy(()=>A.cancel()),A};for(let d of t)b.use(d);return b}i(Un,\"make\");function ze(t,r,s){return C.objEvents[t]||(C.objEvents[t]=new Ut),C.objEvents.on(t,(u,...a)=>{u.is(r)&&s(u,...a)})}i(ze,\"on\");let as=Ee(t=>{let r=gt([{update:t}]);return{get paused(){return r.paused},set paused(s){r.paused=s},cancel:()=>r.destroy()}},(t,r)=>ze(\"update\",t,r)),us=Ee(t=>{let r=gt([{draw:t}]);return{get paused(){return r.hidden},set paused(s){r.hidden=s},cancel:()=>r.destroy()}},(t,r)=>ze(\"draw\",t,r)),En=Ee(t=>C.events.on(\"add\",t),(t,r)=>ze(\"add\",t,r)),ir=Ee(t=>C.events.on(\"destroy\",t),(t,r)=>ze(\"destroy\",t,r));function cs(t,r,s){return ze(\"collide\",t,(u,a,h)=>a.is(r)&&s(u,a,h))}i(cs,\"onCollide\");function hs(t,r,s){return ze(\"collideUpdate\",t,(u,a,h)=>a.is(r)&&s(u,a,h))}i(hs,\"onCollideUpdate\");function ls(t,r,s){return ze(\"collideEnd\",t,(u,a,h)=>a.is(r)&&s(u,a,h))}i(ls,\"onCollideEnd\");function Ht(t,r){On(t,{recursive:!0}).forEach(r),En(t,r)}i(Ht,\"forAllCurrentAndFuture\");let ds=Ee(t=>y.onMousePress(t),(t,r)=>{let s=[];return Ht(t,u=>{if(!u.area)throw new Error(\"onClick() requires the object to have area() component\");s.push(u.onClick(()=>r(u)))}),ke.join(s)});function fs(t,r){let s=[];return Ht(t,u=>{if(!u.area)throw new Error(\"onHover() requires the object to have area() component\");s.push(u.onHover(()=>r(u)))}),ke.join(s)}i(fs,\"onHover\");function ms(t,r){let s=[];return Ht(t,u=>{if(!u.area)throw new Error(\"onHoverUpdate() requires the object to have area() component\");s.push(u.onHoverUpdate(()=>r(u)))}),ke.join(s)}i(ms,\"onHoverUpdate\");function ps(t,r){let s=[];return Ht(t,u=>{if(!u.area)throw new Error(\"onHoverEnd() requires the object to have area() component\");s.push(u.onHoverEnd(()=>r(u)))}),ke.join(s)}i(ps,\"onHoverEnd\");function gs(t){C.gravity=t}i(gs,\"setGravity\");function ws(){return C.gravity}i(ws,\"getGravity\");function bs(...t){t.length===1||t.length===2?(E.bgColor=J(t[0]),t[1]&&(E.bgAlpha=t[1])):(t.length===3||t.length===4)&&(E.bgColor=J(t[0],t[1],t[2]),t[3]&&(E.bgAlpha=t[3])),S.clearColor(E.bgColor.r/255,E.bgColor.g/255,E.bgColor.b/255,E.bgAlpha)}i(bs,\"setBackground\");function vs(){return E.bgColor.clone()}i(vs,\"getBackground\");function qt(...t){return{id:\"pos\",pos:T(...t),moveBy(...r){this.pos=this.pos.add(T(...r))},move(...r){this.moveBy(T(...r).scale(Me()))},moveTo(...r){if(typeof r[0]==\"number\"&&typeof r[1]==\"number\")return this.moveTo(T(r[0],r[1]),r[2]);let s=r[0],u=r[1];if(u===void 0){this.pos=T(s);return}let a=s.sub(this.pos);if(a.len()<=u*Me()){this.pos=T(s);return}this.move(a.unit().scale(u))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let r=this.worldPos();return pt(this)?r:rr(r)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){L({color:J(255,0,0),radius:4/De()})}}}i(qt,\"pos\");function $t(...t){return t.length===0?$t(1):{id:\"scale\",scale:T(...t),scaleTo(...r){this.scale=T(...r)},scaleBy(...r){this.scale.scale(T(...r))},inspect(){return`(${mt(this.scale.x,2)}, ${mt(this.scale.y,2)})`}}}i($t,\"scale\");function ys(t){return{id:\"rotate\",angle:t??0,rotateBy(r){this.angle+=r},rotateTo(r){this.angle=r},inspect(){return`${Math.round(this.angle)}`}}}i(ys,\"rotate\");function xs(...t){return{id:\"color\",color:J(...t),inspect(){return this.color.toString()}}}i(xs,\"color\");function mt(t,r){return Number(t.toFixed(r))}i(mt,\"toFixed\");function Us(t){return{id:\"opacity\",opacity:t??1,inspect(){return`${mt(this.opacity,1)}`},fadeOut(r=1,s=Ct.linear){return Rn(this.opacity,0,r,u=>this.opacity=u,s)}}}i(Us,\"opacity\");function Sn(t){if(!t)throw new Error(\"Please define an anchor\");return{id:\"anchor\",anchor:t,inspect(){return typeof this.anchor==\"string\"?this.anchor:this.anchor.toString()}}}i(Sn,\"anchor\");function Es(t){return{id:\"z\",z:t,inspect(){return`${this.z}`}}}i(Es,\"z\");function Ss(t,r){return{id:\"follow\",require:[\"pos\"],follow:{obj:t,offset:r??T(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}i(Ss,\"follow\");function Cs(t,r){let s=typeof t==\"number\"?v.fromAngle(t):t.unit();return{id:\"move\",require:[\"pos\"],update(){this.move(s.scale(r))}}}i(Cs,\"move\");let As=200;function Ts(t={}){let r=t.distance??As,s=!1;return{id:\"offscreen\",require:[\"pos\"],isOffScreen(){let u=this.screenPos(),a=new de(T(0),we(),xe());return!vt(a,u)&&a.sdistToPoint(u)>r*r},onExitScreen(u){return this.on(\"exitView\",u)},onEnterScreen(u){return this.on(\"enterView\",u)},update(){this.isOffScreen()?(s||(this.trigger(\"exitView\"),s=!0),t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()):(s&&(this.trigger(\"enterView\"),s=!1),t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1))}}}i(Ts,\"offscreen\");function pt(t){return t.fixed?!0:t.parent?pt(t.parent):!1}i(pt,\"isFixed\");function Os(t={}){let r={},s=new Set;return{id:\"area\",collisionIgnore:t.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>y.setCursor(this.area.cursor)),this.onCollideUpdate((u,a)=>{r[u.id]||this.trigger(\"collide\",u,a),r[u.id]=a,s.add(u.id)})},update(){for(let u in r)s.has(Number(u))||(this.trigger(\"collideEnd\",r[u].target),delete r[u]);s.clear()},drawInspect(){let u=this.localArea();le(),He(this.area.scale),ne(this.area.offset);let a={outline:{width:4/De(),color:J(0,0,255)},anchor:this.anchor,fill:!1,fixed:pt(this)};u instanceof de?ge({...a,pos:u.pos,width:u.width,height:u.height}):u instanceof Ke?z({...a,pts:u.pts}):u instanceof yt&&L({...a,pos:u.center,radius:u.radius}),ae()},area:{shape:t.shape??null,scale:t.scale?T(t.scale):T(1),offset:t.offset??T(0),cursor:t.cursor??null},isClicked(){return y.isMousePressed()&&this.isHovering()},isHovering(){let u=pt(this)?Nt():sr(Nt());return this.hasPoint(u)},checkCollision(u){return r[u.id]??null},getCollisions(){return Object.values(r)},isColliding(u){return!!r[u.id]},isOverlapping(u){let a=r[u.id];return a&&a.hasOverlap()},onClick(u){let a=y.onMousePress(\"left\",()=>{this.isHovering()&&u()});return this.onDestroy(()=>a.cancel()),a},onHover(u){let a=!1;return this.onUpdate(()=>{a?a=this.isHovering():this.isHovering()&&(a=!0,u())})},onHoverUpdate(u){return this.onUpdate(()=>{this.isHovering()&&u()})},onHoverEnd(u){let a=!1;return this.onUpdate(()=>{a?this.isHovering()||(a=!1,u()):a=this.isHovering()})},onCollide(u,a){if(typeof u==\"function\"&&a===void 0)return this.on(\"collide\",u);if(typeof u==\"string\")return this.onCollide((h,f)=>{h.is(u)&&a(h,f)})},onCollideUpdate(u,a){if(typeof u==\"function\"&&a===void 0)return this.on(\"collideUpdate\",u);if(typeof u==\"string\")return this.on(\"collideUpdate\",(h,f)=>h.is(u)&&a(h,f))},onCollideEnd(u,a){if(typeof u==\"function\"&&a===void 0)return this.on(\"collideEnd\",u);if(typeof u==\"string\")return this.on(\"collideEnd\",h=>h.is(u)&&a(h))},hasPoint(u){return _n(this.worldArea(),u)},resolveCollision(u){let a=this.checkCollision(u);a&&!a.resolved&&(this.pos=this.pos.add(a.displacement),a.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let u=this.localArea();if(!(u instanceof Ke||u instanceof de))throw new Error(\"Only support polygon and rect shapes for now\");let a=this.transform.clone().scale(T(this.area.scale??1)).translate(this.area.offset);if(u instanceof de){let h=ut(this.anchor||tn).add(1,1).scale(-.5).scale(u.width,u.height);a.translate(h)}return u.transform(a)},screenArea(){let u=this.worldArea();return pt(this)?u:u.transform(C.cam.transform)}}}i(Os,\"area\");function Qe(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,shader:t.shader,uniform:t.uniform}}i(Qe,\"getRenderProps\");function Cn(t,r={}){let s=null,u=null,a=null,h=new be;if(!t)throw new Error(\"Please pass the resource name or data to sprite()\");let f=i((b,p,d,w)=>{let A=T(1,1);return d&&w?(A.x=d/(b.width*p.w),A.y=w/(b.height*p.h)):d?(A.x=d/(b.width*p.w),A.y=A.x):w&&(A.y=w/(b.height*p.h),A.x=A.y),A},\"calcTexScale\");return{id:\"sprite\",width:0,height:0,frame:r.frame||0,quad:r.quad||new oe(0,0,1,1),animSpeed:r.animSpeed??1,flipX:r.flipX??!1,flipY:r.flipY??!1,draw(){if(!s)return;let b=s.frames[this.frame??0];if(!b)throw new Error(`Frame not found: ${this.frame??0}`);if(s.slice9){let{left:p,right:d,top:w,bottom:A}=s.slice9,D=s.tex.width*b.w,N=s.tex.height*b.h,_=this.width-p-d,M=this.height-w-A,O=p/D,ie=d/D,Z=1-O-ie,H=w/N,V=A/N,fe=1-H-V,U=[ce(0,0,O,H),ce(O,0,Z,H),ce(O+Z,0,ie,H),ce(0,H,O,fe),ce(O,H,Z,fe),ce(O+Z,H,ie,fe),ce(0,H+fe,O,V),ce(O,H+fe,Z,V),ce(O+Z,H+fe,ie,V),ce(0,0,p,w),ce(p,0,_,w),ce(p+_,0,d,w),ce(0,w,p,M),ce(p,w,_,M),ce(p+_,w,d,M),ce(0,w+M,p,A),ce(p,w+M,_,A),ce(p+_,w+M,d,A)];for(let G=0;G<9;G++){let B=U[G],F=U[G+9];We(Object.assign(Qe(this),{pos:F.pos(),tex:s.tex,quad:b.scale(B),flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:F.w,height:F.h}))}}else We(Object.assign(Qe(this),{tex:s.tex,quad:b.scale(this.quad??new oe(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:this.width,height:this.height}))},add(){let b=i(d=>{let w=d.frames[0].clone();r.quad&&(w=w.scale(r.quad));let A=f(d.tex,w,r.width,r.height);this.width=d.tex.width*w.w*A.x,this.height=d.tex.height*w.h*A.y,r.anim&&this.play(r.anim),s=d,h.trigger(s)},\"setSpriteData\"),p=ct(t);p?p.onLoad(b):Tn(()=>b(ct(t).data))},update(){if(!u)return;let b=s.anims[u.name];if(typeof b==\"number\"){this.frame=b;return}if(b.speed===0)throw new Error(\"Sprite anim speed cannot be 0\");u.timer+=Me()*this.animSpeed,u.timer>=1/u.speed&&(u.timer=0,this.frame+=a,(this.frame<Math.min(b.from,b.to)||this.frame>Math.max(b.from,b.to))&&(u.loop?u.pingpong?(this.frame-=a,a*=-1,this.frame+=a):this.frame=b.from:(this.frame=b.to,u.onEnd(),this.stop())))},play(b,p={}){if(!s){h.add(()=>this.play(b,p));return}let d=s.anims[b];if(d===void 0)throw new Error(`Anim not found: ${b}`);u&&this.stop(),u=typeof d==\"number\"?{name:b,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:b,timer:0,loop:p.loop??d.loop??!1,pingpong:p.pingpong??d.pingpong??!1,speed:p.speed??d.speed??10,onEnd:p.onEnd??(()=>{})},a=typeof d==\"number\"?null:d.from<d.to?1:-1,this.frame=typeof d==\"number\"?d:d.from,this.trigger(\"animStart\",b)},stop(){if(!u)return;let b=u.name;u=null,this.trigger(\"animEnd\",b)},numFrames(){return s?.frames.length??0},curAnim(){return u?.name},onAnimEnd(b){return this.on(\"animEnd\",b)},onAnimStart(b){return this.on(\"animStart\",b)},renderArea(){return new de(T(0),this.width,this.height)},inspect(){if(typeof t==\"string\")return`\"${t}\"`}}}i(Cn,\"sprite\");function Rs(t,r={}){function s(a){let h=Xe(Object.assign(Qe(a),{text:a.text+\"\",size:a.textSize,font:a.font,width:r.width&&a.width,align:a.align,letterSpacing:a.letterSpacing,lineSpacing:a.lineSpacing,transform:a.textTransform,styles:a.textStyles}));return r.width||(a.width=h.width/(a.scale?.x||1)),a.height=h.height/(a.scale?.y||1),h}i(s,\"update\");let u={id:\"text\",set text(a){t=a,s(this)},get text(){return t},textSize:r.size??ji,font:r.font,width:r.width??0,height:0,align:r.align,lineSpacing:r.lineSpacing,letterSpacing:r.letterSpacing,textTransform:r.transform,textStyles:r.styles,add(){Tn(()=>s(this))},draw(){Je(s(this))},renderArea(){return new de(T(0),this.width,this.height)}};return s(u),u}i(Rs,\"text\");function Ps(t,r={}){if(t.length<3)throw new Error(`Polygon's need more than two points, ${t.length} points provided`);return{id:\"polygon\",pts:t,colors:r.colors,radius:r.radius,draw(){z(Object.assign(Qe(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:r.fill}))},renderArea(){return new Ke(this.pts)},inspect(){return this.pts.map(s=>`[${s.x},${s.y}]`).join(\",\")}}}i(Ps,\"polygon\");function Ds(t,r,s={}){return{id:\"rect\",width:t,height:r,radius:s.radius||0,draw(){ge(Object.assign(Qe(this),{width:this.width,height:this.height,radius:this.radius,fill:s.fill}))},renderArea(){return new de(T(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}i(Ds,\"rect\");function Ms(t,r){return{id:\"rect\",width:t,height:r,draw(){Be(Object.assign(Qe(this),{width:this.width,height:this.height}))},renderArea(){return new de(T(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}i(Ms,\"uvquad\");function Gs(t,r={}){return{id:\"circle\",radius:t,draw(){L(Object.assign(Qe(this),{radius:this.radius,fill:r.fill}))},renderArea(){return new de(new v(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`${Math.ceil(this.radius)}`}}}i(Gs,\"circle\");function Bs(t=1,r=J(0,0,0)){return{id:\"outline\",outline:{width:t,color:r}}}i(Bs,\"outline\");function An(){return{id:\"timer\",wait(t,r){let s=[];r&&s.push(r);let u=0,a=this.onUpdate(()=>{u+=Me(),u>=t&&(s.forEach(h=>h()),a.cancel())});return{get paused(){return a.paused},set paused(h){a.paused=h},cancel:a.cancel,onEnd(h){s.push(h)},then(h){return this.onEnd(h),this}}},loop(t,r){let s=null,u=i(()=>{s=this.wait(t,u),r()},\"newAction\");return s=this.wait(0,u),{get paused(){return s.paused},set paused(a){s.paused=a},cancel:()=>s.cancel()}},tween(t,r,s,u,a=Ct.linear){let h=0,f=[],b=this.onUpdate(()=>{h+=Me();let p=Math.min(h/s,1);u(Ve(t,r,a(p))),p===1&&(b.cancel(),u(r),f.forEach(d=>d()))});return{get paused(){return b.paused},set paused(p){b.paused=p},onEnd(p){f.push(p)},then(p){return this.onEnd(p),this},cancel(){b.cancel()},finish(){b.cancel(),u(r),f.forEach(p=>p())}}}}}i(An,\"timer\");let Fs=640,Is=65536;function Ls(t={}){let r=null,s=null,u=!1;return{id:\"body\",require:[\"pos\",\"area\"],vel:new v(0),jumpForce:t.jumpForce??Fs,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(this.mass===0)throw new Error(\"Can't set body mass to 0\");this.onCollideUpdate((a,h)=>{if(a.is(\"body\")&&!h.resolved&&(this.trigger(\"beforePhysicsResolve\",h),a.trigger(\"beforePhysicsResolve\",h.reverse()),!h.resolved&&!(this.isStatic&&a.isStatic))){if(!this.isStatic&&!a.isStatic){let f=this.mass+a.mass;this.pos=this.pos.add(h.displacement.scale(a.mass/f)),a.pos=a.pos.add(h.displacement.scale(-this.mass/f)),this.transform=jt(this),a.transform=jt(a)}else{let f=!this.isStatic&&a.isStatic?h:h.reverse();f.source.pos=f.source.pos.add(f.displacement),f.source.transform=jt(f.source)}h.resolved=!0,this.trigger(\"physicsResolve\",h),a.trigger(\"physicsResolve\",h.reverse())}}),this.onPhysicsResolve(a=>{C.gravity&&(a.isBottom()&&this.isFalling()?(this.vel.y=0,r=a.target,s=a.target.pos,u?u=!1:this.trigger(\"ground\",r)):a.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger(\"headbutt\",a.target)))})},update(){if(!C.gravity||this.isStatic)return;if(u&&(r=null,s=null,this.trigger(\"fallOff\"),u=!1),r)if(!this.isColliding(r)||!r.exists()||!r.is(\"body\"))u=!0;else{!r.pos.eq(s)&&t.stickToPlatform!==!1&&this.moveBy(r.pos.sub(s)),s=r.pos;return}let a=this.vel.y;this.vel.y+=C.gravity*this.gravityScale*Me(),this.vel.y=Math.min(this.vel.y,t.maxVelocity??Is),a<0&&this.vel.y>=0&&this.trigger(\"fall\"),this.move(this.vel)},onPhysicsResolve(a){return this.on(\"physicsResolve\",a)},onBeforePhysicsResolve(a){return this.on(\"beforePhysicsResolve\",a)},curPlatform(){return r},isGrounded(){return r!==null},isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(a){r=null,s=null,this.vel.y=-a||-this.jumpForce},onGround(a){return this.on(\"ground\",a)},onFall(a){return this.on(\"fall\",a)},onFallOff(a){return this.on(\"fallOff\",a)},onHeadbutt(a){return this.on(\"headbutt\",a)}}}i(Ls,\"body\");function Vs(t=2){let r=t;return{id:\"doubleJump\",require:[\"body\"],numJumps:t,add(){this.onGround(()=>{r=this.numJumps})},doubleJump(s){r<=0||(r<this.numJumps&&this.trigger(\"doubleJump\"),r--,this.jump(s))},onDoubleJump(s){return this.on(\"doubleJump\",s)},inspect(){return`${r}`}}}i(Vs,\"doubleJump\");function _s(t,r){return{id:\"shader\",shader:t,...typeof r==\"function\"?{uniform:r(),update(){this.uniform=r()}}:{uniform:r}}}i(_s,\"shader\");function ks(){return{id:\"fixed\",fixed:!0}}i(ks,\"fixed\");function or(t){return{id:\"stay\",stay:!0,scenesToStay:t}}i(or,\"stay\");function Ns(t,r){if(t==null)throw new Error(\"health() requires the initial amount of hp\");return{id:\"health\",hurt(s=1){this.setHP(t-s),this.trigger(\"hurt\",s)},heal(s=1){let u=t;this.setHP(t+s),this.trigger(\"heal\",t-u)},hp(){return t},maxHP(){return r??null},setMaxHP(s){r=s},setHP(s){t=r?Math.min(r,s):s,t<=0&&this.trigger(\"death\")},onHurt(s){return this.on(\"hurt\",s)},onHeal(s){return this.on(\"heal\",s)},onDeath(s){return this.on(\"death\",s)},inspect(){return`${t}`}}}i(Ns,\"health\");function js(t,r={}){if(t==null)throw new Error(\"lifespan() requires time\");let s=r.fade??0;return{id:\"lifespan\",async add(){await hr(t),s>0&&this.opacity&&await Rn(this.opacity,0,s,u=>this.opacity=u,Ct.linear),this.destroy()}}}i(js,\"lifespan\");function Hs(t,r,s){if(!t)throw new Error(\"state() requires an initial state\");let u={};function a(p){u[p]||(u[p]={enter:new be,end:new be,update:new be,draw:new be})}i(a,\"initStateEvents\");function h(p,d,w){return a(d),u[d][p].add(w)}i(h,\"on\");function f(p,d,...w){a(d),u[d][p].trigger(...w)}i(f,\"trigger\");let b=!1;return{id:\"state\",state:t,enterState(p,...d){if(b=!0,r&&!r.includes(p))throw new Error(`State not found: ${p}`);let w=this.state;if(s){if(!s?.[w])return;let A=typeof s[w]==\"string\"?[s[w]]:s[w];if(!A.includes(p))throw new Error(`Cannot transition state from \"${w}\" to \"${p}\". Available transitions: ${A.map(D=>`\"${D}\"`).join(\", \")}`)}f(\"end\",w,...d),this.state=p,f(\"enter\",p,...d),f(\"enter\",`${w} -> ${p}`,...d)},onStateTransition(p,d,w){return h(\"enter\",`${p} -> ${d}`,w)},onStateEnter(p,d){return h(\"enter\",p,d)},onStateUpdate(p,d){return h(\"update\",p,d)},onStateDraw(p,d){return h(\"draw\",p,d)},onStateEnd(p,d){return h(\"end\",p,d)},update(){b||(f(\"enter\",t),b=!0),f(\"update\",this.state)},draw(){f(\"draw\",this.state)},inspect(){return this.state}}}i(Hs,\"state\");function qs(t=1){let r=0,s=!1;return{require:[\"opacity\"],add(){this.opacity=0},update(){s||(r+=Me(),this.opacity=_e(r,0,t,0,1),r>=t&&(this.opacity=1,s=!0))}}}i(qs,\"fadeIn\");function $s(t=\"intersect\"){return{id:\"mask\",mask:t}}i($s,\"mask\");function zs(t){return{add(){this.canvas=t}}}i(zs,\"drawon\");function Tn(t){k.loaded?t():C.events.on(\"load\",t)}i(Tn,\"onLoad\");function Ks(t,r){C.scenes[t]=r}i(Ks,\"scene\");function Ys(t,...r){if(!C.scenes[t])throw new Error(`Scene not found: ${t}`);C.events.onOnce(\"frameEnd\",()=>{C.events.trigger(\"sceneLeave\",t),y.events.clear(),C.events.clear(),C.objEvents.clear(),[...C.root.children].forEach(s=>{(!s.stay||s.scenesToStay&&!s.scenesToStay.includes(t))&&C.root.remove(s)}),C.root.clearEvents(),pr(),C.cam={pos:null,scale:T(1),angle:0,shake:0,transform:new Ue},C.scenes[t](...r)})}i(Ys,\"go\");function Ws(t){return C.events.on(\"sceneLeave\",t)}i(Ws,\"onSceneLeave\");function Xs(t,r){try{return JSON.parse(window.localStorage[t])}catch{return r?(ar(t,r),r):null}}i(Xs,\"getData\");function ar(t,r){window.localStorage[t]=JSON.stringify(r)}i(ar,\"setData\");function ur(t,...r){let s=t(Ze),u;typeof s==\"function\"?u=s(...r)(Ze):u=s;for(let a in u)Ze[a]=u[a],n.global!==!1&&(window[a]=u[a]);return Ze}i(ur,\"plug\");function zt(){return T(we()/2,xe()/2)}i(zt,\"center\");let Js;(O=>(O[O.None=0]=\"None\",O[O.Left=1]=\"Left\",O[O.Top=2]=\"Top\",O[O.LeftTop=3]=\"LeftTop\",O[O.Right=4]=\"Right\",O[O.Horizontal=5]=\"Horizontal\",O[O.RightTop=6]=\"RightTop\",O[O.HorizontalTop=7]=\"HorizontalTop\",O[O.Bottom=8]=\"Bottom\",O[O.LeftBottom=9]=\"LeftBottom\",O[O.Vertical=10]=\"Vertical\",O[O.LeftVertical=11]=\"LeftVertical\",O[O.RightBottom=12]=\"RightBottom\",O[O.HorizontalBottom=13]=\"HorizontalBottom\",O[O.RightVertical=14]=\"RightVertical\",O[O.All=15]=\"All\"))(Js||={});function cr(t={}){let r=T(0),s=t.isObstacle??!1,u=t.cost??0,a=t.edges??[],h=i(()=>{let b={left:1,top:2,right:4,bottom:8};return a.map(p=>b[p]||0).reduce((p,d)=>p|d,0)},\"getEdgeMask\"),f=h();return{id:\"tile\",tilePosOffset:t.offset??T(0),set tilePos(b){let p=this.getLevel();r=b.clone(),this.pos=T(this.tilePos.x*p.tileWidth(),this.tilePos.y*p.tileHeight()).add(this.tilePosOffset)},get tilePos(){return r},set isObstacle(b){s!==b&&(s=b,this.getLevel().invalidateNavigationMap())},get isObstacle(){return s},set cost(b){u!==b&&(u=b,this.getLevel().invalidateNavigationMap())},get cost(){return u},set edges(b){a=b,f=h(),this.getLevel().invalidateNavigationMap()},get edges(){return a},get edgeMask(){return f},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(T(-1,0))},moveRight(){this.tilePos=this.tilePos.add(T(1,0))},moveUp(){this.tilePos=this.tilePos.add(T(0,-1))},moveDown(){this.tilePos=this.tilePos.add(T(0,1))}}}i(cr,\"tile\");function Qs(t,r){if(!r.tileWidth||!r.tileHeight)throw new Error(\"Must provide tileWidth and tileHeight.\");let s=gt([qt(r.pos??T(0))]),u=t.length,a=0,h=null,f=null,b=null,p=null,d=i(U=>U.x+U.y*a,\"tile2Hash\"),w=i(U=>T(Math.floor(U%a),Math.floor(U/a)),\"hash2Tile\"),A=i(()=>{h=[];for(let U of s.children)D(U)},\"createSpatialMap\"),D=i(U=>{let G=d(U.tilePos);h[G]?h[G].push(U):h[G]=[U]},\"insertIntoSpatialMap\"),N=i(U=>{let G=d(U.tilePos);if(h[G]){let B=h[G].indexOf(U);B>=0&&h[G].splice(B,1)}},\"removeFromSpatialMap\"),_=i(()=>{let U=!1;for(let G of s.children){let B=s.pos2Tile(G.pos);(G.tilePos.x!=B.x||G.tilePos.y!=B.y)&&(U=!0,N(G),G.tilePos.x=B.x,G.tilePos.y=B.y,D(G))}U&&s.trigger(\"spatial_map_changed\")},\"updateSpatialMap\"),M=i(()=>{let U=s.getSpatialMap(),G=s.numRows()*s.numColumns();f?f.length=G:f=new Array(G),f.fill(1,0,G);for(let B=0;B<U.length;B++){let F=U[B];if(F){let Y=0;for(let ee of F)if(ee.isObstacle){Y=1/0;break}else Y+=ee.cost;f[B]=Y||1}}},\"createCostMap\"),O=i(()=>{let U=s.getSpatialMap(),G=s.numRows()*s.numColumns();b?b.length=G:b=new Array(G),b.fill(15,0,G);for(let B=0;B<U.length;B++){let F=U[B];if(F){let Y=F.length,ee=15;for(let ue=0;ue<Y;ue++)ee|=F[ue].edgeMask;b[B]=ee}}},\"createEdgeMap\"),ie=i(()=>{let U=s.numRows()*s.numColumns(),G=i((F,Y)=>{let ee=[];for(ee.push(F);ee.length>0;){let ue=ee.pop();V(ue).forEach(me=>{p[me]<0&&(p[me]=Y,ee.push(me))})}},\"traverse\");p?p.length=U:p=new Array(U),p.fill(-1,0,U);let B=0;for(let F=0;F<f.length;F++){if(p[F]>=0){B++;continue}G(F,B),B++}},\"createConnectivityMap\"),Z=i((U,G)=>f[G],\"getCost\"),H=i((U,G)=>{let B=w(U),F=w(G);return B.dist(F)},\"getHeuristic\"),V=i((U,G)=>{let B=[],F=Math.floor(U%a),Y=F>0&&b[U]&1&&f[U-1]!==1/0,ee=U>=a&&b[U]&2&&f[U-a]!==1/0,ue=F<a-1&&b[U]&4&&f[U+1]!==1/0,me=U<a*u-a-1&&b[U]&8&&f[U+a]!==1/0;return G?(Y&&(ee&&B.push(U-a-1),B.push(U-1),me&&B.push(U+a-1)),ee&&B.push(U-a),ue&&(ee&&B.push(U-a+1),B.push(U+1),me&&B.push(U+a+1)),me&&B.push(U+a)):(Y&&B.push(U-1),ee&&B.push(U-a),ue&&B.push(U+1),me&&B.push(U+a)),B},\"getNeighbours\"),fe={id:\"level\",tileWidth(){return r.tileWidth},tileHeight(){return r.tileHeight},spawn(U,...G){let B=T(...G),F=(()=>{if(typeof U==\"string\"){if(r.tiles[U]){if(typeof r.tiles[U]!=\"function\")throw new Error(\"Level symbol def must be a function returning a component list\");return r.tiles[U](B)}else if(r.wildcardTile)return r.wildcardTile(U,B)}else{if(Array.isArray(U))return U;throw new Error(\"Expected a symbol or a component list\")}})();if(!F)return null;let Y=!1,ee=!1;for(let me of F)me.id===\"tile\"&&(ee=!0),me.id===\"pos\"&&(Y=!0);Y||F.push(qt()),ee||F.push(cr());let ue=s.add(F);return Y&&(ue.tilePosOffset=ue.pos.clone()),ue.tilePos=B,h&&(D(ue),this.trigger(\"spatial_map_changed\"),this.trigger(\"navigation_map_invalid\")),ue},numColumns(){return a},numRows(){return u},levelWidth(){return a*this.tileWidth()},levelHeight(){return u*this.tileHeight()},tile2Pos(...U){return T(...U).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...U){let G=T(...U);return T(Math.floor(G.x/this.tileWidth()),Math.floor(G.y/this.tileHeight()))},getSpatialMap(){return h||A(),h},onSpatialMapChanged(U){return this.on(\"spatial_map_changed\",U)},onNavigationMapInvalid(U){return this.on(\"navigation_map_invalid\",U)},getAt(U){h||A();let G=d(U);return h[G]||[]},update(){h&&_()},invalidateNavigationMap(){f=null,b=null,p=null},onNavigationMapChanged(U){return this.on(\"navigation_map_changed\",U)},getTilePath(U,G,B={}){if(f||M(),b||O(),p||ie(),U.x<0||U.x>=a||U.y<0||U.y>=u||G.x<0||G.x>=a||G.y<0||G.y>=u)return null;let F=d(U),Y=d(G);if(f[Y]===1/0)return null;if(F===Y)return[];if(p[F]!=-1&&p[F]!==p[Y])return null;let ee=new Yt((Fe,Mn)=>Fe.cost<Mn.cost);ee.insert({cost:0,node:F});let ue=new Map;ue.set(F,F);let me=new Map;for(me.set(F,0);ee.length!==0;){let Fe=ee.remove()?.node;if(Fe===Y)break;let Mn=V(Fe,B.allowDiagonals);for(let et of Mn){let Gn=(me.get(Fe)||0)+Z(Fe,et)+H(et,Y);(!me.has(et)||Gn<me.get(et))&&(me.set(et,Gn),ee.insert({cost:Gn,node:et}),ue.set(et,Fe))}}let Dn=[],wt=Y,vi=w(wt);for(Dn.push(vi);wt!==F;){wt=ue.get(wt);let Fe=w(wt);Dn.push(Fe)}return Dn.reverse()},getPath(U,G,B={}){let F=this.tileWidth(),Y=this.tileHeight(),ee=this.getTilePath(this.pos2Tile(U),this.pos2Tile(G),B);return ee?[U,...ee.slice(1,-1).map(ue=>ue.scale(F,Y).add(F/2,Y/2)),G]:null}};return s.use(fe),s.onNavigationMapInvalid(()=>{s.invalidateNavigationMap(),s.trigger(\"navigation_map_changed\")}),t.forEach((U,G)=>{let B=U.split(\"\");a=Math.max(B.length,a),B.forEach((F,Y)=>{s.spawn(F,T(Y,G))})}),s}i(Qs,\"addLevel\");function Zs(t={}){let r=null,s=null,u=null,a=null;return{id:\"agent\",require:[\"pos\",\"tile\"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return r?this.pos.dist(r):0},getNextLocation(){return s&&u?s[u]:null},getPath(){return s?s.slice():null},getTarget(){return r},isNavigationFinished(){return s?u===null:!0},isTargetReachable(){return s!==null},isTargetReached(){return r?this.pos.eq(r):!0},setTarget(h){r=h,s=this.getLevel().getPath(this.pos,r,{allowDiagonals:this.allowDiagonals}),u=s?0:null,s?(a||(a=this.getLevel().onNavigationMapChanged(()=>{s&&u!==null&&(s=this.getLevel().getPath(this.pos,r,{allowDiagonals:this.allowDiagonals}),u=s?0:null,s?this.trigger(\"navigation-next\",this,s[u]):this.trigger(\"navigation-ended\",this))}),this.onDestroy(()=>a.cancel())),this.trigger(\"navigation-started\",this),this.trigger(\"navigation-next\",this,s[u])):this.trigger(\"navigation-ended\",this)},update(){if(s&&u!==null){if(this.pos.sdist(s[u])<2)if(u===s.length-1){this.pos=r.clone(),u=null,this.trigger(\"navigation-ended\",this),this.trigger(\"target-reached\",this);return}else u++,this.trigger(\"navigation-next\",this,s[u]);this.moveTo(s[u],this.agentSpeed)}},onNavigationStarted(h){return this.on(\"navigation-started\",h)},onNavigationNext(h){return this.on(\"navigation-next\",h)},onNavigationEnded(h){return this.on(\"navigation-ended\",h)},onTargetReached(h){return this.on(\"target-reached\",h)},inspect(){return JSON.stringify({target:JSON.stringify(r),path:JSON.stringify(s)})}}}i(Zs,\"agent\");function ei(t){let r=y.canvas.captureStream(t),s=te.ctx.createMediaStreamDestination();te.masterNode.connect(s);let u=new MediaRecorder(r),a=[];return u.ondataavailable=h=>{h.data.size>0&&a.push(h.data)},u.onerror=()=>{te.masterNode.disconnect(s),r.getTracks().forEach(h=>h.stop())},u.start(),{resume(){u.resume()},pause(){u.pause()},stop(){return u.stop(),te.masterNode.disconnect(s),r.getTracks().forEach(h=>h.stop()),new Promise(h=>{u.onstop=()=>{h(new Blob(a,{type:\"video/mp4\"}))}})},download(h=\"kaboom.mp4\"){this.stop().then(f=>Nn(h,f))}}}i(ei,\"record\");function ti(){return document.activeElement===y.canvas}i(ti,\"isFocused\");function ni(t){t.destroy()}i(ni,\"destroy\");let gt=C.root.add.bind(C.root),ri=C.root.readd.bind(C.root),si=C.root.removeAll.bind(C.root),On=C.root.get.bind(C.root),hr=C.root.wait.bind(C.root),ii=C.root.loop.bind(C.root),Rn=C.root.tween.bind(C.root);function lr(t=2,r=1){let s=0;return{require:[\"scale\"],update(){let u=Math.sin(s*t)*r;u<0&&this.destroy(),this.scale=T(u),s+=Me()}}}i(lr,\"boom\");let oi=Ye(null,qr),ai=Ye(null,$r);function ui(t,r={}){let s=gt([qt(t),or()]),u=(r.speed||1)*5,a=r.scale||1;s.add([Cn(ai),$t(0),Sn(\"center\"),lr(u,a),...r.comps??[]]);let h=s.add([Cn(oi),$t(0),Sn(\"center\"),An(),...r.comps??[]]);return h.wait(.4/u,()=>h.use(lr(u,a))),h.onDestroy(()=>s.destroy()),s}i(ui,\"addKaboom\");function dr(){C.root.update()}i(dr,\"updateFrame\");class Pn{static{i(this,\"Collision\")}source;target;displacement;resolved=!1;constructor(r,s,u,a=!1){this.source=r,this.target=s,this.displacement=u,this.resolved=a}reverse(){return new Pn(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}function ci(){let t={},r=n.hashGridSize||Hi,s=new Ue,u=[];function a(h){if(u.push(s.clone()),h.pos&&s.translate(h.pos),h.scale&&s.scale(h.scale),h.angle&&s.rotate(h.angle),h.transform=s.clone(),h.c(\"area\")&&!h.paused){let f=h,p=f.worldArea().bbox(),d=Math.floor(p.pos.x/r),w=Math.floor(p.pos.y/r),A=Math.ceil((p.pos.x+p.width)/r),D=Math.ceil((p.pos.y+p.height)/r),N=new Set;for(let _=d;_<=A;_++)for(let M=w;M<=D;M++)if(!t[_])t[_]={},t[_][M]=[f];else if(!t[_][M])t[_][M]=[f];else{let O=t[_][M];e:for(let ie of O){if(ie.paused||!ie.exists()||N.has(ie.id))continue;for(let H of f.collisionIgnore)if(ie.is(H))continue e;for(let H of ie.collisionIgnore)if(f.is(H))continue e;let Z=Or(f.worldArea(),ie.worldArea());if(Z){let H=new Pn(f,ie,Z);f.trigger(\"collideUpdate\",ie,H);let V=H.reverse();V.resolved=H.resolved,ie.trigger(\"collideUpdate\",f,V)}N.add(ie.id)}O.push(f)}}h.children.forEach(a),s=u.pop()}i(a,\"checkObj\"),a(C.root)}i(ci,\"checkFrame\");function hi(){let t=C.cam,r=v.fromAngle(xt(0,360)).scale(t.shake);t.shake=Ve(t.shake,0,5*Me()),t.transform=new Ue().translate(zt()).scale(t.scale).rotate(t.angle).translate((t.pos??zt()).scale(-1).add(r)),C.root.draw(),Pe()}i(hi,\"drawFrame\");function li(){let t=$();C.events.numListeners(\"loading\")>0?C.events.trigger(\"loading\",t):Ce(()=>{let r=we()/2,s=24,u=T(we()/2,xe()/2).sub(T(r/2,s/2));ge({pos:T(0),width:we(),height:xe(),color:J(0,0,0)}),ge({pos:u,width:r,height:s,fill:!1,outline:{width:4}}),ge({pos:u,width:r*t,height:s})})}i(li,\"drawLoadScreen\");function fr(t,r){Ce(()=>{let s=T(8);le(),ne(t);let u=Xe({text:r,font:nn,size:16,pos:s,color:J(255,255,255),fixed:!0}),a=u.width+s.x*2,h=u.height+s.x*2;t.x+a>=we()&&ne(T(-a,0)),t.y+h>=xe()&&ne(T(0,-h)),ge({width:a,height:h,color:J(0,0,0),radius:4,opacity:.8,fixed:!0}),Je(u),ae()})}i(fr,\"drawInspectText\");function di(){if(re.inspect){let t=null;for(let r of C.root.get(\"*\",{recursive:!0}))if(r.c(\"area\")&&r.isHovering()){t=r;break}if(C.root.drawInspect(),t){let r=[],s=t.inspect();for(let u in s)s[u]?r.push(`${u}: ${s[u]}`):r.push(`${u}`);fr(ns(Nt()),r.join(`\n`))}fr(T(8),`FPS: ${re.fps()}`)}re.paused&&Ce(()=>{le(),ne(we(),0),ne(-8,8);let t=32;ge({width:t,height:t,anchor:\"topright\",color:J(0,0,0),opacity:.8,radius:4,fixed:!0});for(let r=1;r<=2;r++)ge({width:4,height:t*.6,anchor:\"center\",pos:T(-t/3*r,t*.5),color:J(255,255,255),radius:2,fixed:!0});ae()}),re.timeScale!==1&&Ce(()=>{le(),ne(we(),xe()),ne(-8,-8);let t=8,r=Xe({text:re.timeScale.toFixed(1),font:nn,size:16,color:J(255,255,255),pos:T(-t),anchor:\"botright\",fixed:!0});ge({width:r.width+t*2+t*4,height:r.height+t*2,anchor:\"botright\",color:J(0,0,0),opacity:.8,radius:4,fixed:!0});for(let s=0;s<2;s++){let u=re.timeScale<1;R({p1:T(-r.width-t*(u?2:3.5),-t),p2:T(-r.width-t*(u?2:3.5),-t-r.height),p3:T(-r.width-t*(u?3.5:2),-t-r.height/2),pos:T(-s*t*1+(u?-t*.5:0),0),color:J(255,255,255),fixed:!0})}Je(r),ae()}),re.curRecording&&Ce(()=>{le(),ne(0,xe()),ne(24,-24),L({radius:12,color:J(255,0,0),opacity:In(0,1,y.time()*4),fixed:!0}),ae()}),re.showLog&&C.logs.length>0&&Ce(()=>{le(),ne(0,xe()),ne(8,-8);let t=8,r=[];for(let u of C.logs){let a=\"\",h=u.msg instanceof Error?\"error\":\"info\";a+=`[time]${u.time.toFixed(2)}[/time]`,a+=\" \",a+=`[${h}]${u.msg?.toString?u.msg.toString():u.msg}[/${h}]`,r.push(a)}C.logs=C.logs.filter(u=>y.time()-u.time<(n.logTime||$i));let s=Xe({text:r.join(`\n`),font:nn,pos:T(t,-t),anchor:\"botleft\",size:16,width:we()*.6,lineSpacing:t/2,fixed:!0,styles:{time:{color:J(127,127,127)},info:{color:J(255,255,255)},error:{color:J(255,0,127)}}});ge({width:s.width+t*2,height:s.height+t*2,anchor:\"botleft\",color:J(0,0,0),radius:4,opacity:.8,fixed:!0}),Je(s),ae()})}i(di,\"drawDebug\");function fi(t){C.events.on(\"loading\",t)}i(fi,\"onLoading\");function mi(t){y.onResize(t)}i(mi,\"onResize\");function pi(t){C.events.on(\"error\",t)}i(pi,\"onError\");function gi(t){console.error(t),te.ctx.suspend(),y.run(()=>{dt(),Ce(()=>{let u=we(),a=xe(),h={size:36,width:u-32*2,letterSpacing:4,lineSpacing:4,font:nn,fixed:!0};ge({width:u,height:a,color:J(0,0,255),fixed:!0});let f=Xe({...h,text:\"Error\",pos:T(32),color:J(255,128,0),fixed:!0});Je(f),tr({...h,text:t.message,pos:T(32,32+f.height+16),fixed:!0}),ae(),C.events.trigger(\"error\",t)}),ft()})}i(gi,\"handleErr\");function wi(t){X.push(t)}i(wi,\"onCleanup\");function bi(){C.events.onOnce(\"frameEnd\",()=>{y.quit(),S.clear(S.COLOR_BUFFER_BIT|S.DEPTH_BUFFER_BIT|S.STENCIL_BUFFER_BIT);let t=S.getParameter(S.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<t;r++)S.activeTexture(S.TEXTURE0+r),S.bindTexture(S.TEXTURE_2D,null),S.bindTexture(S.TEXTURE_CUBE_MAP,null);S.bindBuffer(S.ARRAY_BUFFER,null),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,null),S.bindRenderbuffer(S.RENDERBUFFER,null),S.bindFramebuffer(S.FRAMEBUFFER,null),q.destroy(),X.forEach(r=>r())})}i(bi,\"quit\");let Kt=!0;y.run(()=>{try{k.loaded||$()===1&&!Kt&&(k.loaded=!0,C.events.trigger(\"load\")),!k.loaded&&n.loadingScreen!==!1||Kt?(dt(),li(),ft()):(re.paused||dr(),ci(),dt(),hi(),n.debug!==!1&&di(),ft()),Kt&&(Kt=!1),C.events.trigger(\"frameEnd\")}catch(t){gi(t)}});function mr(){let t=P,r=S.drawingBufferWidth/t,s=S.drawingBufferHeight/t;if(n.letterbox){if(!n.width||!n.height)throw new Error(\"Letterboxing requires width and height defined.\");let u=r/s,a=n.width/n.height;if(u>a){let h=s*a,f=(r-h)/2;E.viewport={x:f,y:0,width:h,height:s}}else{let h=r/a,f=(s-h)/2;E.viewport={x:0,y:f,width:r,height:h}}return}if(n.stretch&&(!n.width||!n.height))throw new Error(\"Stretching requires width and height defined.\");E.viewport={x:0,y:0,width:r,height:s}}i(mr,\"updateViewport\");function pr(){y.onHide(()=>{n.backgroundAudio||te.ctx.suspend()}),y.onShow(()=>{!n.backgroundAudio&&!re.paused&&te.ctx.resume()}),y.onResize(()=>{if(y.isFullscreen())return;let t=n.width&&n.height;t&&!n.stretch&&!n.letterbox||(o.width=o.offsetWidth*P,o.height=o.offsetHeight*P,mr(),t||(E.frameBuffer.free(),E.frameBuffer=new rt(q,S.drawingBufferWidth,S.drawingBufferHeight),E.width=S.drawingBufferWidth/P,E.height=S.drawingBufferHeight/P))}),n.debug!==!1&&(y.onKeyPress(\"f1\",()=>re.inspect=!re.inspect),y.onKeyPress(\"f2\",()=>re.clearLog()),y.onKeyPress(\"f8\",()=>re.paused=!re.paused),y.onKeyPress(\"f7\",()=>{re.timeScale=mt(Le(re.timeScale-.2,0,2),1)}),y.onKeyPress(\"f9\",()=>{re.timeScale=mt(Le(re.timeScale+.2,0,2),1)}),y.onKeyPress(\"f10\",()=>re.stepFrame())),n.burp&&y.onKeyPress(\"b\",()=>Lt())}i(pr,\"initEvents\"),mr(),pr();let Ze={VERSION:ki,loadRoot:Te,loadProgress:$,loadSprite:Ye,loadSpriteAtlas:Ot,loadSound:ln,loadBitmapFont:on,loadFont:st,loadShader:cn,loadShaderURL:hn,loadAseprite:un,loadPedit:an,loadBean:dn,loadJSON:ye,load:Ae,getSprite:Pt,getSound:Dt,getFont:Mt,getBitmapFont:Gt,getShader:Bt,getAsset:fn,Asset:ve,SpriteData:K,SoundData:Q,width:we,height:xe,center:zt,dt:Me,time:y.time,screenshot:y.screenshot,record:ei,isFocused:ti,setCursor:y.setCursor,getCursor:y.getCursor,setCursorLocked:y.setCursorLocked,isCursorLocked:y.isCursorLocked,setFullscreen:y.setFullscreen,isFullscreen:y.isFullscreen,isTouchscreen:y.isTouchscreen,onLoad:Tn,onLoading:fi,onResize:mi,onGamepadConnect:y.onGamepadConnect,onGamepadDisconnect:y.onGamepadDisconnect,onError:pi,onCleanup:wi,camPos:rs,camScale:ss,camRot:is,shake:os,toScreen:rr,toWorld:sr,setGravity:gs,getGravity:ws,setBackground:bs,getBackground:vs,getGamepads:y.getGamepads,add:gt,make:Un,destroy:ni,destroyAll:si,get:On,readd:ri,pos:qt,scale:$t,rotate:ys,color:xs,opacity:Us,anchor:Sn,area:Os,sprite:Cn,text:Rs,polygon:Ps,rect:Ds,circle:Gs,uvquad:Ms,outline:Bs,body:Ls,doubleJump:Vs,shader:_s,timer:An,fixed:ks,stay:or,health:Ns,lifespan:js,z:Es,move:Cs,offscreen:Ts,follow:Ss,state:Hs,fadeIn:qs,mask:$s,drawon:zs,tile:cr,agent:Zs,on:ze,onUpdate:as,onDraw:us,onAdd:En,onDestroy:ir,onClick:ds,onCollide:cs,onCollideUpdate:hs,onCollideEnd:ls,onHover:fs,onHoverUpdate:ms,onHoverEnd:ps,onKeyDown:y.onKeyDown,onKeyPress:y.onKeyPress,onKeyPressRepeat:y.onKeyPressRepeat,onKeyRelease:y.onKeyRelease,onMouseDown:y.onMouseDown,onMousePress:y.onMousePress,onMouseRelease:y.onMouseRelease,onMouseMove:y.onMouseMove,onCharInput:y.onCharInput,onTouchStart:y.onTouchStart,onTouchMove:y.onTouchMove,onTouchEnd:y.onTouchEnd,onScroll:y.onScroll,onHide:y.onHide,onShow:y.onShow,onGamepadButtonDown:y.onGamepadButtonDown,onGamepadButtonPress:y.onGamepadButtonPress,onGamepadButtonRelease:y.onGamepadButtonRelease,onGamepadStick:y.onGamepadStick,mousePos:Nt,mouseDeltaPos:y.mouseDeltaPos,isKeyDown:y.isKeyDown,isKeyPressed:y.isKeyPressed,isKeyPressedRepeat:y.isKeyPressedRepeat,isKeyReleased:y.isKeyReleased,isMouseDown:y.isMouseDown,isMousePressed:y.isMousePressed,isMouseReleased:y.isMouseReleased,isMouseMoved:y.isMouseMoved,isGamepadButtonPressed:y.isGamepadButtonPressed,isGamepadButtonDown:y.isGamepadButtonDown,isGamepadButtonReleased:y.isGamepadButtonReleased,getGamepadStick:y.getGamepadStick,charInputted:y.charInputted,loop:ii,wait:hr,play:It,volume:gn,burp:Lt,audioCtx:te.ctx,Line:Ie,Rect:de,Circle:yt,Polygon:Ke,Vec2:v,Color:W,Mat4:Ue,Quad:oe,RNG:bt,rand:xt,randi:Ln,randSeed:yr,vec2:T,rgb:J,hsl2rgb:vr,quad:ce,choose:Ur,chance:xr,lerp:Ve,tween:Rn,easings:Ct,map:_e,mapc:br,wave:In,deg2rad:Ge,rad2deg:ot,clamp:Le,testLineLine:it,testRectRect:Er,testRectLine:Sr,testRectPoint:vt,testCirclePolygon:Tr,testLinePoint:Cr,testLineCircle:Vn,drawSprite:yn,drawText:tr,formatText:Xe,drawRect:ge,drawLine:l,drawLines:x,drawTriangle:R,drawCircle:L,drawEllipse:he,drawUVQuad:Be,drawPolygon:z,drawFormattedText:Je,drawMasked:$e,drawSubtracted:kt,pushTransform:le,popTransform:ae,pushTranslate:ne,pushScale:He,pushRotate:se,pushMatrix:_t,usePostEffect:Vt,makeCanvas:wn,debug:re,scene:Ks,go:Ys,onSceneLeave:Ws,addLevel:Qs,getData:Xs,setData:ar,download:Xt,downloadJSON:Dr,downloadText:kn,downloadBlob:Nn,plug:ur,ASCII_CHARS:zr,canvas:y.canvas,addKaboom:ui,LEFT:v.LEFT,RIGHT:v.RIGHT,UP:v.UP,DOWN:v.DOWN,RED:W.RED,GREEN:W.GREEN,BLUE:W.BLUE,YELLOW:W.YELLOW,MAGENTA:W.MAGENTA,CYAN:W.CYAN,WHITE:W.WHITE,BLACK:W.BLACK,quit:bi,Event:be,EventHandler:Ne,EventController:ke};if(n.plugins&&n.plugins.forEach(ur),n.global!==!1)for(let t in Ze)window[t]=Ze[t];return n.focus!==!1&&y.canvas.focus(),Ze},\"default\");export{zo as default};\n//# sourceMappingURL=kaboom.mjs.map\n","import {\n\tPoint,\n\tRNGValue,\n\tLerpValue,\n\tVec2Args,\n} from \"./types\"\n\nexport function deg2rad(deg: number): number {\n\treturn deg * Math.PI / 180\n}\n\nexport function rad2deg(rad: number): number {\n\treturn rad * 180 / Math.PI\n}\n\nexport function clamp(\n\tval: number,\n\tmin: number,\n\tmax: number,\n): number {\n\tif (min > max) {\n\t\treturn clamp(val, max, min)\n\t}\n\treturn Math.min(Math.max(val, min), max)\n}\n\nexport function lerp<V extends LerpValue>(\n\ta: V,\n\tb: V,\n\tt: number,\n): V {\n\tif (typeof a === \"number\" && typeof b === \"number\") {\n\t\treturn a + (b - a) * t as V\n\t} else if (a instanceof Vec2 && b instanceof Vec2) {\n\t\treturn a.lerp(b, t) as V\n\t} else if (a instanceof Color && b instanceof Color) {\n\t\treturn a.lerp(b, t) as V\n\t}\n\tthrow new Error(`Bad value for lerp(): ${a}, ${b}. Only number, Vec2 and Color is supported.`)\n}\n\nexport function map(\n\tv: number,\n\tl1: number,\n\th1: number,\n\tl2: number,\n\th2: number,\n): number {\n\treturn l2 + (v - l1) / (h1 - l1) * (h2 - l2)\n}\n\nexport function mapc(\n\tv: number,\n\tl1: number,\n\th1: number,\n\tl2: number,\n\th2: number,\n): number {\n\treturn clamp(map(v, l1, h1, l2, h2), l2, h2)\n}\n\nexport class Vec2 {\n\tx: number = 0\n\ty: number = 0\n\tconstructor(x: number = 0, y: number = x) {\n\t\tthis.x = x\n\t\tthis.y = y\n\t}\n\tstatic fromAngle(deg: number) {\n\t\tconst angle = deg2rad(deg)\n\t\treturn new Vec2(Math.cos(angle), Math.sin(angle))\n\t}\n\tstatic LEFT = new Vec2(-1, 0)\n\tstatic RIGHT = new Vec2(1, 0)\n\tstatic UP = new Vec2(0, -1)\n\tstatic DOWN = new Vec2(0, 1)\n\tclone(): Vec2 {\n\t\treturn new Vec2(this.x, this.y)\n\t}\n\tadd(...args: Vec2Args): Vec2 {\n\t\tconst p2 = vec2(...args)\n\t\treturn new Vec2(this.x + p2.x, this.y + p2.y)\n\t}\n\tsub(...args: Vec2Args): Vec2 {\n\t\tconst p2 = vec2(...args)\n\t\treturn new Vec2(this.x - p2.x, this.y - p2.y)\n\t}\n\tscale(...args: Vec2Args): Vec2 {\n\t\tconst s = vec2(...args)\n\t\treturn new Vec2(this.x * s.x, this.y * s.y)\n\t}\n\tdist(...args: Vec2Args): number {\n\t\tconst p2 = vec2(...args)\n\t\treturn this.sub(p2).len()\n\t}\n\tsdist(...args: Vec2Args): number {\n\t\tconst p2 = vec2(...args)\n\t\treturn this.sub(p2).slen()\n\t}\n\tlen(): number {\n\t\treturn Math.sqrt(this.dot(this))\n\t}\n\tslen(): number {\n\t\treturn this.dot(this)\n\t}\n\tunit(): Vec2 {\n\t\tconst len = this.len()\n\t\treturn len === 0 ? new Vec2(0) : this.scale(1 / len)\n\t}\n\tnormal(): Vec2 {\n\t\treturn new Vec2(this.y, -this.x)\n\t}\n\treflect(normal: Vec2) {\n\t\treturn this.sub(normal.scale(2 * this.dot(normal)))\n\t}\n\tproject(on: Vec2) {\n\t\treturn on.scale(on.dot(this) / on.len())\n\t}\n\treject(on: Vec2) {\n\t\treturn this.sub(this.project(on))\n\t}\n\tdot(p2: Vec2): number {\n\t\treturn this.x * p2.x + this.y * p2.y\n\t}\n\tcross(p2: Vec2): number {\n\t\treturn this.x * p2.y - this.y * p2.x\n\t}\n\tangle(...args: Vec2Args): number {\n\t\tconst p2 = vec2(...args)\n\t\treturn rad2deg(Math.atan2(this.y - p2.y, this.x - p2.x))\n\t}\n\tangleBetween(...args: Vec2Args): number {\n\t\tconst p2 = vec2(...args)\n\t\treturn rad2deg(Math.atan2(this.cross(p2), this.dot(p2)))\n\t}\n\tlerp(dest: Vec2, t: number): Vec2 {\n\t\treturn new Vec2(lerp(this.x, dest.x, t), lerp(this.y, dest.y, t))\n\t}\n\tslerp(dest: Vec2, t: number): Vec2 {\n\t\tconst cos = this.dot(dest)\n\t\tconst sin = this.cross(dest)\n\t\tconst angle = Math.atan2(sin, cos)\n\t\treturn this\n\t\t\t.scale(Math.sin((1 - t) * angle))\n\t\t\t.add(dest.scale(Math.sin(t * angle)))\n\t\t\t.scale(1 / sin)\n\t}\n\tisZero(): boolean {\n\t\treturn this.x === 0 && this.y === 0\n\t}\n\ttoFixed(n: number): Vec2 {\n\t\treturn new Vec2(Number(this.x.toFixed(n)), Number(this.y.toFixed(n)))\n\t}\n\ttransform(m: Mat4): Vec2 {\n\t\treturn m.multVec2(this)\n\t}\n\teq(other: Vec2): boolean {\n\t\treturn this.x === other.x && this.y === other.y\n\t}\n\tbbox(): Rect {\n\t\treturn new Rect(this, 0, 0)\n\t}\n\ttoString(): string {\n\t\treturn `vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`\n\t}\n}\n\nexport function vec2(...args: Vec2Args): Vec2 {\n\tif (args.length === 1) {\n\t\tif (args[0] instanceof Vec2) {\n\t\t\treturn new Vec2(args[0].x, args[0].y)\n\t\t} else if (Array.isArray(args[0]) && args[0].length === 2) {\n\t\t\treturn new Vec2(...args[0])\n\t\t}\n\t}\n\t// @ts-ignore\n\treturn new Vec2(...args)\n}\n\nexport class Color {\n\n\tr: number = 255\n\tg: number = 255\n\tb: number = 255\n\n\tconstructor(r: number, g: number, b: number) {\n\t\tthis.r = clamp(r, 0, 255)\n\t\tthis.g = clamp(g, 0, 255)\n\t\tthis.b = clamp(b, 0, 255)\n\t}\n\n\tstatic fromArray(arr: number[]) {\n\t\treturn new Color(arr[0], arr[1], arr[2])\n\t}\n\n\tstatic fromHex(hex: string | number) {\n\t\tif (typeof hex === \"number\") {\n\t\t\treturn new Color(\n\t\t\t\t(hex >> 16) & 0xff,\n\t\t\t\t(hex >> 8) & 0xff,\n\t\t\t\t(hex >> 0) & 0xff,\n\t\t\t)\n\t\t} else if (typeof hex === \"string\") {\n\t\t\tconst result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)\n\t\t\treturn new Color(\n\t\t\t\tparseInt(result[1], 16),\n\t\t\t\tparseInt(result[2], 16),\n\t\t\t\tparseInt(result[3], 16),\n\t\t\t)\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid hex color format\")\n\t\t}\n\t}\n\n\t// TODO: use range of [0, 360] [0, 100] [0, 100]?\n\tstatic fromHSL(h: number, s: number, l: number) {\n\n\t\tif (s == 0){\n\t\t\treturn new Color(255 * l, 255 * l, 255 * l)\n\t\t}\n\n\t\tconst hue2rgb = (p, q, t) => {\n\t\t\tif (t < 0) t += 1\n\t\t\tif (t > 1) t -= 1\n\t\t\tif (t < 1 / 6) return p + (q - p) * 6 * t\n\t\t\tif (t < 1 / 2) return q\n\t\t\tif (t < 2 / 3) return p + (q - p) * (2/3 - t) * 6\n\t\t\treturn p\n\t\t}\n\n\t\tconst q = l < 0.5 ? l * (1 + s) : l + s - l * s\n\t\tconst p = 2 * l - q\n\t\tconst r = hue2rgb(p, q, h + 1 / 3)\n\t\tconst g = hue2rgb(p, q, h)\n\t\tconst b = hue2rgb(p, q, h - 1 / 3)\n\n\t\treturn new Color(Math.round(r * 255), Math.round(g * 255), Math.round(b * 255))\n\n\t}\n\n\tstatic RED = new Color(255, 0, 0)\n\tstatic GREEN = new Color(0, 255, 0)\n\tstatic BLUE = new Color(0, 0, 255)\n\tstatic YELLOW = new Color(255, 255, 0)\n\tstatic MAGENTA = new Color(255, 0, 255)\n\tstatic CYAN = new Color(0, 255, 255)\n\tstatic WHITE = new Color(255, 255, 255)\n\tstatic BLACK = new Color(0, 0, 0)\n\n\tclone(): Color {\n\t\treturn new Color(this.r, this.g, this.b)\n\t}\n\n\tlighten(a: number): Color {\n\t\treturn new Color(this.r + a, this.g + a, this.b + a)\n\t}\n\n\tdarken(a: number): Color {\n\t\treturn this.lighten(-a)\n\t}\n\n\tinvert(): Color {\n\t\treturn new Color(255 - this.r, 255 - this.g, 255 - this.b)\n\t}\n\n\tmult(other: Color): Color {\n\t\treturn new Color(\n\t\t\tthis.r * other.r / 255,\n\t\t\tthis.g * other.g / 255,\n\t\t\tthis.b * other.b / 255,\n\t\t)\n\t}\n\n\tlerp(dest: Color, t: number): Color {\n\t\treturn new Color(\n\t\t\tlerp(this.r, dest.r, t),\n\t\t\tlerp(this.g, dest.g, t),\n\t\t\tlerp(this.b, dest.b, t),\n\t\t)\n\t}\n\n\ttoHSL(): [number, number, number] {\n\t\tconst r = this.r / 255\n\t\tconst g = this.g / 255\n\t\tconst b = this.b / 255\n\t\tconst max = Math.max(r, g, b), min = Math.min(r, g, b)\n\t\tlet h = (max + min) / 2\n\t\tlet s = h\n\t\tconst l = h\n\t\tif (max == min) {\n\t\t\th = s = 0\n\t\t} else {\n\t\t\tconst d = max - min\n\t\t\ts = l > 0.5 ? d / (2 - max - min) : d / (max + min)\n\t\t\tswitch (max) {\n\t\t\t\tcase r: h = (g - b) / d + (g < b ? 6 : 0); break\n\t\t\t\tcase g: h = (b - r) / d + 2; break\n\t\t\t\tcase b: h = (r - g) / d + 4; break\n\t\t\t}\n\t\t\th /= 6\n\t\t}\n\t\treturn [ h, s, l ]\n\t}\n\n\teq(other: Color): boolean {\n\t\treturn this.r === other.r\n\t\t\t&& this.g === other.g\n\t\t\t&& this.b === other.b\n\n\t}\n\n\ttoString(): string {\n\t\treturn `rgb(${this.r}, ${this.g}, ${this.b})`\n\t}\n\n\ttoHex(): string {\n\t\treturn \"#\" + ((1 << 24) + (this.r << 16) + (this.g << 8) + this.b).toString(16).slice(1)\n\t}\n\n}\n\nexport function rgb(...args): Color {\n\tif (args.length === 0) {\n\t\treturn new Color(255, 255, 255)\n\t} else if (args.length === 1) {\n\t\tif (args[0] instanceof Color) {\n\t\t\treturn args[0].clone()\n\t\t} else if (typeof args[0] === \"string\") {\n\t\t\treturn Color.fromHex(args[0])\n\t\t} else if (Array.isArray(args[0]) && args[0].length === 3) {\n\t\t\treturn Color.fromArray(args[0])\n\t\t}\n\t}\n\t// @ts-ignore\n\treturn new Color(...args)\n}\n\nexport const hsl2rgb = (h, s, l) => Color.fromHSL(h, s, l)\n\nexport class Quad {\n\tx: number = 0\n\ty: number = 0\n\tw: number = 1\n\th: number = 1\n\tconstructor(x: number, y: number, w: number, h: number) {\n\t\tthis.x = x\n\t\tthis.y = y\n\t\tthis.w = w\n\t\tthis.h = h\n\t}\n\tscale(other: Quad): Quad {\n\t\treturn new Quad(\n\t\t\tthis.x + this.w * other.x,\n\t\t\tthis.y + this.h * other.y,\n\t\t\tthis.w * other.w,\n\t\t\tthis.h * other.h,\n\t\t)\n\t}\n\tpos() {\n\t\treturn new Vec2(this.x, this.y)\n\t}\n\tclone(): Quad {\n\t\treturn new Quad(this.x, this.y, this.w, this.h)\n\t}\n\teq(other: Quad): boolean {\n\t\treturn this.x === other.x\n\t\t\t&& this.y === other.y\n\t\t\t&& this.w === other.w\n\t\t\t&& this.h === other.h\n\t}\n\ttoString(): string {\n\t\treturn `quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`\n\t}\n}\n\nexport function quad(x: number, y: number, w: number, h: number): Quad {\n\treturn new Quad(x, y, w, h)\n}\n\nexport class Mat4 {\n\n\tm: number[] = [\n\t\t1, 0, 0, 0,\n\t\t0, 1, 0, 0,\n\t\t0, 0, 1, 0,\n\t\t0, 0, 0, 1,\n\t]\n\n\tconstructor(m?: number[]) {\n\t\tif (m) {\n\t\t\tthis.m = m\n\t\t}\n\t}\n\n\tstatic translate(p: Vec2): Mat4 {\n\t\treturn new Mat4([\n\t\t\t1, 0, 0, 0,\n\t\t\t0, 1, 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\tp.x, p.y, 0, 1,\n\t\t])\n\t}\n\n\tstatic scale(s: Vec2): Mat4 {\n\t\treturn new Mat4([\n\t\t\ts.x, 0, 0, 0,\n\t\t\t0, s.y, 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\t0, 0, 0, 1,\n\t\t])\n\t}\n\n\tstatic rotateX(a: number): Mat4 {\n\t\ta = deg2rad(-a)\n\t\tconst c = Math.cos(a)\n\t\tconst s = Math.sin(a)\n\t\treturn new Mat4([\n\t\t\t1, 0, 0, 0,\n\t\t\t0, c, -s, 0,\n\t\t\t0, s, c, 0,\n\t\t\t0, 0, 0, 1,\n\t\t])\n\t}\n\n\tstatic rotateY(a: number): Mat4 {\n\t\ta = deg2rad(-a)\n\t\tconst c = Math.cos(a)\n\t\tconst s = Math.sin(a)\n\t\treturn new Mat4([\n\t\t\tc, 0, s, 0,\n\t\t\t0, 1, 0, 0,\n\t\t\t-s, 0, c, 0,\n\t\t\t0, 0, 0, 1,\n\t\t])\n\t}\n\n\tstatic rotateZ(a: number): Mat4 {\n\t\ta = deg2rad(-a)\n\t\tconst c = Math.cos(a)\n\t\tconst s = Math.sin(a)\n\t\treturn new Mat4([\n\t\t\tc, -s, 0, 0,\n\t\t\ts, c, 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\t0, 0, 0, 1,\n\t\t])\n\t}\n\n\ttranslate(p: Vec2) {\n\t\tthis.m[12] += this.m[0] * p.x + this.m[4] * p.y\n\t\tthis.m[13] += this.m[1] * p.x + this.m[5] * p.y\n\t\tthis.m[14] += this.m[2] * p.x + this.m[6] * p.y\n\t\tthis.m[15] += this.m[3] * p.x + this.m[7] * p.y\n\t\treturn this\n\t}\n\n\tscale(p: Vec2) {\n\t\tthis.m[0] *= p.x\n\t\tthis.m[4] *= p.y\n\t\tthis.m[1] *= p.x\n\t\tthis.m[5] *= p.y\n\t\tthis.m[2] *= p.x\n\t\tthis.m[6] *= p.y\n\t\tthis.m[3] *= p.x\n\t\tthis.m[7] *= p.y\n\t\treturn this\n\t}\n\n\trotate(a: number): Mat4 {\n\t\ta = deg2rad(-a)\n\t\tconst c = Math.cos(a)\n\t\tconst s = Math.sin(a)\n\t\tconst m0 = this.m[0]\n\t\tconst m1 = this.m[1]\n\t\tconst m4 = this.m[4]\n\t\tconst m5 = this.m[5]\n\t\tthis.m[0] = m0 * c + m1 * s\n\t\tthis.m[1] = -m0 * s + m1 * c\n\t\tthis.m[4] = m4 * c + m5 * s\n\t\tthis.m[5] = -m4 * s + m5 * c\n\t\treturn this\n\t}\n\n\t// TODO: in-place variant\n\tmult(other: Mat4): Mat4 {\n\t\tconst out = []\n\t\tfor (let i = 0; i < 4; i++) {\n\t\t\tfor (let j = 0; j < 4; j++) {\n\t\t\t\tout[i * 4 + j] =\n\t\t\t\t\tthis.m[0 * 4 + j] * other.m[i * 4 + 0] +\n\t\t\t\t\tthis.m[1 * 4 + j] * other.m[i * 4 + 1] +\n\t\t\t\t\tthis.m[2 * 4 + j] * other.m[i * 4 + 2] +\n\t\t\t\t\tthis.m[3 * 4 + j] * other.m[i * 4 + 3]\n\t\t\t}\n\t\t}\n\t\treturn new Mat4(out)\n\t}\n\n\tmultVec2(p: Vec2): Vec2 {\n\t\treturn new Vec2(\n\t\t\tp.x * this.m[0] + p.y * this.m[4] + this.m[12],\n\t\t\tp.x * this.m[1] + p.y * this.m[5] + this.m[13],\n\t\t)\n\t}\n\n\tgetTranslation() {\n\t\treturn new Vec2(this.m[12], this.m[13])\n\t}\n\n\tgetScale() {\n\t\tif (this.m[0] != 0 || this.m[1] != 0) {\n\t\t\tconst det = this.m[0] * this.m[5] - this.m[1] * this.m[4]\n\t\t\tconst r = Math.sqrt(this.m[0] * this.m[0] + this.m[1] * this.m[1])\n\t\t\treturn new Vec2(r, det / r)\n\t\t} else if (this.m[4] != 0 || this.m[5] != 0) {\n\t\t\tconst det = this.m[0] * this.m[5] - this.m[1] * this.m[4]\n\t\t\tconst s = Math.sqrt(this.m[4] * this.m[4] + this.m[5] * this.m[5])\n\t\t\treturn new Vec2(det / s, s)\n\t\t} else {\n\t\t\treturn new Vec2(0, 0)\n\t\t}\n\t}\n\n\tgetRotation() {\n\t\tif (this.m[0] != 0 || this.m[1] != 0) {\n\t\t\tconst r = Math.sqrt(this.m[0] * this.m[0] + this.m[1] * this.m[1])\n\t\t\treturn rad2deg(this.m[1] > 0 ? Math.acos(this.m[0] / r) : -Math.acos(this.m[0] / r))\n\t\t} else if (this.m[4] != 0 || this.m[5] != 0) {\n\t\t\tconst s = Math.sqrt(this.m[4] * this.m[4] + this.m[5] * this.m[5])\n\t\t\treturn rad2deg(Math.PI / 2 - (this.m[5] > 0 ? Math.acos(-this.m[4] / s) : -Math.acos(this.m[4] / s)))\n\t\t} else {\n\t\t\treturn 0\n\t\t}\n\t}\n\n\tgetSkew() {\n\t\tif (this.m[0] != 0 || this.m[1] != 0) {\n\t\t\tconst r = Math.sqrt(this.m[0] * this.m[0] + this.m[1] * this.m[1])\n\t\t\treturn new Vec2(Math.atan(this.m[0] * this.m[4] + this.m[1] * this.m[5]) / (r * r), 0)\n\t\t}\n\t\telse if (this.m[4] != 0 || this.m[5] != 0) {\n\t\t\tconst s = Math.sqrt(this.m[4] * this.m[4] + this.m[5] * this.m[5])\n\t\t\treturn new Vec2(0, Math.atan(this.m[0] * this.m[4] + this.m[1] * this.m[5]) / (s * s))\n\t\t}\n\t\telse {\n\t\t\treturn new Vec2(0, 0)\n\t\t}\n\t}\n\n\tinvert(): Mat4 {\n\n\t\tconst out = []\n\n\t\tconst f00 = this.m[10] * this.m[15] - this.m[14] * this.m[11]\n\t\tconst f01 = this.m[9] * this.m[15] - this.m[13] * this.m[11]\n\t\tconst f02 = this.m[9] * this.m[14] - this.m[13] * this.m[10]\n\t\tconst f03 = this.m[8] * this.m[15] - this.m[12] * this.m[11]\n\t\tconst f04 = this.m[8] * this.m[14] - this.m[12] * this.m[10]\n\t\tconst f05 = this.m[8] * this.m[13] - this.m[12] * this.m[9]\n\t\tconst f06 = this.m[6] * this.m[15] - this.m[14] * this.m[7]\n\t\tconst f07 = this.m[5] * this.m[15] - this.m[13] * this.m[7]\n\t\tconst f08 = this.m[5] * this.m[14] - this.m[13] * this.m[6]\n\t\tconst f09 = this.m[4] * this.m[15] - this.m[12] * this.m[7]\n\t\tconst f10 = this.m[4] * this.m[14] - this.m[12] * this.m[6]\n\t\tconst f11 = this.m[5] * this.m[15] - this.m[13] * this.m[7]\n\t\tconst f12 = this.m[4] * this.m[13] - this.m[12] * this.m[5]\n\t\tconst f13 = this.m[6] * this.m[11] - this.m[10] * this.m[7]\n\t\tconst f14 = this.m[5] * this.m[11] - this.m[9] * this.m[7]\n\t\tconst f15 = this.m[5] * this.m[10] - this.m[9] * this.m[6]\n\t\tconst f16 = this.m[4] * this.m[11] - this.m[8] * this.m[7]\n\t\tconst f17 = this.m[4] * this.m[10] - this.m[8] * this.m[6]\n\t\tconst f18 = this.m[4] * this.m[9] - this.m[8] * this.m[5]\n\n\t\tout[0] = this.m[5] * f00 - this.m[6] * f01 + this.m[7] * f02\n\t\tout[4] = -(this.m[4] * f00 - this.m[6] * f03 + this.m[7] * f04)\n\t\tout[8] = this.m[4] * f01 - this.m[5] * f03 + this.m[7] * f05\n\t\tout[12] = -(this.m[4] * f02 - this.m[5] * f04 + this.m[6] * f05)\n\n\t\tout[1] = -(this.m[1] * f00 - this.m[2] * f01 + this.m[3] * f02)\n\t\tout[5] = this.m[0] * f00 - this.m[2] * f03 + this.m[3] * f04\n\t\tout[9] = -(this.m[0] * f01 - this.m[1] * f03 + this.m[3] * f05)\n\t\tout[13] = this.m[0] * f02 - this.m[1] * f04 + this.m[2] * f05\n\n\t\tout[2] = this.m[1] * f06 - this.m[2] * f07 + this.m[3] * f08\n\t\tout[6] = -(this.m[0] * f06 - this.m[2] * f09 + this.m[3] * f10)\n\t\tout[10] = this.m[0] * f11 - this.m[1] * f09 + this.m[3] * f12\n\t\tout[14] = -(this.m[0] * f08 - this.m[1] * f10 + this.m[2] * f12)\n\n\t\tout[3] = -(this.m[1] * f13 - this.m[2] * f14 + this.m[3] * f15)\n\t\tout[7] = this.m[0] * f13 - this.m[2] * f16 + this.m[3] * f17\n\t\tout[11] = -(this.m[0] * f14 - this.m[1] * f16 + this.m[3] * f18)\n\t\tout[15] = this.m[0] * f15 - this.m[1] * f17 + this.m[2] * f18\n\n\t\tconst det =\n\t\t\tthis.m[0] * out[0] +\n\t\t\tthis.m[1] * out[4] +\n\t\t\tthis.m[2] * out[8] +\n\t\t\tthis.m[3] * out[12]\n\n\t\tfor (let i = 0; i < 4; i++) {\n\t\t\tfor (let j = 0; j < 4; j++) {\n\t\t\t\tout[i * 4 + j] *= (1.0 / det)\n\t\t\t}\n\t\t}\n\n\t\treturn new Mat4(out)\n\n\t}\n\n\tclone(): Mat4 {\n\t\treturn new Mat4([...this.m])\n\t}\n\n\ttoString(): string {\n\t\treturn this.m.toString()\n\t}\n\n}\n\nexport function wave(lo: number, hi: number, t: number, f = (t) => -Math.cos(t)): number {\n\treturn lo + (f(t) + 1) / 2 * (hi - lo)\n}\n\n// basic ANSI C LCG\nconst A = 1103515245\nconst C = 12345\nconst M = 2147483648\n\nexport class RNG {\n\tseed: number\n\tconstructor(seed: number) {\n\t\tthis.seed = seed\n\t}\n\tgen(): number {\n\t\tthis.seed = (A * this.seed + C) % M\n\t\treturn this.seed / M\n\t}\n\tgenNumber(a: number, b: number): number {\n\t\treturn a + this.gen() * (b - a)\n\t}\n\tgenVec2(a: Vec2, b?: Vec2): Vec2 {\n\t\treturn new Vec2(\n\t\t\tthis.genNumber(a.x, b.x),\n\t\t\tthis.genNumber(a.y, b.y),\n\t\t)\n\t}\n\tgenColor(a: Color, b: Color): Color {\n\t\treturn new Color(\n\t\t\tthis.genNumber(a.r, b.r),\n\t\t\tthis.genNumber(a.g, b.g),\n\t\t\tthis.genNumber(a.b, b.b),\n\t\t)\n\t}\n\tgenAny<T = RNGValue>(...args: T[]): T {\n\t\tif (args.length === 0) {\n\t\t\treturn this.gen() as T\n\t\t} else if (args.length === 1) {\n\t\t\tif (typeof args[0] === \"number\") {\n\t\t\t\treturn this.genNumber(0, args[0]) as T\n\t\t\t} else if (args[0] instanceof Vec2) {\n\t\t\t\treturn this.genVec2(vec2(0, 0), args[0]) as T\n\t\t\t} else if (args[0] instanceof Color) {\n\t\t\t\treturn this.genColor(rgb(0, 0, 0), args[0]) as T\n\t\t\t}\n\t\t} else if (args.length === 2) {\n\t\t\tif (typeof args[0] === \"number\" && typeof args[1] === \"number\") {\n\t\t\t\treturn this.genNumber(args[0], args[1]) as T\n\t\t\t} else if (args[0] instanceof Vec2 && args[1] instanceof Vec2) {\n\t\t\t\treturn this.genVec2(args[0], args[1]) as T\n\t\t\t} else if (args[0] instanceof Color && args[1] instanceof Color) {\n\t\t\t\treturn this.genColor(args[0], args[1]) as T\n\t\t\t}\n\t\t}\n\t}\n}\n\n// TODO: let user pass seed\nconst defRNG = new RNG(Date.now())\n\nexport function randSeed(seed?: number): number {\n\tif (seed != null) {\n\t\tdefRNG.seed = seed\n\t}\n\treturn defRNG.seed\n}\n\nexport function rand(...args) {\n\t// @ts-ignore\n\treturn defRNG.genAny(...args)\n}\n\n// TODO: randi() to return 0 / 1?\nexport function randi(...args: number[]) {\n\treturn Math.floor(rand(...args))\n}\n\nexport function chance(p: number): boolean {\n\treturn rand() <= p\n}\n\nexport function choose<T>(list: T[]): T {\n\treturn list[randi(list.length)]\n}\n\n// TODO: better name\nexport function testRectRect2(r1: Rect, r2: Rect): boolean {\n\treturn r1.pos.x + r1.width >= r2.pos.x\n\t\t&& r1.pos.x <= r2.pos.x + r2.width\n\t\t&& r1.pos.y + r1.height >= r2.pos.y\n\t\t&& r1.pos.y <= r2.pos.y + r2.height\n}\n\nexport function testRectRect(r1: Rect, r2: Rect): boolean {\n\treturn r1.pos.x + r1.width > r2.pos.x\n\t\t&& r1.pos.x < r2.pos.x + r2.width\n\t\t&& r1.pos.y + r1.height > r2.pos.y\n\t\t&& r1.pos.y < r2.pos.y + r2.height\n}\n\n// TODO: better name\nexport function testLineLineT(l1: Line, l2: Line): number | null {\n\n\tif ((l1.p1.x === l1.p2.x && l1.p1.y === l1.p2.y) || (l2.p1.x === l2.p2.x && l2.p1.y === l2.p2.y)) {\n\t\treturn null\n\t}\n\n\tconst denom = ((l2.p2.y - l2.p1.y) * (l1.p2.x - l1.p1.x) - (l2.p2.x - l2.p1.x) * (l1.p2.y - l1.p1.y))\n\n\t// parallel\n\tif (denom === 0) {\n\t\treturn null\n\t}\n\n\tconst ua = ((l2.p2.x - l2.p1.x) * (l1.p1.y - l2.p1.y) - (l2.p2.y - l2.p1.y) * (l1.p1.x - l2.p1.x)) / denom\n\tconst ub = ((l1.p2.x - l1.p1.x) * (l1.p1.y - l2.p1.y) - (l1.p2.y - l1.p1.y) * (l1.p1.x - l2.p1.x)) / denom\n\n\t// is the intersection on the segments\n\tif (ua < 0 || ua > 1 || ub < 0 || ub > 1) {\n\t\treturn null\n\t}\n\n\treturn ua\n\n}\n\nexport function testLineLine(l1: Line, l2: Line): Vec2 | null {\n\tconst t = testLineLineT(l1, l2)\n\tif (!t) return null\n\treturn vec2(\n\t\tl1.p1.x + t * (l1.p2.x - l1.p1.x),\n\t\tl1.p1.y + t * (l1.p2.y - l1.p1.y),\n\t)\n}\n\nexport function testRectLine(r: Rect, l: Line): boolean {\n\tif (testRectPoint(r, l.p1) || testRectPoint(r, l.p2)) {\n\t\treturn true\n\t}\n\tconst pts = r.points()\n\treturn !!testLineLine(l, new Line(pts[0], pts[1]))\n\t\t|| !!testLineLine(l, new Line(pts[1], pts[2]))\n\t\t|| !!testLineLine(l, new Line(pts[2], pts[3]))\n\t\t|| !!testLineLine(l, new Line(pts[3], pts[0]))\n}\n\nexport function testRectPoint2(r: Rect, pt: Point): boolean {\n\treturn pt.x >= r.pos.x\n\t\t&& pt.x <= r.pos.x + r.width\n\t\t&& pt.y >= r.pos.y\n\t\t&& pt.y <= r.pos.y + r.height\n}\n\nexport function testRectPoint(r: Rect, pt: Point): boolean {\n\treturn pt.x > r.pos.x\n\t\t&& pt.x < r.pos.x + r.width\n\t\t&& pt.y > r.pos.y\n\t\t&& pt.y < r.pos.y + r.height\n}\n\nexport function testRectCircle(r: Rect, c: Circle): boolean {\n\tconst nx = Math.max(r.pos.x, Math.min(c.center.x, r.pos.x + r.width))\n\tconst ny = Math.max(r.pos.y, Math.min(c.center.y, r.pos.y + r.height))\n\tconst nearestPoint = vec2(nx, ny)\n\treturn nearestPoint.sdist(c.center) <= c.radius * c.radius\n}\n\nexport function testRectPolygon(r: Rect, p: Polygon): boolean {\n\treturn testPolygonPolygon(p, new Polygon(r.points()))\n}\n\nexport function testLinePoint(l: Line, pt: Vec2): boolean {\n\tconst v1 = pt.sub(l.p1)\n\tconst v2 = l.p2.sub(l.p1)\n\n\t// Check if sine is 0, in that case lines are parallel.\n\t// If not parallel, the point cannot lie on the line.\n\tif (Math.abs(v1.cross(v2)) > Number.EPSILON) {\n\t\treturn false\n\t}\n\n\t// Scalar projection of v1 on v2\n\tconst t = v1.dot(v2) / v2.dot(v2)\n\t// Since t is percentual distance of pt from line.p1 on the line,\n\t// it should be between 0% and 100%\n\treturn t >= 0 && t <= 1\n}\n\nexport function testLineCircle(l: Line, circle: Circle): boolean {\n\tconst v = l.p2.sub(l.p1)\n\tconst a = v.dot(v)\n\tconst centerToOrigin = l.p1.sub(circle.center)\n\tconst b = 2 * v.dot(centerToOrigin)\n\tconst c = centerToOrigin.dot(centerToOrigin) - circle.radius * circle.radius\n\t// Calculate the discriminant of ax^2 + bx + c\n\tconst dis = b * b - 4 * a * c\n\n\t// No root\n\tif ((a <= Number.EPSILON) || (dis < 0)) {\n\t\treturn false\n\t}\n\t// One possible root\n\telse if (dis == 0) {\n\t\tconst t = -b / (2 * a)\n\t\tif (t >= 0 && t <= 1) {\n\t\t\treturn true\n\t\t}\n\t}\n\t// Two possible roots\n\telse {\n\t\tconst t1 = (-b + Math.sqrt(dis)) / (2 * a)\n\t\tconst t2 = (-b - Math.sqrt(dis)) / (2 * a)\n\t\tif ((t1 >= 0 && t1 <= 1) || (t2 >= 0 && t2 <= 1)) {\n\t\t\treturn true\n\t\t}\n\t}\n\n\t// Check if line is completely within the circle\n\t// We only need to check one point, since the line didn't cross the circle\n\treturn testCirclePoint(circle, l.p1)\n}\n\nexport function testLinePolygon(l: Line, p: Polygon): boolean {\n\n\t// test if line is inside\n\tif (testPolygonPoint(p, l.p1) || testPolygonPoint(p, l.p2)) {\n\t\treturn true\n\t}\n\n\t// test each line\n\tfor (let i = 0; i < p.pts.length; i++) {\n\t\tconst p1 = p.pts[i]\n\t\tconst p2 = p.pts[(i + 1) % p.pts.length]\n\t\tif (testLineLine(l, new Line(p1, p2))) {\n\t\t\treturn true\n\t\t}\n\t}\n\n\treturn false\n\n}\n\nexport function testCirclePoint(c: Circle, p: Point): boolean {\n\treturn c.center.sdist(p) < c.radius * c.radius\n}\n\nexport function testCircleCircle(c1: Circle, c2: Circle): boolean {\n\treturn c1.center.sdist(c2.center) < (c1.radius + c2.radius) * (c1.radius + c2.radius)\n}\n\nexport function testCirclePolygon(c: Circle, p: Polygon): boolean {\n\t// For each edge check for intersection\n\tlet prev = p.pts[p.pts.length - 1]\n\tfor (const cur of p.pts) {\n\t\tif (testLineCircle(new Line(prev, cur), c)) {\n\t\t\treturn true\n\t\t}\n\t\tprev = cur\n\t}\n\n\t// Check if the polygon is completely within the circle\n\t// We only need to check one point, since the polygon didn't cross the circle\n\tif (testCirclePoint(c, p.pts[0])) {\n\t\treturn true\n\t}\n\n\t// Check if the circle is completely within the polygon\n\treturn testPolygonPoint(p, c.center)\n}\n\nexport function testPolygonPolygon(p1: Polygon, p2: Polygon): boolean {\n\tfor (let i = 0; i < p1.pts.length; i++) {\n\t\tif (testLinePolygon(new Line(p1.pts[i], p1.pts[(i + 1) % p1.pts.length]), p2)) {\n\t\t\treturn true\n\t\t}\n\t}\n\treturn false\n}\n\n// https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html\nexport function testPolygonPoint(poly: Polygon, pt: Point): boolean {\n\n\tlet c = false\n\tconst p = poly.pts\n\n\tfor (let i = 0, j = p.length - 1; i < p.length; j = i++) {\n\t\tif (\n\t\t\t((p[i].y > pt.y) != (p[j].y > pt.y))\n\t\t\t&& (pt.x < (p[j].x - p[i].x) * (pt.y - p[i].y) / (p[j].y - p[i].y) + p[i].x)\n\t\t) {\n\t\t\tc = !c\n\t\t}\n\t}\n\n\treturn c\n\n}\n\nexport function testPointPoint(p1: Point, p2: Point): boolean {\n\treturn p1.x === p2.x && p1.y === p2.y\n}\n\nexport class Line {\n\tp1: Vec2\n\tp2: Vec2\n\tconstructor(p1: Vec2, p2: Vec2) {\n\t\tthis.p1 = p1.clone()\n\t\tthis.p2 = p2.clone()\n\t}\n\ttransform(m: Mat4): Line {\n\t\treturn new Line(m.multVec2(this.p1), m.multVec2(this.p2))\n\t}\n\tbbox(): Rect {\n\t\treturn Rect.fromPoints(this.p1, this.p2)\n\t}\n\tarea(): number {\n\t\treturn this.p1.dist(this.p2)\n\t}\n\tclone(): Line {\n\t\treturn new Line(this.p1, this.p2)\n\t}\n}\n\n// TODO: use x: number y: number (x, y, width, height)\nexport class Rect {\n\tpos: Vec2\n\twidth: number\n\theight: number\n\tconstructor(pos: Vec2, width: number, height: number) {\n\t\tthis.pos = pos.clone()\n\t\tthis.width = width\n\t\tthis.height = height\n\t}\n\tstatic fromPoints(p1: Vec2, p2: Vec2): Rect {\n\t\treturn new Rect(p1.clone(), p2.x - p1.x, p2.y - p1.y)\n\t}\n\tcenter(): Vec2 {\n\t\treturn new Vec2(this.pos.x + this.width / 2, this.pos.y + this.height / 2)\n\t}\n\tpoints(): [Vec2, Vec2, Vec2, Vec2] {\n\t\treturn [\n\t\t\tthis.pos,\n\t\t\tthis.pos.add(this.width, 0),\n\t\t\tthis.pos.add(this.width, this.height),\n\t\t\tthis.pos.add(0, this.height),\n\t\t]\n\t}\n\ttransform(m: Mat4): Polygon {\n\t\treturn new Polygon(this.points().map((pt) => m.multVec2(pt)))\n\t}\n\tbbox(): Rect {\n\t\treturn this.clone()\n\t}\n\tarea(): number {\n\t\treturn this.width * this.height\n\t}\n\tclone(): Rect {\n\t\treturn new Rect(this.pos.clone(), this.width, this.height)\n\t}\n\tdistToPoint(p: Vec2): number {\n\t\treturn Math.sqrt(this.sdistToPoint(p))\n\t}\n\tsdistToPoint(p: Vec2): number {\n\t\tconst min = this.pos\n\t\tconst max = this.pos.add(this.width, this.height)\n\t\tconst dx = Math.max(min.x - p.x, 0, p.x - max.x)\n\t\tconst dy = Math.max(min.y - p.y, 0, p.y - max.y)\n\t\treturn dx * dx + dy * dy\n\t}\n}\n\nexport class Circle {\n\tcenter: Vec2\n\tradius: number\n\tconstructor(center: Vec2, radius: number) {\n\t\tthis.center = center.clone()\n\t\tthis.radius = radius\n\t}\n\ttransform(tr: Mat4): Ellipse {\n\t\treturn new Ellipse(this.center, this.radius, this.radius).transform(tr)\n\t}\n\tbbox(): Rect {\n\t\treturn Rect.fromPoints(\n\t\t\tthis.center.sub(vec2(this.radius)),\n\t\t\tthis.center.add(vec2(this.radius)),\n\t\t)\n\t}\n\tarea(): number {\n\t\treturn this.radius * this.radius * Math.PI\n\t}\n\tclone(): Circle {\n\t\treturn new Circle(this.center, this.radius)\n\t}\n}\n\nexport class Ellipse {\n\tcenter: Vec2\n\tradiusX: number\n\tradiusY: number\n\tconstructor(center: Vec2, rx: number, ry: number) {\n\t\tthis.center = center.clone()\n\t\tthis.radiusX = rx\n\t\tthis.radiusY = ry\n\t}\n\ttransform(tr: Mat4): Ellipse {\n\t\treturn new Ellipse(\n\t\t\ttr.multVec2(this.center),\n\t\t\ttr.m[0] * this.radiusX,\n\t\t\ttr.m[5] * this.radiusY,\n\t\t)\n\t}\n\tbbox(): Rect {\n\t\treturn Rect.fromPoints(\n\t\t\tthis.center.sub(vec2(this.radiusX, this.radiusY)),\n\t\t\tthis.center.add(vec2(this.radiusX, this.radiusY)),\n\t\t)\n\t}\n\tarea(): number {\n\t\treturn this.radiusX * this.radiusY * Math.PI\n\t}\n\tclone(): Ellipse {\n\t\treturn new Ellipse(this.center, this.radiusX, this.radiusY)\n\t}\n}\n\nexport class Polygon {\n\tpts: Vec2[]\n\tconstructor(pts: Vec2[]) {\n\t\tif (pts.length < 3) {\n\t\t\tthrow new Error(\"Polygons should have at least 3 vertices\")\n\t\t}\n\t\tthis.pts = pts\n\t}\n\ttransform(m: Mat4): Polygon {\n\t\treturn new Polygon(this.pts.map((pt) => m.multVec2(pt)))\n\t}\n\tbbox(): Rect {\n\t\tconst p1 = vec2(Number.MAX_VALUE)\n\t\tconst p2 = vec2(-Number.MAX_VALUE)\n\t\tfor (const pt of this.pts) {\n\t\t\tp1.x = Math.min(p1.x, pt.x)\n\t\t\tp2.x = Math.max(p2.x, pt.x)\n\t\t\tp1.y = Math.min(p1.y, pt.y)\n\t\t\tp2.y = Math.max(p2.y, pt.y)\n\t\t}\n\t\treturn Rect.fromPoints(p1, p2)\n\t}\n\tarea(): number {\n\t\tlet total = 0\n\t\tconst l = this.pts.length\n\t\tfor (let i = 0; i < l; i++) {\n\t\t\tconst p1 = this.pts[i]\n\t\t\tconst p2 = this.pts[(i + 1) % l]\n\t\t\ttotal += (p1.x * p2.y * 0.5)\n\t\t\ttotal -= (p2.x * p1.y * 0.5)\n\t\t}\n\t\treturn Math.abs(total)\n\t}\n\tclone(): Polygon {\n\t\treturn new Polygon(this.pts.map((pt) => pt.clone()))\n\t}\n}\n\nexport function sat(p1: Polygon, p2: Polygon): Vec2 | null {\n\tlet overlap = Number.MAX_VALUE\n\tlet displacement = vec2(0)\n\tfor (const poly of [p1, p2]) {\n\t\tfor (let i = 0; i < poly.pts.length; i++) {\n\t\t\tconst a = poly.pts[i]\n\t\t\tconst b = poly.pts[(i + 1) % poly.pts.length]\n\t\t\tconst axisProj = b.sub(a).normal().unit()\n\t\t\tlet min1 = Number.MAX_VALUE\n\t\t\tlet max1 = -Number.MAX_VALUE\n\t\t\tfor (let j = 0; j < p1.pts.length; j++) {\n\t\t\t\tconst q = p1.pts[j].dot(axisProj)\n\t\t\t\tmin1 = Math.min(min1, q)\n\t\t\t\tmax1 = Math.max(max1, q)\n\t\t\t}\n\t\t\tlet min2 = Number.MAX_VALUE\n\t\t\tlet max2 = -Number.MAX_VALUE\n\t\t\tfor (let j = 0; j < p2.pts.length; j++) {\n\t\t\t\tconst q = p2.pts[j].dot(axisProj)\n\t\t\t\tmin2 = Math.min(min2, q)\n\t\t\t\tmax2 = Math.max(max2, q)\n\t\t\t}\n\t\t\tconst o = Math.min(max1, max2) - Math.max(min1, min2)\n\t\t\tif (o < 0) {\n\t\t\t\treturn null\n\t\t\t}\n\t\t\tif (o < Math.abs(overlap)) {\n\t\t\t\tconst o1 = max2 - min1\n\t\t\t\tconst o2 = min2 - max1\n\t\t\t\toverlap = Math.abs(o1) < Math.abs(o2) ? o1 : o2\n\t\t\t\tdisplacement = axisProj.scale(overlap)\n\t\t\t}\n\t\t}\n\t}\n\treturn displacement\n}\n","export class Registry<T> extends Map<number, T> {\n\tprivate lastID: number\n\tconstructor(...args) {\n\t\tsuper(...args)\n\t\tthis.lastID = 0\n\t}\n\tpush(v: T): number {\n\t\tconst id = this.lastID\n\t\tthis.set(id, v)\n\t\tthis.lastID++\n\t\treturn id\n\t}\n\tpushd(v: T): () => void {\n\t\tconst id = this.push(v)\n\t\treturn () => this.delete(id)\n\t}\n}\n\nexport class EventController {\n\tpaused: boolean = false\n\treadonly cancel: () => void\n\tconstructor(cancel: () => void) {\n\t\tthis.cancel = cancel\n\t}\n\tstatic join(events: EventController[]): EventController {\n\t\tconst ev = new EventController(() => events.forEach((e) => e.cancel()))\n\t\tObject.defineProperty(ev, \"paused\", {\n\t\t\tget: () => events[0].paused,\n\t\t\tset: (p: boolean) => events.forEach((e) => e.paused = p),\n\t\t})\n\t\tev.paused = false\n\t\treturn ev\n\t}\n}\n\nexport class Event<Args extends any[] = any[]> {\n\tprivate handlers: Registry<(...args: Args) => void> = new Registry()\n\tadd(action: (...args: Args) => void): EventController {\n\t\tconst cancel = this.handlers.pushd((...args: Args) => {\n\t\t\tif (ev.paused) return\n\t\t\taction(...args)\n\t\t})\n\t\tconst ev = new EventController(cancel)\n\t\treturn ev\n\t}\n\taddOnce(action: (...args) => void): EventController {\n\t\tconst ev = this.add((...args) => {\n\t\t\tev.cancel()\n\t\t\taction(...args)\n\t\t})\n\t\treturn ev\n\t}\n\tnext(): Promise<Args> {\n\t\treturn new Promise((res) => this.addOnce(res))\n\t}\n\ttrigger(...args: Args) {\n\t\tthis.handlers.forEach((action) => action(...args))\n\t}\n\tnumListeners(): number {\n\t\treturn this.handlers.size\n\t}\n\tclear() {\n\t\tthis.handlers.clear()\n\t}\n}\n\n// TODO: only accept one argument?\nexport class EventHandler<EventMap extends Record<string, any[]>> {\n\tprivate handlers: Partial<{\n\t\t[Name in keyof EventMap]: Event<EventMap[Name]>\n\t}> = {}\n\ton<Name extends keyof EventMap>(\n\t\tname: Name,\n\t\taction: (...args: EventMap[Name]) => void,\n\t): EventController {\n\t\tif (!this.handlers[name]) {\n\t\t\tthis.handlers[name] = new Event<EventMap[Name]>()\n\t\t}\n\t\treturn this.handlers[name].add(action)\n\t}\n\tonOnce<Name extends keyof EventMap>(\n\t\tname: Name,\n\t\taction: (...args: EventMap[Name]) => void,\n\t): EventController {\n\t\tconst ev = this.on(name, (...args) => {\n\t\t\tev.cancel()\n\t\t\taction(...args)\n\t\t})\n\t\treturn ev\n\t}\n\tnext<Name extends keyof EventMap>(name: Name): Promise<unknown> {\n\t\treturn new Promise((res) => {\n\t\t\t// TODO: can only pass 1 val to resolve()\n\t\t\tthis.onOnce(name, (...args: EventMap[Name]) => res(args[0]))\n\t\t})\n\t}\n\ttrigger<Name extends keyof EventMap>(name: Name, ...args: EventMap[Name]) {\n\t\tif (this.handlers[name]) {\n\t\t\tthis.handlers[name].trigger(...args)\n\t\t}\n\t}\n\tremove<Name extends keyof EventMap>(name: Name) {\n\t\tdelete this.handlers[name]\n\t}\n\tclear() {\n\t\tthis.handlers = {}\n\t}\n\tnumListeners<Name extends keyof EventMap>(name: Name): number {\n\t\treturn this.handlers[name]?.numListeners() ?? 0\n\t}\n}\n\nexport function deepEq(o1: any, o2: any): boolean {\n\tif (o1 === o2) {\n\t\treturn true\n\t}\n\tconst t1 = typeof o1\n\tconst t2 = typeof o2\n\tif (t1 !== t2) {\n\t\treturn false\n\t}\n\tif (t1 === \"object\" && t2 === \"object\" && o1 !== null && o2 !== null) {\n\t\tif (Array.isArray(o1) !== Array.isArray(o2)) {\n\t\t\treturn false\n\t\t}\n\t\tconst k1 = Object.keys(o1)\n\t\tconst k2 = Object.keys(o2)\n\t\tif (k1.length !== k2.length) {\n\t\t\treturn false\n\t\t}\n\t\tfor (const k of k1) {\n\t\t\tconst v1 = o1[k]\n\t\t\tconst v2 = o2[k]\n\t\t\tif (!deepEq(v1, v2)) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t\treturn true\n\t}\n\treturn false\n}\n\nexport function base64ToArrayBuffer(base64: string): ArrayBuffer {\n\tconst binstr = window.atob(base64)\n\tconst len = binstr.length\n\tconst bytes = new Uint8Array(len)\n\tfor (let i = 0; i < len; i++) {\n\t\tbytes[i] = binstr.charCodeAt(i)\n\t}\n\treturn bytes.buffer\n}\n\nexport function dataURLToArrayBuffer(url: string): ArrayBuffer {\n\treturn base64ToArrayBuffer(url.split(\",\")[1])\n}\n\nexport function download(filename: string, url: string) {\n\tconst a = document.createElement(\"a\")\n\ta.href = url\n\ta.download = filename\n\ta.click()\n}\n\nexport function downloadText(filename: string, text: string) {\n\tdownload(filename, \"data:text/plain;charset=utf-8,\" + text)\n}\n\nexport function downloadJSON(filename: string, data: any) {\n\tdownloadText(filename, JSON.stringify(data))\n}\n\nexport function downloadBlob(filename: string, blob: Blob) {\n\tconst url = URL.createObjectURL(blob)\n\tdownload(filename, url)\n\tURL.revokeObjectURL(url)\n}\n\nexport const isDataURL = (str: string) => str.match(/^data:\\w+\\/\\w+;base64,.+/)\nexport const getFileExt = (p: string) => p.split(\".\").pop()\nexport const getFileName = (p: string) => p.split(\".\").slice(0, -1).join(\".\")\n\ntype Func = (...args: any[]) => any\n\nexport function overload2<A extends Func, B extends Func>(fn1: A, fn2: B): A & B {\n\treturn ((...args) => {\n\t\tconst al = args.length\n\t\tif (al === fn1.length) return fn1(...args)\n\t\tif (al === fn2.length) return fn2(...args)\n\t}) as A & B\n}\n\nexport function overload3<\n\tA extends Func,\n\tB extends Func,\n\tC extends Func,\n>(fn1: A, fn2: B, fn3: C): A & B & C {\n\treturn ((...args) => {\n\t\tconst al = args.length\n\t\tif (al === fn1.length) return fn1(...args)\n\t\tif (al === fn2.length) return fn2(...args)\n\t\tif (al === fn3.length) return fn3(...args)\n\t}) as A & B & C\n}\n\nexport function overload4<\n\tA extends Func,\n\tB extends Func,\n\tC extends Func,\n\tD extends Func,\n>(fn1: A, fn2: B, fn3: C, fn4: D): A & B & C & D {\n\treturn ((...args) => {\n\t\tconst al = args.length\n\t\tif (al === fn1.length) return fn1(...args)\n\t\tif (al === fn2.length) return fn2(...args)\n\t\tif (al === fn3.length) return fn3(...args)\n\t\tif (al === fn4.length) return fn4(...args)\n\t}) as A & B & C & D\n}\n\nexport const uid = (() => {\n\tlet id = 0\n\treturn () => id++\n})()\n\nexport const getErrorMessage = (error: unknown) =>\n\t(error instanceof Error) ? error.message : String(error)\n\nconst warned = new Set()\n\nexport function warn(msg: string) {\n\tif (!warned.has(msg)) {\n\t\twarned.add(msg)\n\t\tconsole.warn(msg)\n\t}\n}\n\nexport function deprecateMsg(oldName: string, newName: string) {\n\twarn(`${oldName} is deprecated. Use ${newName} instead.`)\n}\n\nexport function deprecate(oldName: string, newName: string, newFunc: (...args) => any) {\n\treturn (...args) => {\n\t\tdeprecateMsg(oldName, newName)\n\t\treturn newFunc(...args)\n\t}\n}\n\nexport function benchmark(task: () => void, times: number = 1) {\n\tconst t1 = performance.now()\n\tfor (let i = 0; i < times; i++) {\n\t\ttask()\n\t}\n\tconst t2 = performance.now()\n\treturn t2 - t1\n}\n\nexport function comparePerf(t1: () => void, t2: () => void, times: number = 1) {\n\treturn benchmark(t2, times) / benchmark(t1, times)\n}\n\nexport class BinaryHeap<T> {\n\t_items: T[]\n\t_compareFn: (a: T, b: T) => boolean\n\n\t/**\n\t * Creates a binary heap with the given compare function\n\t * Not passing a compare function will give a min heap\n\t */\n\tconstructor(compareFn = (a: T, b: T) => a < b) {\n\t\tthis._compareFn = compareFn\n\t\tthis._items = []\n\t}\n\n\t/**\n\t * Insert an item into the binary heap\n\t */\n\tinsert(item: T) {\n\t\tthis._items.push(item)\n\t\tthis.moveUp(this._items.length - 1)\n\t}\n\n\t/**\n\t * Remove the smallest item from the binary heap in case of a min heap\n\t * or the greatest item from the binary heap in case of a max heap\n\t */\n\tremove() {\n\t\tif (this._items.length === 0)\n\t\t\treturn null\n\t\tconst item = this._items[0]\n\t\tconst lastItem = this._items.pop()\n\t\tif (this._items.length !== 0) {\n\t\t\tthis._items[0] = lastItem as T\n\t\t\tthis.moveDown(0)\n\t\t}\n\t\treturn item\n\t}\n\n\t/**\n\t * Remove all items\n\t */\n\tclear() {\n\t\tthis._items.splice(0, this._items.length)\n\t}\n\n\tmoveUp(pos: number) {\n\t\twhile (pos > 0) {\n\t\t\tconst parent = Math.floor((pos - 1) / 2)\n\t\t\tif (!this._compareFn(this._items[pos], this._items[parent]))\n\t\t\t\tif (this._items[pos] >= this._items[parent])\n\t\t\t\t\tbreak\n\t\t\tthis.swap(pos, parent)\n\t\t\tpos = parent\n\t\t}\n\t}\n\n\tmoveDown(pos: number) {\n\t\twhile (pos < Math.floor(this._items.length / 2)) {\n\t\t\tlet child = 2 * pos + 1\n\t\t\tif (child < this._items.length - 1 && !this._compareFn(this._items[child], this._items[child + 1]))\n\t\t\t\t++child\n\t\t\tif (this._compareFn(this._items[pos], this._items[child]))\n\t\t\t\tbreak\n\t\t\tthis.swap(pos, child)\n\t\t\tpos = child\n\t\t}\n\t}\n\n\tswap(index1: number, index2: number) {\n\t\t[this._items[index1], this._items[index2]] = [this._items[index2], this._items[index1]]\n\t}\n\n\t/**\n\t * Returns the amount of items\n\t */\n\tget length() {\n\t\treturn this._items.length\n\t}\n}\n\nconst enum EnumRunesCode {\n\tHIGH_SURROGATE_START = 0xd800,\n\tHIGH_SURROGATE_END = 0xdbff,\n\n\tLOW_SURROGATE_START = 0xdc00,\n\n\tREGIONAL_INDICATOR_START = 0x1f1e6,\n\tREGIONAL_INDICATOR_END = 0x1f1ff,\n\n\tFITZPATRICK_MODIFIER_START = 0x1f3fb,\n\tFITZPATRICK_MODIFIER_END = 0x1f3ff,\n\n\tVARIATION_MODIFIER_START = 0xfe00,\n\tVARIATION_MODIFIER_END = 0xfe0f,\n\n\tDIACRITICAL_MARKS_START = 0x20d0,\n\tDIACRITICAL_MARKS_END = 0x20ff,\n\n\tSUBDIVISION_INDICATOR_START = 0x1f3f4,\n\tTAGS_START = 0xe0000,\n\tTAGS_END = 0xe007f,\n\n\tZWJ = 0x200d,\n}\n\nconst GRAPHEMES = Object.freeze([\n\t0x0308, // (  ) COMBINING DIAERESIS\n\t0x0937, // (  ) DEVANAGARI LETTER SSA\n\t0x093F, // (  ) DEVANAGARI VOWEL SIGN I\n\t0x0BA8, // (  ) TAMIL LETTER NA\n\t0x0BBF, // (  ) TAMIL VOWEL SIGN I\n\t0x0BCD, // ( ) TAMIL SIGN VIRAMA\n\t0x0E31, // (  ) THAI CHARACTER MAI HAN-AKAT\n\t0x0E33, // (  ) THAI CHARACTER SARA AM\n\t0x0E40, // (  ) THAI CHARACTER SARA E\n\t0x0E49, // (  ) THAI CHARACTER MAI THO\n\t0x1100, // (  ) HANGUL CHOSEONG KIYEOK\n\t0x1161, // (  ) HANGUL JUNGSEONG A\n\t0x11A8, // (  ) HANGUL JONGSEONG KIYEOK\n])\n\nenum EnumCodeUnits {\n\tunit_1 = 1,\n\tunit_2 = 2,\n\tunit_4 = 4,\n}\n\nexport function runes(string: string): string[] {\n\tif (typeof string !== \"string\") {\n\t\tthrow new TypeError(\"string cannot be undefined or null\")\n\t}\n\tconst result: string[] = []\n\tlet i = 0\n\tlet increment = 0\n\twhile (i < string.length) {\n\t\tincrement += nextUnits(i + increment, string)\n\t\tif (isGrapheme(string[i + increment])) {\n\t\t\tincrement++\n\t\t}\n\t\tif (isVariationSelector(string[i + increment])) {\n\t\t\tincrement++\n\t\t}\n\t\tif (isDiacriticalMark(string[i + increment])) {\n\t\t\tincrement++\n\t\t}\n\t\tif (isZeroWidthJoiner(string[i + increment])) {\n\t\t\tincrement++\n\t\t\tcontinue\n\t\t}\n\t\tresult.push(string.substring(i, i + increment))\n\t\ti += increment\n\t\tincrement = 0\n\t}\n\treturn result\n}\n\n// Decide how many code units make up the current character.\n// BMP characters: 1 code unit\n// Non-BMP characters (represented by surrogate pairs): 2 code units\n// Emoji with skin-tone modifiers: 4 code units (2 code points)\n// Country flags: 4 code units (2 code points)\n// Variations: 2 code units\n// Subdivision flags: 14 code units (7 code points)\nfunction nextUnits(i: number, string: string) {\n\tconst current = string[i]\n\t// If we don't have a value that is part of a surrogate pair, or we're at\n\t// the end, only take the value at i\n\tif (!isFirstOfSurrogatePair(current) || i === string.length - 1) {\n\t\treturn EnumCodeUnits.unit_1\n\t}\n\n\tconst currentPair = current + string[i + 1]\n\tconst nextPair = string.substring(i + 2, i + 5)\n\n\t// Country flags are comprised of two regional indicator symbols,\n\t// each represented by a surrogate pair.\n\t// See http://emojipedia.org/flags/\n\t// If both pairs are regional indicator symbols, take 4\n\tif (isRegionalIndicator(currentPair) && isRegionalIndicator(nextPair)) {\n\t\treturn EnumCodeUnits.unit_4\n\t}\n\n\t// https://unicode.org/emoji/charts/full-emoji-list.html#subdivision-flag\n\t// See https://emojipedia.org/emoji-tag-sequence/\n\t// If nextPair is in Tags(https://en.wikipedia.org/wiki/Tags_(Unicode_block)),\n\t// then find next closest U+E007F(CANCEL TAG)\n\tif (isSubdivisionFlag(currentPair) &&\tisSupplementarySpecialpurposePlane(nextPair)) {\n\t\treturn string.slice(i).indexOf(String.fromCodePoint(EnumRunesCode.TAGS_END)) + 2\n\t}\n\n\t// If the next pair make a Fitzpatrick skin tone\n\t// modifier, take 4\n\t// See http://emojipedia.org/modifiers/\n\t// Technically, only some code points are meant to be\n\t// combined with the skin tone modifiers. This function\n\t// does not check the current pair to see if it is\n\t// one of them.\n\tif (isFitzpatrickModifier(nextPair)) {\n\t\treturn EnumCodeUnits.unit_4\n\t}\n\treturn EnumCodeUnits.unit_2\n}\n\nfunction isFirstOfSurrogatePair(string: string) {\n\treturn string && betweenInclusive(string[0].charCodeAt(0), EnumRunesCode.HIGH_SURROGATE_START, EnumRunesCode.HIGH_SURROGATE_END)\n}\n\nfunction isRegionalIndicator(string: string) {\n\treturn betweenInclusive(codePointFromSurrogatePair(string), EnumRunesCode.REGIONAL_INDICATOR_START, EnumRunesCode.REGIONAL_INDICATOR_END)\n}\n\nfunction isSubdivisionFlag(string: string) {\n\treturn betweenInclusive(codePointFromSurrogatePair(string),\tEnumRunesCode.SUBDIVISION_INDICATOR_START, EnumRunesCode.SUBDIVISION_INDICATOR_START)\n}\n\nfunction isFitzpatrickModifier(string: string) {\n\treturn betweenInclusive(codePointFromSurrogatePair(string), EnumRunesCode.FITZPATRICK_MODIFIER_START, EnumRunesCode.FITZPATRICK_MODIFIER_END)\n}\n\nfunction isVariationSelector(string: string) {\n\treturn typeof string === \"string\" && betweenInclusive(string.charCodeAt(0), EnumRunesCode.VARIATION_MODIFIER_START, EnumRunesCode.VARIATION_MODIFIER_END)\n}\n\nfunction isDiacriticalMark(string: string) {\n\treturn typeof string === \"string\" && betweenInclusive(string.charCodeAt(0), EnumRunesCode.DIACRITICAL_MARKS_START, EnumRunesCode.DIACRITICAL_MARKS_END)\n}\n\nfunction isSupplementarySpecialpurposePlane(string: string) {\n\tconst codePoint = string.codePointAt(0)\n\treturn (typeof string === \"string\" &&\ttypeof codePoint === \"number\" && betweenInclusive(codePoint, EnumRunesCode.TAGS_START, EnumRunesCode.TAGS_END))\n}\n\nfunction isGrapheme(string: string) {\n\treturn typeof string === \"string\" && GRAPHEMES.includes(string.charCodeAt(0))\n}\n\nfunction isZeroWidthJoiner(string: string) {\n\treturn typeof string === \"string\" && string.charCodeAt(0) === EnumRunesCode.ZWJ\n}\n\nfunction codePointFromSurrogatePair(pair: string) {\n\tconst highOffset = pair.charCodeAt(0) - EnumRunesCode.HIGH_SURROGATE_START\n\tconst lowOffset = pair.charCodeAt(1) - EnumRunesCode.LOW_SURROGATE_START\n\treturn (highOffset << 10) + lowOffset + 0x10000\n}\n\nfunction betweenInclusive(value: number, lower: number, upper: number) {\n\treturn value >= lower && value <= upper\n}\n\nexport function substring(string: string, start?: number, width?: number) {\n\tconst chars = runes(string)\n\tif (start === undefined) {\n\t\treturn string\n\t}\n\tif (start >= chars.length) {\n\t\treturn \"\"\n\t}\n\tconst rest = chars.length - start\n\tconst stringWidth = width === undefined ? rest : width\n\tlet endIndex = start + stringWidth\n\tif (endIndex > (start + rest)) {\n\t\tendIndex = undefined\n\t}\n\treturn chars.slice(start, endIndex).join(\"\")\n}\n","{\n\t\"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)\": {\n\t\t\"buttons\": {\n\t\t\t\"0\": \"south\",\n\t\t\t\"1\": \"east\",\n\t\t\t\"2\": \"west\",\n\t\t\t\"3\": \"north\",\n\t\t\t\"4\": \"lshoulder\",\n\t\t\t\"5\": \"rshoulder\",\n\t\t\t\"6\": \"ltrigger\",\n\t\t\t\"7\": \"rtrigger\",\n\t\t\t\"8\": \"select\",\n\t\t\t\"9\": \"start\",\n\t\t\t\"10\": \"lstick\",\n\t\t\t\"11\": \"rstick\",\n\t\t\t\"12\": \"dpad-up\",\n\t\t\t\"13\": \"dpad-down\",\n\t\t\t\"14\": \"dpad-left\",\n\t\t\t\"15\": \"dpad-right\",\n\t\t\t\"16\": \"home\",\n\t\t\t\"17\": \"capture\"\n\t\t},\n\t\t\"sticks\": {\n\t\t\t\"left\": { \"x\": 0, \"y\": 1 },\n\t\t\t\"right\": { \"x\": 2, \"y\": 3 }\n\t\t}\n\t},\n\t\"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)\": {\n\t\t\"buttons\": {\n\t\t\t\"0\": \"south\",\n\t\t\t\"1\": \"east\",\n\t\t\t\"2\": \"west\",\n\t\t\t\"3\": \"north\",\n\t\t\t\"4\": \"lshoulder\",\n\t\t\t\"5\": \"rshoulder\",\n\t\t\t\"9\": \"select\",\n\t\t\t\"10\": \"lstick\",\n\t\t\t\"16\": \"start\"\n\t\t},\n\t\t\"sticks\": {\n\t\t\t\"left\": { \"x\": 0, \"y\": 1 }\n\t\t}\n\t},\n\t\"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)\": {\n\t\t\"buttons\": {\n\t\t\t\"0\": \"south\",\n\t\t\t\"1\": \"east\",\n\t\t\t\"2\": \"west\",\n\t\t\t\"3\": \"north\",\n\t\t\t\"4\": \"lshoulder\",\n\t\t\t\"5\": \"rshoulder\",\n\t\t\t\"9\": \"start\",\n\t\t\t\"10\": \"lstick\",\n\t\t\t\"16\": \"select\"\n\t\t},\n\t\t\"sticks\": {\n\t\t\t\"left\": { \"x\": 0, \"y\": 1 }\n\t\t}\n\t},\n\t\"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)\": {\n\t\t\"buttons\": {\n\t\t\t\"0\": \"south\",\n\t\t\t\"1\": \"east\",\n\t\t\t\"2\": \"west\",\n\t\t\t\"3\": \"north\",\n\t\t\t\"4\": \"lshoulder\",\n\t\t\t\"5\": \"rshoulder\",\n\t\t\t\"6\": \"ltrigger\",\n\t\t\t\"7\": \"rtrigger\",\n\t\t\t\"8\": \"select\",\n\t\t\t\"9\": \"start\",\n\t\t\t\"10\": \"lstick\",\n\t\t\t\"11\": \"rstick\",\n\t\t\t\"12\": \"dpad-up\",\n\t\t\t\"13\": \"dpad-down\",\n\t\t\t\"14\": \"dpad-left\",\n\t\t\t\"15\": \"dpad-right\",\n\t\t\t\"16\": \"home\",\n\t\t\t\"17\": \"capture\"\n\t\t},\n\t\t\"sticks\": {\n\t\t\t\"left\": { \"x\": 0, \"y\": 1 },\n\t\t\t\"right\": { \"x\": 2, \"y\": 3 }\n\t\t}\n\t},\n\t\"default\": {\n\t\t\"buttons\": {\n\t\t\t\"0\": \"south\",\n\t\t\t\"1\": \"east\",\n\t\t\t\"2\": \"west\",\n\t\t\t\"3\": \"north\",\n\t\t\t\"4\": \"lshoulder\",\n\t\t\t\"5\": \"rshoulder\",\n\t\t\t\"6\": \"ltrigger\",\n\t\t\t\"7\": \"rtrigger\",\n\t\t\t\"8\": \"select\",\n\t\t\t\"9\": \"start\",\n\t\t\t\"10\": \"lstick\",\n\t\t\t\"11\": \"rstick\",\n\t\t\t\"12\": \"dpad-up\",\n\t\t\t\"13\": \"dpad-down\",\n\t\t\t\"14\": \"dpad-left\",\n\t\t\t\"15\": \"dpad-right\",\n\t\t\t\"16\": \"home\"\n\t\t},\n\t\t\"sticks\": {\n\t\t\t\"left\": { \"x\": 0, \"y\": 1 },\n\t\t\t\"right\": { \"x\": 2, \"y\": 3 }\n\t\t}\n\t}\n}\n","// everything related to canvas, game loop and input\n\nimport type {\n\tCursor,\n\tKey,\n\tMouseButton,\n\tGamepadButton,\n\tGamepadStick,\n\tGamepadDef,\n\tKGamePad,\n} from \"./types\"\n\nimport {\n\tVec2,\n\tmap,\n} from \"./math\"\n\nimport {\n\tEventHandler,\n\tEventController,\n\toverload2,\n} from \"./utils\"\n\nimport GAMEPAD_MAP from \"./gamepad.json\"\n\nexport class ButtonState<T = string> {\n\tpressed: Set<T> = new Set([])\n\tpressedRepeat: Set<T> = new Set([])\n\treleased: Set<T> = new Set([])\n\tdown: Set<T> = new Set([])\n\tupdate() {\n\t\tthis.pressed.clear()\n\t\tthis.released.clear()\n\t\tthis.pressedRepeat.clear()\n\t}\n\tpress(btn: T) {\n\t\tthis.pressed.add(btn)\n\t\tthis.pressedRepeat.add(btn)\n\t\tthis.down.add(btn)\n\t}\n\tpressRepeat(btn: T) {\n\t\tthis.pressedRepeat.add(btn)\n\t}\n\trelease(btn: T) {\n\t\tthis.down.delete(btn)\n\t\tthis.pressed.delete(btn)\n\t\tthis.released.add(btn)\n\t}\n}\n\nclass GamepadState {\n\tbuttonState: ButtonState<GamepadButton> = new ButtonState()\n\tstickState: Map<GamepadStick, Vec2> = new Map()\n}\n\nclass FPSCounter {\n\tprivate dts: number[] = []\n\tprivate timer: number = 0\n\tfps: number = 0\n\ttick(dt: number) {\n\t\tthis.dts.push(dt)\n\t\tthis.timer += dt\n\t\tif (this.timer >= 1) {\n\t\t\tthis.timer = 0\n\t\t\tthis.fps = Math.round(1 / (this.dts.reduce((a, b) => a + b) / this.dts.length))\n\t\t\tthis.dts = []\n\t\t}\n\t}\n}\n\nexport default (opt: {\n\tcanvas: HTMLCanvasElement,\n\ttouchToMouse?: boolean,\n\tgamepads?: Record<string, GamepadDef>,\n\tpixelDensity?: number,\n\tmaxFPS?: number,\n}) => {\n\n\tif (!opt.canvas) {\n\t\tthrow new Error(\"Please provide a canvas\")\n\t}\n\n\tconst state = {\n\t\tcanvas: opt.canvas,\n\t\tloopID: null as null | number,\n\t\tstopped: false,\n\t\tdt: 0,\n\t\ttime: 0,\n\t\trealTime: 0,\n\t\tfpsCounter: new FPSCounter(),\n\t\ttimeScale: 1,\n\t\tskipTime: false,\n\t\tnumFrames: 0,\n\t\tmousePos: new Vec2(0),\n\t\tmouseDeltaPos: new Vec2(0),\n\t\tkeyState: new ButtonState<Key>(),\n\t\tmouseState: new ButtonState<MouseButton>(),\n\t\tmergedGamepadState: new GamepadState(),\n\t\tgamepadStates: new Map<number, GamepadState>(),\n\t\tgamepads: [] as KGamePad[],\n\t\tcharInputted: [],\n\t\tisMouseMoved: false,\n\t\tlastWidth: opt.canvas.offsetWidth,\n\t\tlastHeight: opt.canvas.offsetHeight,\n\t\tevents: new EventHandler<{\n\t\t\tmouseMove: [],\n\t\t\tmouseDown: [MouseButton],\n\t\t\tmousePress: [MouseButton],\n\t\t\tmouseRelease: [MouseButton],\n\t\t\tcharInput: [string],\n\t\t\tkeyPress: [Key],\n\t\t\tkeyDown: [Key],\n\t\t\tkeyPressRepeat: [Key],\n\t\t\tkeyRelease: [Key],\n\t\t\ttouchStart: [Vec2, Touch],\n\t\t\ttouchMove: [Vec2, Touch],\n\t\t\ttouchEnd: [Vec2, Touch],\n\t\t\tgamepadButtonDown: [string],\n\t\t\tgamepadButtonPress: [string],\n\t\t\tgamepadButtonRelease: [string],\n\t\t\tgamepadStick: [string, Vec2],\n\t\t\tgamepadConnect: [KGamePad],\n\t\t\tgamepadDisconnect: [KGamePad],\n\t\t\tscroll: [Vec2],\n\t\t\thide: [],\n\t\t\tshow: [],\n\t\t\tresize: [],\n\t\t\tinput: [],\n\t\t}>(),\n\t}\n\n\tfunction dt() {\n\t\treturn state.dt * state.timeScale\n\t}\n\n\tfunction time() {\n\t\treturn state.time\n\t}\n\n\tfunction fps() {\n\t\treturn state.fpsCounter.fps\n\t}\n\n\tfunction numFrames() {\n\t\treturn state.numFrames\n\t}\n\n\tfunction screenshot(): string {\n\t\treturn state.canvas.toDataURL()\n\t}\n\n\tfunction setCursor(c: Cursor): void {\n\t\tstate.canvas.style.cursor = c\n\t}\n\n\tfunction getCursor(): Cursor {\n\t\treturn state.canvas.style.cursor\n\t}\n\n\tfunction setCursorLocked(b: boolean): void {\n\t\tif (b) {\n\t\t\ttry {\n\t\t\t\tconst res = state.canvas.requestPointerLock() as unknown as Promise<void>\n\t\t\t\tif (res.catch) {\n\t\t\t\t\tres.catch((e) => console.error(e))\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e)\n\t\t\t}\n\t\t} else {\n\t\t\tdocument.exitPointerLock()\n\t\t}\n\t}\n\n\tfunction isCursorLocked(): boolean {\n\t\treturn !!document.pointerLockElement\n\t}\n\n\t// wrappers around full screen functions to work across browsers\n\tfunction enterFullscreen(el: HTMLElement) {\n\t\tif (el.requestFullscreen) el.requestFullscreen()\n\t\t// @ts-ignore\n\t\telse if (el.webkitRequestFullscreen) el.webkitRequestFullscreen()\n\t}\n\n\tfunction exitFullscreen() {\n\t\tif (document.exitFullscreen) document.exitFullscreen()\n\t\t// @ts-ignore\n\t\telse if (document.webkitExitFullScreen) document.webkitExitFullScreen()\n\t}\n\n\tfunction getFullscreenElement(): Element | void {\n\t\treturn document.fullscreenElement\n\t\t\t// @ts-ignore\n\t\t\t|| document.webkitFullscreenElement\n\t}\n\n\tfunction setFullscreen(f: boolean = true) {\n\t\tif (f) {\n\t\t\tenterFullscreen(state.canvas)\n\t\t} else {\n\t\t\texitFullscreen()\n\t\t}\n\t}\n\n\tfunction isFullscreen(): boolean {\n\t\treturn Boolean(getFullscreenElement())\n\t}\n\n\tfunction quit() {\n\t\tstate.stopped = true\n\t\tfor (const name in canvasEvents) {\n\t\t\tstate.canvas.removeEventListener(name, canvasEvents[name])\n\t\t}\n\t\tfor (const name in docEvents) {\n\t\t\tdocument.removeEventListener(name, docEvents[name])\n\t\t}\n\t\tfor (const name in winEvents) {\n\t\t\twindow.removeEventListener(name, winEvents[name])\n\t\t}\n\t\tresizeObserver.disconnect()\n\t}\n\n\tfunction run(action: () => void) {\n\n\t\tif (state.loopID !== null) {\n\t\t\tcancelAnimationFrame(state.loopID)\n\t\t}\n\n\t\tlet accumulatedDt = 0\n\n\t\tconst frame = (t: number) => {\n\n\t\t\tif (state.stopped) return\n\n\t\t\t// TODO: allow background actions?\n\t\t\tif (document.visibilityState !== \"visible\") {\n\t\t\t\tstate.loopID = requestAnimationFrame(frame)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst loopTime = t / 1000\n\t\t\tconst realDt = loopTime - state.realTime\n\t\t\tconst desiredDt = opt.maxFPS ? 1 / opt.maxFPS : 0\n\n\t\t\tstate.realTime = loopTime\n\t\t\taccumulatedDt += realDt\n\n\t\t\tif (accumulatedDt > desiredDt) {\n\t\t\t\tif (!state.skipTime) {\n\t\t\t\t\tstate.dt = accumulatedDt\n\t\t\t\t\tstate.time += dt()\n\t\t\t\t\tstate.fpsCounter.tick(state.dt)\n\t\t\t\t}\n\t\t\t\taccumulatedDt = 0\n\t\t\t\tstate.skipTime = false\n\t\t\t\tstate.numFrames++\n\t\t\t\tprocessInput()\n\t\t\t\taction()\n\t\t\t\tresetInput()\n\t\t\t}\n\n\t\t\tstate.loopID = requestAnimationFrame(frame)\n\n\t\t}\n\n\t\tframe(0)\n\n\t}\n\n\tfunction isTouchscreen() {\n\t\treturn (\"ontouchstart\" in window) || navigator.maxTouchPoints > 0\n\t}\n\n\tfunction mousePos(): Vec2 {\n\t\treturn state.mousePos.clone()\n\t}\n\n\tfunction mouseDeltaPos(): Vec2 {\n\t\treturn state.mouseDeltaPos.clone()\n\t}\n\n\tfunction isMousePressed(m: MouseButton = \"left\"): boolean {\n\t\treturn state.mouseState.pressed.has(m)\n\t}\n\n\tfunction isMouseDown(m: MouseButton = \"left\"): boolean {\n\t\treturn state.mouseState.down.has(m)\n\t}\n\n\tfunction isMouseReleased(m: MouseButton = \"left\"): boolean {\n\t\treturn state.mouseState.released.has(m)\n\t}\n\n\tfunction isMouseMoved(): boolean {\n\t\treturn state.isMouseMoved\n\t}\n\n\tfunction isKeyPressed(k?: Key): boolean {\n\t\treturn k === undefined\n\t\t\t? state.keyState.pressed.size > 0\n\t\t\t: state.keyState.pressed.has(k)\n\t}\n\n\tfunction isKeyPressedRepeat(k?: Key): boolean {\n\t\treturn k === undefined\n\t\t\t? state.keyState.pressedRepeat.size > 0\n\t\t\t: state.keyState.pressedRepeat.has(k)\n\t}\n\n\tfunction isKeyDown(k?: Key): boolean {\n\t\treturn k === undefined\n\t\t\t? state.keyState.down.size > 0\n\t\t\t: state.keyState.down.has(k)\n\t}\n\n\tfunction isKeyReleased(k?: Key): boolean {\n\t\treturn k === undefined\n\t\t\t? state.keyState.released.size > 0\n\t\t\t: state.keyState.released.has(k)\n\t}\n\n\tfunction isGamepadButtonPressed(btn?: GamepadButton): boolean {\n\t\treturn btn === undefined\n\t\t\t? state.mergedGamepadState.buttonState.pressed.size > 0\n\t\t\t: state.mergedGamepadState.buttonState.pressed.has(btn)\n\t}\n\n\tfunction isGamepadButtonDown(btn?: GamepadButton): boolean {\n\t\treturn btn === undefined\n\t\t\t? state.mergedGamepadState.buttonState.down.size > 0\n\t\t\t: state.mergedGamepadState.buttonState.down.has(btn)\n\t}\n\n\tfunction isGamepadButtonReleased(btn?: GamepadButton): boolean {\n\t\treturn btn === undefined\n\t\t\t? state.mergedGamepadState.buttonState.released.size > 0\n\t\t\t: state.mergedGamepadState.buttonState.released.has(btn)\n\t}\n\n\tfunction onResize(action: () => void): EventController {\n\t\treturn state.events.on(\"resize\", action)\n\t}\n\n\t// input callbacks\n\tconst onKeyDown = overload2((action: (key: Key) => void) => {\n\t\treturn state.events.on(\"keyDown\", action)\n\t}, (key: Key, action: (key: Key) => void) => {\n\t\treturn state.events.on(\"keyDown\", (k) => k === key && action(key))\n\t})\n\n\tconst onKeyPress = overload2((action: (key: Key) => void) => {\n\t\treturn state.events.on(\"keyPress\", action)\n\t}, (key: Key, action: (key: Key) => void) => {\n\t\treturn state.events.on(\"keyPress\", (k) => k === key && action(key))\n\t})\n\n\tconst onKeyPressRepeat = overload2((action: (key: Key) => void) => {\n\t\treturn state.events.on(\"keyPressRepeat\", action)\n\t}, (key: Key, action: (key: Key) => void) => {\n\t\treturn state.events.on(\"keyPressRepeat\", (k) => k === key && action(key))\n\t})\n\n\tconst onKeyRelease = overload2((action: (key: Key) => void) => {\n\t\treturn state.events.on(\"keyRelease\", action)\n\t}, (key: Key, action: (key: Key) => void) => {\n\t\treturn state.events.on(\"keyRelease\", (k) => k === key && action(key))\n\t})\n\n\tconst onMouseDown = overload2((action: (m: MouseButton) => void) => {\n\t\treturn state.events.on(\"mouseDown\", (m) => action(m))\n\t}, (mouse: MouseButton, action: (m: MouseButton) => void) => {\n\t\treturn state.events.on(\"mouseDown\", (m) => m === mouse && action(m))\n\t})\n\n\tconst onMousePress = overload2((action: (m: MouseButton) => void) => {\n\t\treturn state.events.on(\"mousePress\", (m) => action(m))\n\t}, (mouse: MouseButton, action: (m: MouseButton) => void) => {\n\t\treturn state.events.on(\"mousePress\", (m) => m === mouse && action(m))\n\t})\n\n\tconst onMouseRelease = overload2((action: (m: MouseButton) => void) => {\n\t\treturn state.events.on(\"mouseRelease\", (m) => action(m))\n\t}, (mouse: MouseButton, action: (m: MouseButton) => void) => {\n\t\treturn state.events.on(\"mouseRelease\", (m) => m === mouse && action(m))\n\t})\n\n\tfunction onMouseMove(f: (pos: Vec2, dpos: Vec2) => void): EventController {\n\t\treturn state.events.on(\"mouseMove\", () => f(mousePos(), mouseDeltaPos()))\n\t}\n\n\tfunction onCharInput(action: (ch: string) => void): EventController {\n\t\treturn state.events.on(\"charInput\", action)\n\t}\n\n\tfunction onTouchStart(f: (pos: Vec2, t: Touch) => void): EventController {\n\t\treturn state.events.on(\"touchStart\", f)\n\t}\n\n\tfunction onTouchMove(f: (pos: Vec2, t: Touch) => void): EventController {\n\t\treturn state.events.on(\"touchMove\", f)\n\t}\n\n\tfunction onTouchEnd(f: (pos: Vec2, t: Touch) => void): EventController {\n\t\treturn state.events.on(\"touchEnd\", f)\n\t}\n\n\tfunction onScroll(action: (delta: Vec2) => void): EventController {\n\t\treturn state.events.on(\"scroll\", action)\n\t}\n\n\tfunction onHide(action: () => void): EventController {\n\t\treturn state.events.on(\"hide\", action)\n\t}\n\n\tfunction onShow(action: () => void): EventController {\n\t\treturn state.events.on(\"show\", action)\n\t}\n\n\tfunction onGamepadButtonDown(btn: GamepadButton | ((btn: GamepadButton) => void), action?: (btn: GamepadButton) => void): EventController {\n\t\tif (typeof btn === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonDown\", btn)\n\t\t} else if (typeof btn === \"string\" && typeof action === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonDown\", (b) => b === btn && action(btn))\n\t\t}\n\t}\n\n\tfunction onGamepadButtonPress(btn: GamepadButton | ((btn: GamepadButton) => void), action?: (btn: GamepadButton) => void): EventController {\n\t\tif (typeof btn === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonPress\", btn)\n\t\t} else if (typeof btn === \"string\" && typeof action === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonPress\", (b) => b === btn && action(btn))\n\t\t}\n\t}\n\n\tfunction onGamepadButtonRelease(btn: GamepadButton | ((btn: GamepadButton) => void), action?: (btn: GamepadButton) => void): EventController {\n\t\tif (typeof btn === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonRelease\", btn)\n\t\t} else if (typeof btn === \"string\" && typeof action === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonRelease\", (b) => b === btn && action(btn))\n\t\t}\n\t}\n\n\tfunction onGamepadStick(stick: GamepadStick, action: (value: Vec2) => void): EventController {\n\t\treturn state.events.on(\"gamepadStick\", ((a: string, v: Vec2) => a === stick && action(v)))\n\t}\n\n\tfunction onGamepadConnect(action: (gamepad: KGamePad) => void) {\n\t\tstate.events.on(\"gamepadConnect\", action)\n\t}\n\n\tfunction onGamepadDisconnect(action: (gamepad: KGamePad) => void) {\n\t\tstate.events.on(\"gamepadDisconnect\", action)\n\t}\n\n\tfunction getGamepadStick(stick: GamepadStick): Vec2 {\n\t\treturn state.mergedGamepadState.stickState.get(stick) || new Vec2(0)\n\t}\n\n\tfunction charInputted(): string[] {\n\t\treturn [...state.charInputted]\n\t}\n\n\tfunction getGamepads(): KGamePad[] {\n\t\treturn [...state.gamepads]\n\t}\n\n\tfunction processInput() {\n\t\tstate.events.trigger(\"input\")\n\t\tstate.keyState.down.forEach((k) => state.events.trigger(\"keyDown\", k))\n\t\tstate.mouseState.down.forEach((k) => state.events.trigger(\"mouseDown\", k))\n\t\tprocessGamepad()\n\t}\n\n\tfunction resetInput() {\n\t\tstate.keyState.update()\n\t\tstate.mouseState.update()\n\t\tstate.mergedGamepadState.buttonState.update()\n\t\tstate.mergedGamepadState.stickState.forEach((v, k) => {\n\t\t\tstate.mergedGamepadState.stickState.set(k, new Vec2(0))\n\t\t})\n\t\tstate.charInputted = []\n\t\tstate.isMouseMoved = false\n\n\t\tstate.gamepadStates.forEach((s) => {\n\t\t\ts.buttonState.update()\n\t\t\ts.stickState.forEach((v, k) => {\n\t\t\t\ts.stickState.set(k, new Vec2(0))\n\t\t\t})\n\t\t})\n\t}\n\n\tfunction registerGamepad(browserGamepad: Gamepad) {\n\n\t\tconst gamepad = {\n\t\t\tindex: browserGamepad.index,\n\t\t\tisPressed: (btn: GamepadButton) => {\n\t\t\t\treturn state.gamepadStates.get(browserGamepad.index).buttonState.pressed.has(btn)\n\t\t\t},\n\t\t\tisDown: (btn: GamepadButton) => {\n\t\t\t\treturn state.gamepadStates.get(browserGamepad.index).buttonState.down.has(btn)\n\t\t\t},\n\t\t\tisReleased: (btn: GamepadButton) => {\n\t\t\t\treturn state.gamepadStates.get(browserGamepad.index).buttonState.released.has(btn)\n\t\t\t},\n\t\t\tgetStick: (stick: GamepadStick) => {\n\t\t\t\treturn state.gamepadStates.get(browserGamepad.index).stickState.get(stick)\n\t\t\t},\n\t\t}\n\n\t\tstate.gamepads.push(gamepad)\n\n\t\tstate.gamepadStates.set(browserGamepad.index, {\n\t\t\tbuttonState: new ButtonState(),\n\t\t\tstickState: new Map([\n\t\t\t\t[\"left\", new Vec2(0)],\n\t\t\t\t[\"right\", new Vec2(0)],\n\t\t\t]),\n\t\t})\n\n\t\treturn gamepad\n\n\t}\n\n\tfunction removeGamepad(gamepad: Gamepad) {\n\t\tstate.gamepads = state.gamepads.filter((g) => g.index !== gamepad.index)\n\t\tstate.gamepadStates.delete(gamepad.index)\n\t}\n\n\tfunction processGamepad() {\n\n\t\tfor (const browserGamepad of navigator.getGamepads()) {\n\t\t\tif (browserGamepad && !state.gamepadStates.has(browserGamepad.index)) {\n\t\t\t\tregisterGamepad(browserGamepad)\n\t\t\t}\n\t\t}\n\n\t\tfor (const gamepad of state.gamepads) {\n\n\t\t\tconst browserGamepad = navigator.getGamepads()[gamepad.index]\n\t\t\tconst customMap = opt.gamepads ?? {}\n\t\t\tconst map = customMap[browserGamepad.id] ?? GAMEPAD_MAP[browserGamepad.id] ?? GAMEPAD_MAP[\"default\"]\n\t\t\tconst gamepadState = state.gamepadStates.get(gamepad.index)\n\n\t\t\tfor (let i = 0; i < browserGamepad.buttons.length; i++) {\n\t\t\t\tif (browserGamepad.buttons[i].pressed) {\n\t\t\t\t\tif (!gamepadState.buttonState.down.has(map.buttons[i])) {\n\t\t\t\t\t\tstate.mergedGamepadState.buttonState.press(map.buttons[i])\n\t\t\t\t\t\tgamepadState.buttonState.press(map.buttons[i])\n\t\t\t\t\t\tstate.events.trigger(\"gamepadButtonPress\", map.buttons[i])\n\t\t\t\t\t}\n\t\t\t\t\tstate.events.trigger(\"gamepadButtonDown\", map.buttons[i])\n\t\t\t\t} else {\n\t\t\t\t\tif (gamepadState.buttonState.down.has(map.buttons[i])) {\n\t\t\t\t\t\tstate.mergedGamepadState.buttonState.release(map.buttons[i])\n\t\t\t\t\t\tgamepadState.buttonState.release(map.buttons[i])\n\t\t\t\t\t\tstate.events.trigger(\"gamepadButtonRelease\", map.buttons[i])\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const stickName in map.sticks) {\n\t\t\t\tconst stick = map.sticks[stickName]\n\t\t\t\tconst value = new Vec2(\n\t\t\t\t\tbrowserGamepad.axes[stick.x],\n\t\t\t\t\tbrowserGamepad.axes[stick.y],\n\t\t\t\t)\n\t\t\t\tgamepadState.stickState.set(stickName as GamepadStick, value)\n\t\t\t\tstate.mergedGamepadState.stickState.set(stickName as GamepadStick, value)\n\t\t\t\tstate.events.trigger(\"gamepadStick\", stickName, value)\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\ttype EventList<M> = {\n\t\t[event in keyof M]?: (event: M[event]) => void\n\t}\n\n\tconst canvasEvents: EventList<HTMLElementEventMap> = {}\n\tconst docEvents: EventList<DocumentEventMap> = {}\n\tconst winEvents: EventList<WindowEventMap> = {}\n\n\tconst pd = opt.pixelDensity || window.devicePixelRatio || 1\n\n\tcanvasEvents.mousemove = (e) => {\n\t\tconst mousePos = new Vec2(e.offsetX, e.offsetY)\n\t\tconst mouseDeltaPos = new Vec2(e.movementX, e.movementY)\n\t\tif (isFullscreen()) {\n\t\t\tconst cw = state.canvas.width / pd\n\t\t\tconst ch = state.canvas.height / pd\n\t\t\tconst ww = window.innerWidth\n\t\t\tconst wh = window.innerHeight\n\t\t\tconst rw = ww / wh\n\t\t\tconst rc = cw / ch\n\t\t\tif (rw > rc) {\n\t\t\t\tconst ratio = wh / ch\n\t\t\t\tconst offset = (ww - (cw * ratio)) / 2\n\t\t\t\tmousePos.x = map(e.offsetX - offset, 0, cw * ratio, 0, cw)\n\t\t\t\tmousePos.y = map(e.offsetY, 0, ch * ratio, 0, ch)\n\t\t\t} else {\n\t\t\t\tconst ratio = ww / cw\n\t\t\t\tconst offset = (wh - (ch * ratio)) / 2\n\t\t\t\tmousePos.x = map(e.offsetX , 0, cw * ratio, 0, cw)\n\t\t\t\tmousePos.y = map(e.offsetY - offset, 0, ch * ratio, 0, ch)\n\t\t\t}\n\t\t}\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tstate.isMouseMoved = true\n\t\t\tstate.mousePos = mousePos\n\t\t\tstate.mouseDeltaPos = mouseDeltaPos\n\t\t\tstate.events.trigger(\"mouseMove\")\n\t\t})\n\t}\n\n\tconst MOUSE_BUTTONS: MouseButton[] = [\n\t\t\"left\",\n\t\t\"middle\",\n\t\t\"right\",\n\t\t\"back\",\n\t\t\"forward\",\n\t]\n\n\tcanvasEvents.mousedown = (e) => {\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tconst m = MOUSE_BUTTONS[e.button]\n\t\t\tif (!m) return\n\t\t\tstate.mouseState.press(m)\n\t\t\tstate.events.trigger(\"mousePress\", m)\n\t\t})\n\t}\n\n\tcanvasEvents.mouseup = (e) => {\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tconst m = MOUSE_BUTTONS[e.button]\n\t\t\tif (!m) return\n\t\t\tstate.mouseState.release(m)\n\t\t\tstate.events.trigger(\"mouseRelease\", m)\n\t\t})\n\t}\n\n\tconst PREVENT_DEFAULT_KEYS = new Set([\n\t\t\" \",\n\t\t\"ArrowLeft\",\n\t\t\"ArrowRight\",\n\t\t\"ArrowUp\",\n\t\t\"ArrowDown\",\n\t\t\"Tab\",\n\t])\n\n\t// translate these key names to a simpler version\n\tconst KEY_ALIAS = {\n\t\t\"ArrowLeft\": \"left\",\n\t\t\"ArrowRight\": \"right\",\n\t\t\"ArrowUp\": \"up\",\n\t\t\"ArrowDown\": \"down\",\n\t\t\" \": \"space\",\n\t}\n\n\tcanvasEvents.keydown = (e) => {\n\t\tif (PREVENT_DEFAULT_KEYS.has(e.key)) {\n\t\t\te.preventDefault()\n\t\t}\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tconst k = KEY_ALIAS[e.key] || e.key.toLowerCase()\n\t\t\tif (k.length === 1) {\n\t\t\t\tstate.events.trigger(\"charInput\", k)\n\t\t\t\tstate.charInputted.push(k)\n\t\t\t} else if (k === \"space\") {\n\t\t\t\tstate.events.trigger(\"charInput\", \" \")\n\t\t\t\tstate.charInputted.push(\" \")\n\t\t\t}\n\t\t\tif (e.repeat) {\n\t\t\t\tstate.keyState.pressRepeat(k)\n\t\t\t\tstate.events.trigger(\"keyPressRepeat\", k)\n\t\t\t} else {\n\t\t\t\tstate.keyState.press(k)\n\t\t\t\tstate.events.trigger(\"keyPressRepeat\", k)\n\t\t\t\tstate.events.trigger(\"keyPress\", k)\n\t\t\t}\n\t\t})\n\t}\n\n\tcanvasEvents.keyup = (e) => {\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tconst k = KEY_ALIAS[e.key] || e.key.toLowerCase()\n\t\t\tstate.keyState.release(k)\n\t\t\tstate.events.trigger(\"keyRelease\", k)\n\t\t})\n\t}\n\n\t// TODO: handle all touches at once instead of sequentially\n\tcanvasEvents.touchstart = (e) => {\n\t\t// disable long tap context menu\n\t\te.preventDefault()\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tconst touches = [...e.changedTouches]\n\t\t\tconst box = state.canvas.getBoundingClientRect()\n\t\t\tif (opt.touchToMouse !== false) {\n\t\t\t\tstate.mousePos = new Vec2(\n\t\t\t\t\ttouches[0].clientX - box.x,\n\t\t\t\t\ttouches[0].clientY - box.y,\n\t\t\t\t)\n\t\t\t\tstate.mouseState.press(\"left\")\n\t\t\t\tstate.events.trigger(\"mousePress\", \"left\")\n\t\t\t}\n\t\t\ttouches.forEach((t) => {\n\t\t\t\tstate.events.trigger(\n\t\t\t\t\t\"touchStart\",\n\t\t\t\t\tnew Vec2(t.clientX - box.x, t.clientY - box.y),\n\t\t\t\t\tt,\n\t\t\t\t)\n\t\t\t})\n\t\t})\n\t}\n\n\tcanvasEvents.touchmove = (e) => {\n\t\t// disable scrolling\n\t\te.preventDefault()\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tconst touches = [...e.changedTouches]\n\t\t\tconst box = state.canvas.getBoundingClientRect()\n\t\t\tif (opt.touchToMouse !== false) {\n\t\t\t\tstate.mousePos = new Vec2(\n\t\t\t\t\ttouches[0].clientX - box.x,\n\t\t\t\t\ttouches[0].clientY - box.y,\n\t\t\t\t)\n\t\t\t\tstate.events.trigger(\"mouseMove\")\n\t\t\t}\n\t\t\ttouches.forEach((t) => {\n\t\t\t\tstate.events.trigger(\n\t\t\t\t\t\"touchMove\",\n\t\t\t\t\tnew Vec2(t.clientX - box.x, t.clientY - box.y),\n\t\t\t\t\tt,\n\t\t\t\t)\n\t\t\t})\n\t\t})\n\t}\n\n\tcanvasEvents.touchend = (e) => {\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tconst touches = [...e.changedTouches]\n\t\t\tconst box = state.canvas.getBoundingClientRect()\n\t\t\tif (opt.touchToMouse !== false) {\n\t\t\t\tstate.mousePos = new Vec2(\n\t\t\t\t\ttouches[0].clientX - box.x,\n\t\t\t\t\ttouches[0].clientY - box.y,\n\t\t\t\t)\n\t\t\t\tstate.mouseState.release(\"left\")\n\t\t\t\tstate.events.trigger(\"mouseRelease\", \"left\")\n\t\t\t}\n\t\t\ttouches.forEach((t) => {\n\t\t\t\tstate.events.trigger(\n\t\t\t\t\t\"touchEnd\",\n\t\t\t\t\tnew Vec2(t.clientX - box.x, t.clientY - box.y),\n\t\t\t\t\tt,\n\t\t\t\t)\n\t\t\t})\n\t\t})\n\t}\n\n\tcanvasEvents.touchcancel = (e) => {\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tconst touches = [...e.changedTouches]\n\t\t\tconst box = state.canvas.getBoundingClientRect()\n\t\t\tif (opt.touchToMouse !== false) {\n\t\t\t\tstate.mousePos = new Vec2(\n\t\t\t\t\ttouches[0].clientX - box.x,\n\t\t\t\t\ttouches[0].clientY - box.y,\n\t\t\t\t)\n\t\t\t\tstate.mouseState.release(\"left\")\n\t\t\t\tstate.events.trigger(\"mouseRelease\", \"left\")\n\t\t\t}\n\t\t\ttouches.forEach((t) => {\n\t\t\t\tstate.events.trigger(\n\t\t\t\t\t\"touchEnd\",\n\t\t\t\t\tnew Vec2(t.clientX - box.x, t.clientY - box.y),\n\t\t\t\t\tt,\n\t\t\t\t)\n\t\t\t})\n\t\t})\n\t}\n\n\t// TODO: option to not prevent default?\n\tcanvasEvents.wheel = (e) => {\n\t\te.preventDefault()\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tstate.events.trigger(\"scroll\", new Vec2(e.deltaX, e.deltaY))\n\t\t})\n\t}\n\n\tcanvasEvents.contextmenu = (e) => e.preventDefault()\n\n\tdocEvents.visibilitychange = () => {\n\t\tif (document.visibilityState === \"visible\") {\n\t\t\t// prevent a surge of dt when switch back after the tab being hidden for a while\n\t\t\tstate.skipTime = true\n\t\t\tstate.events.trigger(\"show\")\n\t\t} else {\n\t\t\tstate.events.trigger(\"hide\")\n\t\t}\n\t}\n\n\twinEvents.gamepadconnected = (e) => {\n\t\tconst kbGamepad = registerGamepad(e.gamepad)\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tstate.events.trigger(\"gamepadConnect\", kbGamepad)\n\t\t})\n\t}\n\n\twinEvents.gamepaddisconnected = (e) => {\n\t\tconst kbGamepad = getGamepads().filter((g) => g.index === e.gamepad.index)[0]\n\t\tremoveGamepad(e.gamepad)\n\t\tstate.events.onOnce(\"input\", () => {\n\t\t\tstate.events.trigger(\"gamepadDisconnect\", kbGamepad)\n\t\t})\n\t}\n\n\tfor (const name in canvasEvents) {\n\t\tstate.canvas.addEventListener(name, canvasEvents[name])\n\t}\n\n\tfor (const name in docEvents) {\n\t\tdocument.addEventListener(name, docEvents[name])\n\t}\n\n\tfor (const name in winEvents) {\n\t\twindow.addEventListener(name, winEvents[name])\n\t}\n\n\tconst resizeObserver = new ResizeObserver((entries) => {\n\t\tfor (const entry of entries) {\n\t\t\tif (entry.target !== state.canvas) continue\n\t\t\tif (\n\t\t\t\tstate.lastWidth === state.canvas.offsetWidth\n\t\t\t\t&& state.lastHeight === state.canvas.offsetHeight\n\t\t\t) return\n\t\t\tstate.lastWidth = state.canvas.offsetWidth\n\t\t\tstate.lastHeight = state.canvas.offsetHeight\n\t\t\tstate.events.onOnce(\"input\", () => {\n\t\t\t\tstate.events.trigger(\"resize\")\n\t\t\t})\n\t\t}\n\t})\n\n\tresizeObserver.observe(state.canvas)\n\n\treturn {\n\t\tdt,\n\t\ttime,\n\t\trun,\n\t\tcanvas: state.canvas,\n\t\tfps,\n\t\tnumFrames,\n\t\tquit,\n\t\tsetFullscreen,\n\t\tisFullscreen,\n\t\tsetCursor,\n\t\tscreenshot,\n\t\tgetGamepads,\n\t\tgetCursor,\n\t\tsetCursorLocked,\n\t\tisCursorLocked,\n\t\tisTouchscreen,\n\t\tmousePos,\n\t\tmouseDeltaPos,\n\t\tisKeyDown,\n\t\tisKeyPressed,\n\t\tisKeyPressedRepeat,\n\t\tisKeyReleased,\n\t\tisMouseDown,\n\t\tisMousePressed,\n\t\tisMouseReleased,\n\t\tisMouseMoved,\n\t\tisGamepadButtonPressed,\n\t\tisGamepadButtonDown,\n\t\tisGamepadButtonReleased,\n\t\tgetGamepadStick,\n\t\tcharInputted,\n\t\tonResize,\n\t\tonKeyDown,\n\t\tonKeyPress,\n\t\tonKeyPressRepeat,\n\t\tonKeyRelease,\n\t\tonMouseDown,\n\t\tonMousePress,\n\t\tonMouseRelease,\n\t\tonMouseMove,\n\t\tonCharInput,\n\t\tonTouchStart,\n\t\tonTouchMove,\n\t\tonTouchEnd,\n\t\tonScroll,\n\t\tonHide,\n\t\tonShow,\n\t\tonGamepadButtonDown,\n\t\tonGamepadButtonPress,\n\t\tonGamepadButtonRelease,\n\t\tonGamepadStick,\n\t\tonGamepadConnect,\n\t\tonGamepadDisconnect,\n\t\tevents: state.events,\n\t}\n\n}\n","import type {\n\tImageSource,\n\tTextureOpt,\n\tTexFilter,\n\tUniform,\n} from \"./types\"\n\nimport {\n\tMat4,\n\tVec2,\n\tColor,\n} from \"./math\"\n\nimport {\n\tdeepEq,\n} from \"./utils\"\n\nexport type GfxCtx = ReturnType<typeof initGfx>\n\nexport class Texture {\n\n\tctx: GfxCtx\n\tsrc: null | ImageSource = null\n\tglTex: WebGLTexture\n\twidth: number\n\theight: number\n\n\tconstructor(ctx: GfxCtx, w: number, h: number, opt: TextureOpt = {}) {\n\n\t\tthis.ctx = ctx\n\t\tconst gl = ctx.gl\n\t\tthis.glTex = ctx.gl.createTexture()\n\t\tctx.onDestroy(() => this.free())\n\n\t\tthis.width = w\n\t\tthis.height = h\n\n\t\t// TODO: no default\n\t\tconst filter = {\n\t\t\t\"linear\": gl.LINEAR,\n\t\t\t\"nearest\": gl.NEAREST,\n\t\t}[opt.filter ?? ctx.opts.texFilter] ?? gl.NEAREST\n\n\t\tconst wrap = {\n\t\t\t\"repeat\": gl.REPEAT,\n\t\t\t\"clampToEadge\": gl.CLAMP_TO_EDGE,\n\t\t}[opt.wrap] ?? gl.CLAMP_TO_EDGE\n\n\t\tthis.bind()\n\n\t\tif (w && h) {\n\t\t\tgl.texImage2D(\n\t\t\t\tgl.TEXTURE_2D,\n\t\t\t\t0, gl.RGBA,\n\t\t\t\tw,\n\t\t\t\th,\n\t\t\t\t0,\n\t\t\t\tgl.RGBA,\n\t\t\t\tgl.UNSIGNED_BYTE,\n\t\t\t\tnull,\n\t\t\t)\n\t\t}\n\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter)\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter)\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrap)\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrap)\n\t\tthis.unbind()\n\n\t}\n\n\tstatic fromImage(ctx: GfxCtx, img: ImageSource, opt: TextureOpt = {}): Texture {\n\t\tconst tex = new Texture(ctx, img.width, img.height, opt)\n\t\ttex.update(img)\n\t\ttex.src = img\n\t\treturn tex\n\t}\n\n\tupdate(img: ImageSource, x = 0, y = 0) {\n\t\tconst gl = this.ctx.gl\n\t\tthis.bind()\n\t\tgl.texSubImage2D(gl.TEXTURE_2D, 0, x, y, gl.RGBA, gl.UNSIGNED_BYTE, img)\n\t\tthis.unbind()\n\t}\n\n\tbind() {\n\t\tthis.ctx.pushTexture2D(this.glTex)\n\t}\n\n\tunbind() {\n\t\tthis.ctx.popTexture2D()\n\t}\n\n\tfree() {\n\t\tthis.ctx.gl.deleteTexture(this.glTex)\n\t}\n\n}\n\nexport class FrameBuffer {\n\n\tctx: GfxCtx\n\ttex: Texture\n\tglFramebuffer: WebGLFramebuffer\n\tglRenderbuffer: WebGLRenderbuffer\n\n\tconstructor(ctx: GfxCtx, w: number, h: number, opt: TextureOpt = {}) {\n\n\t\tthis.ctx = ctx\n\t\tconst gl = ctx.gl\n\t\tctx.onDestroy(() => this.free())\n\t\tthis.tex = new Texture(ctx, w, h, opt)\n\t\tthis.glFramebuffer = gl.createFramebuffer()\n\t\tthis.glRenderbuffer = gl.createRenderbuffer()\n\t\tthis.bind()\n\t\tgl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_STENCIL, w, h)\n\t\tgl.framebufferTexture2D(\n\t\t\tgl.FRAMEBUFFER,\n\t\t\tgl.COLOR_ATTACHMENT0,\n\t\t\tgl.TEXTURE_2D,\n\t\t\tthis.tex.glTex,\n\t\t\t0,\n\t\t)\n\t\tgl.framebufferRenderbuffer(\n\t\t\tgl.FRAMEBUFFER,\n\t\t\tgl.DEPTH_STENCIL_ATTACHMENT,\n\t\t\tgl.RENDERBUFFER,\n\t\t\tthis.glRenderbuffer,\n\t\t)\n\t\tthis.unbind()\n\t}\n\n\tget width() {\n\t\treturn this.tex.width\n\t}\n\n\tget height() {\n\t\treturn this.tex.height\n\t}\n\n\ttoImageData() {\n\t\tconst gl = this.ctx.gl\n\t\tconst data = new Uint8ClampedArray(this.width * this.height * 4)\n\t\tthis.bind()\n\t\tgl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, data)\n\t\tthis.unbind()\n\t\t// flip vertically\n\t\tconst bytesPerRow = this.width * 4\n\t\tconst temp = new Uint8Array(bytesPerRow)\n\t\tfor (let y = 0; y < (this.height / 2 | 0); y++) {\n\t\t\tconst topOffset = y * bytesPerRow\n\t\t\tconst bottomOffset = (this.height - y - 1) * bytesPerRow\n\t\t\ttemp.set(data.subarray(topOffset, topOffset + bytesPerRow))\n\t\t\tdata.copyWithin(topOffset, bottomOffset, bottomOffset + bytesPerRow)\n\t\t\tdata.set(temp, bottomOffset)\n\t\t}\n\t\treturn new ImageData(data, this.width, this.height)\n\t}\n\n\ttoDataURL() {\n\t\tconst canvas = document.createElement(\"canvas\")\n\t\tconst ctx = canvas.getContext(\"2d\")\n\t\tcanvas.width = this.width\n\t\tcanvas.height = this.height\n\t\tctx.putImageData(this.toImageData(), 0, 0)\n\t\treturn canvas.toDataURL()\n\t}\n\n\tdraw(action: () => void) {\n\t\tthis.bind()\n\t\taction()\n\t\tthis.unbind()\n\t}\n\n\tbind() {\n\t\tthis.ctx.pushFramebuffer(this.glFramebuffer)\n\t\tthis.ctx.pushRenderbuffer(this.glRenderbuffer)\n\t\tthis.ctx.pushViewport({ x: 0, y: 0, w: this.width, h: this.height })\n\t}\n\n\tunbind() {\n\t\tthis.ctx.popFramebuffer()\n\t\tthis.ctx.popRenderbuffer()\n\t\tthis.ctx.popViewport()\n\t}\n\n\tfree() {\n\t\tconst gl = this.ctx.gl\n\t\tgl.deleteFramebuffer(this.glFramebuffer)\n\t\tgl.deleteRenderbuffer(this.glRenderbuffer)\n\t\tthis.tex.free()\n\t}\n\n}\n\nexport class Shader {\n\n\tctx: GfxCtx\n\tglProgram: WebGLProgram\n\n\tconstructor(ctx: GfxCtx, vert: string, frag: string, attribs: string[]) {\n\n\t\tthis.ctx = ctx\n\t\tctx.onDestroy(() => this.free())\n\n\t\tconst gl = ctx.gl\n\t\tconst vertShader = gl.createShader(gl.VERTEX_SHADER)\n\t\tconst fragShader = gl.createShader(gl.FRAGMENT_SHADER)\n\n\t\tgl.shaderSource(vertShader, vert)\n\t\tgl.shaderSource(fragShader, frag)\n\t\tgl.compileShader(vertShader)\n\t\tgl.compileShader(fragShader)\n\n\t\tconst prog = gl.createProgram()\n\t\tthis.glProgram = prog\n\n\t\tgl.attachShader(prog, vertShader)\n\t\tgl.attachShader(prog, fragShader)\n\n\t\tattribs.forEach((attrib, i) => gl.bindAttribLocation(prog, i, attrib))\n\n\t\tgl.linkProgram(prog)\n\n\t\tif (!gl.getProgramParameter(prog, gl.LINK_STATUS)) {\n\t\t\tconst vertError = gl.getShaderInfoLog(vertShader)\n\t\t\tif (vertError) throw new Error(\"VERTEX SHADER \" + vertError)\n\t\t\tconst fragError = gl.getShaderInfoLog(fragShader)\n\t\t\tif (fragError) throw new Error(\"FRAGMENT SHADER \" + fragError)\n\t\t}\n\n\t\tgl.deleteShader(vertShader)\n\t\tgl.deleteShader(fragShader)\n\n\t}\n\n\tbind() {\n\t\tthis.ctx.pushProgram(this.glProgram)\n\t}\n\n\tunbind() {\n\t\tthis.ctx.popProgram()\n\t}\n\n\tsend(uniform: Uniform) {\n\t\tconst gl = this.ctx.gl\n\t\tfor (const name in uniform) {\n\t\t\tconst val = uniform[name]\n\t\t\tconst loc = gl.getUniformLocation(this.glProgram, name)\n\t\t\tif (typeof val === \"number\") {\n\t\t\t\tgl.uniform1f(loc, val)\n\t\t\t} else if (val instanceof Mat4) {\n\t\t\t\tgl.uniformMatrix4fv(loc, false, new Float32Array(val.m))\n\t\t\t} else if (val instanceof Color) {\n\t\t\t\tgl.uniform3f(loc, val.r, val.g, val.b)\n\t\t\t} else if (val instanceof Vec2) {\n\t\t\t\tgl.uniform2f(loc, val.x, val.y)\n\t\t\t}\n\t\t}\n\t}\n\n\tfree() {\n\t\tthis.ctx.gl.deleteProgram(this.glProgram)\n\t}\n\n}\n\nexport type VertexFormat = {\n\tname: string,\n\tsize: number,\n}[]\n\nexport class BatchRenderer {\n\n\tctx: GfxCtx\n\n\tglVBuf: WebGLBuffer\n\tglIBuf: WebGLBuffer\n\tvqueue: number[] = []\n\tiqueue: number[] = []\n\tstride: number\n\tmaxVertices: number\n\tmaxIndices: number\n\n\tvertexFormat: VertexFormat\n\tnumDraws: number = 0\n\n\tcurPrimitive: GLenum | null = null\n\tcurTex: Texture | null = null\n\tcurShader: Shader | null = null\n\tcurUniform: Uniform = {}\n\n\tconstructor(ctx: GfxCtx, format: VertexFormat, maxVertices: number, maxIndices: number) {\n\n\t\tconst gl = ctx.gl\n\n\t\tthis.vertexFormat = format\n\t\tthis.ctx = ctx\n\t\tthis.stride = format.reduce((sum, f) => sum + f.size, 0)\n\t\tthis.maxVertices = maxVertices\n\t\tthis.maxIndices = maxIndices\n\n\t\tthis.glVBuf = gl.createBuffer()\n\t\tctx.pushArrayBuffer(this.glVBuf)\n\t\tgl.bufferData(gl.ARRAY_BUFFER, maxVertices * 4, gl.DYNAMIC_DRAW)\n\t\tctx.popArrayBuffer()\n\n\t\tthis.glIBuf = gl.createBuffer()\n\t\tctx.pushElementArrayBuffer(this.glIBuf)\n\t\tgl.bufferData(gl.ELEMENT_ARRAY_BUFFER, maxIndices * 4, gl.DYNAMIC_DRAW)\n\t\tctx.popElementArrayBuffer()\n\n\t}\n\n\tpush(\n\t\tprimitive: GLenum,\n\t\tverts: number[],\n\t\tindices: number[],\n\t\tshader: Shader,\n\t\ttex: Texture | null = null,\n\t\tuniform: Uniform = {},\n\t) {\n\t\tif (\n\t\t\tprimitive !== this.curPrimitive\n\t\t\t|| tex !== this.curTex\n\t\t\t|| shader !== this.curShader\n\t\t\t|| !deepEq(this.curUniform, uniform)\n\t\t\t|| this.vqueue.length + verts.length * this.stride > this.maxVertices\n\t\t\t|| this.iqueue.length + indices.length > this.maxIndices\n\t\t) {\n\t\t\tthis.flush()\n\t\t}\n\t\tconst indexOffset = this.vqueue.length / this.stride\n\t\tfor (const v of verts) {\n\t\t\tthis.vqueue.push(v)\n\t\t}\n\t\tfor (const i of indices) {\n\t\t\tthis.iqueue.push(i + indexOffset)\n\t\t}\n\t\tthis.curPrimitive = primitive\n\t\tthis.curShader = shader\n\t\tthis.curTex = tex\n\t\tthis.curUniform = uniform\n\t}\n\n\tflush() {\n\n\t\tif (\n\t\t\t!this.curPrimitive\n\t\t\t|| !this.curShader\n\t\t\t|| this.vqueue.length === 0\n\t\t\t|| this.iqueue.length === 0\n\t\t) {\n\t\t\treturn\n\t\t}\n\n\t\tconst gl = this.ctx.gl\n\n\t\tthis.ctx.pushArrayBuffer(this.glVBuf)\n\t\tgl.bufferSubData(gl.ARRAY_BUFFER, 0, new Float32Array(this.vqueue))\n\t\tthis.ctx.pushElementArrayBuffer(this.glIBuf)\n\t\tgl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER, 0, new Uint16Array(this.iqueue))\n\t\tthis.ctx.setVertexFormat(this.vertexFormat)\n\t\tthis.curShader.bind()\n\t\tthis.curShader.send(this.curUniform)\n\t\tthis.curTex?.bind()\n\t\tgl.drawElements(this.curPrimitive, this.iqueue.length, gl.UNSIGNED_SHORT, 0)\n\t\tthis.curTex?.unbind()\n\t\tthis.curShader.unbind()\n\n\t\tthis.ctx.popArrayBuffer()\n\t\tthis.ctx.popElementArrayBuffer()\n\n\t\tthis.vqueue = []\n\t\tthis.iqueue = []\n\t\tthis.numDraws++\n\n\t}\n\n\tfree() {\n\t\tconst gl = this.ctx.gl\n\t\tgl.deleteBuffer(this.glVBuf)\n\t\tgl.deleteBuffer(this.glIBuf)\n\t}\n\n}\n\nexport class Mesh {\n\n\tctx: GfxCtx\n\tglVBuf: WebGLBuffer\n\tglIBuf: WebGLBuffer\n\tvertexFormat: VertexFormat\n\tcount: number\n\n\tconstructor(ctx: GfxCtx, format: VertexFormat, verts: number[], indices: number[]) {\n\n\t\tconst gl = ctx.gl\n\n\t\tthis.vertexFormat = format\n\t\tthis.ctx = ctx\n\n\t\tthis.glVBuf = gl.createBuffer()\n\t\tctx.pushArrayBuffer(this.glVBuf)\n\t\tgl.bufferData(gl.ARRAY_BUFFER, new Float32Array(verts), gl.STATIC_DRAW)\n\t\tctx.popArrayBuffer()\n\n\t\tthis.glIBuf = gl.createBuffer()\n\t\tctx.pushElementArrayBuffer(this.glIBuf)\n\t\tgl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices), gl.STATIC_DRAW)\n\t\tctx.popElementArrayBuffer()\n\n\t\tthis.count = indices.length\n\n\t}\n\n\tdraw(primitive?: GLenum) {\n\t\tconst gl = this.ctx.gl\n\t\tthis.ctx.pushArrayBuffer(this.glVBuf)\n\t\tthis.ctx.pushElementArrayBuffer(this.glIBuf)\n\t\tthis.ctx.setVertexFormat(this.vertexFormat)\n\t\tgl.drawElements(primitive ?? gl.TRIANGLES, this.count, gl.UNSIGNED_SHORT, 0)\n\t\tthis.ctx.popArrayBuffer()\n\t\tthis.ctx.popElementArrayBuffer()\n\t}\n\n\tfree() {\n\t\tconst gl = this.ctx.gl\n\t\tgl.deleteBuffer(this.glVBuf)\n\t\tgl.deleteBuffer(this.glIBuf)\n\t}\n\n\n}\n\nfunction genStack<T>(setFunc: (item: T) => void) {\n\tconst stack: T[] = []\n\tconst push = (item: T) => {\n\t\tstack.push(item)\n\t\tsetFunc(item)\n\t}\n\tconst pop = () => {\n\t\tstack.pop()\n\t\tsetFunc(cur() ?? null)\n\t}\n\tconst cur = () => stack[stack.length - 1]\n\treturn [push, pop, cur] as const\n}\n\nexport default function initGfx(gl: WebGLRenderingContext, opts: {\n\ttexFilter?: TexFilter,\n} = {}) {\n\n\tconst gc: Array<() => void> = []\n\n\tfunction onDestroy(action) {\n\t\tgc.push(action)\n\t}\n\n\tfunction destroy() {\n\t\tgc.forEach((action) => action())\n\t\tgl.getExtension(\"WEBGL_lose_context\").loseContext()\n\t}\n\n\tlet curVertexFormat = null\n\n\tfunction setVertexFormat(fmt: VertexFormat) {\n\t\tif (deepEq(fmt, curVertexFormat)) return\n\t\tcurVertexFormat = fmt\n\t\tconst stride = fmt.reduce((sum, f) => sum + f.size, 0)\n\t\tfmt.reduce((offset, f, i) => {\n\t\t\tgl.vertexAttribPointer(i, f.size, gl.FLOAT, false, stride * 4, offset)\n\t\t\tgl.enableVertexAttribArray(i)\n\t\t\treturn offset + f.size * 4\n\t\t}, 0)\n\t}\n\n\tconst [ pushTexture2D, popTexture2D ] =\n\t\tgenStack<WebGLTexture>((t) => gl.bindTexture(gl.TEXTURE_2D, t))\n\n\tconst [ pushArrayBuffer, popArrayBuffer ] =\n\t\tgenStack<WebGLBuffer>((b) => gl.bindBuffer(gl.ARRAY_BUFFER, b))\n\n\tconst [ pushElementArrayBuffer, popElementArrayBuffer ] =\n\t\tgenStack<WebGLBuffer>((b) => gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, b))\n\n\tconst [ pushFramebuffer, popFramebuffer ] =\n\t\tgenStack<WebGLFramebuffer>((b) => gl.bindFramebuffer(gl.FRAMEBUFFER, b))\n\n\tconst [ pushRenderbuffer, popRenderbuffer ] =\n\t\tgenStack<WebGLRenderbuffer>((b) => gl.bindRenderbuffer(gl.RENDERBUFFER, b))\n\n\tconst [ pushViewport, popViewport ] =\n\t\tgenStack<{ x: number, y: number, w: number, h: number }>(({ x, y, w, h }) => {\n\t\t\tgl.viewport(x, y, w, h)\n\t\t})\n\n\tconst [ pushProgram, popProgram ] = genStack<WebGLProgram>((p) => gl.useProgram(p))\n\n\tpushViewport({ x: 0, y: 0, w: gl.drawingBufferWidth, h: gl.drawingBufferHeight })\n\n\treturn {\n\t\tgl,\n\t\topts,\n\t\tonDestroy,\n\t\tdestroy,\n\t\tpushTexture2D,\n\t\tpopTexture2D,\n\t\tpushArrayBuffer,\n\t\tpopArrayBuffer,\n\t\tpushElementArrayBuffer,\n\t\tpopElementArrayBuffer,\n\t\tpushFramebuffer,\n\t\tpopFramebuffer,\n\t\tpushRenderbuffer,\n\t\tpopRenderbuffer,\n\t\tpushViewport,\n\t\tpopViewport,\n\t\tpushProgram,\n\t\tpopProgram,\n\t\tsetVertexFormat,\n\t}\n\n}\n","import {\n\tEvent,\n} from \"./utils\"\n\nexport class Asset<D> {\n\tloaded: boolean = false\n\tdata: D | null = null\n\terror: Error | null = null\n\tprivate onLoadEvents: Event<[D]> = new Event()\n\tprivate onErrorEvents: Event<[Error]> = new Event()\n\tprivate onFinishEvents: Event<[]> = new Event()\n\tconstructor(loader: Promise<D>) {\n\t\tloader.then((data) => {\n\t\t\tthis.data = data\n\t\t\tthis.onLoadEvents.trigger(data)\n\t\t}).catch((err) => {\n\t\t\tthis.error = err\n\t\t\tif (this.onErrorEvents.numListeners() > 0) {\n\t\t\t\tthis.onErrorEvents.trigger(err)\n\t\t\t} else {\n\t\t\t\tthrow err\n\t\t\t}\n\t\t}).finally(() => {\n\t\t\tthis.onFinishEvents.trigger()\n\t\t\tthis.loaded = true\n\t\t})\n\t}\n\tstatic loaded<D>(data: D): Asset<D> {\n\t\tconst asset = new Asset(Promise.resolve(data)) as Asset<D>\n\t\tasset.data = data\n\t\tasset.loaded = true\n\t\treturn asset\n\t}\n\tonLoad(action: (data: D) => void) {\n\t\tif (this.loaded && this.data) {\n\t\t\taction(this.data)\n\t\t} else {\n\t\t\tthis.onLoadEvents.add(action)\n\t\t}\n\t\treturn this\n\t}\n\tonError(action: (err: Error) => void) {\n\t\tif (this.loaded && this.error) {\n\t\t\taction(this.error)\n\t\t} else {\n\t\t\tthis.onErrorEvents.add(action)\n\t\t}\n\t\treturn this\n\t}\n\tonFinish(action: () => void) {\n\t\tif (this.loaded) {\n\t\t\taction()\n\t\t} else {\n\t\t\tthis.onFinishEvents.add(action)\n\t\t}\n\t\treturn this\n\t}\n\tthen(action: (data: D) => void): Asset<D> {\n\t\treturn this.onLoad(action)\n\t}\n\tcatch(action: (err: Error) => void): Asset<D> {\n\t\treturn this.onError(action)\n\t}\n\tfinally(action: () => void): Asset<D> {\n\t\treturn this.onFinish(action)\n\t}\n}\n\nexport class AssetBucket<D> {\n\tassets: Map<string, Asset<D>> = new Map()\n\tlastUID: number = 0\n\tadd(name: string | null, loader: Promise<D>): Asset<D> {\n\t\t// if user don't provide a name we use a generated one\n\t\tconst id = name ?? (this.lastUID++ + \"\")\n\t\tconst asset = new Asset(loader)\n\t\tthis.assets.set(id, asset)\n\t\treturn asset\n\t}\n\taddLoaded(name: string | null, data: D): Asset<D> {\n\t\tconst id = name ?? (this.lastUID++ + \"\")\n\t\tconst asset = Asset.loaded(data)\n\t\tthis.assets.set(id, asset)\n\t\treturn asset\n\t}\n\tget(handle: string): Asset<D> | void {\n\t\treturn this.assets.get(handle)\n\t}\n\tprogress(): number {\n\t\tif (this.assets.size === 0) {\n\t\t\treturn 1\n\t\t}\n\t\tlet loaded = 0\n\t\tthis.assets.forEach((asset) => {\n\t\t\tif (asset.loaded) {\n\t\t\t\tloaded++\n\t\t\t}\n\t\t})\n\t\treturn loaded / this.assets.size\n\t}\n}\n\nexport function fetchURL(url: string) {\n\treturn fetch(url)\n\t\t.then((res) => {\n\t\t\tif (!res.ok) throw new Error(`Failed to fetch \"${url}\"`)\n\t\t\treturn res\n\t\t})\n}\n\nexport function fetchJSON(path: string) {\n\treturn fetchURL(path).then((res) => res.json())\n}\n\nexport function fetchText(path: string) {\n\treturn fetchURL(path).then((res) => res.text())\n}\n\nexport function fetchArrayBuffer(path: string) {\n\treturn fetchURL(path).then((res) => res.arrayBuffer())\n}\n\n// wrapper around image loader to get a Promise\nexport function loadImg(src: string): Promise<HTMLImageElement> {\n\tconst img = new Image()\n\timg.crossOrigin = \"anonymous\"\n\timg.src = src\n\treturn new Promise<HTMLImageElement>((resolve, reject) => {\n\t\timg.onload = () => resolve(img)\n\t\timg.onerror = () => reject(new Error(`Failed to load image from \"${src}\"`))\n\t})\n}\n","// https://easings.net/\nconst c1 = 1.70158\nconst c2 = c1 * 1.525\nconst c3 = c1 + 1\nconst c4 = (2 * Math.PI) / 3\nconst c5 = (2 * Math.PI) / 4.5\n\nconst easings = {\n\tlinear: (x) => x,\n\teaseInSine: (x) => 1 - Math.cos((x * Math.PI) / 2),\n\teaseOutSine: (x) => Math.sin((x * Math.PI) / 2),\n\teaseInOutSine: (x) => -(Math.cos(Math.PI * x) - 1) / 2,\n\teaseInQuad: (x) => x * x,\n\teaseOutQuad: (x) => 1 - (1 - x) * (1 - x),\n\teaseInOutQuad: (x) => x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2,\n\teaseInCubic: (x) => x * x * x,\n\teaseOutCubic: (x) => 1 - Math.pow(1 - x, 3),\n\teaseInOutCubic: (x) => x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2,\n\teaseInQuart: (x) => x * x * x * x,\n\teaseOutQuart: (x) => 1 - Math.pow(1 - x, 4),\n\teaseInOutQuart: (x) => x < 0.5 ? 8 * x * x * x * x : 1 - Math.pow(-2 * x + 2, 4) / 2,\n\teaseInQuint: (x) => x * x * x * x * x,\n\teaseOutQuint: (x) => 1 - Math.pow(1 - x, 5),\n\teaseInOutQuint: (x) => x < 0.5 ? 16 * x * x * x * x * x : 1 - Math.pow(-2 * x + 2, 5) / 2,\n\teaseInExpo: (x) => x === 0 ? 0 : Math.pow(2, 10 * x - 10),\n\teaseOutExpo: (x) => x === 1 ? 1 : 1 - Math.pow(2, -10 * x),\n\teaseInOutExpo: (x) => {\n\t\treturn x === 0\n\t\t\t? 0\n\t\t\t: x === 1\n\t\t\t\t? 1\n\t\t\t\t: x < 0.5\n\t\t\t\t\t? Math.pow(2, 20 * x - 10) / 2\n\t\t\t\t\t: (2 - Math.pow(2, -20 * x + 10)) / 2\n\t},\n\teaseInCirc: (x) => 1 - Math.sqrt(1 - Math.pow(x, 2)),\n\teaseOutCirc: (x) => Math.sqrt(1 - Math.pow(x - 1, 2)),\n\teaseInOutCirc: (x) => {\n\t\treturn x < 0.5\n\t\t\t? (1 - Math.sqrt(1 - Math.pow(2 * x, 2))) / 2\n\t\t\t: (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2\n\t},\n\teaseInBack: (x) => c3 * x * x * x - c1 * x * x,\n\teaseOutBack: (x) => 1 + c3 * Math.pow(x - 1, 3) + c1 * Math.pow(x - 1, 2),\n\teaseInOutBack: (x) => {\n\t\treturn x < 0.5\n\t\t\t? (Math.pow(2 * x, 2) * ((c2 + 1) * 2 * x - c2)) / 2\n\t\t\t: (Math.pow(2 * x - 2, 2) * ((c2 + 1) * (x * 2 - 2) + c2) + 2) / 2\n\t},\n\teaseInElastic: (x) => {\n\t\treturn x === 0\n\t\t\t? 0\n\t\t\t: x === 1\n\t\t\t\t? 1\n\t\t\t\t: -Math.pow(2, 10 * x - 10) * Math.sin((x * 10 - 10.75) * c4)\n\t},\n\teaseOutElastic: (x) => {\n\t\treturn x === 0\n\t\t\t? 0\n\t\t\t: x === 1\n\t\t\t\t? 1\n\t\t\t\t: Math.pow(2, -10 * x) * Math.sin((x * 10 - 0.75) * c4) + 1\n\t},\n\teaseInOutElastic: (x) => {\n\t\treturn x === 0\n\t\t\t? 0\n\t\t\t: x === 1\n\t\t\t\t? 1\n\t\t\t\t: x < 0.5\n\t\t\t\t\t? -(Math.pow(2, 20 * x - 10) * Math.sin((20 * x - 11.125) * c5)) / 2\n\t\t\t\t\t: (Math.pow(2, -20 * x + 10) * Math.sin((20 * x - 11.125) * c5)) / 2 + 1\n\t},\n\teaseInBounce: (x) => 1 - easings.easeOutBounce(1 - x),\n\teaseOutBounce: (x) => {\n\t\tconst n1 = 7.5625\n\t\tconst d1 = 2.75\n\t\tif (x < 1 / d1) {\n\t\t\treturn n1 * x * x\n\t\t} else if (x < 2 / d1) {\n\t\t\treturn n1 * (x -= 1.5 / d1) * x + 0.75\n\t\t} else if (x < 2.5 / d1) {\n\t\t\treturn n1 * (x -= 2.25 / d1) * x + 0.9375\n\t\t} else {\n\t\t\treturn n1 * (x -= 2.625 / d1) * x + 0.984375\n\t\t}\n\t},\n\teaseInOutBounce: (x) => {\n\t\treturn x < 0.5\n\t\t\t? (1 - easings.easeOutBounce(1 - 2 * x)) / 2\n\t\t\t: (1 + easings.easeOutBounce(2 * x - 1)) / 2\n\t},\n}\n\nexport default easings\n","import type {\n\tImageSource,\n} from \"./types\"\n\nimport {\n\tGfxCtx,\n\tTexture,\n} from \"./gfx\"\n\nimport {\n\tVec2,\n\tQuad,\n} from \"./math\"\n\nexport default class TexPacker {\n\tprivate textures: Texture[] = []\n\tprivate canvas: HTMLCanvasElement\n\tprivate c2d: CanvasRenderingContext2D\n\tprivate x: number = 0\n\tprivate y: number = 0\n\tprivate curHeight: number = 0\n\tprivate gfx: GfxCtx\n\tconstructor(gfx: GfxCtx, w: number, h: number) {\n\t\tthis.gfx = gfx\n\t\tthis.canvas = document.createElement(\"canvas\")\n\t\tthis.canvas.width = w\n\t\tthis.canvas.height = h\n\t\tthis.textures = [Texture.fromImage(gfx, this.canvas)]\n\t\tthis.c2d = this.canvas.getContext(\"2d\")\n\t}\n\tadd(img: ImageSource): [Texture, Quad] {\n\t\tif (img.width > this.canvas.width || img.height > this.canvas.height) {\n\t\t\tthrow new Error(`Texture size (${img.width} x ${img.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`)\n\t\t}\n\t\t// next row\n\t\tif (this.x + img.width > this.canvas.width) {\n\t\t\tthis.x = 0\n\t\t\tthis.y += this.curHeight\n\t\t\tthis.curHeight = 0\n\t\t}\n\t\t// next texture\n\t\tif (this.y + img.height > this.canvas.height) {\n\t\t\tthis.c2d.clearRect(0, 0, this.canvas.width, this.canvas.height)\n\t\t\tthis.textures.push(Texture.fromImage(this.gfx, this.canvas))\n\t\t\tthis.x = 0\n\t\t\tthis.y = 0\n\t\t\tthis.curHeight = 0\n\t\t}\n\t\tconst curTex = this.textures[this.textures.length - 1]\n\t\tconst pos = new Vec2(this.x, this.y)\n\t\tthis.x += img.width\n\t\tif (img.height > this.curHeight) {\n\t\t\tthis.curHeight = img.height\n\t\t}\n\t\tif (img instanceof ImageData) {\n\t\t\tthis.c2d.putImageData(img, pos.x, pos.y)\n\t\t} else {\n\t\t\tthis.c2d.drawImage(img, pos.x, pos.y)\n\t\t}\n\t\tcurTex.update(this.canvas)\n\t\treturn [curTex, new Quad(\n\t\t\tpos.x / this.canvas.width,\n\t\t\tpos.y / this.canvas.height,\n\t\t\timg.width / this.canvas.width,\n\t\t\timg.height / this.canvas.height,\n\t\t)]\n\t}\n\tfree() {\n\t\tfor (const tex of this.textures) {\n\t\t\ttex.free()\n\t\t}\n\t}\n}\n","const VERSION = \"3000.1.17\"\n\nimport initApp from \"./app\"\nimport initGfx, {\n\tTexture,\n\tFrameBuffer,\n\tShader,\n\tBatchRenderer,\n} from \"./gfx\"\n\nimport {\n\tAsset,\n\tAssetBucket,\n\tfetchArrayBuffer,\n\tfetchJSON,\n\tfetchText,\n\tloadImg,\n} from \"./assets\"\n\nimport {\n\tsat,\n\tvec2,\n\tRect,\n\tPolygon,\n\tLine,\n\tCircle,\n\tColor,\n\tVec2,\n\tMat4,\n\tQuad,\n\tRNG,\n\tquad,\n\trgb,\n\thsl2rgb,\n\trand,\n\trandi,\n\trandSeed,\n\tchance,\n\tchoose,\n\tclamp,\n\tlerp,\n\tmap,\n\tmapc,\n\twave,\n\ttestLinePoint,\n\ttestLineLine,\n\ttestLineCircle,\n\ttestRectRect,\n\ttestRectLine,\n\ttestRectPoint,\n\ttestPolygonPoint,\n\ttestCirclePolygon,\n\tdeg2rad,\n\trad2deg,\n} from \"./math\"\n\nimport easings from \"./easings\"\nimport TexPacker from \"./texPacker\"\n\nimport {\n\tRegistry,\n\tEvent,\n\tEventHandler,\n\tdownload,\n\tdownloadText,\n\tdownloadJSON,\n\tdownloadBlob,\n\tuid,\n\tisDataURL,\n\tgetFileName,\n\toverload2,\n\tdataURLToArrayBuffer,\n\tEventController,\n\tgetErrorMessage,\n\t// eslint-disable-next-line\n\twarn,\n\t// eslint-disable-next-line\n\tbenchmark,\n\t// eslint-disable-next-line\n\tcomparePerf,\n\tBinaryHeap,\n\trunes,\n} from \"./utils\"\n\nimport type {\n\tGfxFont,\n\tRenderProps,\n\tCharTransform,\n\tImageSource,\n\tFormattedText,\n\tFormattedChar,\n\tDrawRectOpt,\n\tDrawLineOpt,\n\tDrawLinesOpt,\n\tDrawTriangleOpt,\n\tDrawPolygonOpt,\n\tDrawCircleOpt,\n\tDrawEllipseOpt,\n\tDrawUVQuadOpt,\n\tVertex,\n\tBitmapFontData,\n\tShaderData,\n\tAsepriteData,\n\tLoadSpriteSrc,\n\tLoadSpriteOpt,\n\tSpriteAtlasData,\n\tLoadBitmapFontOpt,\n\tKaboomCtx,\n\tKaboomOpt,\n\tAudioPlay,\n\tAudioPlayOpt,\n\tDrawSpriteOpt,\n\tDrawTextOpt,\n\tTextAlign,\n\tGameObj,\n\tSceneName,\n\tSceneDef,\n\tCompList,\n\tComp,\n\tTag,\n\tKey,\n\tMouseButton,\n\tPosComp,\n\tScaleComp,\n\tRotateComp,\n\tColorComp,\n\tOpacityComp,\n\tAnchor,\n\tAnchorComp,\n\tZComp,\n\tFollowComp,\n\tOffScreenCompOpt,\n\tOffScreenComp,\n\tAreaCompOpt,\n\tAreaComp,\n\tSpriteComp,\n\tSpriteCompOpt,\n\tSpriteAnimPlayOpt,\n\tSpriteAnims,\n\tTextComp,\n\tTextCompOpt,\n\tRectComp,\n\tRectCompOpt,\n\tUVQuadComp,\n\tCircleCompOpt,\n\tCircleComp,\n\tOutlineComp,\n\tTimerComp,\n\tBodyComp,\n\tBodyCompOpt,\n\tUniform,\n\tShaderComp,\n\tFixedComp,\n\tStayComp,\n\tHealthComp,\n\tLifespanCompOpt,\n\tStateComp,\n\tDebug,\n\tKaboomPlugin,\n\tEmptyComp,\n\tLevelComp,\n\tEdge,\n\tTileComp,\n\tTileCompOpt,\n\tLevelOpt,\n\tRecording,\n\tBoomOpt,\n\tPeditFile,\n\tShape,\n\tDoubleJumpComp,\n\tTimerController,\n\tTweenController,\n\tLoadFontOpt,\n\tAgentComp,\n\tAgentCompOpt,\n\tPathFindOpt,\n\tGetOpt,\n\tVec2Args,\n\tNineSlice,\n\tLerpValue,\n\tTexFilter,\n\tMaskComp,\n\tMask,\n\tOutline,\n\tPolygonComp,\n\tPolygonCompOpt,\n} from \"./types\"\n\nimport beanSpriteSrc from \"./assets/bean.png\"\nimport burpSoundSrc from \"./assets/burp.mp3\"\nimport kaSpriteSrc from \"./assets/ka.png\"\nimport boomSpriteSrc from \"./assets/boom.png\"\n\ninterface SpriteCurAnim {\n\tname: string,\n\ttimer: number,\n\tloop: boolean,\n\tspeed: number,\n\tpingpong: boolean,\n\tonEnd: () => void,\n}\n\n// some default charsets for loading bitmap fonts\nconst ASCII_CHARS = \" !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\"\n\nconst DEF_ANCHOR = \"topleft\"\nconst BG_GRID_SIZE = 64\n\nconst DEF_FONT = \"monospace\"\nconst DBG_FONT = \"monospace\"\nconst DEF_TEXT_SIZE = 36\nconst DEF_TEXT_CACHE_SIZE = 64\nconst MAX_TEXT_CACHE_SIZE = 256\nconst FONT_ATLAS_WIDTH = 2048\nconst FONT_ATLAS_HEIGHT = 2048\nconst SPRITE_ATLAS_WIDTH = 2048\nconst SPRITE_ATLAS_HEIGHT = 2048\n// 0.1 pixel padding to texture coordinates to prevent artifact\nconst UV_PAD = 0.1\nconst DEF_HASH_GRID_SIZE = 64\nconst DEF_FONT_FILTER = \"linear\"\n\nconst LOG_MAX = 8\nconst LOG_TIME = 4\n\nconst VERTEX_FORMAT = [\n\t{ name: \"a_pos\", size: 2 },\n\t{ name: \"a_uv\", size: 2 },\n\t{ name: \"a_color\", size: 4 },\n]\n\nconst STRIDE = VERTEX_FORMAT.reduce((sum, f) => sum + f.size, 0)\n\nconst MAX_BATCHED_QUAD = 2048\nconst MAX_BATCHED_VERTS = MAX_BATCHED_QUAD * 4 * STRIDE\nconst MAX_BATCHED_INDICES = MAX_BATCHED_QUAD * 6\n\n// vertex shader template, replace {{user}} with user vertex shader code\nconst VERT_TEMPLATE = `\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n`\n\n// fragment shader template, replace {{user}} with user fragment shader code\nconst FRAG_TEMPLATE = `\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n`\n\n// default {{user}} vertex shader code\nconst DEF_VERT = `\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n`\n\n// default {{user}} fragment shader code\nconst DEF_FRAG = `\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n`\n\nconst COMP_DESC = new Set([\n\t\"id\",\n\t\"require\",\n])\n\nconst COMP_EVENTS = new Set([\n\t\"add\",\n\t\"update\",\n\t\"draw\",\n\t\"destroy\",\n\t\"inspect\",\n\t\"drawInspect\",\n])\n\n// convert anchor string to a vec2 offset\nfunction anchorPt(orig: Anchor | Vec2): Vec2 {\n\tswitch (orig) {\n\t\tcase \"topleft\": return new Vec2(-1, -1)\n\t\tcase \"top\": return new Vec2(0, -1)\n\t\tcase \"topright\": return new Vec2(1, -1)\n\t\tcase \"left\": return new Vec2(-1, 0)\n\t\tcase \"center\": return new Vec2(0, 0)\n\t\tcase \"right\": return new Vec2(1, 0)\n\t\tcase \"botleft\": return new Vec2(-1, 1)\n\t\tcase \"bot\": return new Vec2(0, 1)\n\t\tcase \"botright\": return new Vec2(1, 1)\n\t\tdefault: return orig\n\t}\n}\n\nfunction alignPt(align: TextAlign): number {\n\tswitch (align) {\n\t\tcase \"left\": return 0\n\t\tcase \"center\": return 0.5\n\t\tcase \"right\": return 1\n\t\tdefault: return 0\n\t}\n}\n\nfunction createEmptyAudioBuffer(ctx: AudioContext) {\n\treturn ctx.createBuffer(1, 1, 44100)\n}\n\n// only exports one kaboom() which contains all the state\nexport default (gopt: KaboomOpt = {}): KaboomCtx => {\n\n\tconst root = gopt.root ?? document.body\n\n\t// if root is not defined (which falls back to <body>) we assume user is using kaboom on a clean page, and modify <body> to better fit a full screen canvas\n\tif (root === document.body) {\n\t\tdocument.body.style[\"width\"] = \"100%\"\n\t\tdocument.body.style[\"height\"] = \"100%\"\n\t\tdocument.body.style[\"margin\"] = \"0px\"\n\t\tdocument.documentElement.style[\"width\"] = \"100%\"\n\t\tdocument.documentElement.style[\"height\"] = \"100%\"\n\t}\n\n\t// create a <canvas> if user didn't provide one\n\tconst canvas = gopt.canvas ?? (() => {\n\t\tconst canvas = document.createElement(\"canvas\")\n\t\troot.appendChild(canvas)\n\t\treturn canvas\n\t})()\n\n\t// global pixel scale\n\tconst gscale = gopt.scale ?? 1\n\tconst fixedSize = gopt.width && gopt.height && !gopt.stretch && !gopt.letterbox\n\n\t// adjust canvas size according to user size / viewport settings\n\tif (fixedSize) {\n\t\tcanvas.width = gopt.width * gscale\n\t\tcanvas.height = gopt.height * gscale\n\t} else {\n\t\tcanvas.width = canvas.parentElement.offsetWidth\n\t\tcanvas.height = canvas.parentElement.offsetHeight\n\t}\n\n\t// canvas css styles\n\tconst styles = [\n\t\t\"outline: none\",\n\t\t\"cursor: default\",\n\t]\n\n\tif (fixedSize) {\n\t\tconst cw = canvas.width\n\t\tconst ch = canvas.height\n\t\tstyles.push(`width: ${cw}px`)\n\t\tstyles.push(`height: ${ch}px`)\n\t} else {\n\t\tstyles.push(\"width: 100%\")\n\t\tstyles.push(\"height: 100%\")\n\t}\n\n\tif (gopt.crisp) {\n\t\t// chrome only supports pixelated and firefox only supports crisp-edges\n\t\tstyles.push(\"image-rendering: pixelated\")\n\t\tstyles.push(\"image-rendering: crisp-edges\")\n\t}\n\n\tcanvas.style.cssText = styles.join(\";\")\n\n\tconst pixelDensity = gopt.pixelDensity || window.devicePixelRatio\n\n\tcanvas.width *= pixelDensity\n\tcanvas.height *= pixelDensity\n\t// make canvas focusable\n\tcanvas.tabIndex = 0\n\n\tconst fontCacheCanvas = document.createElement(\"canvas\")\n\tfontCacheCanvas.width = MAX_TEXT_CACHE_SIZE\n\tfontCacheCanvas.height = MAX_TEXT_CACHE_SIZE\n\tconst fontCacheC2d = fontCacheCanvas.getContext(\"2d\", {\n\t\twillReadFrequently: true,\n\t})\n\n\tconst app = initApp({\n\t\tcanvas: canvas,\n\t\ttouchToMouse: gopt.touchToMouse,\n\t\tgamepads: gopt.gamepads,\n\t\tpixelDensity: gopt.pixelDensity,\n\t\tmaxFPS: gopt.maxFPS,\n\t})\n\n\tconst gc: Array<() => void> = []\n\n\tconst gl = app.canvas\n\t\t.getContext(\"webgl\", {\n\t\t\tantialias: true,\n\t\t\tdepth: true,\n\t\t\tstencil: true,\n\t\t\talpha: true,\n\t\t\tpreserveDrawingBuffer: true,\n\t\t})\n\n\tconst ggl = initGfx(gl, {\n\t\ttexFilter: gopt.texFilter,\n\t})\n\n\tconst gfx = (() => {\n\n\t\tconst defShader = makeShader(DEF_VERT, DEF_FRAG)\n\n\t\t// a 1x1 white texture to draw raw shapes like rectangles and polygons\n\t\t// we use a texture for those so we can use only 1 pipeline for drawing sprites + shapes\n\t\tconst emptyTex = Texture.fromImage(\n\t\t\tggl,\n\t\t\tnew ImageData(new Uint8ClampedArray([ 255, 255, 255, 255 ]), 1, 1),\n\t\t)\n\n\t\tconst frameBuffer = (gopt.width && gopt.height)\n\t\t\t? new FrameBuffer(ggl, gopt.width * pixelDensity * gscale, gopt.height * pixelDensity * gscale)\n\t\t\t: new FrameBuffer(ggl, gl.drawingBufferWidth, gl.drawingBufferHeight)\n\n\t\tlet bgColor: null | Color = null\n\t\tlet bgAlpha = 1\n\n\t\tif (gopt.background) {\n\t\t\tbgColor = rgb(gopt.background)\n\t\t\tbgAlpha = Array.isArray(gopt.background) ? gopt.background[3] : 1\n\t\t\tgl.clearColor(\n\t\t\t\tbgColor.r / 255,\n\t\t\t\tbgColor.g / 255,\n\t\t\t\tbgColor.b / 255,\n\t\t\t\tbgAlpha ?? 1,\n\t\t\t)\n\t\t}\n\n\t\tgl.enable(gl.BLEND)\n\t\tgl.blendFuncSeparate(\n\t\t\tgl.SRC_ALPHA,\n\t\t\tgl.ONE_MINUS_SRC_ALPHA,\n\t\t\tgl.ONE,\n\t\t\tgl.ONE_MINUS_SRC_ALPHA,\n\t\t)\n\n\t\tconst renderer = new BatchRenderer(ggl, VERTEX_FORMAT, MAX_BATCHED_VERTS, MAX_BATCHED_INDICES)\n\n\t\t// a checkerboard texture used for the default background\n\t\tconst bgTex = Texture.fromImage(\n\t\t\tggl,\n\t\t\tnew ImageData(new Uint8ClampedArray([\n\t\t\t\t128, 128, 128, 255,\n\t\t\t\t190, 190, 190, 255,\n\t\t\t\t190, 190, 190, 255,\n\t\t\t\t128, 128, 128, 255,\n\t\t\t]), 2, 2), {\n\t\t\t\twrap: \"repeat\",\n\t\t\t\tfilter: \"nearest\",\n\t\t\t},\n\t\t)\n\n\t\treturn {\n\n\t\t\t// how many draw calls we're doing last frame, this is the number we give to users\n\t\t\tlastDrawCalls: 0,\n\n\t\t\t// gfx states\n\t\t\tdefShader: defShader,\n\t\t\tdefTex: emptyTex,\n\t\t\tframeBuffer: frameBuffer,\n\t\t\tpostShader: null,\n\t\t\tpostShaderUniform: null,\n\t\t\trenderer: renderer,\n\n\t\t\ttransform: new Mat4(),\n\t\t\ttransformStack: [],\n\n\t\t\tbgTex: bgTex,\n\t\t\tbgColor: bgColor,\n\t\t\tbgAlpha: bgAlpha,\n\n\t\t\twidth: gopt.width ?? gl.drawingBufferWidth / pixelDensity / gscale,\n\t\t\theight: gopt.height ?? gl.drawingBufferHeight / pixelDensity / gscale,\n\n\t\t\tviewport: {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\twidth: gl.drawingBufferWidth,\n\t\t\t\theight: gl.drawingBufferHeight,\n\t\t\t},\n\n\t\t\tfixed: false,\n\n\t\t}\n\n\t})()\n\n\tclass SpriteData {\n\n\t\ttex: Texture\n\t\tframes: Quad[] = [ new Quad(0, 0, 1, 1) ]\n\t\tanims: SpriteAnims = {}\n\t\tslice9: NineSlice | null = null\n\n\t\tconstructor(\n\t\t\ttex: Texture,\n\t\t\tframes?: Quad[],\n\t\t\tanims: SpriteAnims = {},\n\t\t\tslice9: NineSlice = null,\n\t\t) {\n\t\t\tthis.tex = tex\n\t\t\tif (frames) this.frames = frames\n\t\t\tthis.anims = anims\n\t\t\tthis.slice9 = slice9\n\t\t}\n\n\t\tget width() {\n\t\t\treturn this.tex.width * this.frames[0].w\n\t\t}\n\n\t\tget height() {\n\t\t\treturn this.tex.height * this.frames[0].h\n\t\t}\n\n\t\tstatic from(src: LoadSpriteSrc, opt: LoadSpriteOpt = {}): Promise<SpriteData> {\n\t\t\treturn typeof src === \"string\"\n\t\t\t\t? SpriteData.fromURL(src, opt)\n\t\t\t\t: Promise.resolve(SpriteData.fromImage(src, opt))\n\t\t}\n\n\t\tstatic fromImage(data: ImageSource, opt: LoadSpriteOpt = {}): SpriteData {\n\t\t\tconst [tex, quad] = assets.packer.add(data)\n\t\t\tconst frames = opt.frames ? opt.frames.map((f) => new Quad(\n\t\t\t\tquad.x + f.x * quad.w,\n\t\t\t\tquad.y + f.y * quad.h,\n\t\t\t\tf.w * quad.w,\n\t\t\t\tf.h * quad.h,\n\t\t\t)) : slice(opt.sliceX || 1, opt.sliceY || 1, quad.x, quad.y, quad.w, quad.h)\n\t\t\treturn new SpriteData(tex, frames, opt.anims, opt.slice9)\n\t\t}\n\n\t\tstatic fromURL(url: string, opt: LoadSpriteOpt = {}): Promise<SpriteData> {\n\t\t\treturn loadImg(url).then((img) => SpriteData.fromImage(img, opt))\n\t\t}\n\n\t}\n\n\tclass SoundData {\n\n\t\tbuf: AudioBuffer\n\n\t\tconstructor(buf: AudioBuffer) {\n\t\t\tthis.buf = buf\n\t\t}\n\n\t\tstatic fromArrayBuffer(buf: ArrayBuffer): Promise<SoundData> {\n\t\t\treturn new Promise((resolve, reject) =>\n\t\t\t\taudio.ctx.decodeAudioData(buf, resolve, reject),\n\t\t\t).then((buf: AudioBuffer) => new SoundData(buf))\n\t\t}\n\n\t\tstatic fromURL(url: string): Promise<SoundData> {\n\t\t\tif (isDataURL(url)) {\n\t\t\t\treturn SoundData.fromArrayBuffer(dataURLToArrayBuffer(url))\n\t\t\t} else {\n\t\t\t\treturn fetchArrayBuffer(url).then((buf) => SoundData.fromArrayBuffer(buf))\n\t\t\t}\n\t\t}\n\n\t}\n\n\tconst audio = (() => {\n\n\t\tconst ctx = new (\n\t\t\twindow.AudioContext || (window as any).webkitAudioContext\n\t\t)() as AudioContext\n\n\t\tconst masterNode = ctx.createGain()\n\t\tmasterNode.connect(ctx.destination)\n\n\t\t// by default browsers can only load audio async, we don't deal with that and just start with an empty audio buffer\n\t\tconst burpSnd = new SoundData(createEmptyAudioBuffer(ctx))\n\n\t\t// load that burp sound\n\t\tctx.decodeAudioData(burpSoundSrc.buffer.slice(0)).then((buf) => {\n\t\t\tburpSnd.buf = buf\n\t\t}).catch((err) => {\n\t\t\tconsole.error(\"Failed to load burp: \", err)\n\t\t})\n\n\t\treturn {\n\t\t\tctx,\n\t\t\tmasterNode,\n\t\t\tburpSnd,\n\t\t}\n\n\t})()\n\n\tconst assets = {\n\t\turlPrefix: \"\",\n\t\t// asset holders\n\t\tsprites: new AssetBucket<SpriteData>(),\n\t\tfonts: new AssetBucket<FontData>(),\n\t\tbitmapFonts: new AssetBucket<BitmapFontData>(),\n\t\tsounds: new AssetBucket<SoundData>(),\n\t\tshaders: new AssetBucket<ShaderData>(),\n\t\tcustom: new AssetBucket<any>(),\n\t\tpacker: new TexPacker(ggl, SPRITE_ATLAS_WIDTH, SPRITE_ATLAS_HEIGHT),\n\t\t// if we finished initially loading all assets\n\t\tloaded: false,\n\t}\n\n\tfunction fixURL<D>(url: D): D {\n\t\tif (typeof url !== \"string\" || isDataURL(url)) return url\n\t\treturn assets.urlPrefix + url as D\n\t}\n\n\tconst game = {\n\n\t\t// general events\n\t\tevents: new EventHandler<{\n\t\t\tmouseMove: [],\n\t\t\tmouseDown: [MouseButton],\n\t\t\tmousePress: [MouseButton],\n\t\t\tmouseRelease: [MouseButton],\n\t\t\tcharInput: [string],\n\t\t\tkeyPress: [Key],\n\t\t\tkeyDown: [Key],\n\t\t\tkeyPressRepeat: [Key],\n\t\t\tkeyRelease: [Key],\n\t\t\ttouchStart: [Vec2, Touch],\n\t\t\ttouchMove: [Vec2, Touch],\n\t\t\ttouchEnd: [Vec2, Touch],\n\t\t\tgamepadButtonDown: [string],\n\t\t\tgamepadButtonPress: [string],\n\t\t\tgamepadButtonRelease: [string],\n\t\t\tgamepadStick: [string, Vec2],\n\t\t\tgamepadConnect: [Gamepad],\n\t\t\tgamepadDisconnect: [Gamepad],\n\t\t\tscroll: [Vec2],\n\t\t\tadd: [GameObj],\n\t\t\tdestroy: [GameObj],\n\t\t\tload: [],\n\t\t\tloading: [number],\n\t\t\terror: [Error],\n\t\t\tinput: [],\n\t\t\tframeEnd: [],\n\t\t\tresize: [],\n\t\t\tsceneLeave: [string],\n\t\t}>(),\n\n\t\t// object events\n\t\tobjEvents: new EventHandler(),\n\n\t\t// root game object\n\t\troot: make([]),\n\n\t\t// misc\n\t\tgravity: 0,\n\t\tscenes: {},\n\n\t\t// on screen log\n\t\tlogs: [],\n\n\t\t// camera\n\t\tcam: {\n\t\t\tpos: null,\n\t\t\tscale: new Vec2(1),\n\t\t\tangle: 0,\n\t\t\tshake: 0,\n\t\t\ttransform: new Mat4(),\n\t\t},\n\n\t}\n\n\tgame.root.use(timer())\n\n\t// wrap individual loaders with global loader counter, for stuff like progress bar\n\tfunction load<T>(prom: Promise<T>): Asset<T> {\n\t\treturn assets.custom.add(null, prom)\n\t}\n\n\t// get current load progress\n\tfunction loadProgress(): number {\n\t\tconst buckets = [\n\t\t\tassets.sprites,\n\t\t\tassets.sounds,\n\t\t\tassets.shaders,\n\t\t\tassets.fonts,\n\t\t\tassets.bitmapFonts,\n\t\t\tassets.custom,\n\t\t]\n\t\treturn buckets.reduce((n, bucket) => n + bucket.progress(), 0) / buckets.length\n\t}\n\n\t// global load path prefix\n\tfunction loadRoot(path?: string): string {\n\t\tif (path !== undefined) {\n\t\t\tassets.urlPrefix = path\n\t\t}\n\t\treturn assets.urlPrefix\n\t}\n\n\tfunction loadJSON(name, url) {\n\t\treturn assets.custom.add(name, fetchJSON(url))\n\t}\n\n\tclass FontData {\n\t\tfontface: FontFace\n\t\tfilter: TexFilter = DEF_FONT_FILTER\n\t\toutline: Outline | null = null\n\t\tsize: number = DEF_TEXT_CACHE_SIZE\n\t\tconstructor(face: FontFace, opt: LoadFontOpt = {}) {\n\t\t\tthis.fontface = face\n\t\t\tthis.filter = opt.filter ?? DEF_FONT_FILTER\n\t\t\tthis.size = opt.size ?? DEF_TEXT_CACHE_SIZE\n\t\t\tif (this.size > MAX_TEXT_CACHE_SIZE) {\n\t\t\t\tthrow new Error(`Max font size: ${MAX_TEXT_CACHE_SIZE}`)\n\t\t\t}\n\t\t\tif (opt.outline) {\n\t\t\t\tthis.outline = {\n\t\t\t\t\twidth: 1,\n\t\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\t}\n\t\t\t\tif (typeof opt.outline === \"number\") {\n\t\t\t\t\tthis.outline.width = opt.outline\n\t\t\t\t} else if (typeof opt.outline === \"object\") {\n\t\t\t\t\tif (opt.outline.width) this.outline.width = opt.outline.width\n\t\t\t\t\tif (opt.outline.color) this.outline.color = opt.outline.color\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// TODO: pass in null src to store opt for default fonts like \"monospace\"\n\tfunction loadFont(\n\t\tname: string,\n\t\tsrc: string | BinaryData,\n\t\topt: LoadFontOpt = {},\n\t): Asset<FontData> {\n\t\tconst font = new FontFace(name, typeof src === \"string\" ? `url(${src})` : src)\n\t\tdocument.fonts.add(font)\n\t\treturn assets.fonts.add(name, font.load().catch((err) => {\n\t\t\tthrow new Error(`Failed to load font from \"${src}\": ${err}`)\n\t\t}).then((face) => new FontData(face, opt)))\n\t}\n\n\t// TODO: support outline\n\t// TODO: support LoadSpriteSrc\n\tfunction loadBitmapFont(\n\t\tname: string | null,\n\t\tsrc: string,\n\t\tgw: number,\n\t\tgh: number,\n\t\topt: LoadBitmapFontOpt = {},\n\t): Asset<BitmapFontData> {\n\t\treturn assets.bitmapFonts.add(name, loadImg(src)\n\t\t\t.then((img) => {\n\t\t\t\treturn makeFont(\n\t\t\t\t\tTexture.fromImage(ggl, img, opt),\n\t\t\t\t\tgw,\n\t\t\t\t\tgh,\n\t\t\t\t\topt.chars ?? ASCII_CHARS,\n\t\t\t\t)\n\t\t\t}),\n\t\t)\n\t}\n\n\t// get an array of frames based on configuration on how to slice the image\n\tfunction slice(x = 1, y = 1, dx = 0, dy = 0, w = 1, h = 1): Quad[] {\n\t\tconst frames = []\n\t\tconst qw = w / x\n\t\tconst qh = h / y\n\t\tfor (let j = 0; j < y; j++) {\n\t\t\tfor (let i = 0; i < x; i++) {\n\t\t\t\tframes.push(new Quad(\n\t\t\t\t\tdx + i * qw,\n\t\t\t\t\tdy + j * qh,\n\t\t\t\t\tqw,\n\t\t\t\t\tqh,\n\t\t\t\t))\n\t\t\t}\n\t\t}\n\t\treturn frames\n\t}\n\n\t// TODO: load synchronously if passed ImageSource\n\tfunction loadSpriteAtlas(\n\t\tsrc: LoadSpriteSrc,\n\t\tdata: SpriteAtlasData | string,\n\t): Asset<Record<string, SpriteData>> {\n\t\tsrc = fixURL(src)\n\t\tif (typeof data === \"string\") {\n\t\t\treturn load(new Promise((res, rej) => {\n\t\t\t\tfetchJSON(data).then((json) => {\n\t\t\t\t\tloadSpriteAtlas(src, json).then(res).catch(rej)\n\t\t\t\t})\n\t\t\t}))\n\t\t}\n\t\treturn load(SpriteData.from(src).then((atlas) => {\n\t\t\tconst map = {}\n\t\t\tfor (const name in data) {\n\t\t\t\tconst info = data[name]\n\t\t\t\tconst quad = atlas.frames[0]\n\t\t\t\tconst w = SPRITE_ATLAS_WIDTH * quad.w\n\t\t\t\tconst h = SPRITE_ATLAS_HEIGHT * quad.h\n\t\t\t\tconst frames = info.frames ? info.frames.map((f) => new Quad(\n\t\t\t\t\tquad.x + (info.x + f.x) / w * quad.w,\n\t\t\t\t\tquad.y + (info.y + f.y) / h * quad.h,\n\t\t\t\t\tf.w / w * quad.w,\n\t\t\t\t\tf.h / h * quad.h,\n\t\t\t\t)) : slice(\n\t\t\t\t\tinfo.sliceX || 1,\n\t\t\t\t\tinfo.sliceY || 1,\n\t\t\t\t\tquad.x + info.x / w * quad.w,\n\t\t\t\t\tquad.y + info.y / h * quad.h,\n\t\t\t\t\tinfo.width / w * quad.w,\n\t\t\t\t\tinfo.height / h * quad.h,\n\t\t\t\t)\n\t\t\t\tconst spr = new SpriteData(atlas.tex, frames, info.anims)\n\t\t\t\tassets.sprites.addLoaded(name, spr)\n\t\t\t\tmap[name] = spr\n\t\t\t}\n\t\t\treturn map\n\t\t}))\n\t}\n\n\tfunction createSpriteSheet(\n\t\timages: ImageSource[],\n\t\topt: LoadSpriteOpt = {},\n\t): SpriteData {\n\t\tconst canvas = document.createElement(\"canvas\")\n\t\tconst width = images[0].width\n\t\tconst height = images[0].height\n\t\tcanvas.width = width * images.length\n\t\tcanvas.height = height\n\t\tconst c2d = canvas.getContext(\"2d\")\n\t\timages.forEach((img, i) => {\n\t\t\tif (img instanceof ImageData) {\n\t\t\t\tc2d.putImageData(img, i * width, 0)\n\t\t\t} else {\n\t\t\t\tc2d.drawImage(img, i * width, 0)\n\t\t\t}\n\t\t})\n\t\tconst merged = c2d.getImageData(0, 0, images.length * width, height)\n\t\treturn SpriteData.fromImage(merged, {\n\t\t\t...opt,\n\t\t\tsliceX: images.length,\n\t\t\tsliceY: 1,\n\t\t})\n\t}\n\n\t// load a sprite to asset manager\n\tfunction loadSprite(\n\t\tname: string | null,\n\t\tsrc: LoadSpriteSrc | LoadSpriteSrc[],\n\t\topt: LoadSpriteOpt = {\n\t\t\tsliceX: 1,\n\t\t\tsliceY: 1,\n\t\t\tanims: {},\n\t\t},\n\t): Asset<SpriteData> {\n\t\tsrc = fixURL(src)\n\t\tif (Array.isArray(src)) {\n\t\t\tif (src.some((s) => typeof s === \"string\")) {\n\t\t\t\treturn assets.sprites.add(\n\t\t\t\t\tname,\n\t\t\t\t\tPromise.all(src.map((s) => {\n\t\t\t\t\t\treturn typeof s === \"string\" ? loadImg(s) : Promise.resolve(s)\n\t\t\t\t\t})).then((images) => createSpriteSheet(images, opt)),\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\treturn assets.sprites.addLoaded(name, createSpriteSheet(src as ImageSource[], opt))\n\t\t\t}\n\t\t} else {\n\t\t\tif (typeof src === \"string\") {\n\t\t\t\treturn assets.sprites.add(name, SpriteData.from(src, opt))\n\t\t\t} else {\n\t\t\t\treturn assets.sprites.addLoaded(name, SpriteData.fromImage(src, opt))\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction loadPedit(name: string | null, src: string | PeditFile): Asset<SpriteData> {\n\n\t\tsrc = fixURL(src)\n\n\t\t// eslint-disable-next-line\n\t\treturn assets.sprites.add(name, new Promise(async (resolve) => {\n\n\t\t\tconst data = typeof src === \"string\" ? await fetchJSON(src) : src\n\t\t\tconst images = await Promise.all(data.frames.map(loadImg))\n\t\t\tconst canvas = document.createElement(\"canvas\")\n\t\t\tcanvas.width = data.width\n\t\t\tcanvas.height = data.height * data.frames.length\n\n\t\t\tconst c2d = canvas.getContext(\"2d\")\n\n\t\t\timages.forEach((img: HTMLImageElement, i) => {\n\t\t\t\tc2d.drawImage(img, 0, i * data.height)\n\t\t\t})\n\n\t\t\tconst spr = await loadSprite(null, canvas, {\n\t\t\t\tsliceY: data.frames.length,\n\t\t\t\tanims: data.anims,\n\t\t\t})\n\n\t\t\tresolve(spr)\n\n\t\t}))\n\n\t}\n\n\tfunction loadAseprite(\n\t\tname: string | null,\n\t\timgSrc: LoadSpriteSrc,\n\t\tjsonSrc: string | AsepriteData,\n\t): Asset<SpriteData> {\n\n\t\timgSrc = fixURL(imgSrc)\n\t\tjsonSrc = fixURL(jsonSrc)\n\n\t\tif (typeof imgSrc === \"string\" && !jsonSrc) {\n\t\t\tjsonSrc = getFileName(imgSrc) + \".json\"\n\t\t}\n\n\t\tconst resolveJSON = typeof jsonSrc === \"string\"\n\t\t\t? fetchJSON(jsonSrc)\n\t\t\t: Promise.resolve(jsonSrc)\n\n\t\treturn assets.sprites.add(name, resolveJSON.then((data: AsepriteData) => {\n\t\t\tconst size = data.meta.size\n\t\t\tconst frames = data.frames.map((f: any) => {\n\t\t\t\treturn new Quad(\n\t\t\t\t\tf.frame.x / size.w,\n\t\t\t\t\tf.frame.y / size.h,\n\t\t\t\t\tf.frame.w / size.w,\n\t\t\t\t\tf.frame.h / size.h,\n\t\t\t\t)\n\t\t\t})\n\t\t\tconst anims = {}\n\t\t\tfor (const anim of data.meta.frameTags) {\n\t\t\t\tif (anim.from === anim.to) {\n\t\t\t\t\tanims[anim.name] = anim.from\n\t\t\t\t} else {\n\t\t\t\t\tanims[anim.name] = {\n\t\t\t\t\t\tfrom: anim.from,\n\t\t\t\t\t\tto: anim.to,\n\t\t\t\t\t\tspeed: 10,\n\t\t\t\t\t\tloop: true,\n\t\t\t\t\t\tpingpong: anim.direction === \"pingpong\",\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn SpriteData.from(imgSrc, {\n\t\t\t\tframes: frames,\n\t\t\t\tanims: anims,\n\t\t\t})\n\t\t}))\n\n\t}\n\n\tfunction loadShader(\n\t\tname: string | null,\n\t\tvert?: string,\n\t\tfrag?: string,\n\t) {\n\t\treturn assets.shaders.addLoaded(name, makeShader(vert, frag))\n\t}\n\n\tfunction loadShaderURL(\n\t\tname: string | null,\n\t\tvert?: string,\n\t\tfrag?: string,\n\t): Asset<ShaderData> {\n\t\tvert = fixURL(vert)\n\t\tfrag = fixURL(frag)\n\t\tconst resolveUrl = (url?: string) =>\n\t\t\turl\n\t\t\t\t? fetchText(url)\n\t\t\t\t: Promise.resolve(null)\n\t\tconst load = Promise.all([resolveUrl(vert), resolveUrl(frag)])\n\t\t\t.then(([vcode, fcode]: [string | null, string | null]) => {\n\t\t\t\treturn makeShader(vcode, fcode)\n\t\t\t})\n\t\treturn assets.shaders.add(name, load)\n\t}\n\n\t// TODO: allow stream big audio\n\t// load a sound to asset manager\n\tfunction loadSound(\n\t\tname: string | null,\n\t\tsrc: string | ArrayBuffer,\n\t): Asset<SoundData> {\n\t\tsrc = fixURL(src)\n\t\treturn assets.sounds.add(\n\t\t\tname,\n\t\t\ttypeof src === \"string\"\n\t\t\t\t? SoundData.fromURL(src)\n\t\t\t\t: SoundData.fromArrayBuffer(src),\n\t\t)\n\t}\n\n\tfunction loadBean(name: string = \"bean\"): Asset<SpriteData> {\n\t\treturn loadSprite(name, beanSpriteSrc)\n\t}\n\n\tfunction getSprite(name: string): Asset<SpriteData> | void {\n\t\treturn assets.sprites.get(name)\n\t}\n\n\tfunction getSound(name: string): Asset<SoundData> | void {\n\t\treturn assets.sounds.get(name)\n\t}\n\n\tfunction getFont(name: string): Asset<FontData> | void {\n\t\treturn assets.fonts.get(name)\n\t}\n\n\tfunction getBitmapFont(name: string): Asset<BitmapFontData> | void {\n\t\treturn assets.bitmapFonts.get(name)\n\t}\n\n\tfunction getShader(name: string): Asset<ShaderData> | void {\n\t\treturn assets.shaders.get(name)\n\t}\n\n\tfunction getAsset(name: string): Asset<any> | void {\n\t\treturn assets.custom.get(name)\n\t}\n\n\tfunction resolveSprite(\n\t\tsrc: DrawSpriteOpt[\"sprite\"],\n\t): Asset<SpriteData> | null {\n\t\tif (typeof src === \"string\") {\n\t\t\tconst spr = getSprite(src)\n\t\t\tif (spr) {\n\t\t\t\t// if it's already loaded or being loading, return it\n\t\t\t\treturn spr\n\t\t\t} else if (loadProgress() < 1) {\n\t\t\t\t// if there's any other ongoing loading task we return empty and don't error yet\n\t\t\t\treturn null\n\t\t\t} else {\n\t\t\t\t// if all other assets are loaded and we still haven't found this sprite, throw\n\t\t\t\tthrow new Error(`Sprite not found: ${src}`)\n\t\t\t}\n\t\t} else if (src instanceof SpriteData) {\n\t\t\treturn Asset.loaded(src)\n\t\t} else if (src instanceof Asset) {\n\t\t\treturn src\n\t\t} else {\n\t\t\tthrow new Error(`Invalid sprite: ${src}`)\n\t\t}\n\t}\n\n\tfunction resolveSound(\n\t\tsrc: Parameters<typeof play>[0],\n\t): Asset<SoundData> | null {\n\t\tif (typeof src === \"string\") {\n\t\t\tconst snd = getSound(src)\n\t\t\tif (snd) {\n\t\t\t\treturn snd\n\t\t\t} else if (loadProgress() < 1) {\n\t\t\t\treturn null\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Sound not found: ${src}`)\n\t\t\t}\n\t\t} else if (src instanceof SoundData) {\n\t\t\treturn Asset.loaded(src)\n\t\t} else if (src instanceof Asset) {\n\t\t\treturn src\n\t\t} else {\n\t\t\tthrow new Error(`Invalid sound: ${src}`)\n\t\t}\n\t}\n\n\tfunction resolveShader(\n\t\tsrc: RenderProps[\"shader\"],\n\t): ShaderData | Asset<ShaderData> | null {\n\t\tif (!src) {\n\t\t\treturn gfx.defShader\n\t\t}\n\t\tif (typeof src === \"string\") {\n\t\t\tconst shader = getShader(src)\n\t\t\tif (shader) {\n\t\t\t\treturn shader.data ?? shader\n\t\t\t} else if (loadProgress() < 1) {\n\t\t\t\treturn null\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Shader not found: ${src}`)\n\t\t\t}\n\t\t} else if (src instanceof Asset) {\n\t\t\treturn src.data ? src.data : src\n\t\t}\n\t\t// TODO: check type\n\t\t// @ts-ignore\n\t\treturn src\n\t}\n\n\tfunction resolveFont(\n\t\tsrc: DrawTextOpt[\"font\"],\n\t):\n\t\t| FontData\n\t\t| Asset<FontData>\n\t\t| BitmapFontData\n\t\t| Asset<BitmapFontData>\n\t\t| string\n\t\t| void\n\t{\n\t\tif (!src) {\n\t\t\treturn resolveFont(gopt.font ?? DEF_FONT)\n\t\t}\n\t\tif (typeof src === \"string\") {\n\t\t\tconst bfont = getBitmapFont(src)\n\t\t\tconst font = getFont(src)\n\t\t\tif (bfont) {\n\t\t\t\treturn bfont.data ?? bfont\n\t\t\t} else if (font) {\n\t\t\t\treturn font.data ?? font\n\t\t\t} else if (document.fonts.check(`${DEF_TEXT_CACHE_SIZE}px ${src}`)) {\n\t\t\t\treturn src\n\t\t\t} else if (loadProgress() < 1) {\n\t\t\t\treturn null\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Font not found: ${src}`)\n\t\t\t}\n\t\t} else if (src instanceof Asset) {\n\t\t\treturn src.data ? src.data : src\n\t\t}\n\t\t// TODO: check type\n\t\t// @ts-ignore\n\t\treturn src\n\t}\n\n\t// get / set master volume\n\tfunction volume(v?: number): number {\n\t\tif (v !== undefined) {\n\t\t\taudio.masterNode.gain.value = v\n\t\t}\n\t\treturn audio.masterNode.gain.value\n\t}\n\n\t// TODO: method to completely destory audio?\n\t// TODO: time() not correct when looped over or ended\n\t// TODO: onEnd() not working\n\t// plays a sound, returns a control handle\n\tfunction play(\n\t\tsrc: string | SoundData | Asset<SoundData>,\n\t\topt: AudioPlayOpt = {},\n\t): AudioPlay {\n\n\t\tconst ctx = audio.ctx\n\t\tlet paused = opt.paused ?? false\n\t\tlet srcNode = ctx.createBufferSource()\n\t\tconst onEndEvents = new Event()\n\t\tconst gainNode = ctx.createGain()\n\t\tconst pos = opt.seek ?? 0\n\t\tlet startTime = 0\n\t\tlet stopTime = 0\n\t\tlet started = false\n\n\t\tsrcNode.loop = Boolean(opt.loop)\n\t\tsrcNode.detune.value = opt.detune ?? 0\n\t\tsrcNode.playbackRate.value = opt.speed ?? 1\n\t\tsrcNode.connect(gainNode)\n\t\tsrcNode.onended = () => {\n\t\t\tif (getTime() >= srcNode.buffer?.duration ?? Number.POSITIVE_INFINITY) {\n\t\t\t\tonEndEvents.trigger()\n\t\t\t}\n\t\t}\n\t\tgainNode.connect(audio.masterNode)\n\t\tgainNode.gain.value = opt.volume ?? 1\n\n\t\tconst start = (data: SoundData) => {\n\t\t\tsrcNode.buffer = data.buf\n\t\t\tif (!paused) {\n\t\t\t\tstartTime = ctx.currentTime\n\t\t\t\tsrcNode.start(0, pos)\n\t\t\t\tstarted = true\n\t\t\t}\n\t\t}\n\n\t\tconst snd = resolveSound(src)\n\n\t\tif (snd instanceof Asset) {\n\t\t\tsnd.onLoad(start)\n\t\t}\n\n\t\tconst getTime = () => {\n\t\t\tif (!srcNode.buffer) return 0\n\t\t\tconst t = paused\n\t\t\t\t? stopTime - startTime\n\t\t\t\t: ctx.currentTime - startTime\n\t\t\tconst d = srcNode.buffer.duration\n\t\t\treturn srcNode.loop ? t % d : Math.min(t, d)\n\t\t}\n\n\t\tconst cloneNode = (oldNode: AudioBufferSourceNode) => {\n\t\t\tconst newNode = ctx.createBufferSource()\n\t\t\tnewNode.buffer = oldNode.buffer\n\t\t\tnewNode.loop = oldNode.loop\n\t\t\tnewNode.playbackRate.value = oldNode.playbackRate.value\n\t\t\tnewNode.detune.value = oldNode.detune.value\n\t\t\tnewNode.onended = oldNode.onended\n\t\t\tnewNode.connect(gainNode)\n\t\t\treturn newNode\n\t\t}\n\n\t\treturn {\n\n\t\t\tstop() {\n\t\t\t\tthis.paused = true\n\t\t\t\tthis.seek(0)\n\t\t\t},\n\n\t\t\tset paused(p: boolean) {\n\t\t\t\tif (paused === p) return\n\t\t\t\tpaused = p\n\t\t\t\tif (p) {\n\t\t\t\t\tif (started) {\n\t\t\t\t\t\tsrcNode.stop()\n\t\t\t\t\t\tstarted = false\n\t\t\t\t\t}\n\t\t\t\t\tstopTime = ctx.currentTime\n\t\t\t\t} else {\n\t\t\t\t\tsrcNode = cloneNode(srcNode)\n\t\t\t\t\tconst pos = stopTime - startTime\n\t\t\t\t\tsrcNode.start(0, pos)\n\t\t\t\t\tstarted = true\n\t\t\t\t\tstartTime = ctx.currentTime - pos\n\t\t\t\t\tstopTime = 0\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tget paused() {\n\t\t\t\treturn paused\n\t\t\t},\n\n\t\t\tplay(time: number = 0) {\n\t\t\t\tthis.seek(time)\n\t\t\t\tthis.paused = false\n\t\t\t},\n\n\t\t\tseek(time: number) {\n\t\t\t\tif (!srcNode.buffer?.duration) return\n\t\t\t\tif (time > srcNode.buffer.duration) return\n\t\t\t\tif (paused) {\n\t\t\t\t\tsrcNode = cloneNode(srcNode)\n\t\t\t\t\tstartTime = stopTime - time\n\t\t\t\t} else {\n\t\t\t\t\tsrcNode.stop()\n\t\t\t\t\tsrcNode = cloneNode(srcNode)\n\t\t\t\t\tstartTime = ctx.currentTime - time\n\t\t\t\t\tsrcNode.start(0, time)\n\t\t\t\t\tstarted = true\n\t\t\t\t\tstopTime = 0\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// TODO: affect time()\n\t\t\tset speed(val: number) {\n\t\t\t\tsrcNode.playbackRate.value = val\n\t\t\t},\n\n\t\t\tget speed() {\n\t\t\t\treturn srcNode.playbackRate.value\n\t\t\t},\n\n\t\t\tset detune(val: number) {\n\t\t\t\tsrcNode.detune.value = val\n\t\t\t},\n\n\t\t\tget detune() {\n\t\t\t\treturn srcNode.detune.value\n\t\t\t},\n\n\t\t\tset volume(val: number) {\n\t\t\t\tgainNode.gain.value = Math.max(val, 0)\n\t\t\t},\n\n\t\t\tget volume() {\n\t\t\t\treturn gainNode.gain.value\n\t\t\t},\n\n\t\t\tset loop(l: boolean) {\n\t\t\t\tsrcNode.loop = l\n\t\t\t},\n\n\t\t\tget loop() {\n\t\t\t\treturn srcNode.loop\n\t\t\t},\n\n\t\t\tduration(): number {\n\t\t\t\treturn srcNode.buffer?.duration ?? 0\n\t\t\t},\n\n\t\t\ttime(): number {\n\t\t\t\treturn getTime() % this.duration()\n\t\t\t},\n\n\t\t\tonEnd(action: () => void) {\n\t\t\t\treturn onEndEvents.add(action)\n\t\t\t},\n\n\t\t\tthen(action: () => void) {\n\t\t\t\treturn this.onEnd(action)\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\t// core kaboom logic\n\tfunction burp(opt?: AudioPlayOpt): AudioPlay {\n\t\treturn play(audio.burpSnd, opt)\n\t}\n\n\ttype DrawTextureOpt = RenderProps & {\n\t\ttex: Texture,\n\t\twidth?: number,\n\t\theight?: number,\n\t\ttiled?: boolean,\n\t\tflipX?: boolean,\n\t\tflipY?: boolean,\n\t\tquad?: Quad,\n\t\tanchor?: Anchor | Vec2,\n\t}\n\n\tfunction makeCanvas(w: number, h: number) {\n\t\treturn new FrameBuffer(ggl, w, h)\n\t}\n\n\tfunction makeShader(\n\t\tvertSrc: string | null = DEF_VERT,\n\t\tfragSrc: string | null = DEF_FRAG,\n\t): Shader {\n\t\tconst vcode = VERT_TEMPLATE.replace(\"{{user}}\", vertSrc ?? DEF_VERT)\n\t\tconst fcode = FRAG_TEMPLATE.replace(\"{{user}}\", fragSrc ?? DEF_FRAG)\n\t\ttry {\n\t\t\treturn new Shader(ggl, vcode, fcode, VERTEX_FORMAT.map((vert) => vert.name))\n\t\t} catch (e) {\n\t\t\tconst lineOffset = 14\n\t\t\tconst fmt = /(?<type>^\\w+) SHADER ERROR: 0:(?<line>\\d+): (?<msg>.+)/\n\t\t\tconst match = getErrorMessage(e).match(fmt)\n\t\t\tconst line = Number(match.groups.line) - lineOffset\n\t\t\tconst msg = match.groups.msg.trim()\n\t\t\tconst ty = match.groups.type.toLowerCase()\n\t\t\tthrow new Error(`${ty} shader line ${line}: ${msg}`)\n\t\t}\n\t}\n\n\tfunction makeFont(\n\t\ttex: Texture,\n\t\tgw: number,\n\t\tgh: number,\n\t\tchars: string,\n\t): GfxFont {\n\n\t\tconst cols = tex.width / gw\n\t\tconst map: Record<string, Quad> = {}\n\t\tconst charMap = chars.split(\"\").entries()\n\n\t\tfor (const [i, ch] of charMap) {\n\t\t\tmap[ch] = new Quad(\n\t\t\t\t(i % cols) * gw,\n\t\t\t\tMath.floor(i / cols) * gh,\n\t\t\t\tgw,\n\t\t\t\tgh,\n\t\t\t)\n\t\t}\n\n\t\treturn {\n\t\t\ttex: tex,\n\t\t\tmap: map,\n\t\t\tsize: gh,\n\t\t}\n\n\t}\n\n\t// TODO: expose\n\tfunction drawRaw(\n\t\tverts: Vertex[],\n\t\tindices: number[],\n\t\tfixed: boolean,\n\t\ttex: Texture = gfx.defTex,\n\t\tshaderSrc: RenderProps[\"shader\"] = gfx.defShader,\n\t\tuniform: Uniform = {},\n\t) {\n\n\t\tconst shader = resolveShader(shaderSrc)\n\n\t\tif (!shader || shader instanceof Asset) {\n\t\t\treturn\n\t\t}\n\n\t\tconst transform = (gfx.fixed || fixed)\n\t\t\t? gfx.transform\n\t\t\t: game.cam.transform.mult(gfx.transform)\n\n\t\tconst vv = []\n\n\t\tfor (const v of verts) {\n\t\t\t// normalized world space coordinate [-1.0 ~ 1.0]\n\t\t\tconst pt = screen2ndc(transform.multVec2(v.pos))\n\t\t\tvv.push(\n\t\t\t\tpt.x, pt.y,\n\t\t\t\tv.uv.x, v.uv.y,\n\t\t\t\tv.color.r / 255, v.color.g / 255, v.color.b / 255, v.opacity,\n\t\t\t)\n\t\t}\n\n\t\tgfx.renderer.push(gl.TRIANGLES, vv, indices, shader, tex, uniform)\n\n\t}\n\n\t// draw all batched shapes\n\tfunction flush() {\n\t\tgfx.renderer.flush()\n\t}\n\n\t// start a rendering frame, reset some states\n\tfunction frameStart() {\n\n\t\t// clear backbuffer\n\t\tgl.clear(gl.COLOR_BUFFER_BIT)\n\t\tgfx.frameBuffer.bind()\n\t\t// clear framebuffer\n\t\tgl.clear(gl.COLOR_BUFFER_BIT)\n\n\t\tif (!gfx.bgColor) {\n\t\t\tdrawUnscaled(() => {\n\t\t\t\tdrawUVQuad({\n\t\t\t\t\twidth: width(),\n\t\t\t\t\theight: height(),\n\t\t\t\t\tquad: new Quad(\n\t\t\t\t\t\t0,\n\t\t\t\t\t\t0,\n\t\t\t\t\t\twidth() / BG_GRID_SIZE,\n\t\t\t\t\t\theight() / BG_GRID_SIZE,\n\t\t\t\t\t),\n\t\t\t\t\ttex: gfx.bgTex,\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\n\t\tgfx.renderer.numDraws = 0\n\t\tgfx.fixed = false\n\t\tgfx.transformStack.length = 0\n\t\tgfx.transform = new Mat4()\n\n\t}\n\n\tfunction usePostEffect(name: string, uniform?: Uniform | (() => Uniform)) {\n\t\tgfx.postShader = name\n\t\tgfx.postShaderUniform = uniform ?? null\n\t}\n\n\tfunction frameEnd() {\n\n\t\t// TODO: don't render debug UI with framebuffer\n\t\t// TODO: polish framebuffer rendering / sizing issues\n\t\tflush()\n\t\tgfx.lastDrawCalls = gfx.renderer.numDraws\n\t\tgfx.frameBuffer.unbind()\n\t\tgl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight)\n\n\t\tconst ow = gfx.width\n\t\tconst oh = gfx.height\n\t\tgfx.width = gl.drawingBufferWidth / pixelDensity\n\t\tgfx.height = gl.drawingBufferHeight / pixelDensity\n\n\t\tdrawTexture({\n\t\t\tflipY: true,\n\t\t\ttex: gfx.frameBuffer.tex,\n\t\t\tpos: new Vec2(gfx.viewport.x, gfx.viewport.y),\n\t\t\twidth: gfx.viewport.width,\n\t\t\theight: gfx.viewport.height,\n\t\t\tshader: gfx.postShader,\n\t\t\tuniform: typeof gfx.postShaderUniform === \"function\"\n\t\t\t\t? gfx.postShaderUniform()\n\t\t\t\t: gfx.postShaderUniform,\n\t\t\tfixed: true,\n\t\t})\n\n\t\tflush()\n\t\tgfx.width = ow\n\t\tgfx.height = oh\n\n\t}\n\n\t// convert a screen space coordinate to webgl normalized device coordinate\n\tfunction screen2ndc(pt: Vec2): Vec2 {\n\t\treturn new Vec2(\n\t\t\tpt.x / width() * 2 - 1,\n\t\t\t-pt.y / height() * 2 + 1,\n\t\t)\n\t}\n\n\tfunction pushMatrix(m: Mat4) {\n\t\tgfx.transform = m.clone()\n\t}\n\n\tfunction pushTranslate(...args: Vec2Args) {\n\t\tif (args[0] === undefined) return\n\t\tconst p = vec2(...args)\n\t\tif (p.x === 0 && p.y === 0) return\n\t\tgfx.transform.translate(p)\n\t}\n\n\tfunction pushScale(...args: Vec2Args) {\n\t\tif (args[0] === undefined) return\n\t\tconst p = vec2(...args)\n\t\tif (p.x === 1 && p.y === 1) return\n\t\tgfx.transform.scale(p)\n\t}\n\n\tfunction pushRotate(a: number) {\n\t\tif (!a) return\n\t\tgfx.transform.rotate(a)\n\t}\n\n\tfunction pushTransform() {\n\t\tgfx.transformStack.push(gfx.transform.clone())\n\t}\n\n\tfunction popTransform() {\n\t\tif (gfx.transformStack.length > 0) {\n\t\t\tgfx.transform = gfx.transformStack.pop()\n\t\t}\n\t}\n\n\t// draw a uv textured quad\n\tfunction drawUVQuad(opt: DrawUVQuadOpt) {\n\n\t\tif (opt.width === undefined || opt.height === undefined) {\n\t\t\tthrow new Error(\"drawUVQuad() requires property \\\"width\\\" and \\\"height\\\".\")\n\t\t}\n\n\t\tif (opt.width <= 0 || opt.height <= 0) {\n\t\t\treturn\n\t\t}\n\n\t\tconst w = opt.width\n\t\tconst h = opt.height\n\t\tconst anchor = anchorPt(opt.anchor || DEF_ANCHOR)\n\t\tconst offset = anchor.scale(new Vec2(w, h).scale(-0.5))\n\t\tconst q = opt.quad || new Quad(0, 0, 1, 1)\n\t\tconst color = opt.color || rgb(255, 255, 255)\n\t\tconst opacity = opt.opacity ?? 1\n\n\t\t// apply uv padding to avoid artifacts\n\t\tconst uvPadX = opt.tex ? UV_PAD / opt.tex.width : 0\n\t\tconst uvPadY = opt.tex ? UV_PAD / opt.tex.height : 0\n\t\tconst qx = q.x + uvPadX\n\t\tconst qy = q.y + uvPadY\n\t\tconst qw = q.w - uvPadX * 2\n\t\tconst qh = q.h - uvPadY * 2\n\n\t\tpushTransform()\n\t\tpushTranslate(opt.pos)\n\t\tpushRotate(opt.angle)\n\t\tpushScale(opt.scale)\n\t\tpushTranslate(offset)\n\n\t\tdrawRaw([\n\t\t\t{\n\t\t\t\tpos: new Vec2(-w / 2, h / 2),\n\t\t\t\tuv: new Vec2(opt.flipX ? qx + qw : qx, opt.flipY ? qy : qy + qh),\n\t\t\t\tcolor: color,\n\t\t\t\topacity: opacity,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpos: new Vec2(-w / 2, -h / 2),\n\t\t\t\tuv: new Vec2(opt.flipX ? qx + qw : qx, opt.flipY ? qy + qh : qy),\n\t\t\t\tcolor: color,\n\t\t\t\topacity: opacity,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpos: new Vec2(w / 2, -h / 2),\n\t\t\t\tuv: new Vec2(opt.flipX ? qx : qx + qw, opt.flipY ? qy + qh : qy),\n\t\t\t\tcolor: color,\n\t\t\t\topacity: opacity,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpos: new Vec2(w / 2, h / 2),\n\t\t\t\tuv: new Vec2(opt.flipX ? qx : qx + qw, opt.flipY ? qy : qy + qh),\n\t\t\t\tcolor: color,\n\t\t\t\topacity: opacity,\n\t\t\t},\n\t\t], [0, 1, 3, 1, 2, 3], opt.fixed, opt.tex, opt.shader, opt.uniform)\n\n\t\tpopTransform()\n\n\t}\n\n\t// TODO: clean\n\tfunction drawTexture(opt: DrawTextureOpt) {\n\n\t\tif (!opt.tex) {\n\t\t\tthrow new Error(\"drawTexture() requires property \\\"tex\\\".\")\n\t\t}\n\n\t\tconst q = opt.quad ?? new Quad(0, 0, 1, 1)\n\t\tconst w = opt.tex.width * q.w\n\t\tconst h = opt.tex.height * q.h\n\t\tconst scale = new Vec2(1)\n\n\t\tif (opt.tiled) {\n\n\t\t\t// TODO: draw fract\n\t\t\tconst repX = Math.ceil((opt.width || w) / w)\n\t\t\tconst repY = Math.ceil((opt.height || h) / h)\n\t\t\tconst anchor = anchorPt(opt.anchor || DEF_ANCHOR).add(new Vec2(1, 1)).scale(0.5)\n\t\t\tconst offset = anchor.scale(repX * w, repY * h)\n\n\t\t\t// TODO: rotation\n\t\t\tfor (let i = 0; i < repX; i++) {\n\t\t\t\tfor (let j = 0; j < repY; j++) {\n\t\t\t\t\tdrawUVQuad(Object.assign({}, opt, {\n\t\t\t\t\t\tpos: (opt.pos || new Vec2(0)).add(new Vec2(w * i, h * j)).sub(offset),\n\t\t\t\t\t\tscale: scale.scale(opt.scale || new Vec2(1)),\n\t\t\t\t\t\ttex: opt.tex,\n\t\t\t\t\t\tquad: q,\n\t\t\t\t\t\twidth: w,\n\t\t\t\t\t\theight: h,\n\t\t\t\t\t\tanchor: \"topleft\",\n\t\t\t\t\t}))\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\n\t\t\t// TODO: should this ignore scale?\n\t\t\tif (opt.width && opt.height) {\n\t\t\t\tscale.x = opt.width / w\n\t\t\t\tscale.y = opt.height / h\n\t\t\t} else if (opt.width) {\n\t\t\t\tscale.x = opt.width / w\n\t\t\t\tscale.y = scale.x\n\t\t\t} else if (opt.height) {\n\t\t\t\tscale.y = opt.height / h\n\t\t\t\tscale.x = scale.y\n\t\t\t}\n\n\t\t\tdrawUVQuad(Object.assign({}, opt, {\n\t\t\t\tscale: scale.scale(opt.scale || new Vec2(1)),\n\t\t\t\ttex: opt.tex,\n\t\t\t\tquad: q,\n\t\t\t\twidth: w,\n\t\t\t\theight: h,\n\t\t\t}))\n\n\t\t}\n\n\t}\n\n\tfunction drawSprite(opt: DrawSpriteOpt) {\n\n\t\tif (!opt.sprite) {\n\t\t\tthrow new Error(\"drawSprite() requires property \\\"sprite\\\"\")\n\t\t}\n\n\t\t// TODO: slow\n\t\tconst spr = resolveSprite(opt.sprite)\n\n\t\tif (!spr || !spr.data) {\n\t\t\treturn\n\t\t}\n\n\t\tconst q = spr.data.frames[opt.frame ?? 0]\n\n\t\tif (!q) {\n\t\t\tthrow new Error(`Frame not found: ${opt.frame ?? 0}`)\n\t\t}\n\n\t\tdrawTexture(Object.assign({}, opt, {\n\t\t\ttex: spr.data.tex,\n\t\t\tquad: q.scale(opt.quad ?? new Quad(0, 0, 1, 1)),\n\t\t}))\n\n\t}\n\n\t// generate vertices to form an arc\n\tfunction getArcPts(\n\t\tpos: Vec2,\n\t\tradiusX: number,\n\t\tradiusY: number,\n\t\tstart: number,\n\t\tend: number,\n\t\tres: number = 1,\n\t): Vec2[] {\n\n\t\t// normalize and turn start and end angles to radians\n\t\tstart = deg2rad(start % 360)\n\t\tend = deg2rad(end % 360)\n\t\tif (end <= start) end += Math.PI * 2\n\n\t\tconst pts = []\n\t\tconst nverts = Math.ceil((end - start) / deg2rad(8) * res)\n\t\tconst step = (end - start) / nverts\n\n\t\t// calculate vertices\n\t\tfor (let a = start; a < end; a += step) {\n\t\t\tpts.push(pos.add(radiusX * Math.cos(a), radiusY * Math.sin(a)))\n\t\t}\n\n\t\tpts.push(pos.add(radiusX * Math.cos(end), radiusY * Math.sin(end)))\n\n\t\treturn pts\n\n\t}\n\n\tfunction drawRect(opt: DrawRectOpt) {\n\n\t\tif (opt.width === undefined || opt.height === undefined) {\n\t\t\tthrow new Error(\"drawRect() requires property \\\"width\\\" and \\\"height\\\".\")\n\t\t}\n\n\t\tif (opt.width <= 0 || opt.height <= 0) {\n\t\t\treturn\n\t\t}\n\n\t\tconst w = opt.width\n\t\tconst h = opt.height\n\t\tconst anchor = anchorPt(opt.anchor || DEF_ANCHOR).add(1, 1)\n\t\tconst offset = anchor.scale(new Vec2(w, h).scale(-0.5))\n\n\t\tlet pts = [\n\t\t\tnew Vec2(0, 0),\n\t\t\tnew Vec2(w, 0),\n\t\t\tnew Vec2(w, h),\n\t\t\tnew Vec2(0, h),\n\t\t]\n\n\t\t// TODO: gradient for rounded rect\n\t\t// TODO: drawPolygon should handle generic rounded corners\n\t\tif (opt.radius) {\n\n\t\t\t// maxium radius is half the shortest side\n\t\t\tconst r = Math.min(Math.min(w, h) / 2, opt.radius)\n\n\t\t\tpts = [\n\t\t\t\tnew Vec2(r, 0),\n\t\t\t\tnew Vec2(w - r, 0),\n\t\t\t\t...getArcPts(new Vec2(w - r, r), r, r, 270, 360),\n\t\t\t\tnew Vec2(w, r),\n\t\t\t\tnew Vec2(w, h - r),\n\t\t\t\t...getArcPts(new Vec2(w - r, h - r), r, r, 0, 90),\n\t\t\t\tnew Vec2(w - r, h),\n\t\t\t\tnew Vec2(r, h),\n\t\t\t\t...getArcPts(new Vec2(r, h - r), r, r, 90, 180),\n\t\t\t\tnew Vec2(0, h - r),\n\t\t\t\tnew Vec2(0, r),\n\t\t\t\t...getArcPts(new Vec2(r, r), r, r, 180, 270),\n\t\t\t]\n\n\t\t}\n\n\t\tdrawPolygon(Object.assign({}, opt, {\n\t\t\toffset,\n\t\t\tpts,\n\t\t\t...(opt.gradient ? {\n\t\t\t\tcolors: opt.horizontal ? [\n\t\t\t\t\topt.gradient[0],\n\t\t\t\t\topt.gradient[1],\n\t\t\t\t\topt.gradient[1],\n\t\t\t\t\topt.gradient[0],\n\t\t\t\t] : [\n\t\t\t\t\topt.gradient[0],\n\t\t\t\t\topt.gradient[0],\n\t\t\t\t\topt.gradient[1],\n\t\t\t\t\topt.gradient[1],\n\t\t\t\t],\n\t\t\t} : {}),\n\t\t}))\n\n\t}\n\n\tfunction drawLine(opt: DrawLineOpt) {\n\n\t\tconst { p1, p2 } = opt\n\n\t\tif (!p1 || !p2) {\n\t\t\tthrow new Error(\"drawLine() requires properties \\\"p1\\\" and \\\"p2\\\".\")\n\t\t}\n\n\t\tconst w = opt.width || 1\n\n\t\t// the displacement from the line end point to the corner point\n\t\tconst dis = p2.sub(p1).unit().normal().scale(w * 0.5)\n\n\t\t// calculate the 4 corner points of the line polygon\n\t\tconst verts = [\n\t\t\tp1.sub(dis),\n\t\t\tp1.add(dis),\n\t\t\tp2.add(dis),\n\t\t\tp2.sub(dis),\n\t\t].map((p) => ({\n\t\t\tpos: new Vec2(p.x, p.y),\n\t\t\tuv: new Vec2(0),\n\t\t\tcolor: opt.color ?? Color.WHITE,\n\t\t\topacity: opt.opacity ?? 1,\n\t\t}))\n\n\t\tdrawRaw(verts, [0, 1, 3, 1, 2, 3], opt.fixed, gfx.defTex, opt.shader, opt.uniform)\n\n\t}\n\n\tfunction drawLines(opt: DrawLinesOpt) {\n\n\t\tconst pts = opt.pts\n\n\t\tif (!pts) {\n\t\t\tthrow new Error(\"drawLines() requires property \\\"pts\\\".\")\n\t\t}\n\n\t\tif (pts.length < 2) {\n\t\t\treturn\n\t\t}\n\n\t\tif (opt.radius && pts.length >= 3) {\n\n\t\t\t// TODO: line joines\n\t\t\t// TODO: rounded vertices for arbitury polygonic shape\n\t\t\tlet minSLen = pts[0].sdist(pts[1])\n\n\t\t\tfor (let i = 1; i < pts.length - 1; i++) {\n\t\t\t\tminSLen = Math.min(pts[i].sdist(pts[i + 1]), minSLen)\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line\n\t\t\tconst radius = Math.min(opt.radius, Math.sqrt(minSLen) / 2)\n\n\t\t\tdrawLine(Object.assign({}, opt, { p1: pts[0], p2: pts[1] }))\n\n\t\t\tfor (let i = 1; i < pts.length - 2; i++) {\n\t\t\t\tconst p1 = pts[i]\n\t\t\t\tconst p2 = pts[i + 1]\n\t\t\t\tdrawLine(Object.assign({}, opt, {\n\t\t\t\t\tp1: p1,\n\t\t\t\t\tp2: p2,\n\t\t\t\t}))\n\t\t\t}\n\n\t\t\tdrawLine(Object.assign({}, opt, {\n\t\t\t\tp1: pts[pts.length - 2],\n\t\t\t\tp2: pts[pts.length - 1],\n\t\t\t}))\n\n\t\t} else {\n\n\t\t\tfor (let i = 0; i < pts.length - 1; i++) {\n\t\t\t\tdrawLine(Object.assign({}, opt, {\n\t\t\t\t\tp1: pts[i],\n\t\t\t\t\tp2: pts[i + 1],\n\t\t\t\t}))\n\t\t\t\t// TODO: other line join types\n\t\t\t\tif (opt.join !== \"none\") {\n\t\t\t\t\tdrawCircle(Object.assign({}, opt, {\n\t\t\t\t\t\tpos: pts[i],\n\t\t\t\t\t\tradius: opt.width / 2,\n\t\t\t\t\t}))\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction drawTriangle(opt: DrawTriangleOpt) {\n\t\tif (!opt.p1 || !opt.p2 || !opt.p3) {\n\t\t\tthrow new Error(\"drawTriangle() requires properties \\\"p1\\\", \\\"p2\\\" and \\\"p3\\\".\")\n\t\t}\n\t\treturn drawPolygon(Object.assign({}, opt, {\n\t\t\tpts: [opt.p1, opt.p2, opt.p3],\n\t\t}))\n\t}\n\n\tfunction drawCircle(opt: DrawCircleOpt) {\n\n\t\tif (typeof opt.radius !== \"number\") {\n\t\t\tthrow new Error(\"drawCircle() requires property \\\"radius\\\".\")\n\t\t}\n\n\t\tif (opt.radius === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tdrawEllipse(Object.assign({}, opt, {\n\t\t\tradiusX: opt.radius,\n\t\t\tradiusY: opt.radius,\n\t\t\tangle: 0,\n\t\t}))\n\n\t}\n\n\tfunction drawEllipse(opt: DrawEllipseOpt) {\n\n\t\tif (opt.radiusX === undefined || opt.radiusY === undefined) {\n\t\t\tthrow new Error(\"drawEllipse() requires properties \\\"radiusX\\\" and \\\"radiusY\\\".\")\n\t\t}\n\n\t\tif (opt.radiusX === 0 || opt.radiusY === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tconst start = opt.start ?? 0\n\t\tconst end = opt.end ?? 360\n\t\tconst offset = anchorPt(opt.anchor ?? \"center\").scale(new Vec2(-opt.radiusX, -opt.radiusY))\n\n\t\tconst pts = getArcPts(\n\t\t\toffset,\n\t\t\topt.radiusX,\n\t\t\topt.radiusY,\n\t\t\tstart,\n\t\t\tend,\n\t\t\topt.resolution,\n\t\t)\n\n\t\t// center\n\t\tpts.unshift(offset)\n\n\t\tconst polyOpt = Object.assign({}, opt, {\n\t\t\tpts,\n\t\t\tradius: 0,\n\t\t\t...(opt.gradient ? {\n\t\t\t\tcolors: [\n\t\t\t\t\topt.gradient[0],\n\t\t\t\t\t...Array(pts.length - 1).fill(opt.gradient[1]),\n\t\t\t\t],\n\t\t\t} : {}),\n\t\t})\n\n\t\t// full circle with outline shouldn't have the center point\n\t\tif (end - start >= 360 && opt.outline) {\n\t\t\tif (opt.fill !== false) {\n\t\t\t\tdrawPolygon(Object.assign(polyOpt, {\n\t\t\t\t\toutline: null,\n\t\t\t\t}))\n\t\t\t}\n\t\t\tdrawPolygon(Object.assign(polyOpt, {\n\t\t\t\tpts: pts.slice(1),\n\t\t\t\tfill: false,\n\t\t\t}))\n\t\t\treturn\n\t\t}\n\n\t\tdrawPolygon(polyOpt)\n\n\t}\n\n\tfunction drawPolygon(opt: DrawPolygonOpt) {\n\n\t\tif (!opt.pts) {\n\t\t\tthrow new Error(\"drawPolygon() requires property \\\"pts\\\".\")\n\t\t}\n\n\t\tconst npts = opt.pts.length\n\n\t\tif (npts < 3) {\n\t\t\treturn\n\t\t}\n\n\t\tpushTransform()\n\t\tpushTranslate(opt.pos)\n\t\tpushScale(opt.scale)\n\t\tpushRotate(opt.angle)\n\t\tpushTranslate(opt.offset)\n\n\t\tif (opt.fill !== false) {\n\n\t\t\tconst color = opt.color ?? Color.WHITE\n\n\t\t\tconst verts = opt.pts.map((pt, i) => ({\n\t\t\t\tpos: new Vec2(pt.x, pt.y),\n\t\t\t\tuv: new Vec2(0, 0),\n\t\t\t\tcolor: opt.colors ? (opt.colors[i] ? opt.colors[i].mult(color) : color) : color,\n\t\t\t\topacity: opt.opacity ?? 1,\n\t\t\t}))\n\n\t\t\t// TODO: better triangulation\n\t\t\tconst indices = [...Array(npts - 2).keys()]\n\t\t\t\t.map((n) => [0, n + 1, n + 2])\n\t\t\t\t.flat()\n\n\t\t\tdrawRaw(verts, opt.indices ?? indices, opt.fixed, gfx.defTex, opt.shader, opt.uniform)\n\n\t\t}\n\n\t\tif (opt.outline) {\n\t\t\tdrawLines({\n\t\t\t\tpts: [ ...opt.pts, opt.pts[0] ],\n\t\t\t\tradius: opt.radius,\n\t\t\t\twidth: opt.outline.width,\n\t\t\t\tcolor: opt.outline.color,\n\t\t\t\tjoin: opt.outline.join,\n\t\t\t\tuniform: opt.uniform,\n\t\t\t\tfixed: opt.fixed,\n\t\t\t\topacity: opt.opacity,\n\t\t\t})\n\t\t}\n\n\t\tpopTransform()\n\n\t}\n\n\tfunction drawStenciled(content: () => void, mask: () => void, test: number) {\n\n\t\tflush()\n\t\tgl.clear(gl.STENCIL_BUFFER_BIT)\n\t\tgl.enable(gl.STENCIL_TEST)\n\n\t\t// don't perform test, pure write\n\t\tgl.stencilFunc(\n\t\t\tgl.NEVER,\n\t\t\t1,\n\t\t\t0xFF,\n\t\t)\n\n\t\t// always replace since we're writing to the buffer\n\t\tgl.stencilOp(\n\t\t\tgl.REPLACE,\n\t\t\tgl.REPLACE,\n\t\t\tgl.REPLACE,\n\t\t)\n\n\t\tmask()\n\t\tflush()\n\n\t\t// perform test\n\t\tgl.stencilFunc(\n\t\t\ttest,\n\t\t\t1,\n\t\t\t0xFF,\n\t\t)\n\n\t\t// don't write since we're only testing\n\t\tgl.stencilOp(\n\t\t\tgl.KEEP,\n\t\t\tgl.KEEP,\n\t\t\tgl.KEEP,\n\t\t)\n\n\t\tcontent()\n\t\tflush()\n\t\tgl.disable(gl.STENCIL_TEST)\n\n\t}\n\n\tfunction drawMasked(content: () => void, mask: () => void) {\n\t\tdrawStenciled(content, mask, gl.EQUAL)\n\t}\n\n\tfunction drawSubtracted(content: () => void, mask: () => void) {\n\t\tdrawStenciled(content, mask, gl.NOTEQUAL)\n\t}\n\n\tfunction getViewportScale() {\n\t\treturn (gfx.viewport.width + gfx.viewport.height) / (gfx.width + gfx.height)\n\t}\n\n\tfunction drawUnscaled(content: () => void) {\n\t\tflush()\n\t\tconst ow = gfx.width\n\t\tconst oh = gfx.height\n\t\tgfx.width = gfx.viewport.width\n\t\tgfx.height = gfx.viewport.height\n\t\tcontent()\n\t\tflush()\n\t\tgfx.width = ow\n\t\tgfx.height = oh\n\t}\n\n\tfunction applyCharTransform(fchar: FormattedChar, tr: CharTransform) {\n\t\tif (tr.pos) fchar.pos = fchar.pos.add(tr.pos)\n\t\tif (tr.scale) fchar.scale = fchar.scale.scale(vec2(tr.scale))\n\t\tif (tr.angle) fchar.angle += tr.angle\n\t\tif (tr.color && fchar.ch.length === 1) fchar.color = fchar.color.mult(tr.color)\n\t\tif (tr.opacity) fchar.opacity *= tr.opacity\n\t}\n\n\t// TODO: escape\n\t// eslint-disable-next-line\n\tconst TEXT_STYLE_RE = /\\[(?<style>\\w+)\\](?<text>.*?)\\[\\/\\k<style>\\]/g\n\n\t// TODO: handle nested\n\tfunction compileStyledText(text: string): {\n\t\tcharStyleMap: Record<number, string[]>,\n\t\ttext: string,\n\t} {\n\n\t\tconst charStyleMap = {}\n\t\t// get the text without the styling syntax\n\t\tconst renderText = text.replace(TEXT_STYLE_RE, \"$2\")\n\t\tlet idxOffset = 0\n\n\t\t// put each styled char index into a map for easy access when iterating each char\n\t\tfor (const match of text.matchAll(TEXT_STYLE_RE)) {\n\t\t\tconst origIdx = match.index - idxOffset\n\t\t\tfor (let i = 0; i < match.groups.text.length; i++) {\n\t\t\t\tcharStyleMap[i + origIdx] = [match.groups.style]\n\t\t\t}\n\t\t\t// omit the style syntax in format string when calculating index\n\t\t\tidxOffset += match[0].length - match.groups.text.length\n\t\t}\n\n\t\treturn {\n\t\t\tcharStyleMap: charStyleMap,\n\t\t\ttext: renderText,\n\t\t}\n\n\t}\n\n\ttype FontAtlas = {\n\t\tfont: BitmapFontData,\n\t\tcursor: Vec2,\n\t\toutline: Outline | null,\n\t}\n\n\tconst fontAtlases: Record<string, FontAtlas> = {}\n\n\t// TODO: cache formatted text\n\t// format text and return a list of chars with their calculated position\n\tfunction formatText(opt: DrawTextOpt): FormattedText {\n\n\t\tif (opt.text === undefined) {\n\t\t\tthrow new Error(\"formatText() requires property \\\"text\\\".\")\n\t\t}\n\n\t\tlet font = resolveFont(opt.font)\n\n\t\t// if it's still loading\n\t\tif (opt.text === \"\" || font instanceof Asset || !font) {\n\t\t\treturn {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t\tchars: [],\n\t\t\t\topt: opt,\n\t\t\t}\n\t\t}\n\n\t\tconst { charStyleMap, text } = compileStyledText(opt.text + \"\")\n\t\tconst chars = runes(text)\n\n\t\t// if it's not bitmap font, we draw it with 2d canvas or use cached image\n\t\tif (font instanceof FontData || typeof font === \"string\") {\n\n\t\t\tconst fontName = font instanceof FontData ? font.fontface.family : font\n\t\t\tconst opts: {\n\t\t\t\toutline: Outline | null,\n\t\t\t\tfilter: TexFilter,\n\t\t\t} = font instanceof FontData ? {\n\t\t\t\toutline: font.outline,\n\t\t\t\tfilter: font.filter,\n\t\t\t} : {\n\t\t\t\toutline: null,\n\t\t\t\tfilter: DEF_FONT_FILTER,\n\t\t\t}\n\n\t\t\t// TODO: customizable font tex filter\n\t\t\tconst atlas: FontAtlas = fontAtlases[fontName] ?? {\n\t\t\t\tfont: {\n\t\t\t\t\ttex: new Texture(ggl, FONT_ATLAS_WIDTH, FONT_ATLAS_HEIGHT, {\n\t\t\t\t\t\tfilter: opts.filter,\n\t\t\t\t\t}),\n\t\t\t\t\tmap: {},\n\t\t\t\t\tsize: DEF_TEXT_CACHE_SIZE,\n\t\t\t\t},\n\t\t\t\tcursor: new Vec2(0),\n\t\t\t\toutline: opts.outline,\n\t\t\t}\n\n\t\t\tif (!fontAtlases[fontName]) {\n\t\t\t\tfontAtlases[fontName] = atlas\n\t\t\t}\n\n\t\t\tfont = atlas.font\n\n\t\t\tfor (const ch of chars) {\n\n\t\t\t\tif (!atlas.font.map[ch]) {\n\n\t\t\t\t\t// TODO: use assets.packer to pack font texture\n\t\t\t\t\tconst c2d = fontCacheC2d\n\t\t\t\t\tc2d.clearRect(0, 0, fontCacheCanvas.width, fontCacheCanvas.height)\n\t\t\t\t\tc2d.font = `${font.size}px ${fontName}`\n\t\t\t\t\tc2d.textBaseline = \"top\"\n\t\t\t\t\tc2d.textAlign = \"left\"\n\t\t\t\t\tc2d.fillStyle = \"#ffffff\"\n\t\t\t\t\tconst m = c2d.measureText(ch)\n\t\t\t\t\tlet w = Math.ceil(m.width)\n\t\t\t\t\tlet h = font.size\n\t\t\t\t\tif (atlas.outline) {\n\t\t\t\t\t\tc2d.lineJoin = \"round\"\n\t\t\t\t\t\tc2d.lineWidth = atlas.outline.width * 2\n\t\t\t\t\t\tc2d.strokeStyle = atlas.outline.color.toHex()\n\t\t\t\t\t\tc2d.strokeText(ch, atlas.outline.width, atlas.outline.width)\n\t\t\t\t\t\tw += atlas.outline.width * 2\n\t\t\t\t\t\th += atlas.outline.width * 3\n\t\t\t\t\t}\n\t\t\t\t\tc2d.fillText(ch, atlas.outline?.width ?? 0, atlas.outline?.width ?? 0)\n\n\t\t\t\t\tconst img = c2d.getImageData(0, 0, w, h)\n\n\t\t\t\t\t// if we are about to exceed the X axis of the texture, go to another line\n\t\t\t\t\tif (atlas.cursor.x + w > FONT_ATLAS_WIDTH) {\n\t\t\t\t\t\tatlas.cursor.x = 0\n\t\t\t\t\t\tatlas.cursor.y += h\n\t\t\t\t\t\tif (atlas.cursor.y > FONT_ATLAS_HEIGHT) {\n\t\t\t\t\t\t\t// TODO: create another atlas\n\t\t\t\t\t\t\tthrow new Error(\"Font atlas exceeds character limit\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfont.tex.update(img, atlas.cursor.x, atlas.cursor.y)\n\t\t\t\t\tfont.map[ch] = new Quad(atlas.cursor.x, atlas.cursor.y, w, h)\n\t\t\t\t\tatlas.cursor.x += w\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst size = opt.size || font.size\n\t\tconst scale = vec2(opt.scale ?? 1).scale(size / font.size)\n\t\tconst lineSpacing = opt.lineSpacing ?? 0\n\t\tconst letterSpacing = opt.letterSpacing ?? 0\n\t\tlet curX = 0\n\t\tlet tw = 0\n\t\tlet th = 0\n\t\tconst lines: Array<{\n\t\t\twidth: number,\n\t\t\tchars: FormattedChar[],\n\t\t}> = []\n\t\tlet curLine: FormattedChar[] = []\n\t\tlet cursor = 0\n\t\tlet lastSpace = null\n\t\tlet lastSpaceWidth = null\n\n\t\t// TODO: word break\n\t\twhile (cursor < chars.length) {\n\n\t\t\tlet ch = chars[cursor]\n\n\t\t\t// always new line on '\\n'\n\t\t\tif (ch === \"\\n\") {\n\n\t\t\t\tth += size + lineSpacing\n\n\t\t\t\tlines.push({\n\t\t\t\t\twidth: curX - letterSpacing,\n\t\t\t\t\tchars: curLine,\n\t\t\t\t})\n\n\t\t\t\tlastSpace = null\n\t\t\t\tlastSpaceWidth = null\n\t\t\t\tcurX = 0\n\t\t\t\tcurLine = []\n\n\t\t\t} else {\n\n\t\t\t\tlet q = font.map[ch]\n\n\t\t\t\t// TODO: leave space if character not found?\n\t\t\t\tif (q) {\n\n\t\t\t\t\tlet gw = q.w * scale.x\n\n\t\t\t\t\tif (opt.width && curX + gw > opt.width) {\n\t\t\t\t\t\t// new line on last word if width exceeds\n\t\t\t\t\t\tth += size + lineSpacing\n\t\t\t\t\t\tif (lastSpace != null) {\n\t\t\t\t\t\t\tcursor -= curLine.length - lastSpace\n\t\t\t\t\t\t\tch = chars[cursor]\n\t\t\t\t\t\t\tq = font.map[ch]\n\t\t\t\t\t\t\tgw = q.w * scale.x\n\t\t\t\t\t\t\t// omit trailing space\n\t\t\t\t\t\t\tcurLine = curLine.slice(0, lastSpace - 1)\n\t\t\t\t\t\t\tcurX = lastSpaceWidth\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlastSpace = null\n\t\t\t\t\t\tlastSpaceWidth = null\n\t\t\t\t\t\tlines.push({\n\t\t\t\t\t\t\twidth: curX - letterSpacing,\n\t\t\t\t\t\t\tchars: curLine,\n\t\t\t\t\t\t})\n\t\t\t\t\t\tcurX = 0\n\t\t\t\t\t\tcurLine = []\n\t\t\t\t\t}\n\n\t\t\t\t\t// push char\n\t\t\t\t\tcurLine.push({\n\t\t\t\t\t\ttex: font.tex,\n\t\t\t\t\t\twidth: q.w,\n\t\t\t\t\t\theight: q.h,\n\t\t\t\t\t\t// without some padding there'll be visual artifacts on edges\n\t\t\t\t\t\tquad: new Quad(\n\t\t\t\t\t\t\tq.x / font.tex.width,\n\t\t\t\t\t\t\tq.y / font.tex.height,\n\t\t\t\t\t\t\tq.w / font.tex.width,\n\t\t\t\t\t\t\tq.h / font.tex.height,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tch: ch,\n\t\t\t\t\t\tpos: new Vec2(curX, th),\n\t\t\t\t\t\topacity: opt.opacity ?? 1,\n\t\t\t\t\t\tcolor: opt.color ?? Color.WHITE,\n\t\t\t\t\t\tscale: vec2(scale),\n\t\t\t\t\t\tangle: 0,\n\t\t\t\t\t})\n\n\t\t\t\t\tif (ch === \" \") {\n\t\t\t\t\t\tlastSpace = curLine.length\n\t\t\t\t\t\tlastSpaceWidth = curX\n\t\t\t\t\t}\n\n\t\t\t\t\tcurX += gw\n\t\t\t\t\ttw = Math.max(tw, curX)\n\t\t\t\t\tcurX += letterSpacing\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tcursor++\n\n\t\t}\n\n\t\tlines.push({\n\t\t\twidth: curX - letterSpacing,\n\t\t\tchars: curLine,\n\t\t})\n\n\t\tth += size\n\n\t\tif (opt.width) {\n\t\t\ttw = opt.width\n\t\t}\n\n\t\tconst fchars: FormattedChar[] = []\n\n\t\tfor (const line of lines) {\n\n\t\t\tconst ox = (tw - line.width) * alignPt(opt.align ?? \"left\")\n\n\t\t\tfor (const fchar of line.chars) {\n\n\t\t\t\tconst q = font.map[fchar.ch]\n\t\t\t\tconst idx = fchars.length\n\n\t\t\t\tfchar.pos = fchar.pos.add(ox, 0).add(\n\t\t\t\t\tq.w * scale.x * 0.5,\n\t\t\t\t\tq.h * scale.y * 0.5,\n\t\t\t\t)\n\n\t\t\t\tif (opt.transform) {\n\t\t\t\t\tconst tr = typeof opt.transform === \"function\"\n\t\t\t\t\t\t? opt.transform(idx, fchar.ch)\n\t\t\t\t\t\t: opt.transform\n\t\t\t\t\tif (tr) {\n\t\t\t\t\t\tapplyCharTransform(fchar, tr)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (charStyleMap[idx]) {\n\t\t\t\t\tconst styles = charStyleMap[idx]\n\t\t\t\t\tfor (const name of styles) {\n\t\t\t\t\t\tconst style = opt.styles[name]\n\t\t\t\t\t\tconst tr = typeof style === \"function\"\n\t\t\t\t\t\t\t? style(idx, fchar.ch)\n\t\t\t\t\t\t\t: style\n\t\t\t\t\t\tif (tr) {\n\t\t\t\t\t\t\tapplyCharTransform(fchar, tr)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfchars.push(fchar)\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn {\n\t\t\twidth: tw,\n\t\t\theight: th,\n\t\t\tchars: fchars,\n\t\t\topt: opt,\n\t\t}\n\n\t}\n\n\tfunction drawText(opt: DrawTextOpt) {\n\t\tdrawFormattedText(formatText(opt))\n\t}\n\n\tfunction drawFormattedText(ftext: FormattedText) {\n\t\tpushTransform()\n\t\tpushTranslate(ftext.opt.pos)\n\t\tpushRotate(ftext.opt.angle)\n\t\tpushTranslate(anchorPt(ftext.opt.anchor ?? \"topleft\").add(1, 1).scale(ftext.width, ftext.height).scale(-0.5))\n\t\tftext.chars.forEach((ch) => {\n\t\t\tdrawUVQuad({\n\t\t\t\ttex: ch.tex,\n\t\t\t\twidth: ch.width,\n\t\t\t\theight: ch.height,\n\t\t\t\tpos: ch.pos,\n\t\t\t\tscale: ch.scale,\n\t\t\t\tangle: ch.angle,\n\t\t\t\tcolor: ch.color,\n\t\t\t\topacity: ch.opacity,\n\t\t\t\tquad: ch.quad,\n\t\t\t\tanchor: \"center\",\n\t\t\t\tuniform: ftext.opt.uniform,\n\t\t\t\tshader: ftext.opt.shader,\n\t\t\t\tfixed: ftext.opt.fixed,\n\t\t\t})\n\t\t})\n\t\tpopTransform()\n\t}\n\n\t// get game width\n\tfunction width(): number {\n\t\treturn gfx.width\n\t}\n\n\t// get game height\n\tfunction height(): number {\n\t\treturn gfx.height\n\t}\n\n\t// transform a point from window space to content space\n\tfunction windowToContent(pt: Vec2) {\n\t\treturn new Vec2(\n\t\t\t(pt.x - gfx.viewport.x) * width() / gfx.viewport.width,\n\t\t\t(pt.y - gfx.viewport.y) * height() / gfx.viewport.height,\n\t\t)\n\t}\n\n\t// transform a point from content space to view space\n\tfunction contentToView(pt: Vec2) {\n\t\treturn new Vec2(\n\t\t\tpt.x * gfx.viewport.width / gfx.width,\n\t\t\tpt.y * gfx.viewport.height / gfx.height,\n\t\t)\n\t}\n\n\tfunction mousePos() {\n\t\treturn windowToContent(app.mousePos())\n\t}\n\n\tlet debugPaused = false\n\n\tconst debug: Debug = {\n\t\tinspect: false,\n\t\ttimeScale: 1,\n\t\tshowLog: true,\n\t\tfps: () => app.fps(),\n\t\tnumFrames: () => app.numFrames(),\n\t\tstepFrame: updateFrame,\n\t\tdrawCalls: () => gfx.lastDrawCalls,\n\t\tclearLog: () => game.logs = [],\n\t\tlog: (msg) => {\n\t\t\tconst max = gopt.logMax ?? LOG_MAX\n\t\t\tgame.logs.unshift({\n\t\t\t\tmsg: msg,\n\t\t\t\ttime: app.time(),\n\t\t\t})\n\t\t\tif (game.logs.length > max) {\n\t\t\t\tgame.logs = game.logs.slice(0, max)\n\t\t\t}\n\t\t},\n\t\terror: (msg) => debug.log(new Error(msg.toString ? msg.toString() : msg as string)),\n\t\tcurRecording: null,\n\t\tnumObjects: () => get(\"*\", { recursive: true }).length,\n\t\tget paused() {\n\t\t\treturn debugPaused\n\t\t},\n\t\tset paused(v) {\n\t\t\tdebugPaused = v\n\t\t\tif (v) {\n\t\t\t\taudio.ctx.suspend()\n\t\t\t} else {\n\t\t\t\taudio.ctx.resume()\n\t\t\t}\n\t\t},\n\t}\n\n\tfunction dt() {\n\t\treturn app.dt() * debug.timeScale\n\t}\n\n\tfunction camPos(...pos: Vec2Args): Vec2 {\n\t\tif (pos.length > 0) {\n\t\t\tgame.cam.pos = vec2(...pos)\n\t\t}\n\t\treturn game.cam.pos ? game.cam.pos.clone() : center()\n\t}\n\n\tfunction camScale(...scale: Vec2Args): Vec2 {\n\t\tif (scale.length > 0) {\n\t\t\tgame.cam.scale = vec2(...scale)\n\t\t}\n\t\treturn game.cam.scale.clone()\n\t}\n\n\tfunction camRot(angle: number): number {\n\t\tif (angle !== undefined) {\n\t\t\tgame.cam.angle = angle\n\t\t}\n\t\treturn game.cam.angle\n\t}\n\n\tfunction shake(intensity: number = 12) {\n\t\tgame.cam.shake += intensity\n\t}\n\n\tfunction toScreen(p: Vec2): Vec2 {\n\t\treturn game.cam.transform.multVec2(p)\n\t}\n\n\tfunction toWorld(p: Vec2): Vec2 {\n\t\treturn game.cam.transform.invert().multVec2(p)\n\t}\n\n\tfunction calcTransform(obj: GameObj): Mat4 {\n\t\tconst tr = new Mat4()\n\t\tif (obj.pos) tr.translate(obj.pos)\n\t\tif (obj.scale) tr.scale(obj.scale)\n\t\tif (obj.angle) tr.rotate(obj.angle)\n\t\treturn obj.parent ? tr.mult(obj.parent.transform) : tr\n\t}\n\n\tfunction make<T>(comps: CompList<T> = []): GameObj<T> {\n\n\t\tconst compStates = new Map()\n\t\tconst cleanups = {}\n\t\tconst events = new EventHandler()\n\t\tconst inputEvents: EventController[] = []\n\t\tlet onCurCompCleanup = null\n\t\tlet paused = false\n\n\t\t// @ts-ignore\n\t\tconst obj: GameObj = {\n\n\t\t\tid: uid(),\n\t\t\t// TODO: a nice way to hide / pause when add()-ing\n\t\t\thidden: false,\n\t\t\ttransform: new Mat4(),\n\t\t\tchildren: [],\n\t\t\tparent: null,\n\n\t\t\tset paused(p) {\n\t\t\t\tif (p === paused) return\n\t\t\t\tpaused = p\n\t\t\t\tfor (const e of inputEvents) {\n\t\t\t\t\te.paused = p\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tget paused() {\n\t\t\t\treturn paused\n\t\t\t},\n\n\t\t\tadd<T2>(a: CompList<T2> | GameObj<T2> = []): GameObj<T2> {\n\t\t\t\tconst obj = Array.isArray(a) ? make(a) : a\n\t\t\t\tif (obj.parent) {\n\t\t\t\t\tthrow new Error(\"Cannot add a game obj that already has a parent.\")\n\t\t\t\t}\n\t\t\t\tobj.parent = this\n\t\t\t\tobj.transform = calcTransform(obj)\n\t\t\t\tthis.children.push(obj)\n\t\t\t\t// TODO: trigger add for children\n\t\t\t\tobj.trigger(\"add\", obj)\n\t\t\t\tgame.events.trigger(\"add\", obj)\n\t\t\t\treturn obj\n\t\t\t},\n\n\t\t\treadd(obj: GameObj): GameObj {\n\t\t\t\tconst idx = this.children.indexOf(obj)\n\t\t\t\tif (idx !== -1) {\n\t\t\t\t\tthis.children.splice(idx, 1)\n\t\t\t\t\tthis.children.push(obj)\n\t\t\t\t}\n\t\t\t\treturn obj\n\t\t\t},\n\n\t\t\tremove(obj: GameObj): void {\n\t\t\t\tconst idx = this.children.indexOf(obj)\n\t\t\t\tif (idx !== -1) {\n\t\t\t\t\tobj.parent = null\n\t\t\t\t\tthis.children.splice(idx, 1)\n\t\t\t\t\tconst trigger = (o) => {\n\t\t\t\t\t\to.trigger(\"destroy\")\n\t\t\t\t\t\tgame.events.trigger(\"destroy\", o)\n\t\t\t\t\t\to.children.forEach((child) => trigger(child))\n\t\t\t\t\t}\n\t\t\t\t\ttrigger(obj)\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// TODO: recursive\n\t\t\tremoveAll(tag?: Tag) {\n\t\t\t\tif (tag) {\n\t\t\t\t\tthis.get(tag).forEach((obj) => this.remove(obj))\n\t\t\t\t} else {\n\t\t\t\t\tfor (const child of [...this.children]) this.remove(child)\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tupdate() {\n\t\t\t\tif (this.paused) return\n\t\t\t\tthis.children\n\t\t\t\t\t.sort((o1, o2) => (o1.z ?? 0) - (o2.z ?? 0))\n\t\t\t\t\t.forEach((child) => child.update())\n\t\t\t\tthis.trigger(\"update\")\n\t\t\t},\n\n\t\t\tdraw(this: GameObj<PosComp | ScaleComp | RotateComp | FixedComp | MaskComp>) {\n\t\t\t\tif (this.hidden) return\n\t\t\t\tif (this.canvas) this.canvas.bind()\n\t\t\t\tconst f = gfx.fixed\n\t\t\t\tif (this.fixed) gfx.fixed = true\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(this.pos)\n\t\t\t\tpushScale(this.scale)\n\t\t\t\tpushRotate(this.angle)\n\t\t\t\tconst children = this.children.sort((o1, o2) => (o1.z ?? 0) - (o2.z ?? 0))\n\t\t\t\t// TODO: automatically don't draw if offscreen\n\t\t\t\tif (this.mask) {\n\t\t\t\t\tconst maskFunc = {\n\t\t\t\t\t\tintersect: drawMasked,\n\t\t\t\t\t\tsubtract: drawSubtracted,\n\t\t\t\t\t}[this.mask]\n\t\t\t\t\tif (!maskFunc) {\n\t\t\t\t\t\tthrow new Error(`Invalid mask func: \"${this.mask}\"`)\n\t\t\t\t\t}\n\t\t\t\t\tmaskFunc(() => {\n\t\t\t\t\t\tchildren.forEach((child) => child.draw())\n\t\t\t\t\t}, () => {\n\t\t\t\t\t\tthis.trigger(\"draw\")\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tthis.trigger(\"draw\")\n\t\t\t\t\tchildren.forEach((child) => child.draw())\n\t\t\t\t}\n\t\t\t\tpopTransform()\n\t\t\t\tgfx.fixed = f\n\t\t\t\tif (this.canvas) this.canvas.unbind()\n\t\t\t},\n\n\t\t\tdrawInspect(this: GameObj<PosComp | ScaleComp | RotateComp>) {\n\t\t\t\tif (this.hidden) return\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(this.pos)\n\t\t\t\tpushScale(this.scale)\n\t\t\t\tpushRotate(this.angle)\n\t\t\t\tthis.children\n\t\t\t\t\t.sort((o1, o2) => (o1.z ?? 0) - (o2.z ?? 0))\n\t\t\t\t\t.forEach((child) => child.drawInspect())\n\t\t\t\tthis.trigger(\"drawInspect\")\n\t\t\t\tpopTransform()\n\t\t\t},\n\n\t\t\t// use a comp, or tag\n\t\t\tuse(comp: Comp | Tag) {\n\n\t\t\t\tif (!comp) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\t// tag\n\t\t\t\tif (typeof comp === \"string\") {\n\t\t\t\t\treturn this.use({\n\t\t\t\t\t\tid: comp,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tlet gc = []\n\n\t\t\t\t// clear if overwrite\n\t\t\t\tif (comp.id) {\n\t\t\t\t\tthis.unuse(comp.id)\n\t\t\t\t\tcleanups[comp.id] = []\n\t\t\t\t\tgc = cleanups[comp.id]\n\t\t\t\t\tcompStates.set(comp.id, comp)\n\t\t\t\t}\n\n\t\t\t\tfor (const k in comp) {\n\n\t\t\t\t\tif (COMP_DESC.has(k)) {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\n\t\t\t\t\tconst prop = Object.getOwnPropertyDescriptor(comp, k)\n\n\t\t\t\t\tif (typeof prop.value === \"function\") {\n\t\t\t\t\t\tcomp[k] = comp[k].bind(this)\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prop.set) {\n\t\t\t\t\t\tObject.defineProperty(comp, k, {\n\t\t\t\t\t\t\tset: prop.set.bind(this),\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prop.get) {\n\t\t\t\t\t\tObject.defineProperty(comp, k, {\n\t\t\t\t\t\t\tget: prop.get.bind(this),\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tif (COMP_EVENTS.has(k)) {\n\t\t\t\t\t\t// automatically clean up events created by components in add() stage\n\t\t\t\t\t\tconst func = k === \"add\" ? () => {\n\t\t\t\t\t\t\tonCurCompCleanup = (c) => gc.push(c)\n\t\t\t\t\t\t\tcomp[k]()\n\t\t\t\t\t\t\tonCurCompCleanup = null\n\t\t\t\t\t\t} : comp[k]\n\t\t\t\t\t\tgc.push(this.on(k, func).cancel)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (this[k] === undefined) {\n\t\t\t\t\t\t\t// assign comp fields to game obj\n\t\t\t\t\t\t\tObject.defineProperty(this, k, {\n\t\t\t\t\t\t\t\tget: () => comp[k],\n\t\t\t\t\t\t\t\tset: (val) => comp[k] = val,\n\t\t\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tgc.push(() => delete this[k])\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(`Duplicate component property: \"${k}\"`)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// check for component dependencies\n\t\t\t\tconst checkDeps = () => {\n\t\t\t\t\tif (!comp.require) return\n\t\t\t\t\tfor (const dep of comp.require) {\n\t\t\t\t\t\tif (!this.c(dep)) {\n\t\t\t\t\t\t\tthrow new Error(`Component \"${comp.id}\" requires component \"${dep}\"`)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (comp.destroy) {\n\t\t\t\t\tgc.push(comp.destroy.bind(this))\n\t\t\t\t}\n\n\t\t\t\t// manually trigger add event if object already exist\n\t\t\t\tif (this.exists()) {\n\t\t\t\t\tcheckDeps()\n\t\t\t\t\tif (comp.add) {\n\t\t\t\t\t\tonCurCompCleanup = (c) => gc.push(c)\n\t\t\t\t\t\tcomp.add.call(this)\n\t\t\t\t\t\tonCurCompCleanup = null\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (comp.require) {\n\t\t\t\t\t\tgc.push(this.on(\"add\", checkDeps).cancel)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tunuse(id: Tag) {\n\t\t\t\tif (cleanups[id]) {\n\t\t\t\t\tcleanups[id].forEach((e) => e())\n\t\t\t\t\tdelete cleanups[id]\n\t\t\t\t}\n\t\t\t\tif (compStates.has(id)) {\n\t\t\t\t\tcompStates.delete(id)\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tc(id: Tag): Comp {\n\t\t\t\treturn compStates.get(id)\n\t\t\t},\n\n\t\t\tget(t: Tag | Tag[], opts: GetOpt = {}): GameObj[] {\n\t\t\t\tlet list: GameObj[] = opts.recursive\n\t\t\t\t\t? this.children.flatMap(function recurse(child) {\n\t\t\t\t\t\treturn [child, ...child.children.flatMap(recurse)]\n\t\t\t\t\t})\n\t\t\t\t\t: this.children\n\t\t\t\tlist = list.filter((child) => t ? child.is(t) : true)\n\t\t\t\tif (opts.liveUpdate) {\n\t\t\t\t\tconst isChild = (obj) => {\n\t\t\t\t\t\treturn opts.recursive\n\t\t\t\t\t\t\t? this.isAncestorOf(obj)\n\t\t\t\t\t\t\t: obj.parent === this\n\t\t\t\t\t}\n\t\t\t\t\tconst events = []\n\t\t\t\t\t// TODO: handle when object add / remove tags\n\t\t\t\t\t// TODO: clean up when obj destroyed\n\t\t\t\t\tevents.push(onAdd((obj) => {\n\t\t\t\t\t\tif (isChild(obj) && obj.is(t)) {\n\t\t\t\t\t\t\tlist.push(obj)\n\t\t\t\t\t\t}\n\t\t\t\t\t}))\n\t\t\t\t\tevents.push(onDestroy((obj) => {\n\t\t\t\t\t\tif (isChild(obj) && obj.is(t)) {\n\t\t\t\t\t\t\tconst idx = list.findIndex((o) => o.id === obj.id)\n\t\t\t\t\t\t\tif (idx !== -1) {\n\t\t\t\t\t\t\t\tlist.splice(idx, 1)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}))\n\t\t\t\t\tthis.onDestroy(() => {\n\t\t\t\t\t\tfor (const ev of events) {\n\t\t\t\t\t\t\tev.cancel()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\treturn list\n\t\t\t},\n\n\t\t\tisAncestorOf(obj: GameObj) {\n\t\t\t\tif (!obj.parent) {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\treturn obj.parent === this || this.isAncestorOf(obj.parent)\n\t\t\t},\n\n\t\t\texists(): boolean {\n\t\t\t\treturn game.root.isAncestorOf(this)\n\t\t\t},\n\n\t\t\tis(tag: Tag | Tag[]): boolean {\n\t\t\t\tif (tag === \"*\") {\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(tag)) {\n\t\t\t\t\tfor (const t of tag) {\n\t\t\t\t\t\tif (!this.c(t)) {\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true\n\t\t\t\t} else {\n\t\t\t\t\treturn this.c(tag) != null\n\t\t\t\t}\n\t\t\t},\n\n\t\t\ton(name: string, action: (...args) => void): EventController {\n\t\t\t\tconst ctrl = events.on(name, action.bind(this))\n\t\t\t\tif (onCurCompCleanup) {\n\t\t\t\t\tonCurCompCleanup(() => ctrl.cancel())\n\t\t\t\t}\n\t\t\t\treturn ctrl\n\t\t\t},\n\n\t\t\ttrigger(name: string, ...args): void {\n\t\t\t\tevents.trigger(name, ...args)\n\t\t\t\tgame.objEvents.trigger(name, this, ...args)\n\t\t\t},\n\n\t\t\tdestroy() {\n\t\t\t\tif (this.parent) {\n\t\t\t\t\tthis.parent.remove(this)\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tinspect() {\n\t\t\t\tconst info = {}\n\t\t\t\tfor (const [tag, comp] of compStates) {\n\t\t\t\t\tinfo[tag] = comp.inspect ? comp.inspect() : null\n\t\t\t\t}\n\t\t\t\treturn info\n\t\t\t},\n\n\t\t\tonAdd(cb: () => void): EventController {\n\t\t\t\treturn this.on(\"add\", cb)\n\t\t\t},\n\n\t\t\tonUpdate(cb: () => void): EventController {\n\t\t\t\treturn this.on(\"update\", cb)\n\t\t\t},\n\n\t\t\tonDraw(cb: () => void): EventController {\n\t\t\t\treturn this.on(\"draw\", cb)\n\t\t\t},\n\n\t\t\tonDestroy(action: () => void): EventController {\n\t\t\t\treturn this.on(\"destroy\", action)\n\t\t\t},\n\n\t\t\tclearEvents() {\n\t\t\t\tevents.clear()\n\t\t\t},\n\n\t\t}\n\n\t\t// TODO: type with as const\n\t\tconst evs = [\n\t\t\t\"onKeyPress\",\n\t\t\t\"onKeyPressRepeat\",\n\t\t\t\"onKeyDown\",\n\t\t\t\"onKeyRelease\",\n\t\t\t\"onMousePress\",\n\t\t\t\"onMouseDown\",\n\t\t\t\"onMouseRelease\",\n\t\t\t\"onMouseMove\",\n\t\t\t\"onCharInput\",\n\t\t\t\"onMouseMove\",\n\t\t\t\"onTouchStart\",\n\t\t\t\"onTouchMove\",\n\t\t\t\"onTouchEnd\",\n\t\t\t\"onScroll\",\n\t\t\t\"onGamepadButtonPress\",\n\t\t\t\"onGamepadButtonDown\",\n\t\t\t\"onGamepadButtonRelease\",\n\t\t\t\"onGamepadStick\",\n\t\t]\n\n\t\tfor (const e of evs) {\n\t\t\tobj[e] = (...args) => {\n\t\t\t\tconst ev = app[e](...args)\n\t\t\t\tinputEvents.push(ev)\n\t\t\t\t// TODO: what if the game object is destroy and re-added\n\t\t\t\tobj.onDestroy(() => ev.cancel())\n\t\t\t\treturn ev\n\t\t\t}\n\t\t}\n\n\t\tfor (const comp of comps) {\n\t\t\tobj.use(comp)\n\t\t}\n\n\t\treturn obj as unknown as GameObj<T>\n\n\t}\n\n\t// add an event to a tag\n\tfunction on(event: string, tag: Tag, cb: (obj: GameObj, ...args) => void): EventController {\n\t\tif (!game.objEvents[event]) {\n\t\t\tgame.objEvents[event] = new Registry()\n\t\t}\n\t\treturn game.objEvents.on(event, (obj, ...args) => {\n\t\t\tif (obj.is(tag)) {\n\t\t\t\tcb(obj, ...args)\n\t\t\t}\n\t\t})\n\t}\n\n\tconst onUpdate = overload2((action: () => void): EventController => {\n\t\tconst obj = add([{ update: action }])\n\t\treturn {\n\t\t\tget paused() {\n\t\t\t\treturn obj.paused\n\t\t\t},\n\t\t\tset paused(p) {\n\t\t\t\tobj.paused = p\n\t\t\t},\n\t\t\tcancel: () => obj.destroy(),\n\t\t}\n\t}, (tag: Tag, action: (obj: GameObj) => void) => {\n\t\treturn on(\"update\", tag, action)\n\t})\n\n\tconst onDraw = overload2((action: () => void): EventController => {\n\t\tconst obj = add([{ draw: action }])\n\t\treturn {\n\t\t\tget paused() {\n\t\t\t\treturn obj.hidden\n\t\t\t},\n\t\t\tset paused(p) {\n\t\t\t\tobj.hidden = p\n\t\t\t},\n\t\t\tcancel: () => obj.destroy(),\n\t\t}\n\t}, (tag: Tag, action: (obj: GameObj) => void) => {\n\t\treturn on(\"draw\", tag, action)\n\t})\n\n\tconst onAdd = overload2((action: (obj: GameObj) => void) => {\n\t\treturn game.events.on(\"add\", action)\n\t}, (tag: Tag, action: (obj: GameObj) => void) => {\n\t\treturn on(\"add\", tag, action)\n\t})\n\n\tconst onDestroy = overload2((action: (obj: GameObj) => void) => {\n\t\treturn game.events.on(\"destroy\", action)\n\t}, (tag: Tag, action: (obj: GameObj) => void) => {\n\t\treturn on(\"destroy\", tag, action)\n\t})\n\n\t// add an event that runs with objs with t1 collides with objs with t2\n\tfunction onCollide(\n\t\tt1: Tag,\n\t\tt2: Tag,\n\t\tf: (a: GameObj, b: GameObj, col?: Collision) => void,\n\t): EventController {\n\t\treturn on(\"collide\", t1, (a, b, col) => b.is(t2) && f(a, b, col))\n\t}\n\n\tfunction onCollideUpdate(\n\t\tt1: Tag,\n\t\tt2: Tag,\n\t\tf: (a: GameObj, b: GameObj, col?: Collision) => void,\n\t): EventController {\n\t\treturn on(\"collideUpdate\", t1, (a, b, col) => b.is(t2) && f(a, b, col))\n\t}\n\n\tfunction onCollideEnd(\n\t\tt1: Tag,\n\t\tt2: Tag,\n\t\tf: (a: GameObj, b: GameObj, col?: Collision) => void,\n\t): EventController {\n\t\treturn on(\"collideEnd\", t1, (a, b, col) => b.is(t2) && f(a, b, col))\n\t}\n\n\tfunction forAllCurrentAndFuture(t: Tag, action: (obj: GameObj) => void) {\n\t\tget(t, { recursive: true }).forEach(action)\n\t\tonAdd(t, action)\n\t}\n\n\tconst onClick = overload2((action: () => void) => {\n\t\treturn app.onMousePress(action)\n\t}, (tag: Tag, action: (obj: GameObj) => void) => {\n\t\tconst events = []\n\t\tforAllCurrentAndFuture(tag, (obj) => {\n\t\t\tif (!obj.area)\n\t\t\t\tthrow new Error(\"onClick() requires the object to have area() component\")\n\t\t\tevents.push(obj.onClick(() => action(obj)))\n\t\t})\n\t\treturn EventController.join(events)\n\t})\n\n\t// add an event that runs once when objs with tag t is hovered\n\tfunction onHover(t: Tag, action: (obj: GameObj) => void): EventController {\n\t\tconst events = []\n\t\tforAllCurrentAndFuture(t, (obj) => {\n\t\t\tif (!obj.area)\n\t\t\t\tthrow new Error(\"onHover() requires the object to have area() component\")\n\t\t\tevents.push(obj.onHover(() => action(obj)))\n\t\t})\n\t\treturn EventController.join(events)\n\t}\n\n\t// add an event that runs once when objs with tag t is hovered\n\tfunction onHoverUpdate(t: Tag, action: (obj: GameObj) => void): EventController {\n\t\tconst events = []\n\t\tforAllCurrentAndFuture(t, (obj) => {\n\t\t\tif (!obj.area)\n\t\t\t\tthrow new Error(\"onHoverUpdate() requires the object to have area() component\")\n\t\t\tevents.push(obj.onHoverUpdate(() => action(obj)))\n\t\t})\n\t\treturn EventController.join(events)\n\t}\n\n\t// add an event that runs once when objs with tag t is unhovered\n\tfunction onHoverEnd(t: Tag, action: (obj: GameObj) => void): EventController {\n\t\tconst events = []\n\t\tforAllCurrentAndFuture(t, (obj) => {\n\t\t\tif (!obj.area)\n\t\t\t\tthrow new Error(\"onHoverEnd() requires the object to have area() component\")\n\t\t\tevents.push(obj.onHoverEnd(() => action(obj)))\n\t\t})\n\t\treturn EventController.join(events)\n\t}\n\n\tfunction setGravity(g: number) {\n\t\tgame.gravity = g\n\t}\n\n\tfunction getGravity() {\n\t\treturn game.gravity\n\t}\n\n\tfunction setBackground(...args) {\n\t\tif (args.length === 1 || args.length === 2) {\n\t\t\tgfx.bgColor = rgb(args[0])\n\t\t\tif (args[1]) gfx.bgAlpha = args[1]\n\t\t} else if (args.length === 3 || args.length === 4) {\n\t\t\tgfx.bgColor = rgb(args[0], args[1], args[2])\n\t\t\tif (args[3]) gfx.bgAlpha = args[3]\n\t\t}\n\t\tgl.clearColor(\n\t\t\tgfx.bgColor.r / 255,\n\t\t\tgfx.bgColor.g / 255,\n\t\t\tgfx.bgColor.b / 255,\n\t\t\tgfx.bgAlpha,\n\t\t)\n\t}\n\n\tfunction getBackground() {\n\t\treturn gfx.bgColor.clone()\n\t}\n\n\t// TODO: manage global velocity here?\n\tfunction pos(...args: Vec2Args): PosComp {\n\n\t\treturn {\n\n\t\t\tid: \"pos\",\n\t\t\tpos: vec2(...args),\n\n\t\t\tmoveBy(...args: Vec2Args) {\n\t\t\t\tthis.pos = this.pos.add(vec2(...args))\n\t\t\t},\n\n\t\t\t// move with velocity (pixels per second)\n\t\t\tmove(...args: Vec2Args) {\n\t\t\t\tthis.moveBy(vec2(...args).scale(dt()))\n\t\t\t},\n\n\t\t\t// move to a destination, with optional speed\n\t\t\tmoveTo(...args) {\n\t\t\t\tif (typeof args[0] === \"number\" && typeof args[1] === \"number\") {\n\t\t\t\t\treturn this.moveTo(vec2(args[0], args[1]), args[2])\n\t\t\t\t}\n\t\t\t\tconst dest = args[0]\n\t\t\t\tconst speed = args[1]\n\t\t\t\tif (speed === undefined) {\n\t\t\t\t\tthis.pos = vec2(dest)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst diff = dest.sub(this.pos)\n\t\t\t\tif (diff.len() <= speed * dt()) {\n\t\t\t\t\tthis.pos = vec2(dest)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.move(diff.unit().scale(speed))\n\t\t\t},\n\n\t\t\tworldPos(this: GameObj<PosComp>): Vec2 {\n\t\t\t\treturn this.parent\n\t\t\t\t\t? this.parent.transform.multVec2(this.pos)\n\t\t\t\t\t: this.pos\n\t\t\t},\n\n\t\t\t// get the screen position (transformed by camera)\n\t\t\tscreenPos(this: GameObj<PosComp | FixedComp>): Vec2 {\n\t\t\t\tconst pos = this.worldPos()\n\t\t\t\treturn isFixed(this)\n\t\t\t\t\t? pos\n\t\t\t\t\t: toScreen(pos)\n\t\t\t},\n\n\t\t\tinspect() {\n\t\t\t\treturn `(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`\n\t\t\t},\n\n\t\t\tdrawInspect() {\n\t\t\t\tdrawCircle({\n\t\t\t\t\tcolor: rgb(255, 0, 0),\n\t\t\t\t\tradius: 4 / getViewportScale(),\n\t\t\t\t})\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\t// TODO: allow single number assignment\n\tfunction scale(...args: Vec2Args): ScaleComp {\n\t\tif (args.length === 0) {\n\t\t\treturn scale(1)\n\t\t}\n\t\treturn {\n\t\t\tid: \"scale\",\n\t\t\tscale: vec2(...args),\n\t\t\tscaleTo(...args: Vec2Args) {\n\t\t\t\tthis.scale = vec2(...args)\n\t\t\t},\n\t\t\tscaleBy(...args: Vec2Args) {\n\t\t\t\tthis.scale.scale(vec2(...args))\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `(${toFixed(this.scale.x, 2)}, ${toFixed(this.scale.y, 2)})`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction rotate(r: number): RotateComp {\n\t\treturn {\n\t\t\tid: \"rotate\",\n\t\t\tangle: r ?? 0,\n\t\t\trotateBy(angle: number) {\n\t\t\t\tthis.angle += angle\n\t\t\t},\n\t\t\trotateTo(angle: number) {\n\t\t\t\tthis.angle = angle\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `${Math.round(this.angle)}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction color(...args): ColorComp {\n\t\treturn {\n\t\t\tid: \"color\",\n\t\t\tcolor: rgb(...args),\n\t\t\tinspect() {\n\t\t\t\treturn this.color.toString()\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction toFixed(n: number, f: number) {\n\t\treturn Number(n.toFixed(f))\n\t}\n\n\t// TODO: fadeIn here?\n\tfunction opacity(a: number): OpacityComp {\n\t\treturn {\n\t\t\tid: \"opacity\",\n\t\t\topacity: a ?? 1,\n\t\t\tinspect() {\n\t\t\t\treturn `${toFixed(this.opacity, 1)}`\n\t\t\t},\n\t\t\tfadeOut(time = 1, easeFunc = easings.linear): TweenController {\n\t\t\t\treturn tween(this.opacity, 0, time, (a) => this.opacity = a, easeFunc)\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction anchor(o: Anchor | Vec2): AnchorComp {\n\t\tif (!o) {\n\t\t\tthrow new Error(\"Please define an anchor\")\n\t\t}\n\t\treturn {\n\t\t\tid: \"anchor\",\n\t\t\tanchor: o,\n\t\t\tinspect() {\n\t\t\t\tif (typeof this.anchor === \"string\") {\n\t\t\t\t\treturn this.anchor\n\t\t\t\t} else {\n\t\t\t\t\treturn this.anchor.toString()\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction z(z: number): ZComp {\n\t\treturn {\n\t\t\tid: \"z\",\n\t\t\tz: z,\n\t\t\tinspect() {\n\t\t\t\treturn `${this.z}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction follow(obj: GameObj, offset?: Vec2): FollowComp {\n\t\treturn {\n\t\t\tid: \"follow\",\n\t\t\trequire: [ \"pos\" ],\n\t\t\tfollow: {\n\t\t\t\tobj: obj,\n\t\t\t\toffset: offset ?? vec2(0),\n\t\t\t},\n\t\t\tadd(this: GameObj<FollowComp | PosComp>) {\n\t\t\t\tif (obj.exists()) {\n\t\t\t\t\tthis.pos = this.follow.obj.pos.add(this.follow.offset)\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdate(this: GameObj<FollowComp | PosComp>) {\n\t\t\t\tif (obj.exists()) {\n\t\t\t\t\tthis.pos = this.follow.obj.pos.add(this.follow.offset)\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction move(dir: number | Vec2, speed: number): EmptyComp {\n\t\tconst d = typeof dir === \"number\" ? Vec2.fromAngle(dir) : dir.unit()\n\t\treturn {\n\t\t\tid: \"move\",\n\t\t\trequire: [ \"pos\" ],\n\t\t\tupdate(this: GameObj<PosComp>) {\n\t\t\t\tthis.move(d.scale(speed))\n\t\t\t},\n\t\t}\n\t}\n\n\tconst DEF_OFFSCREEN_DIS = 200\n\n\tfunction offscreen(opt: OffScreenCompOpt = {}): OffScreenComp {\n\t\tconst distance = opt.distance ?? DEF_OFFSCREEN_DIS\n\t\tlet isOut = false\n\t\treturn {\n\t\t\tid: \"offscreen\",\n\t\t\trequire: [ \"pos\" ],\n\t\t\tisOffScreen(this: GameObj<PosComp>): boolean {\n\t\t\t\tconst pos = this.screenPos()\n\t\t\t\tconst screenRect = new Rect(vec2(0), width(), height())\n\t\t\t\treturn !testRectPoint(screenRect, pos)\n\t\t\t\t\t&& screenRect.sdistToPoint(pos) > distance * distance\n\t\t\t},\n\t\t\tonExitScreen(this: GameObj, action: () => void): EventController {\n\t\t\t\treturn this.on(\"exitView\", action)\n\t\t\t},\n\t\t\tonEnterScreen(this: GameObj, action: () => void): EventController {\n\t\t\t\treturn this.on(\"enterView\", action)\n\t\t\t},\n\t\t\tupdate(this: GameObj) {\n\t\t\t\tif (this.isOffScreen()) {\n\t\t\t\t\tif (!isOut) {\n\t\t\t\t\t\tthis.trigger(\"exitView\")\n\t\t\t\t\t\tisOut = true\n\t\t\t\t\t}\n\t\t\t\t\tif (opt.hide) this.hidden = true\n\t\t\t\t\tif (opt.pause) this.paused = true\n\t\t\t\t\tif (opt.destroy) this.destroy()\n\t\t\t\t} else {\n\t\t\t\t\tif (isOut) {\n\t\t\t\t\t\tthis.trigger(\"enterView\")\n\t\t\t\t\t\tisOut = false\n\t\t\t\t\t}\n\t\t\t\t\tif (opt.hide) this.hidden = false\n\t\t\t\t\tif (opt.pause) this.paused = false\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction isFixed(obj: GameObj) {\n\t\tif (obj.fixed) return true\n\t\treturn obj.parent ? isFixed(obj.parent) : false\n\t}\n\n\tfunction area(opt: AreaCompOpt = {}): AreaComp {\n\n\t\tconst colliding = {}\n\t\tconst collidingThisFrame = new Set()\n\n\t\treturn {\n\n\t\t\tid: \"area\",\n\t\t\tcollisionIgnore: opt.collisionIgnore ?? [],\n\n\t\t\tadd(this: GameObj<AreaComp>) {\n\n\t\t\t\tif (this.area.cursor) {\n\t\t\t\t\tthis.onHover(() => app.setCursor(this.area.cursor))\n\t\t\t\t}\n\n\t\t\t\tthis.onCollideUpdate((obj, col) => {\n\t\t\t\t\tif (!colliding[obj.id]) {\n\t\t\t\t\t\tthis.trigger(\"collide\", obj, col)\n\t\t\t\t\t}\n\t\t\t\t\tcolliding[obj.id] = col\n\t\t\t\t\tcollidingThisFrame.add(obj.id)\n\t\t\t\t})\n\n\t\t\t},\n\n\t\t\tupdate(this: GameObj<AreaComp>) {\n\t\t\t\tfor (const id in colliding) {\n\t\t\t\t\tif (!collidingThisFrame.has(Number(id))) {\n\t\t\t\t\t\tthis.trigger(\"collideEnd\", colliding[id].target)\n\t\t\t\t\t\tdelete colliding[id]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcollidingThisFrame.clear()\n\t\t\t},\n\n\t\t\tdrawInspect(this: GameObj<AreaComp | AnchorComp | FixedComp>) {\n\n\t\t\t\tconst a = this.localArea()\n\n\t\t\t\tpushTransform()\n\t\t\t\tpushScale(this.area.scale)\n\t\t\t\tpushTranslate(this.area.offset)\n\n\t\t\t\tconst opts = {\n\t\t\t\t\toutline: {\n\t\t\t\t\t\twidth: 4 / getViewportScale(),\n\t\t\t\t\t\tcolor: rgb(0, 0, 255),\n\t\t\t\t\t},\n\t\t\t\t\tanchor: this.anchor,\n\t\t\t\t\tfill: false,\n\t\t\t\t\tfixed: isFixed(this),\n\t\t\t\t}\n\n\t\t\t\tif (a instanceof Rect) {\n\t\t\t\t\tdrawRect({\n\t\t\t\t\t\t...opts,\n\t\t\t\t\t\tpos: a.pos,\n\t\t\t\t\t\twidth: a.width,\n\t\t\t\t\t\theight: a.height,\n\t\t\t\t\t})\n\t\t\t\t} else if (a instanceof Polygon) {\n\t\t\t\t\tdrawPolygon({\n\t\t\t\t\t\t...opts,\n\t\t\t\t\t\tpts: a.pts,\n\t\t\t\t\t})\n\t\t\t\t} else if (a instanceof Circle) {\n\t\t\t\t\tdrawCircle({\n\t\t\t\t\t\t...opts,\n\t\t\t\t\t\tpos: a.center,\n\t\t\t\t\t\tradius: a.radius,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tpopTransform()\n\n\t\t\t},\n\n\t\t\tarea: {\n\t\t\t\tshape: opt.shape ?? null,\n\t\t\t\tscale: opt.scale ? vec2(opt.scale) : vec2(1),\n\t\t\t\toffset: opt.offset ?? vec2(0),\n\t\t\t\tcursor: opt.cursor ?? null,\n\t\t\t},\n\n\t\t\tisClicked(): boolean {\n\t\t\t\treturn app.isMousePressed() && this.isHovering()\n\t\t\t},\n\n\t\t\tisHovering(this: GameObj) {\n\t\t\t\tconst mpos = isFixed(this) ? mousePos() : toWorld(mousePos())\n\t\t\t\treturn this.hasPoint(mpos)\n\t\t\t},\n\n\t\t\tcheckCollision(this: GameObj, other: GameObj<AreaComp>) {\n\t\t\t\treturn colliding[other.id] ?? null\n\t\t\t},\n\n\t\t\tgetCollisions() {\n\t\t\t\treturn Object.values(colliding)\n\t\t\t},\n\n\t\t\t// TODO: perform check instead of use cache\n\t\t\tisColliding(other: GameObj<AreaComp>) {\n\t\t\t\treturn Boolean(colliding[other.id])\n\t\t\t},\n\n\t\t\tisOverlapping(other) {\n\t\t\t\tconst col = colliding[other.id]\n\t\t\t\treturn col && col.hasOverlap()\n\t\t\t},\n\n\t\t\tonClick(this: GameObj<AreaComp>, f: () => void): EventController {\n\t\t\t\tconst e = app.onMousePress(\"left\", () => {\n\t\t\t\t\tif (this.isHovering()) {\n\t\t\t\t\t\tf()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tthis.onDestroy(() => e.cancel())\n\t\t\t\treturn e\n\t\t\t},\n\n\t\t\tonHover(this: GameObj, action: () => void): EventController {\n\t\t\t\tlet hovering = false\n\t\t\t\treturn this.onUpdate(() => {\n\t\t\t\t\tif (!hovering) {\n\t\t\t\t\t\tif (this.isHovering()) {\n\t\t\t\t\t\t\thovering = true\n\t\t\t\t\t\t\taction()\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\thovering = this.isHovering()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\n\t\t\tonHoverUpdate(this: GameObj, onHover: () => void): EventController {\n\t\t\t\treturn this.onUpdate(() => {\n\t\t\t\t\tif (this.isHovering()) {\n\t\t\t\t\t\tonHover()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\n\t\t\tonHoverEnd(this: GameObj, action: () => void): EventController {\n\t\t\t\tlet hovering = false\n\t\t\t\treturn this.onUpdate(() => {\n\t\t\t\t\tif (hovering) {\n\t\t\t\t\t\tif (!this.isHovering()) {\n\t\t\t\t\t\t\thovering = false\n\t\t\t\t\t\t\taction()\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\thovering = this.isHovering()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\n\t\t\tonCollide(\n\t\t\t\tthis: GameObj,\n\t\t\t\ttag: Tag | ((obj: GameObj, col?: Collision) => void),\n\t\t\t\tcb?: (obj: GameObj, col?: Collision) => void,\n\t\t\t): EventController {\n\t\t\t\tif (typeof tag === \"function\" && cb === undefined) {\n\t\t\t\t\treturn this.on(\"collide\", tag)\n\t\t\t\t} else if (typeof tag === \"string\") {\n\t\t\t\t\treturn this.onCollide((obj, col) => {\n\t\t\t\t\t\tif (obj.is(tag)) {\n\t\t\t\t\t\t\tcb(obj, col)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonCollideUpdate(\n\t\t\t\tthis: GameObj<AreaComp>,\n\t\t\t\ttag: Tag | ((obj: GameObj, col?: Collision) => void),\n\t\t\t\tcb?: (obj: GameObj, col?: Collision) => void,\n\t\t\t): EventController {\n\t\t\t\tif (typeof tag === \"function\" && cb === undefined) {\n\t\t\t\t\treturn this.on(\"collideUpdate\", tag)\n\t\t\t\t} else if (typeof tag === \"string\") {\n\t\t\t\t\treturn this.on(\"collideUpdate\", (obj, col) => obj.is(tag) && cb(obj, col))\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonCollideEnd(\n\t\t\t\tthis: GameObj<AreaComp>,\n\t\t\t\ttag: Tag | ((obj: GameObj) => void),\n\t\t\t\tcb?: (obj: GameObj) => void,\n\t\t\t): EventController {\n\t\t\t\tif (typeof tag === \"function\" && cb === undefined) {\n\t\t\t\t\treturn this.on(\"collideEnd\", tag)\n\t\t\t\t} else if (typeof tag === \"string\") {\n\t\t\t\t\treturn this.on(\"collideEnd\", (obj) => obj.is(tag) && cb(obj))\n\t\t\t\t}\n\t\t\t},\n\n\t\t\thasPoint(pt: Vec2): boolean {\n\t\t\t\t// TODO: convert to pt to local space instead\n\t\t\t\treturn testPolygonPoint(this.worldArea(), pt)\n\t\t\t},\n\n\t\t\t// push an obj out of another if they're overlapped\n\t\t\tresolveCollision(this: GameObj<AreaComp | PosComp>, obj: GameObj<AreaComp>) {\n\t\t\t\tconst col = this.checkCollision(obj)\n\t\t\t\tif (col && !col.resolved) {\n\t\t\t\t\tthis.pos = this.pos.add(col.displacement)\n\t\t\t\t\tcol.resolved = true\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tlocalArea(this: GameObj<AreaComp | { renderArea(): Shape }>): Shape {\n\t\t\t\treturn this.area.shape\n\t\t\t\t\t? this.area.shape\n\t\t\t\t\t: this.renderArea()\n\t\t\t},\n\n\t\t\t// TODO: cache\n\t\t\tworldArea(this: GameObj<AreaComp | AnchorComp>): Polygon {\n\n\t\t\t\tconst localArea = this.localArea()\n\n\t\t\t\tif (!(localArea instanceof Polygon || localArea instanceof Rect)) {\n\t\t\t\t\tthrow new Error(\"Only support polygon and rect shapes for now\")\n\t\t\t\t}\n\n\t\t\t\tconst transform = this.transform\n\t\t\t\t\t.clone()\n\t\t\t\t\t.scale(vec2(this.area.scale ?? 1))\n\t\t\t\t\t.translate(this.area.offset)\n\n\t\t\t\tif (localArea instanceof Rect) {\n\t\t\t\t\tconst offset = anchorPt(this.anchor || DEF_ANCHOR)\n\t\t\t\t\t\t.add(1, 1)\n\t\t\t\t\t\t.scale(-0.5)\n\t\t\t\t\t\t.scale(localArea.width, localArea.height)\n\t\t\t\t\ttransform.translate(offset)\n\t\t\t\t}\n\n\t\t\t\treturn localArea.transform(transform) as Polygon\n\n\t\t\t},\n\n\t\t\tscreenArea(this: GameObj<AreaComp | FixedComp>): Polygon {\n\t\t\t\tconst area = this.worldArea()\n\t\t\t\tif (isFixed(this)) {\n\t\t\t\t\treturn area\n\t\t\t\t} else {\n\t\t\t\t\treturn area.transform(game.cam.transform)\n\t\t\t\t}\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction getRenderProps(obj: GameObj<any>) {\n\t\treturn {\n\t\t\tcolor: obj.color,\n\t\t\topacity: obj.opacity,\n\t\t\tanchor: obj.anchor,\n\t\t\toutline: obj.outline,\n\t\t\tshader: obj.shader,\n\t\t\tuniform: obj.uniform,\n\t\t}\n\t}\n\n\t// TODO: clean\n\tfunction sprite(\n\t\tsrc: string | SpriteData | Asset<SpriteData>,\n\t\topt: SpriteCompOpt = {},\n\t): SpriteComp {\n\n\t\tlet spriteData: SpriteData | null = null\n\t\tlet curAnim: SpriteCurAnim | null = null\n\t\t// 1  - from small index to large index\n\t\t// -1 - reverse\n\t\tlet curAnimDir: -1 | 1 | null = null\n\t\tconst spriteLoadedEvent = new Event<[SpriteData]>()\n\n\t\tif (!src) {\n\t\t\tthrow new Error(\"Please pass the resource name or data to sprite()\")\n\t\t}\n\n\t\tconst calcTexScale = (tex: Texture, q: Quad, w?: number, h?: number): Vec2 => {\n\t\t\tconst scale = vec2(1, 1)\n\t\t\tif (w && h) {\n\t\t\t\tscale.x = w / (tex.width * q.w)\n\t\t\t\tscale.y = h / (tex.height * q.h)\n\t\t\t} else if (w) {\n\t\t\t\tscale.x = w / (tex.width * q.w)\n\t\t\t\tscale.y = scale.x\n\t\t\t} else if (h) {\n\t\t\t\tscale.y = h / (tex.height * q.h)\n\t\t\t\tscale.x = scale.y\n\t\t\t}\n\t\t\treturn scale\n\t\t}\n\n\t\treturn {\n\n\t\t\tid: \"sprite\",\n\t\t\t// TODO: allow update\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tframe: opt.frame || 0,\n\t\t\tquad: opt.quad || new Quad(0, 0, 1, 1),\n\t\t\tanimSpeed: opt.animSpeed ?? 1,\n\t\t\tflipX: opt.flipX ?? false,\n\t\t\tflipY: opt.flipY ?? false,\n\n\t\t\tdraw(this: GameObj<SpriteComp>) {\n\n\t\t\t\tif (!spriteData) return\n\n\t\t\t\tconst q = spriteData.frames[this.frame ?? 0]\n\n\t\t\t\tif (!q) {\n\t\t\t\t\tthrow new Error(`Frame not found: ${this.frame ?? 0}`)\n\t\t\t\t}\n\n\t\t\t\tif (spriteData.slice9) {\n\t\t\t\t\t// TODO: tile\n\t\t\t\t\t// TODO: use scale or width / height, or both?\n\t\t\t\t\tconst { left, right, top, bottom } = spriteData.slice9\n\t\t\t\t\tconst tw = spriteData.tex.width * q.w\n\t\t\t\t\tconst th = spriteData.tex.height * q.h\n\t\t\t\t\tconst iw = this.width - left - right\n\t\t\t\t\tconst ih = this.height - top - bottom\n\t\t\t\t\tconst w1 = left / tw\n\t\t\t\t\tconst w3 = right / tw\n\t\t\t\t\tconst w2 = 1 - w1 - w3\n\t\t\t\t\tconst h1 = top / th\n\t\t\t\t\tconst h3 = bottom / th\n\t\t\t\t\tconst h2 = 1 - h1 - h3\n\t\t\t\t\tconst quads = [\n\t\t\t\t\t\t// uv\n\t\t\t\t\t\tquad(0,       0,       w1, h1),\n\t\t\t\t\t\tquad(w1,      0,       w2, h1),\n\t\t\t\t\t\tquad(w1 + w2, 0,       w3, h1),\n\t\t\t\t\t\tquad(0,       h1,      w1, h2),\n\t\t\t\t\t\tquad(w1,      h1,      w2, h2),\n\t\t\t\t\t\tquad(w1 + w2, h1,      w3, h2),\n\t\t\t\t\t\tquad(0,       h1 + h2, w1, h3),\n\t\t\t\t\t\tquad(w1,      h1 + h2, w2, h3),\n\t\t\t\t\t\tquad(w1 + w2, h1 + h2, w3, h3),\n\t\t\t\t\t\t// transform\n\t\t\t\t\t\tquad(0,         0,        left,  top),\n\t\t\t\t\t\tquad(left,      0,        iw,    top),\n\t\t\t\t\t\tquad(left + iw, 0,        right, top),\n\t\t\t\t\t\tquad(0,         top,      left,  ih),\n\t\t\t\t\t\tquad(left,      top,      iw,    ih),\n\t\t\t\t\t\tquad(left + iw, top,      right, ih),\n\t\t\t\t\t\tquad(0,         top + ih, left,  bottom),\n\t\t\t\t\t\tquad(left,      top + ih, iw,    bottom),\n\t\t\t\t\t\tquad(left + iw, top + ih, right, bottom),\n\t\t\t\t\t]\n\t\t\t\t\tfor (let i = 0; i < 9; i++) {\n\t\t\t\t\t\tconst uv = quads[i]\n\t\t\t\t\t\tconst transform = quads[i + 9]\n\t\t\t\t\t\tdrawTexture(Object.assign(getRenderProps(this), {\n\t\t\t\t\t\t\tpos: transform.pos(),\n\t\t\t\t\t\t\ttex: spriteData.tex,\n\t\t\t\t\t\t\tquad: q.scale(uv),\n\t\t\t\t\t\t\tflipX: this.flipX,\n\t\t\t\t\t\t\tflipY: this.flipY,\n\t\t\t\t\t\t\ttiled: opt.tiled,\n\t\t\t\t\t\t\twidth: transform.w,\n\t\t\t\t\t\t\theight: transform.h,\n\t\t\t\t\t\t}))\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tdrawTexture(Object.assign(getRenderProps(this), {\n\t\t\t\t\t\ttex: spriteData.tex,\n\t\t\t\t\t\tquad: q.scale(this.quad ?? new Quad(0, 0, 1, 1)),\n\t\t\t\t\t\tflipX: this.flipX,\n\t\t\t\t\t\tflipY: this.flipY,\n\t\t\t\t\t\ttiled: opt.tiled,\n\t\t\t\t\t\twidth: this.width,\n\t\t\t\t\t\theight: this.height,\n\t\t\t\t\t}))\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tadd(this: GameObj<SpriteComp>) {\n\n\t\t\t\tconst setSpriteData = (spr) => {\n\n\t\t\t\t\tlet q = spr.frames[0].clone()\n\n\t\t\t\t\tif (opt.quad) {\n\t\t\t\t\t\tq = q.scale(opt.quad)\n\t\t\t\t\t}\n\n\t\t\t\t\tconst scale = calcTexScale(spr.tex, q, opt.width, opt.height)\n\n\t\t\t\t\tthis.width = spr.tex.width * q.w * scale.x\n\t\t\t\t\tthis.height = spr.tex.height * q.h * scale.y\n\n\t\t\t\t\tif (opt.anim) {\n\t\t\t\t\t\tthis.play(opt.anim)\n\t\t\t\t\t}\n\n\t\t\t\t\tspriteData = spr\n\t\t\t\t\tspriteLoadedEvent.trigger(spriteData)\n\n\t\t\t\t}\n\n\t\t\t\tconst spr = resolveSprite(src)\n\n\t\t\t\tif (spr) {\n\t\t\t\t\tspr.onLoad(setSpriteData)\n\t\t\t\t} else {\n\t\t\t\t\tonLoad(() => setSpriteData(resolveSprite(src).data))\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tupdate(this: GameObj<SpriteComp>) {\n\n\t\t\t\tif (!curAnim) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tconst anim = spriteData.anims[curAnim.name]\n\n\t\t\t\tif (typeof anim === \"number\") {\n\t\t\t\t\tthis.frame = anim\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (anim.speed === 0) {\n\t\t\t\t\tthrow new Error(\"Sprite anim speed cannot be 0\")\n\t\t\t\t}\n\n\t\t\t\tcurAnim.timer += dt() * this.animSpeed\n\n\t\t\t\tif (curAnim.timer >= (1 / curAnim.speed)) {\n\n\t\t\t\t\tcurAnim.timer = 0\n\t\t\t\t\tthis.frame += curAnimDir\n\n\t\t\t\t\tif (this.frame < Math.min(anim.from, anim.to) ||\n\t\t\t\t\t\tthis.frame > Math.max(anim.from, anim.to)) {\n\t\t\t\t\t\tif (curAnim.loop) {\n\t\t\t\t\t\t\tif (curAnim.pingpong) {\n\t\t\t\t\t\t\t\tthis.frame -= curAnimDir\n\t\t\t\t\t\t\t\tcurAnimDir *= -1\n\t\t\t\t\t\t\t\tthis.frame += curAnimDir\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.frame = anim.from\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.frame = anim.to\n\t\t\t\t\t\t\tcurAnim.onEnd()\n\t\t\t\t\t\t\tthis.stop()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tplay(this: GameObj<SpriteComp>, name: string, opt: SpriteAnimPlayOpt = {}) {\n\n\t\t\t\tif (!spriteData) {\n\t\t\t\t\tspriteLoadedEvent.add(() => this.play(name, opt))\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tconst anim = spriteData.anims[name]\n\n\t\t\t\tif (anim === undefined) {\n\t\t\t\t\tthrow new Error(`Anim not found: ${name}`)\n\t\t\t\t}\n\n\t\t\t\tif (curAnim) {\n\t\t\t\t\tthis.stop()\n\t\t\t\t}\n\n\t\t\t\tcurAnim = typeof anim === \"number\"\n\t\t\t\t\t? {\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\ttimer: 0,\n\t\t\t\t\t\tloop: false,\n\t\t\t\t\t\tpingpong: false,\n\t\t\t\t\t\tspeed: 0,\n\t\t\t\t\t\tonEnd: () => {},\n\t\t\t\t\t}\n\t\t\t\t\t: {\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\ttimer: 0,\n\t\t\t\t\t\tloop: opt.loop ?? anim.loop ?? false,\n\t\t\t\t\t\tpingpong: opt.pingpong ?? anim.pingpong ?? false,\n\t\t\t\t\t\tspeed: opt.speed ?? anim.speed ?? 10,\n\t\t\t\t\t\tonEnd: opt.onEnd ?? (() => {}),\n\t\t\t\t\t}\n\n\t\t\t\tcurAnimDir = typeof anim === \"number\"\n\t\t\t\t\t? null\n\t\t\t\t\t: anim.from < anim.to ? 1 : -1\n\n\t\t\t\tthis.frame = typeof anim === \"number\"\n\t\t\t\t\t? anim\n\t\t\t\t\t: anim.from\n\n\t\t\t\tthis.trigger(\"animStart\", name)\n\n\t\t\t},\n\n\t\t\tstop(this: GameObj<SpriteComp>) {\n\t\t\t\tif (!curAnim) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst prevAnim = curAnim.name\n\t\t\t\tcurAnim = null\n\t\t\t\tthis.trigger(\"animEnd\", prevAnim)\n\t\t\t},\n\n\t\t\tnumFrames() {\n\t\t\t\treturn spriteData?.frames.length ?? 0\n\t\t\t},\n\n\t\t\tcurAnim() {\n\t\t\t\treturn curAnim?.name\n\t\t\t},\n\n\t\t\tonAnimEnd(\n\t\t\t\tthis: GameObj<SpriteComp>,\n\t\t\t\taction: (name: string) => void,\n\t\t\t): EventController {\n\t\t\t\treturn this.on(\"animEnd\", action)\n\t\t\t},\n\n\t\t\tonAnimStart(\n\t\t\t\tthis: GameObj<SpriteComp>,\n\t\t\t\taction: (name: string) => void,\n\t\t\t): EventController {\n\t\t\t\treturn this.on(\"animStart\", action)\n\t\t\t},\n\n\t\t\trenderArea() {\n\t\t\t\treturn new Rect(vec2(0), this.width, this.height)\n\t\t\t},\n\n\t\t\tinspect() {\n\t\t\t\tif (typeof src === \"string\") {\n\t\t\t\t\treturn `\"${src}\"`\n\t\t\t\t}\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction text(t: string, opt: TextCompOpt = {}): TextComp {\n\n\t\tfunction update(obj: GameObj<TextComp | any>) {\n\n\t\t\tconst ftext = formatText(Object.assign(getRenderProps(obj), {\n\t\t\t\ttext: obj.text + \"\",\n\t\t\t\tsize: obj.textSize,\n\t\t\t\tfont: obj.font,\n\t\t\t\twidth: opt.width && obj.width,\n\t\t\t\talign: obj.align,\n\t\t\t\tletterSpacing: obj.letterSpacing,\n\t\t\t\tlineSpacing: obj.lineSpacing,\n\t\t\t\t// TODO: shouldn't run when object / ancestor is paused\n\t\t\t\ttransform: obj.textTransform,\n\t\t\t\tstyles: obj.textStyles,\n\t\t\t}))\n\n\t\t\tif (!opt.width) {\n\t\t\t\tobj.width = ftext.width / (obj.scale?.x || 1)\n\t\t\t}\n\n\t\t\tobj.height = ftext.height / (obj.scale?.y || 1)\n\n\t\t\treturn ftext\n\n\t\t}\n\n\t\tconst obj = {\n\n\t\t\tid: \"text\",\n\t\t\tset text(nt) {\n\t\t\t\tt = nt\n\t\t\t\t// @ts-ignore\n\t\t\t\tupdate(this)\n\t\t\t},\n\t\t\tget text() {\n\t\t\t\treturn t\n\t\t\t},\n\t\t\ttextSize: opt.size ?? DEF_TEXT_SIZE,\n\t\t\tfont: opt.font,\n\t\t\twidth: opt.width ?? 0,\n\t\t\theight: 0,\n\t\t\talign: opt.align,\n\t\t\tlineSpacing: opt.lineSpacing,\n\t\t\tletterSpacing: opt.letterSpacing,\n\t\t\ttextTransform: opt.transform,\n\t\t\ttextStyles: opt.styles,\n\n\t\t\tadd(this: GameObj<TextComp>) {\n\t\t\t\tonLoad(() => update(this))\n\t\t\t},\n\n\t\t\tdraw(this: GameObj<TextComp>) {\n\t\t\t\tdrawFormattedText(update(this))\n\t\t\t},\n\n\t\t\trenderArea() {\n\t\t\t\treturn new Rect(vec2(0), this.width, this.height)\n\t\t\t},\n\n\t\t}\n\n\t\t// @ts-ignore\n\t\tupdate(obj)\n\n\t\treturn obj\n\n\t}\n\n\tfunction polygon(pts: Vec2[], opt: PolygonCompOpt = {}): PolygonComp {\n\t\tif(pts.length < 3) throw new Error(`Polygon's need more than two points, ${pts.length} points provided`)\n\t\treturn {\n\t\t\tid: \"polygon\",\n\t\t\tpts,\n\t\t\tcolors: opt.colors,\n\t\t\tradius: opt.radius,\n\t\t\tdraw(this: GameObj<PolygonComp>) {\n\t\t\t\tdrawPolygon(Object.assign(getRenderProps(this), {\n\t\t\t\t\tpts: this.pts,\n\t\t\t\t\tcolors: this.colors,\n\t\t\t\t\tradius: this.radius,\n\t\t\t\t\tfill: opt.fill,\n\t\t\t\t}))\n\t\t\t},\n\t\t\trenderArea(this: GameObj<PolygonComp>) {\n\t\t\t\treturn new Polygon(this.pts)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn this.pts.map(p => `[${p.x},${p.y}]`).join(\",\")\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction rect(w: number, h: number, opt: RectCompOpt = {}): RectComp {\n\t\treturn {\n\t\t\tid: \"rect\",\n\t\t\twidth: w,\n\t\t\theight: h,\n\t\t\tradius: opt.radius || 0,\n\t\t\tdraw(this: GameObj<RectComp>) {\n\t\t\t\tdrawRect(Object.assign(getRenderProps(this), {\n\t\t\t\t\twidth: this.width,\n\t\t\t\t\theight: this.height,\n\t\t\t\t\tradius: this.radius,\n\t\t\t\t\tfill: opt.fill,\n\t\t\t\t}))\n\t\t\t},\n\t\t\trenderArea() {\n\t\t\t\treturn new Rect(vec2(0), this.width, this.height)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `${Math.ceil(this.width)}, ${Math.ceil(this.height)}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction uvquad(w: number, h: number): UVQuadComp {\n\t\treturn {\n\t\t\tid: \"rect\",\n\t\t\twidth: w,\n\t\t\theight: h,\n\t\t\tdraw(this: GameObj<UVQuadComp>) {\n\t\t\t\tdrawUVQuad(Object.assign(getRenderProps(this), {\n\t\t\t\t\twidth: this.width,\n\t\t\t\t\theight: this.height,\n\t\t\t\t}))\n\t\t\t},\n\t\t\trenderArea() {\n\t\t\t\treturn new Rect(vec2(0), this.width, this.height)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `${Math.ceil(this.width)}, ${Math.ceil(this.height)}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction circle(radius: number, opt: CircleCompOpt = {}): CircleComp {\n\t\treturn {\n\t\t\tid: \"circle\",\n\t\t\tradius: radius,\n\t\t\tdraw(this: GameObj<CircleComp>) {\n\t\t\t\tdrawCircle(Object.assign(getRenderProps(this), {\n\t\t\t\t\tradius: this.radius,\n\t\t\t\t\tfill: opt.fill,\n\t\t\t\t}))\n\t\t\t},\n\t\t\trenderArea(this: GameObj<AnchorComp | CircleComp>) {\n\t\t\t\treturn new Rect(new Vec2(this.anchor ? 0 : -this.radius), this.radius * 2, this.radius * 2)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `${Math.ceil(this.radius)}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction outline(width: number = 1, color: Color = rgb(0, 0, 0)): OutlineComp {\n\t\treturn {\n\t\t\tid: \"outline\",\n\t\t\toutline: {\n\t\t\t\twidth,\n\t\t\t\tcolor,\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction timer(): TimerComp {\n\t\treturn {\n\t\t\tid: \"timer\",\n\t\t\twait(this: GameObj<TimerComp>, time: number, action?: () => void): TimerController {\n\t\t\t\tconst actions = []\n\t\t\t\tif (action) actions.push(action)\n\t\t\t\tlet t = 0\n\t\t\t\tconst ev = this.onUpdate(() => {\n\t\t\t\t\tt += dt()\n\t\t\t\t\tif (t >= time) {\n\t\t\t\t\t\tactions.forEach((f) => f())\n\t\t\t\t\t\tev.cancel()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\treturn {\n\t\t\t\t\tget paused() {\n\t\t\t\t\t\treturn ev.paused\n\t\t\t\t\t},\n\t\t\t\t\tset paused(p) {\n\t\t\t\t\t\tev.paused = p\n\t\t\t\t\t},\n\t\t\t\t\tcancel: ev.cancel,\n\t\t\t\t\tonEnd(action) {\n\t\t\t\t\t\tactions.push(action)\n\t\t\t\t\t},\n\t\t\t\t\tthen(action) {\n\t\t\t\t\t\tthis.onEnd(action)\n\t\t\t\t\t\treturn this\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t},\n\t\t\tloop(t: number, action: () => void): EventController {\n\t\t\t\tlet curTimer: null | TimerController = null\n\t\t\t\tconst newAction = () => {\n\t\t\t\t\t// TODO: should f be execute right away as loop() is called?\n\t\t\t\t\tcurTimer = this.wait(t, newAction)\n\t\t\t\t\taction()\n\t\t\t\t}\n\t\t\t\tcurTimer = this.wait(0, newAction)\n\t\t\t\treturn {\n\t\t\t\t\tget paused() {\n\t\t\t\t\t\treturn curTimer.paused\n\t\t\t\t\t},\n\t\t\t\t\tset paused(p) {\n\t\t\t\t\t\tcurTimer.paused = p\n\t\t\t\t\t},\n\t\t\t\t\tcancel: () => curTimer.cancel(),\n\t\t\t\t}\n\t\t\t},\n\t\t\ttween<V extends LerpValue>(\n\t\t\t\tthis: GameObj<TimerComp>,\n\t\t\t\tfrom: V,\n\t\t\t\tto: V,\n\t\t\t\tduration: number,\n\t\t\t\tsetValue: (value: V) => void,\n\t\t\t\teaseFunc = easings.linear,\n\t\t\t) {\n\t\t\t\tlet curTime = 0\n\t\t\t\tconst onEndEvents: Array<() => void> = []\n\t\t\t\tconst ev = this.onUpdate(() => {\n\t\t\t\t\tcurTime += dt()\n\t\t\t\t\tconst t = Math.min(curTime / duration, 1)\n\t\t\t\t\tsetValue(lerp(from, to, easeFunc(t)))\n\t\t\t\t\tif (t === 1) {\n\t\t\t\t\t\tev.cancel()\n\t\t\t\t\t\tsetValue(to)\n\t\t\t\t\t\tonEndEvents.forEach((action) => action())\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\treturn {\n\t\t\t\t\tget paused() {\n\t\t\t\t\t\treturn ev.paused\n\t\t\t\t\t},\n\t\t\t\t\tset paused(p) {\n\t\t\t\t\t\tev.paused = p\n\t\t\t\t\t},\n\t\t\t\t\tonEnd(action: () => void) {\n\t\t\t\t\t\tonEndEvents.push(action)\n\t\t\t\t\t},\n\t\t\t\t\tthen(action: () => void) {\n\t\t\t\t\t\tthis.onEnd(action)\n\t\t\t\t\t\treturn this\n\t\t\t\t\t},\n\t\t\t\t\tcancel() {\n\t\t\t\t\t\tev.cancel()\n\t\t\t\t\t},\n\t\t\t\t\tfinish() {\n\t\t\t\t\t\tev.cancel()\n\t\t\t\t\t\tsetValue(to)\n\t\t\t\t\t\tonEndEvents.forEach((action) => action())\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\t// maximum y velocity with body()\n\tconst DEF_JUMP_FORCE = 640\n\tconst MAX_VEL = 65536\n\n\t// TODO: land on wall\n\tfunction body(opt: BodyCompOpt = {}): BodyComp {\n\n\t\tlet curPlatform: GameObj<PosComp | AreaComp | BodyComp> | null = null\n\t\tlet lastPlatformPos = null\n\t\tlet wantFall = false\n\n\t\treturn {\n\n\t\t\tid: \"body\",\n\t\t\trequire: [ \"pos\", \"area\" ],\n\t\t\tvel: new Vec2(0),\n\t\t\tjumpForce: opt.jumpForce ?? DEF_JUMP_FORCE,\n\t\t\tgravityScale: opt.gravityScale ?? 1,\n\t\t\tisStatic: opt.isStatic ?? false,\n\t\t\t// TODO: prefer density * area()\n\t\t\tmass: opt.mass ?? 1,\n\n\t\t\tadd(this: GameObj<PosComp | BodyComp | AreaComp>) {\n\n\t\t\t\tif (this.mass === 0) {\n\t\t\t\t\tthrow new Error(\"Can't set body mass to 0\")\n\t\t\t\t}\n\n\t\t\t\t// static vs static: don't resolve\n\t\t\t\t// static vs non-static: always resolve non-static\n\t\t\t\t// non-static vs non-static: resolve the first one\n\t\t\t\tthis.onCollideUpdate((other: GameObj<PosComp | BodyComp>, col) => {\n\n\t\t\t\t\tif (!other.is(\"body\")) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tif (col.resolved) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.trigger(\"beforePhysicsResolve\", col)\n\t\t\t\t\tother.trigger(\"beforePhysicsResolve\", col.reverse())\n\n\t\t\t\t\t// user can mark 'resolved' in beforePhysicsResolve to stop a resolution\n\t\t\t\t\tif (col.resolved) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isStatic && other.isStatic) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t} else if (!this.isStatic && !other.isStatic) {\n\t\t\t\t\t\t// TODO: update all children transform?\n\t\t\t\t\t\tconst tmass = this.mass + other.mass\n\t\t\t\t\t\tthis.pos = this.pos.add(col.displacement.scale(other.mass / tmass))\n\t\t\t\t\t\tother.pos = other.pos.add(col.displacement.scale(-this.mass / tmass))\n\t\t\t\t\t\tthis.transform = calcTransform(this)\n\t\t\t\t\t\tother.transform = calcTransform(other)\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// if one is static and on is not, resolve the non static one\n\t\t\t\t\t\tconst col2 = (!this.isStatic && other.isStatic) ? col : col.reverse()\n\t\t\t\t\t\tcol2.source.pos = col2.source.pos.add(col2.displacement)\n\t\t\t\t\t\tcol2.source.transform = calcTransform(col2.source)\n\t\t\t\t\t}\n\n\t\t\t\t\tcol.resolved = true\n\t\t\t\t\tthis.trigger(\"physicsResolve\", col)\n\t\t\t\t\tother.trigger(\"physicsResolve\", col.reverse())\n\n\t\t\t\t})\n\n\t\t\t\tthis.onPhysicsResolve((col) => {\n\t\t\t\t\tif (game.gravity) {\n\t\t\t\t\t\tif (col.isBottom() && this.isFalling()) {\n\t\t\t\t\t\t\tthis.vel.y = 0\n\t\t\t\t\t\t\tcurPlatform = col.target as GameObj<PosComp | BodyComp | AreaComp>\n\t\t\t\t\t\t\tlastPlatformPos = col.target.pos\n\t\t\t\t\t\t\tif (wantFall) {\n\t\t\t\t\t\t\t\twantFall = false\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.trigger(\"ground\", curPlatform)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (col.isTop() && this.isJumping()) {\n\t\t\t\t\t\t\tthis.vel.y = 0\n\t\t\t\t\t\t\tthis.trigger(\"headbutt\", col.target)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t},\n\n\t\t\tupdate(this: GameObj<PosComp | BodyComp | AreaComp>) {\n\n\t\t\t\tif (!game.gravity) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (this.isStatic) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (wantFall) {\n\t\t\t\t\tcurPlatform = null\n\t\t\t\t\tlastPlatformPos = null\n\t\t\t\t\tthis.trigger(\"fallOff\")\n\t\t\t\t\twantFall = false\n\t\t\t\t}\n\n\t\t\t\tif (curPlatform) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t// TODO: this prevents from falling when on edge\n\t\t\t\t\t\t!this.isColliding(curPlatform)\n\t\t\t\t\t\t|| !curPlatform.exists()\n\t\t\t\t\t\t|| !curPlatform.is(\"body\")\n\t\t\t\t\t) {\n\t\t\t\t\t\twantFall = true\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!curPlatform.pos.eq(lastPlatformPos)\n\t\t\t\t\t\t\t&& opt.stickToPlatform !== false\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthis.moveBy(curPlatform.pos.sub(lastPlatformPos))\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlastPlatformPos = curPlatform.pos\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst prevVelY = this.vel.y\n\t\t\t\tthis.vel.y += game.gravity * this.gravityScale * dt()\n\t\t\t\tthis.vel.y = Math.min(this.vel.y, opt.maxVelocity ?? MAX_VEL)\n\t\t\t\tif (prevVelY < 0 && this.vel.y >= 0) {\n\t\t\t\t\tthis.trigger(\"fall\")\n\t\t\t\t}\n\t\t\t\tthis.move(this.vel)\n\n\t\t\t},\n\n\t\t\tonPhysicsResolve(this: GameObj, action) {\n\t\t\t\treturn this.on(\"physicsResolve\", action)\n\t\t\t},\n\n\t\t\tonBeforePhysicsResolve(this: GameObj, action) {\n\t\t\t\treturn this.on(\"beforePhysicsResolve\", action)\n\t\t\t},\n\n\t\t\tcurPlatform(): GameObj | null {\n\t\t\t\treturn curPlatform\n\t\t\t},\n\n\t\t\tisGrounded() {\n\t\t\t\treturn curPlatform !== null\n\t\t\t},\n\n\t\t\tisFalling(): boolean {\n\t\t\t\treturn this.vel.y > 0\n\t\t\t},\n\n\t\t\tisJumping(): boolean {\n\t\t\t\treturn this.vel.y < 0\n\t\t\t},\n\n\t\t\tjump(force: number) {\n\t\t\t\tcurPlatform = null\n\t\t\t\tlastPlatformPos = null\n\t\t\t\tthis.vel.y = -force || -this.jumpForce\n\t\t\t},\n\n\t\t\tonGround(this: GameObj, action: () => void): EventController {\n\t\t\t\treturn this.on(\"ground\", action)\n\t\t\t},\n\n\t\t\tonFall(this: GameObj, action: () => void): EventController {\n\t\t\t\treturn this.on(\"fall\", action)\n\t\t\t},\n\n\t\t\tonFallOff(this: GameObj, action: () => void): EventController {\n\t\t\t\treturn this.on(\"fallOff\", action)\n\t\t\t},\n\n\t\t\tonHeadbutt(this: GameObj, action: () => void): EventController {\n\t\t\t\treturn this.on(\"headbutt\", action)\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction doubleJump(numJumps: number = 2): DoubleJumpComp {\n\t\tlet jumpsLeft = numJumps\n\t\treturn {\n\t\t\tid: \"doubleJump\",\n\t\t\trequire: [ \"body\" ],\n\t\t\tnumJumps: numJumps,\n\t\t\tadd(this: GameObj<BodyComp | DoubleJumpComp>) {\n\t\t\t\tthis.onGround(() => {\n\t\t\t\t\tjumpsLeft = this.numJumps\n\t\t\t\t})\n\t\t\t},\n\t\t\tdoubleJump(this: GameObj<BodyComp | DoubleJumpComp>, force?: number) {\n\t\t\t\tif (jumpsLeft <= 0) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (jumpsLeft < this.numJumps) {\n\t\t\t\t\tthis.trigger(\"doubleJump\")\n\t\t\t\t}\n\t\t\t\tjumpsLeft--\n\t\t\t\tthis.jump(force)\n\t\t\t},\n\t\t\tonDoubleJump(this: GameObj, action: () => void): EventController {\n\t\t\t\treturn this.on(\"doubleJump\", action)\n\t\t\t},\n\t\t\tinspect(this: GameObj<BodyComp | DoubleJumpComp>) {\n\t\t\t\treturn `${jumpsLeft}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction shader(id: string, uniform?: Uniform | (() => Uniform)): ShaderComp {\n\t\treturn {\n\t\t\tid: \"shader\",\n\t\t\tshader: id,\n\t\t\t...(typeof uniform === \"function\" ? {\n\t\t\t\tuniform: uniform(),\n\t\t\t\tupdate() {\n\t\t\t\t\tthis.uniform = uniform()\n\t\t\t\t},\n\t\t\t} : {\n\t\t\t\tuniform: uniform,\n\t\t\t}),\n\t\t}\n\t}\n\n\tfunction fixed(): FixedComp {\n\t\treturn {\n\t\t\tid: \"fixed\",\n\t\t\tfixed: true,\n\t\t}\n\t}\n\n\tfunction stay(scenesToStay?: string[]): StayComp {\n\t\treturn {\n\t\t\tid: \"stay\",\n\t\t\tstay: true,\n\t\t\tscenesToStay: scenesToStay,\n\t\t}\n\t}\n\n\tfunction health(hp: number, maxHP?: number): HealthComp {\n\t\tif (hp == null) {\n\t\t\tthrow new Error(\"health() requires the initial amount of hp\")\n\t\t}\n\t\treturn {\n\t\t\tid: \"health\",\n\t\t\thurt(this: GameObj, n: number = 1) {\n\t\t\t\tthis.setHP(hp - n)\n\t\t\t\tthis.trigger(\"hurt\", n)\n\t\t\t},\n\t\t\theal(this: GameObj, n: number = 1) {\n\t\t\t\tconst origHP = hp\n\t\t\t\tthis.setHP(hp + n)\n\t\t\t\tthis.trigger(\"heal\", hp - origHP)\n\t\t\t},\n\t\t\thp(): number {\n\t\t\t\treturn hp\n\t\t\t},\n\t\t\tmaxHP(): number | null {\n\t\t\t\treturn maxHP ?? null\n\t\t\t},\n\t\t\tsetMaxHP(n: number): void {\n\t\t\t\tmaxHP = n\n\t\t\t},\n\t\t\tsetHP(this: GameObj, n: number) {\n\t\t\t\thp = maxHP ? Math.min(maxHP, n) : n\n\t\t\t\tif (hp <= 0) {\n\t\t\t\t\tthis.trigger(\"death\")\n\t\t\t\t}\n\t\t\t},\n\t\t\tonHurt(this: GameObj, action: (amount?: number) => void): EventController {\n\t\t\t\treturn this.on(\"hurt\", action)\n\t\t\t},\n\t\t\tonHeal(this: GameObj, action: (amount?: number) => void): EventController {\n\t\t\t\treturn this.on(\"heal\", action)\n\t\t\t},\n\t\t\tonDeath(this: GameObj, action: () => void): EventController {\n\t\t\t\treturn this.on(\"death\", action)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `${hp}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction lifespan(time: number, opt: LifespanCompOpt = {}): EmptyComp {\n\t\tif (time == null) {\n\t\t\tthrow new Error(\"lifespan() requires time\")\n\t\t}\n\t\tconst fade = opt.fade ?? 0\n\t\treturn {\n\t\t\tid: \"lifespan\",\n\t\t\tasync add(this: GameObj<OpacityComp>) {\n\t\t\t\tawait wait(time)\n\t\t\t\t// TODO: this secretively requires opacity comp, make opacity on every game obj?\n\t\t\t\tif (fade > 0 && this.opacity) {\n\t\t\t\t\tawait tween(this.opacity, 0, fade, (a) => this.opacity = a, easings.linear)\n\t\t\t\t}\n\t\t\t\tthis.destroy()\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction state(\n\t\tinitState: string,\n\t\tstateList?: string[],\n\t\ttransitions?: Record<string, string | string[]>,\n\t): StateComp {\n\n\t\tif (!initState) {\n\t\t\tthrow new Error(\"state() requires an initial state\")\n\t\t}\n\n\t\tconst events = {}\n\n\t\tfunction initStateEvents(state: string) {\n\t\t\tif (!events[state]) {\n\t\t\t\tevents[state] = {\n\t\t\t\t\tenter: new Event(),\n\t\t\t\t\tend: new Event(),\n\t\t\t\t\tupdate: new Event(),\n\t\t\t\t\tdraw: new Event(),\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction on(event, state, action) {\n\t\t\tinitStateEvents(state)\n\t\t\treturn events[state][event].add(action)\n\t\t}\n\n\t\tfunction trigger(event, state, ...args) {\n\t\t\tinitStateEvents(state)\n\t\t\tevents[state][event].trigger(...args)\n\t\t}\n\n\t\tlet didFirstEnter = false\n\n\t\treturn {\n\n\t\t\tid: \"state\",\n\t\t\tstate: initState,\n\n\t\t\tenterState(state: string, ...args) {\n\n\t\t\t\tdidFirstEnter = true\n\n\t\t\t\tif (stateList && !stateList.includes(state)) {\n\t\t\t\t\tthrow new Error(`State not found: ${state}`)\n\t\t\t\t}\n\n\t\t\t\tconst oldState = this.state\n\n\t\t\t\tif (transitions) {\n\n\t\t\t\t\t// check if the transition is legal, if transition graph is defined\n\t\t\t\t\tif (!transitions?.[oldState]) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tconst available = typeof transitions[oldState] === \"string\"\n\t\t\t\t\t\t? [transitions[oldState]]\n\t\t\t\t\t\t: transitions[oldState] as string[]\n\n\t\t\t\t\tif (!available.includes(state)) {\n\t\t\t\t\t\tthrow new Error(`Cannot transition state from \"${oldState}\" to \"${state}\". Available transitions: ${available.map((s) => `\"${s}\"`).join(\", \")}`)\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\ttrigger(\"end\", oldState, ...args)\n\t\t\t\tthis.state = state\n\t\t\t\ttrigger(\"enter\", state, ...args)\n\t\t\t\ttrigger(\"enter\", `${oldState} -> ${state}`, ...args)\n\n\t\t\t},\n\n\t\t\tonStateTransition(from: string, to: string, action: () => void): EventController {\n\t\t\t\treturn on(\"enter\", `${from} -> ${to}`, action)\n\t\t\t},\n\n\t\t\tonStateEnter(state: string, action: () => void): EventController {\n\t\t\t\treturn on(\"enter\", state, action)\n\t\t\t},\n\n\t\t\tonStateUpdate(state: string, action: () => void): EventController {\n\t\t\t\treturn on(\"update\", state, action)\n\t\t\t},\n\n\t\t\tonStateDraw(state: string, action: () => void): EventController {\n\t\t\t\treturn on(\"draw\", state, action)\n\t\t\t},\n\n\t\t\tonStateEnd(state: string, action: () => void): EventController {\n\t\t\t\treturn on(\"end\", state, action)\n\t\t\t},\n\n\t\t\tupdate() {\n\t\t\t\t// execute the enter event for initState\n\t\t\t\tif (!didFirstEnter) {\n\t\t\t\t\ttrigger(\"enter\", initState)\n\t\t\t\t\tdidFirstEnter = true\n\t\t\t\t}\n\t\t\t\ttrigger(\"update\", this.state)\n\t\t\t},\n\n\t\t\tdraw() {\n\t\t\t\ttrigger(\"draw\", this.state)\n\t\t\t},\n\n\t\t\tinspect() {\n\t\t\t\treturn this.state\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction fadeIn(time: number = 1): Comp {\n\t\tlet t = 0\n\t\tlet done = false\n\t\treturn {\n\t\t\trequire: [ \"opacity\" ],\n\t\t\tadd(this: GameObj<OpacityComp>) {\n\t\t\t\tthis.opacity = 0\n\t\t\t},\n\t\t\tupdate(this: GameObj<OpacityComp>) {\n\t\t\t\tif (done) return\n\t\t\t\tt += dt()\n\t\t\t\tthis.opacity = map(t, 0, time, 0, 1)\n\t\t\t\tif (t >= time) {\n\t\t\t\t\tthis.opacity = 1\n\t\t\t\t\tdone = true\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction mask(m: Mask = \"intersect\"): MaskComp {\n\t\treturn {\n\t\t\tid: \"mask\",\n\t\t\tmask: m,\n\t\t}\n\t}\n\n\tfunction drawon(c: FrameBuffer) {\n\t\treturn {\n\t\t\tadd(this: GameObj) {\n\t\t\t\tthis.canvas = c\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction onLoad(cb: () => void): void {\n\t\tif (assets.loaded) {\n\t\t\tcb()\n\t\t} else {\n\t\t\tgame.events.on(\"load\", cb)\n\t\t}\n\t}\n\n\tfunction scene(id: SceneName, def: SceneDef) {\n\t\tgame.scenes[id] = def\n\t}\n\n\tfunction go(name: SceneName, ...args) {\n\n\t\tif (!game.scenes[name]) {\n\t\t\tthrow new Error(`Scene not found: ${name}`)\n\t\t}\n\n\t\tgame.events.onOnce(\"frameEnd\", () => {\n\n\t\t\tgame.events.trigger(\"sceneLeave\", name)\n\t\t\tapp.events.clear()\n\t\t\tgame.events.clear()\n\t\t\tgame.objEvents.clear()\n\n\t\t\t;[...game.root.children].forEach((obj) => {\n\t\t\t\tif (\n\t\t\t\t\t!obj.stay\n\t\t\t\t\t|| (obj.scenesToStay && !obj.scenesToStay.includes(name))\n\t\t\t\t) {\n\t\t\t\t\tgame.root.remove(obj)\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tgame.root.clearEvents()\n\t\t\tinitEvents()\n\n\t\t\t// cam\n\t\t\tgame.cam = {\n\t\t\t\tpos: null,\n\t\t\t\tscale: vec2(1),\n\t\t\t\tangle: 0,\n\t\t\t\tshake: 0,\n\t\t\t\ttransform: new Mat4(),\n\t\t\t}\n\n\t\t\tgame.scenes[name](...args)\n\n\t\t})\n\n\t}\n\n\tfunction onSceneLeave(action: (newScene?: string) => void): EventController {\n\t\treturn game.events.on(\"sceneLeave\", action)\n\t}\n\n\tfunction getData<T>(key: string, def?: T): T {\n\t\ttry {\n\t\t\treturn JSON.parse(window.localStorage[key])\n\t\t} catch {\n\t\t\tif (def) {\n\t\t\t\tsetData(key, def)\n\t\t\t\treturn def\n\t\t\t} else {\n\t\t\t\treturn null\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction setData(key: string, data: any) {\n\t\twindow.localStorage[key] = JSON.stringify(data)\n\t}\n\n\tfunction plug<T extends Record<string, any>>(plugin: KaboomPlugin<T>, ...args: any): KaboomCtx & T {\n\t\tconst funcs = plugin(ctx)\n\t\tlet funcsObj: T\n\t\tif (typeof funcs === \"function\") {\n\t\t\tconst plugWithOptions = funcs(...args)\n\t\t\tfuncsObj = plugWithOptions(ctx)\n\t\t}\n\t\telse {\n\t\t\tfuncsObj = funcs\n\t\t}\n\t\tfor (const k in funcsObj) {\n\t\t\t// @ts-ignore\n\t\t\tctx[k] = funcsObj[k]\n\t\t\tif (gopt.global !== false) {\n\t\t\t\t// @ts-ignore\n\t\t\t\twindow[k] = funcsObj[k]\n\t\t\t}\n\t\t}\n\t\treturn ctx as KaboomCtx & T\n\t}\n\n\tfunction center(): Vec2 {\n\t\treturn vec2(width() / 2, height() / 2)\n\t}\n\n\tenum EdgeMask {\n\t\tNone = 0,\n\t\tLeft = 1,\n\t\tTop = 2,\n\t\tLeftTop = 3,\n\t\tRight = 4,\n\t\tHorizontal = 5,\n\t\tRightTop = 6,\n\t\tHorizontalTop = 7,\n\t\tBottom = 8,\n\t\tLeftBottom = 9,\n\t\tVertical = 10,\n\t\tLeftVertical = 11,\n\t\tRightBottom = 12,\n\t\tHorizontalBottom = 13,\n\t\tRightVertical = 14,\n\t\tAll = 15,\n\t}\n\n\tfunction tile(opts: TileCompOpt = {}): TileComp {\n\n\t\tlet tilePos = vec2(0)\n\t\tlet isObstacle = opts.isObstacle ?? false\n\t\tlet cost = opts.cost ?? 0\n\t\tlet edges = opts.edges ?? []\n\n\t\tconst getEdgeMask = () => {\n\t\t\tconst loopup = {\n\t\t\t\t\"left\": EdgeMask.Left,\n\t\t\t\t\"top\": EdgeMask.Top,\n\t\t\t\t\"right\": EdgeMask.Right,\n\t\t\t\t\"bottom\": EdgeMask.Bottom,\n\t\t\t}\n\t\t\treturn edges.map(s => loopup[s] || 0).reduce((mask, dir) => mask | dir, 0)\n\t\t}\n\n\t\tlet edgeMask = getEdgeMask()\n\n\t\treturn {\n\n\t\t\tid: \"tile\",\n\t\t\ttilePosOffset: opts.offset ?? vec2(0),\n\n\t\t\tset tilePos(p: Vec2) {\n\t\t\t\tconst level = this.getLevel()\n\t\t\t\ttilePos = p.clone()\n\t\t\t\t// @ts-ignore\n\t\t\t\tthis.pos = vec2(\n\t\t\t\t\tthis.tilePos.x * level.tileWidth(),\n\t\t\t\t\tthis.tilePos.y * level.tileHeight(),\n\t\t\t\t).add(this.tilePosOffset)\n\t\t\t},\n\n\t\t\tget tilePos() {\n\t\t\t\treturn tilePos\n\t\t\t},\n\n\t\t\tset isObstacle(is: boolean) {\n\t\t\t\tif (isObstacle === is) return\n\t\t\t\tisObstacle = is\n\t\t\t\tthis.getLevel().invalidateNavigationMap()\n\t\t\t},\n\n\t\t\tget isObstacle() {\n\t\t\t\treturn isObstacle\n\t\t\t},\n\n\t\t\tset cost(n: number) {\n\t\t\t\tif (cost === n) return\n\t\t\t\tcost = n\n\t\t\t\tthis.getLevel().invalidateNavigationMap()\n\t\t\t},\n\n\t\t\tget cost() {\n\t\t\t\treturn cost\n\t\t\t},\n\n\t\t\tset edges(e: Edge[]) {\n\t\t\t\tedges = e\n\t\t\t\tedgeMask = getEdgeMask()\n\t\t\t\tthis.getLevel().invalidateNavigationMap()\n\t\t\t},\n\n\t\t\tget edges() {\n\t\t\t\treturn edges\n\t\t\t},\n\n\t\t\tget edgeMask() {\n\t\t\t\treturn edgeMask\n\t\t\t},\n\n\t\t\tgetLevel(this: GameObj) {\n\t\t\t\treturn this.parent as GameObj<LevelComp>\n\t\t\t},\n\n\t\t\tmoveLeft() {\n\t\t\t\tthis.tilePos = this.tilePos.add(vec2(-1, 0))\n\t\t\t},\n\n\t\t\tmoveRight() {\n\t\t\t\tthis.tilePos = this.tilePos.add(vec2(1, 0))\n\t\t\t},\n\n\t\t\tmoveUp() {\n\t\t\t\tthis.tilePos = this.tilePos.add(vec2(0, -1))\n\t\t\t},\n\n\t\t\tmoveDown() {\n\t\t\t\tthis.tilePos = this.tilePos.add(vec2(0, 1))\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction addLevel(map: string[], opt: LevelOpt): GameObj<PosComp | LevelComp> {\n\n\t\tif (!opt.tileWidth || !opt.tileHeight) {\n\t\t\tthrow new Error(\"Must provide tileWidth and tileHeight.\")\n\t\t}\n\n\t\t// TODO: custom parent\n\t\tconst level = add([\n\t\t\tpos(opt.pos ?? vec2(0)),\n\t\t]) as GameObj<PosComp | LevelComp>\n\n\t\tconst numRows = map.length\n\t\tlet numColumns = 0\n\n\t\t// The spatial map keeps track of the objects at each location\n\t\tlet spatialMap: GameObj[][] | null = null\n\t\tlet costMap: number[] | null = null\n\t\tlet edgeMap: number[] | null = null\n\t\tlet connectivityMap: number[] | null = null\n\n\t\tconst tile2Hash = (tilePos: Vec2) => tilePos.x + tilePos.y * numColumns\n\t\tconst hash2Tile = (hash: number) => vec2(\n\t\t\tMath.floor(hash % numColumns),\n\t\t\tMath.floor(hash / numColumns),\n\t\t)\n\n\t\tconst createSpatialMap = () => {\n\t\t\tspatialMap = []\n\t\t\tfor (const child of level.children) {\n\t\t\t\tinsertIntoSpatialMap(child)\n\t\t\t}\n\t\t}\n\n\t\tconst insertIntoSpatialMap = (obj: GameObj) => {\n\t\t\tconst i = tile2Hash(obj.tilePos)\n\t\t\tif (spatialMap[i]) {\n\t\t\t\tspatialMap[i].push(obj)\n\t\t\t} else {\n\t\t\t\tspatialMap[i] = [obj]\n\t\t\t}\n\t\t}\n\n\t\tconst removeFromSpatialMap = (obj: GameObj) => {\n\t\t\tconst i = tile2Hash(obj.tilePos)\n\t\t\tif (spatialMap[i]) {\n\t\t\t\tconst index = spatialMap[i].indexOf(obj)\n\t\t\t\tif (index >= 0) {\n\t\t\t\t\tspatialMap[i].splice(index, 1)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst updateSpatialMap = () => {\n\t\t\tlet spatialMapChanged = false\n\t\t\tfor (const child of level.children) {\n\t\t\t\tconst tilePos = level.pos2Tile(child.pos)\n\t\t\t\tif (child.tilePos.x != tilePos.x || child.tilePos.y != tilePos.y) {\n\t\t\t\t\tspatialMapChanged = true\n\t\t\t\t\tremoveFromSpatialMap(child)\n\t\t\t\t\tchild.tilePos.x = tilePos.x\n\t\t\t\t\tchild.tilePos.y = tilePos.y\n\t\t\t\t\tinsertIntoSpatialMap(child)\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (spatialMapChanged) {\n\t\t\t\tlevel.trigger(\"spatial_map_changed\")\n\t\t\t}\n\t\t}\n\n\t\t// The obstacle map tells which tiles are accessible\n\t\t// Cost: accessible with cost\n\t\t// Infinite: inaccessible\n\t\tconst createCostMap = () => {\n\t\t\tconst spatialMap = level.getSpatialMap()\n\t\t\tconst size = level.numRows() * level.numColumns()\n\t\t\tif (!costMap) {\n\t\t\t\tcostMap = new Array<number>(size)\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcostMap.length = size\n\t\t\t}\n\t\t\tcostMap.fill(1, 0, size)\n\t\t\tfor (let i = 0; i < spatialMap.length; i++) {\n\t\t\t\tconst objects = spatialMap[i]\n\t\t\t\tif (objects) {\n\t\t\t\t\tlet cost = 0\n\t\t\t\t\tfor (const obj of objects) {\n\t\t\t\t\t\tif (obj.isObstacle) {\n\t\t\t\t\t\t\tcost = Infinity\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcost += obj.cost\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcostMap[i] = cost || 1\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// The edge map tells which edges between nodes are walkable\n\t\tconst createEdgeMap = () => {\n\t\t\tconst spatialMap = level.getSpatialMap()\n\t\t\tconst size = level.numRows() * level.numColumns()\n\t\t\tif (!edgeMap) {\n\t\t\t\tedgeMap = new Array<number>(size)\n\t\t\t}\n\t\t\telse {\n\t\t\t\tedgeMap.length = size\n\t\t\t}\n\t\t\tedgeMap.fill(EdgeMask.All, 0, size)\n\t\t\tfor (let i = 0; i < spatialMap.length; i++) {\n\t\t\t\tconst objects = spatialMap[i]\n\t\t\t\tif (objects) {\n\t\t\t\t\tconst len = objects.length\n\t\t\t\t\tlet mask = EdgeMask.All\n\t\t\t\t\tfor (let j = 0; j < len; j++) {\n\t\t\t\t\t\tmask |= objects[j].edgeMask\n\t\t\t\t\t}\n\t\t\t\t\tedgeMap[i] = mask\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// The connectivity map is used to see whether two locations are connected\n\t\t// -1: inaccesible n: connectivity group\n\t\tconst createConnectivityMap = () => {\n\t\t\tconst size = level.numRows() * level.numColumns()\n\t\t\tconst traverse = (i: number, index: number) => {\n\t\t\t\tconst frontier: number[] = []\n\t\t\t\tfrontier.push(i)\n\t\t\t\twhile (frontier.length > 0) {\n\t\t\t\t\tconst i = frontier.pop()\n\t\t\t\t\tgetNeighbours(i).forEach((i) => {\n\t\t\t\t\t\tif (connectivityMap[i] < 0) {\n\t\t\t\t\t\t\tconnectivityMap[i] = index\n\t\t\t\t\t\t\tfrontier.push(i)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!connectivityMap) {\n\t\t\t\tconnectivityMap = new Array<number>(size)\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconnectivityMap.length = size\n\t\t\t}\n\t\t\tconnectivityMap.fill(-1, 0, size)\n\t\t\tlet index = 0\n\t\t\tfor (let i = 0; i < costMap.length; i++) {\n\t\t\t\tif (connectivityMap[i] >= 0) { index++; continue }\n\t\t\t\ttraverse(i, index)\n\t\t\t\tindex++\n\t\t\t}\n\t\t}\n\n\t\tconst getCost = (node: number, neighbour: number) => {\n\t\t\t// Cost of destination tile\n\t\t\treturn costMap[neighbour]\n\t\t}\n\n\t\tconst getHeuristic = (node: number, goal: number) => {\n\t\t\t// Euclidian distance to target\n\t\t\tconst p1 = hash2Tile(node)\n\t\t\tconst p2 = hash2Tile(goal)\n\t\t\treturn p1.dist(p2)\n\t\t}\n\n\t\tconst getNeighbours = (node: number, diagonals?: boolean) => {\n\t\t\tconst n = []\n\t\t\tconst x = Math.floor(node % numColumns)\n\t\t\tconst left = x > 0 &&\n\t\t\t\t(edgeMap[node] & EdgeMask.Left) &&\n\t\t\t\tcostMap[node - 1] !== Infinity\n\t\t\tconst top = node >= numColumns &&\n\t\t\t\t(edgeMap[node] & EdgeMask.Top) &&\n\t\t\t\tcostMap[node - numColumns] !== Infinity\n\t\t\tconst right = x < numColumns - 1 &&\n\t\t\t\t(edgeMap[node] & EdgeMask.Right) &&\n\t\t\t\tcostMap[node + 1] !== Infinity\n\t\t\tconst bottom = node < numColumns * numRows - numColumns - 1 &&\n\t\t\t\t(edgeMap[node] & EdgeMask.Bottom) &&\n\t\t\t\tcostMap[node + numColumns] !== Infinity\n\t\t\tif (diagonals) {\n\t\t\t\tif (left) {\n\t\t\t\t\tif (top) { n.push(node - numColumns - 1) }\n\t\t\t\t\tn.push(node - 1)\n\t\t\t\t\tif (bottom) { n.push(node + numColumns - 1) }\n\t\t\t\t}\n\t\t\t\tif (top) {\n\t\t\t\t\tn.push(node - numColumns)\n\t\t\t\t}\n\t\t\t\tif (right) {\n\t\t\t\t\tif (top) { n.push(node - numColumns + 1) }\n\t\t\t\t\tn.push(node + 1)\n\t\t\t\t\tif (bottom) { n.push(node + numColumns + 1) }\n\t\t\t\t}\n\t\t\t\tif (bottom) {\n\t\t\t\t\tn.push(node + numColumns)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (left) {\n\t\t\t\t\tn.push(node - 1)\n\t\t\t\t}\n\t\t\t\tif (top) {\n\t\t\t\t\tn.push(node - numColumns)\n\t\t\t\t}\n\t\t\t\tif (right) {\n\t\t\t\t\tn.push(node + 1)\n\t\t\t\t}\n\t\t\t\tif (bottom) {\n\t\t\t\t\tn.push(node + numColumns)\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn n\n\t\t}\n\n\t\tconst levelComp: LevelComp = {\n\n\t\t\tid: \"level\",\n\n\t\t\ttileWidth() {\n\t\t\t\treturn opt.tileWidth\n\t\t\t},\n\n\t\t\ttileHeight() {\n\t\t\t\treturn opt.tileHeight\n\t\t\t},\n\n\t\t\tspawn(this: GameObj<LevelComp>, key: string | CompList<any>, ...args: Vec2Args): GameObj | null {\n\n\t\t\t\tconst p = vec2(...args)\n\n\t\t\t\tconst comps = (() => {\n\t\t\t\t\tif (typeof key === \"string\") {\n\t\t\t\t\t\tif (opt.tiles[key]) {\n\t\t\t\t\t\t\tif (typeof opt.tiles[key] !== \"function\") {\n\t\t\t\t\t\t\t\tthrow new Error(\"Level symbol def must be a function returning a component list\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn opt.tiles[key](p)\n\t\t\t\t\t\t} else if (opt.wildcardTile) {\n\t\t\t\t\t\t\treturn opt.wildcardTile(key, p)\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (Array.isArray(key)) {\n\t\t\t\t\t\treturn key\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"Expected a symbol or a component list\")\n\t\t\t\t\t}\n\t\t\t\t})()\n\n\t\t\t\t// empty tile\n\t\t\t\tif (!comps) {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\tlet hasPos = false\n\t\t\t\tlet hasTile = false\n\n\t\t\t\tfor (const comp of comps) {\n\t\t\t\t\tif (comp.id === \"tile\") hasTile = true\n\t\t\t\t\tif (comp.id === \"pos\") hasPos = true\n\t\t\t\t}\n\n\t\t\t\tif (!hasPos) comps.push(pos())\n\t\t\t\tif (!hasTile) comps.push(tile())\n\n\t\t\t\tconst obj = level.add(comps)\n\n\t\t\t\tif (hasPos) {\n\t\t\t\t\tobj.tilePosOffset = obj.pos.clone()\n\t\t\t\t}\n\n\t\t\t\tobj.tilePos = p\n\n\t\t\t\tif (spatialMap) {\n\t\t\t\t\tinsertIntoSpatialMap(obj)\n\t\t\t\t\tthis.trigger(\"spatial_map_changed\")\n\t\t\t\t\tthis.trigger(\"navigation_map_invalid\")\n\t\t\t\t}\n\n\t\t\t\treturn obj\n\n\t\t\t},\n\n\t\t\tnumColumns() {\n\t\t\t\treturn numColumns\n\t\t\t},\n\n\t\t\tnumRows() {\n\t\t\t\treturn numRows\n\t\t\t},\n\n\t\t\tlevelWidth() {\n\t\t\t\treturn numColumns * this.tileWidth()\n\t\t\t},\n\n\t\t\tlevelHeight() {\n\t\t\t\treturn numRows * this.tileHeight()\n\t\t\t},\n\n\t\t\ttile2Pos(...args: Vec2Args) {\n\t\t\t\treturn vec2(...args).scale(this.tileWidth(), this.tileHeight())\n\t\t\t},\n\n\t\t\tpos2Tile(...args: Vec2Args) {\n\t\t\t\tconst p = vec2(...args)\n\t\t\t\treturn vec2(\n\t\t\t\t\tMath.floor(p.x / this.tileWidth()),\n\t\t\t\t\tMath.floor(p.y / this.tileHeight()),\n\t\t\t\t)\n\t\t\t},\n\n\t\t\tgetSpatialMap() {\n\t\t\t\tif (!spatialMap) {\n\t\t\t\t\tcreateSpatialMap()\n\t\t\t\t}\n\t\t\t\treturn spatialMap\n\t\t\t},\n\n\t\t\tonSpatialMapChanged(this: GameObj<LevelComp>, cb: () => void) {\n\t\t\t\treturn this.on(\"spatial_map_changed\", cb)\n\t\t\t},\n\n\t\t\tonNavigationMapInvalid(this: GameObj<LevelComp>, cb: () => void) {\n\t\t\t\treturn this.on(\"navigation_map_invalid\", cb)\n\t\t\t},\n\n\t\t\tgetAt(tilePos: Vec2) {\n\t\t\t\tif (!spatialMap) {\n\t\t\t\t\tcreateSpatialMap()\n\t\t\t\t}\n\t\t\t\tconst hash = tile2Hash(tilePos)\n\t\t\t\treturn spatialMap[hash] || []\n\t\t\t},\n\n\t\t\tupdate() {\n\t\t\t\tif (spatialMap) {\n\t\t\t\t\tupdateSpatialMap()\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tinvalidateNavigationMap() {\n\t\t\t\tcostMap = null\n\t\t\t\tedgeMap = null\n\t\t\t\tconnectivityMap = null\n\t\t\t},\n\n\t\t\tonNavigationMapChanged(this: GameObj<LevelComp>, cb: () => void) {\n\t\t\t\treturn this.on(\"navigation_map_changed\", cb)\n\t\t\t},\n\n\t\t\tgetTilePath(this: GameObj<LevelComp>, from: Vec2, to: Vec2, opts: PathFindOpt = {}) {\n\t\t\t\tif (!costMap) {\n\t\t\t\t\tcreateCostMap()\n\t\t\t\t}\n\t\t\t\tif (!edgeMap) {\n\t\t\t\t\tcreateEdgeMap()\n\t\t\t\t}\n\t\t\t\tif (!connectivityMap) {\n\t\t\t\t\tcreateConnectivityMap()\n\t\t\t\t}\n\n\t\t\t\t// Tiles are outside the grid\n\t\t\t\tif (from.x < 0 || from.x >= numColumns ||\n\t\t\t\t\tfrom.y < 0 || from.y >= numRows) {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\t\t\t\tif (to.x < 0 || to.x >= numColumns ||\n\t\t\t\t\tto.y < 0 || to.y >= numRows) {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\tconst start = tile2Hash(from)\n\t\t\t\tconst goal = tile2Hash(to)\n\n\t\t\t\t// Tiles are not accessible\n\t\t\t\t// If we test the start tile, we may get stuck\n\t\t\t\t/*if (costMap[start] === Infinity) {\n\t\t\t\t\treturn null\n\t\t\t\t}*/\n\t\t\t\tif (costMap[goal] === Infinity) {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\t// Same Tile, no waypoints needed\n\t\t\t\tif (start === goal) {\n\t\t\t\t\treturn []\n\t\t\t\t}\n\n\t\t\t\t// Tiles are not within the same section\n\t\t\t\t// If we test the start tile when invalid, we may get stuck\n\t\t\t\tif (connectivityMap[start] != -1 && connectivityMap[start] !== connectivityMap[goal]) {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\t// Find a path\n\t\t\t\tinterface CostNode { cost: number, node: number }\n\t\t\t\tconst frontier = new BinaryHeap<CostNode>((a, b) => a.cost < b.cost)\n\t\t\t\tfrontier.insert({ cost: 0, node: start })\n\n\t\t\t\tconst cameFrom = new Map<number, number>()\n\t\t\t\tcameFrom.set(start, start)\n\t\t\t\tconst costSoFar = new Map<number, number>()\n\t\t\t\tcostSoFar.set(start, 0)\n\n\t\t\t\twhile (frontier.length !== 0) {\n\t\t\t\t\tconst current = frontier.remove()?.node\n\n\t\t\t\t\tif (current === goal)\n\t\t\t\t\t\tbreak\n\n\t\t\t\t\tconst neighbours = getNeighbours(current, opts.allowDiagonals)\n\t\t\t\t\tfor (const next of neighbours) {\n\t\t\t\t\t\tconst newCost = (costSoFar.get(current) || 0) +\n\t\t\t\t\t\t\tgetCost(current, next) +\n\t\t\t\t\t\t\tgetHeuristic(next, goal)\n\t\t\t\t\t\tif (!costSoFar.has(next) || newCost < costSoFar.get(next)) {\n\t\t\t\t\t\t\tcostSoFar.set(next, newCost)\n\t\t\t\t\t\t\tfrontier.insert({ cost: newCost, node: next })\n\t\t\t\t\t\t\tcameFrom.set(next, current)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst path = []\n\t\t\t\tlet node = goal\n\t\t\t\tconst p = hash2Tile(node)\n\t\t\t\tpath.push(p)\n\t\t\t\twhile (node !== start) {\n\t\t\t\t\tnode = cameFrom.get(node)\n\t\t\t\t\tconst p = hash2Tile(node)\n\t\t\t\t\tpath.push(p)\n\t\t\t\t}\n\t\t\t\treturn path.reverse()\n\t\t\t},\n\n\t\t\tgetPath(this: GameObj<LevelComp>, from: Vec2, to: Vec2, opts: PathFindOpt = {}) {\n\t\t\t\tconst tw = this.tileWidth()\n\t\t\t\tconst th = this.tileHeight()\n\t\t\t\tconst path = this.getTilePath(\n\t\t\t\t\tthis.pos2Tile(from),\n\t\t\t\t\tthis.pos2Tile(to),\n\t\t\t\t\topts,\n\t\t\t\t)\n\t\t\t\tif (path) {\n\t\t\t\t\treturn [\n\t\t\t\t\t\tfrom,\n\t\t\t\t\t\t...path\n\t\t\t\t\t\t\t.slice(1, -1)\n\t\t\t\t\t\t\t.map((tilePos) => tilePos.scale(tw, th).add(tw / 2, th / 2)),\n\t\t\t\t\t\tto,\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\t\t\t},\n\n\t\t}\n\n\t\tlevel.use(levelComp)\n\n\t\tlevel.onNavigationMapInvalid(() => {\n\t\t\tlevel.invalidateNavigationMap()\n\t\t\tlevel.trigger(\"navigation_map_changed\")\n\t\t})\n\n\t\tmap.forEach((row, i) => {\n\t\t\tconst keys = row.split(\"\")\n\t\t\tnumColumns = Math.max(keys.length, numColumns)\n\t\t\tkeys.forEach((key, j) => {\n\t\t\t\tlevel.spawn(key, vec2(j, i))\n\t\t\t})\n\t\t})\n\n\t\treturn level\n\n\t}\n\n\tfunction agent(opts: AgentCompOpt = {}) : AgentComp {\n\t\tlet target: Vec2 | null = null\n\t\tlet path: Vec2[] | null = null\n\t\tlet index: number | null = null\n\t\tlet navMapChangedEvent: EventController | null = null\n\t\treturn {\n\t\t\tid: \"agent\",\n\t\t\trequire: [\"pos\", \"tile\"],\n\t\t\tagentSpeed: opts.speed ?? 100,\n\t\t\tallowDiagonals: opts.allowDiagonals ?? true,\n\t\t\tgetDistanceToTarget(this: GameObj<AgentComp | PosComp>) {\n\t\t\t\treturn target ? this.pos.dist(target) : 0\n\t\t\t},\n\t\t\tgetNextLocation() {\n\t\t\t\treturn path && index ? path[index] : null\n\t\t\t},\n\t\t\tgetPath() {\n\t\t\t\treturn path ? path.slice() : null\n\t\t\t},\n\t\t\tgetTarget() {\n\t\t\t\treturn target\n\t\t\t},\n\t\t\tisNavigationFinished() {\n\t\t\t\treturn path ? index === null : true\n\t\t\t},\n\t\t\tisTargetReachable() {\n\t\t\t\treturn path !== null\n\t\t\t},\n\t\t\tisTargetReached(this: GameObj<AgentComp | PosComp>) {\n\t\t\t\treturn target ? this.pos.eq(target) : true\n\t\t\t},\n\t\t\tsetTarget(this: GameObj<AgentComp | TileComp | PosComp>, p: Vec2) {\n\t\t\t\ttarget = p\n\t\t\t\tpath = this.getLevel().getPath(this.pos, target, {\n\t\t\t\t\tallowDiagonals: this.allowDiagonals,\n\t\t\t\t})\n\t\t\t\tindex = path ? 0 : null\n\t\t\t\tif (path) {\n\t\t\t\t\tif (!navMapChangedEvent) {\n\t\t\t\t\t\tnavMapChangedEvent = this.getLevel().onNavigationMapChanged(() => {\n\t\t\t\t\t\t\tif (path && index !== null) {\n\t\t\t\t\t\t\t\tpath = this.getLevel().getPath(this.pos, target, {\n\t\t\t\t\t\t\t\t\tallowDiagonals: this.allowDiagonals,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tindex = path ? 0 : null\n\t\t\t\t\t\t\t\tif (path) {\n\t\t\t\t\t\t\t\t\tthis.trigger(\"navigation-next\", this, path[index])\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.trigger(\"navigation-ended\", this)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\tthis.onDestroy(() => navMapChangedEvent.cancel())\n\t\t\t\t\t}\n\t\t\t\t\tthis.trigger(\"navigation-started\", this)\n\t\t\t\t\tthis.trigger(\"navigation-next\", this, path[index])\n\t\t\t\t} else {\n\t\t\t\t\tthis.trigger(\"navigation-ended\", this)\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdate(this: GameObj<AgentComp | PosComp>) {\n\t\t\t\tif (path && index !== null) {\n\t\t\t\t\tif (this.pos.sdist(path[index]) < 2) {\n\t\t\t\t\t\tif (index === path.length - 1) {\n\t\t\t\t\t\t\tthis.pos = target.clone()\n\t\t\t\t\t\t\tindex = null\n\t\t\t\t\t\t\tthis.trigger(\"navigation-ended\", this)\n\t\t\t\t\t\t\tthis.trigger(\"target-reached\", this)\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tindex++\n\t\t\t\t\t\t\tthis.trigger(\"navigation-next\", this, path[index])\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\tthis.moveTo(path[index], this.agentSpeed)\n\t\t\t\t}\n\t\t\t},\n\t\t\tonNavigationStarted(this: GameObj<AgentComp>, cb: () => void) {\n\t\t\t\treturn this.on(\"navigation-started\", cb)\n\t\t\t},\n\t\t\tonNavigationNext(this: GameObj<AgentComp>, cb: () => void) {\n\t\t\t\treturn this.on(\"navigation-next\", cb)\n\t\t\t},\n\t\t\tonNavigationEnded(this: GameObj<AgentComp>, cb: () => void) {\n\t\t\t\treturn this.on(\"navigation-ended\", cb)\n\t\t\t},\n\t\t\tonTargetReached(this: GameObj<AgentComp>, cb: () => void) {\n\t\t\t\treturn this.on(\"target-reached\", cb)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn JSON.stringify({\n\t\t\t\t\ttarget: JSON.stringify(target),\n\t\t\t\t\tpath: JSON.stringify(path),\n\t\t\t\t})\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction record(frameRate?): Recording {\n\n\t\tconst stream = app.canvas.captureStream(frameRate)\n\t\tconst audioDest = audio.ctx.createMediaStreamDestination()\n\n\t\taudio.masterNode.connect(audioDest)\n\n\t\t// TODO: Enabling audio results in empty video if no audio received\n\t\t// const audioStream = audioDest.stream\n\t\t// const [firstAudioTrack] = audioStream.getAudioTracks()\n\n\t\t// stream.addTrack(firstAudioTrack);\n\n\t\tconst recorder = new MediaRecorder(stream)\n\t\tconst chunks = []\n\n\t\trecorder.ondataavailable = (e) => {\n\t\t\tif (e.data.size > 0) {\n\t\t\t\tchunks.push(e.data)\n\t\t\t}\n\t\t}\n\n\t\trecorder.onerror = () => {\n\t\t\taudio.masterNode.disconnect(audioDest)\n\t\t\tstream.getTracks().forEach(t => t.stop())\n\t\t}\n\n\t\trecorder.start()\n\n\t\treturn {\n\n\t\t\tresume() {\n\t\t\t\trecorder.resume()\n\t\t\t},\n\n\t\t\tpause() {\n\t\t\t\trecorder.pause()\n\t\t\t},\n\n\t\t\tstop(): Promise<Blob> {\n\t\t\t\trecorder.stop()\n\t\t\t\t// cleanup\n\t\t\t\taudio.masterNode.disconnect(audioDest)\n\t\t\t\tstream.getTracks().forEach(t => t.stop())\n\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\trecorder.onstop = () => {\n\t\t\t\t\t\tresolve(new Blob(chunks, {\n\t\t\t\t\t\t\ttype: \"video/mp4\",\n\t\t\t\t\t\t}))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\n\t\t\tdownload(filename = \"kaboom.mp4\") {\n\t\t\t\tthis.stop().then((blob) => downloadBlob(filename, blob))\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction isFocused(): boolean {\n\t\treturn document.activeElement === app.canvas\n\t}\n\n\tfunction destroy(obj: GameObj) {\n\t\tobj.destroy()\n\t}\n\n\t// aliases for root game obj operations\n\tconst add = game.root.add.bind(game.root)\n\tconst readd = game.root.readd.bind(game.root)\n\tconst destroyAll = game.root.removeAll.bind(game.root)\n\tconst get = game.root.get.bind(game.root)\n\tconst wait = game.root.wait.bind(game.root)\n\tconst loop = game.root.loop.bind(game.root)\n\tconst tween = game.root.tween.bind(game.root)\n\n\tfunction boom(speed: number = 2, size: number = 1): Comp {\n\t\tlet time = 0\n\t\treturn {\n\t\t\trequire: [ \"scale\" ],\n\t\t\tupdate(this: GameObj<ScaleComp>) {\n\t\t\t\tconst s = Math.sin(time * speed) * size\n\t\t\t\tif (s < 0) {\n\t\t\t\t\tthis.destroy()\n\t\t\t\t}\n\t\t\t\tthis.scale = vec2(s)\n\t\t\t\ttime += dt()\n\t\t\t},\n\t\t}\n\t}\n\n\tconst kaSprite = loadSprite(null, kaSpriteSrc)\n\tconst boomSprite = loadSprite(null, boomSpriteSrc)\n\n\tfunction addKaboom(p: Vec2, opt: BoomOpt = {}): GameObj {\n\n\t\tconst kaboom = add([\n\t\t\tpos(p),\n\t\t\tstay(),\n\t\t])\n\n\t\tconst speed = (opt.speed || 1) * 5\n\t\tconst s = opt.scale || 1\n\n\t\tkaboom.add([\n\t\t\tsprite(boomSprite),\n\t\t\tscale(0),\n\t\t\tanchor(\"center\"),\n\t\t\tboom(speed, s),\n\t\t\t...opt.comps ?? [],\n\t\t])\n\n\t\tconst ka = kaboom.add([\n\t\t\tsprite(kaSprite),\n\t\t\tscale(0),\n\t\t\tanchor(\"center\"),\n\t\t\ttimer(),\n\t\t\t...opt.comps ?? [],\n\t\t])\n\n\t\tka.wait(0.4 / speed, () => ka.use(boom(speed, s)))\n\t\tka.onDestroy(() => kaboom.destroy())\n\n\t\treturn kaboom\n\n\t}\n\n\tfunction updateFrame() {\n\t\t// update every obj\n\t\tgame.root.update()\n\t}\n\n\tclass Collision {\n\t\tsource: GameObj\n\t\ttarget: GameObj\n\t\tdisplacement: Vec2\n\t\tresolved: boolean = false\n\t\tconstructor(source: GameObj, target: GameObj, dis: Vec2, resolved = false) {\n\t\t\tthis.source = source\n\t\t\tthis.target = target\n\t\t\tthis.displacement = dis\n\t\t\tthis.resolved = resolved\n\t\t}\n\t\treverse() {\n\t\t\treturn new Collision(\n\t\t\t\tthis.target,\n\t\t\t\tthis.source,\n\t\t\t\tthis.displacement.scale(-1),\n\t\t\t\tthis.resolved,\n\t\t\t)\n\t\t}\n\t\thasOverlap() {\n\t\t\treturn !this.displacement.isZero()\n\t\t}\n\t\tisLeft() {\n\t\t\treturn this.displacement.x > 0\n\t\t}\n\t\tisRight() {\n\t\t\treturn this.displacement.x < 0\n\t\t}\n\t\tisTop() {\n\t\t\treturn this.displacement.y > 0\n\t\t}\n\t\tisBottom() {\n\t\t\treturn this.displacement.y < 0\n\t\t}\n\t\tpreventResolution() {\n\t\t\tthis.resolved = true\n\t\t}\n\t}\n\n\tfunction checkFrame() {\n\n\t\t// TODO: persistent grid?\n\t\t// start a spatial hash grid for more efficient collision detection\n\t\tconst grid: Record<number, Record<number, GameObj<AreaComp>[]>> = {}\n\t\tconst cellSize = gopt.hashGridSize || DEF_HASH_GRID_SIZE\n\n\t\t// current transform\n\t\tlet tr = new Mat4()\n\n\t\t// a local transform stack\n\t\tconst stack = []\n\n\t\tfunction checkObj(obj: GameObj) {\n\n\t\t\tstack.push(tr.clone())\n\n\t\t\t// Update object transform here. This will be the transform later used in rendering.\n\t\t\tif (obj.pos) tr.translate(obj.pos)\n\t\t\tif (obj.scale) tr.scale(obj.scale)\n\t\t\tif (obj.angle) tr.rotate(obj.angle)\n\t\t\tobj.transform = tr.clone()\n\n\t\t\tif (obj.c(\"area\") && !obj.paused) {\n\n\t\t\t\t// TODO: only update worldArea if transform changed\n\t\t\t\tconst aobj = obj as GameObj<AreaComp>\n\t\t\t\tconst area = aobj.worldArea()\n\t\t\t\tconst bbox = area.bbox()\n\n\t\t\t\t// Get spatial hash grid coverage\n\t\t\t\tconst xmin = Math.floor(bbox.pos.x / cellSize)\n\t\t\t\tconst ymin = Math.floor(bbox.pos.y / cellSize)\n\t\t\t\tconst xmax = Math.ceil((bbox.pos.x + bbox.width) / cellSize)\n\t\t\t\tconst ymax = Math.ceil((bbox.pos.y + bbox.height) / cellSize)\n\n\t\t\t\t// Cache objs that are already checked\n\t\t\t\tconst checked = new Set()\n\n\t\t\t\t// insert & check against all covered grids\n\t\t\t\tfor (let x = xmin; x <= xmax; x++) {\n\t\t\t\t\tfor (let y = ymin; y <= ymax; y++) {\n\t\t\t\t\t\tif(!grid[x]) {\n\t\t\t\t\t\t\tgrid[x] = {}\n\t\t\t\t\t\t\tgrid[x][y] = [aobj]\n\t\t\t\t\t\t} else if(!grid[x][y]) {\n\t\t\t\t\t\t\tgrid[x][y] = [aobj]\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst cell = grid[x][y]\n\t\t\t\t\t\t\tcheck: for (const other of cell) {\n\t\t\t\t\t\t\t\tif (other.paused) continue\n\t\t\t\t\t\t\t\tif (!other.exists()) continue\n\t\t\t\t\t\t\t\tif (checked.has(other.id)) continue\n\t\t\t\t\t\t\t\tfor (const tag of aobj.collisionIgnore) {\n\t\t\t\t\t\t\t\t\tif (other.is(tag)) {\n\t\t\t\t\t\t\t\t\t\tcontinue check\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfor (const tag of other.collisionIgnore) {\n\t\t\t\t\t\t\t\t\tif (aobj.is(tag)) {\n\t\t\t\t\t\t\t\t\t\tcontinue check\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// TODO: cache the world area here\n\t\t\t\t\t\t\t\tconst res = sat(aobj.worldArea(), other.worldArea())\n\t\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\t\t// TODO: rehash if the object position is changed after resolution?\n\t\t\t\t\t\t\t\t\tconst col1 = new Collision(aobj, other, res)\n\t\t\t\t\t\t\t\t\taobj.trigger(\"collideUpdate\", other, col1)\n\t\t\t\t\t\t\t\t\tconst col2 = col1.reverse()\n\t\t\t\t\t\t\t\t\t// resolution only has to happen once\n\t\t\t\t\t\t\t\t\tcol2.resolved = col1.resolved\n\t\t\t\t\t\t\t\t\tother.trigger(\"collideUpdate\", aobj, col2)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tchecked.add(other.id)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcell.push(aobj)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tobj.children.forEach(checkObj)\n\t\t\ttr = stack.pop()\n\n\t\t}\n\n\t\tcheckObj(game.root)\n\n\t}\n\n\tfunction drawFrame() {\n\n\t\t// calculate camera matrix\n\t\tconst cam = game.cam\n\t\tconst shake = Vec2.fromAngle(rand(0, 360)).scale(cam.shake)\n\n\t\tcam.shake = lerp(cam.shake, 0, 5 * dt())\n\t\tcam.transform = new Mat4()\n\t\t\t.translate(center())\n\t\t\t.scale(cam.scale)\n\t\t\t.rotate(cam.angle)\n\t\t\t.translate((cam.pos ?? center()).scale(-1).add(shake))\n\n\t\tgame.root.draw()\n\t\tflush()\n\n\t}\n\n\tfunction drawLoadScreen() {\n\n\t\tconst progress = loadProgress()\n\n\t\tif (game.events.numListeners(\"loading\") > 0) {\n\t\t\tgame.events.trigger(\"loading\", progress)\n\t\t} else {\n\t\t\tdrawUnscaled(() => {\n\t\t\t\tconst w = width() / 2\n\t\t\t\tconst h = 24\n\t\t\t\tconst pos = vec2(width() / 2, height() / 2).sub(vec2(w / 2, h / 2))\n\t\t\t\tdrawRect({\n\t\t\t\t\tpos: vec2(0),\n\t\t\t\t\twidth: width(),\n\t\t\t\t\theight: height(),\n\t\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\t})\n\t\t\t\tdrawRect({\n\t\t\t\t\tpos: pos,\n\t\t\t\t\twidth: w,\n\t\t\t\t\theight: h,\n\t\t\t\t\tfill: false,\n\t\t\t\t\toutline: {\n\t\t\t\t\t\twidth: 4,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tdrawRect({\n\t\t\t\t\tpos: pos,\n\t\t\t\t\twidth: w * progress,\n\t\t\t\t\theight: h,\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\n\t}\n\n\tfunction drawInspectText(pos, txt) {\n\n\t\tdrawUnscaled(() => {\n\n\t\t\tconst pad = vec2(8)\n\n\t\t\tpushTransform()\n\t\t\tpushTranslate(pos)\n\n\t\t\tconst ftxt = formatText({\n\t\t\t\ttext: txt,\n\t\t\t\tfont: DBG_FONT,\n\t\t\t\tsize: 16,\n\t\t\t\tpos: pad,\n\t\t\t\tcolor: rgb(255, 255, 255),\n\t\t\t\tfixed: true,\n\t\t\t})\n\n\t\t\tconst bw = ftxt.width + pad.x * 2\n\t\t\tconst bh = ftxt.height + pad.x * 2\n\n\t\t\tif (pos.x + bw >= width()) {\n\t\t\t\tpushTranslate(vec2(-bw, 0))\n\t\t\t}\n\n\t\t\tif (pos.y + bh >= height()) {\n\t\t\t\tpushTranslate(vec2(0, -bh))\n\t\t\t}\n\n\t\t\tdrawRect({\n\t\t\t\twidth: bw,\n\t\t\t\theight: bh,\n\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\tradius: 4,\n\t\t\t\topacity: 0.8,\n\t\t\t\tfixed: true,\n\t\t\t})\n\n\t\t\tdrawFormattedText(ftxt)\n\t\t\tpopTransform()\n\n\t\t})\n\n\t}\n\n\tfunction drawDebug() {\n\n\t\tif (debug.inspect) {\n\n\t\t\tlet inspecting = null\n\n\t\t\tfor (const obj of game.root.get(\"*\", { recursive: true })) {\n\t\t\t\tif (obj.c(\"area\") && obj.isHovering()) {\n\t\t\t\t\tinspecting = obj\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tgame.root.drawInspect()\n\n\t\t\tif (inspecting) {\n\n\t\t\t\tconst lines = []\n\t\t\t\tconst data = inspecting.inspect()\n\n\t\t\t\tfor (const tag in data) {\n\t\t\t\t\tif (data[tag]) {\n\t\t\t\t\t\tlines.push(`${tag}: ${data[tag]}`)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlines.push(`${tag}`)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdrawInspectText(contentToView(mousePos()), lines.join(\"\\n\"))\n\n\t\t\t}\n\n\t\t\tdrawInspectText(vec2(8), `FPS: ${debug.fps()}`)\n\n\t\t}\n\n\t\tif (debug.paused) {\n\n\t\t\tdrawUnscaled(() => {\n\n\t\t\t\t// top right corner\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(width(), 0)\n\t\t\t\tpushTranslate(-8, 8)\n\n\t\t\t\tconst size = 32\n\n\t\t\t\t// bg\n\t\t\t\tdrawRect({\n\t\t\t\t\twidth: size,\n\t\t\t\t\theight: size,\n\t\t\t\t\tanchor: \"topright\",\n\t\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\t\topacity: 0.8,\n\t\t\t\t\tradius: 4,\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\t// pause icon\n\t\t\t\tfor (let i = 1; i <= 2; i++) {\n\t\t\t\t\tdrawRect({\n\t\t\t\t\t\twidth: 4,\n\t\t\t\t\t\theight: size * 0.6,\n\t\t\t\t\t\tanchor: \"center\",\n\t\t\t\t\t\tpos: vec2(-size / 3 * i, size * 0.5),\n\t\t\t\t\t\tcolor: rgb(255, 255, 255),\n\t\t\t\t\t\tradius: 2,\n\t\t\t\t\t\tfixed: true,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tpopTransform()\n\n\t\t\t})\n\n\t\t}\n\n\t\tif (debug.timeScale !== 1) {\n\n\t\t\tdrawUnscaled(() => {\n\n\t\t\t\t// bottom right corner\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(width(), height())\n\t\t\t\tpushTranslate(-8, -8)\n\n\t\t\t\tconst pad = 8\n\n\t\t\t\t// format text first to get text size\n\t\t\t\tconst ftxt = formatText({\n\t\t\t\t\ttext: debug.timeScale.toFixed(1),\n\t\t\t\t\tfont: DBG_FONT,\n\t\t\t\t\tsize: 16,\n\t\t\t\t\tcolor: rgb(255, 255, 255),\n\t\t\t\t\tpos: vec2(-pad),\n\t\t\t\t\tanchor: \"botright\",\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\t// bg\n\t\t\t\tdrawRect({\n\t\t\t\t\twidth: ftxt.width + pad * 2 + pad * 4,\n\t\t\t\t\theight: ftxt.height + pad * 2,\n\t\t\t\t\tanchor: \"botright\",\n\t\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\t\topacity: 0.8,\n\t\t\t\t\tradius: 4,\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\t// fast forward / slow down icon\n\t\t\t\tfor (let i = 0; i < 2; i++) {\n\t\t\t\t\tconst flipped = debug.timeScale < 1\n\t\t\t\t\tdrawTriangle({\n\t\t\t\t\t\tp1: vec2(-ftxt.width - pad * (flipped ? 2 : 3.5), -pad),\n\t\t\t\t\t\tp2: vec2(-ftxt.width - pad * (flipped ? 2 : 3.5), -pad - ftxt.height),\n\t\t\t\t\t\tp3: vec2(-ftxt.width - pad * (flipped ? 3.5 : 2), -pad - ftxt.height / 2),\n\t\t\t\t\t\tpos: vec2(-i * pad * 1 + (flipped ? -pad * 0.5 : 0), 0),\n\t\t\t\t\t\tcolor: rgb(255, 255, 255),\n\t\t\t\t\t\tfixed: true,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t// text\n\t\t\t\tdrawFormattedText(ftxt)\n\n\t\t\t\tpopTransform()\n\n\t\t\t})\n\n\t\t}\n\n\t\tif (debug.curRecording) {\n\n\t\t\tdrawUnscaled(() => {\n\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(0, height())\n\t\t\t\tpushTranslate(24, -24)\n\n\t\t\t\tdrawCircle({\n\t\t\t\t\tradius: 12,\n\t\t\t\t\tcolor: rgb(255, 0, 0),\n\t\t\t\t\topacity: wave(0, 1, app.time() * 4),\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\tpopTransform()\n\n\t\t\t})\n\n\t\t}\n\n\t\tif (debug.showLog && game.logs.length > 0) {\n\n\t\t\tdrawUnscaled(() => {\n\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(0, height())\n\t\t\t\tpushTranslate(8, -8)\n\n\t\t\t\tconst pad = 8\n\t\t\t\tconst logs = []\n\n\t\t\t\tfor (const log of game.logs) {\n\t\t\t\t\tlet str = \"\"\n\t\t\t\t\tconst style = log.msg instanceof Error ? \"error\" : \"info\"\n\t\t\t\t\tstr += `[time]${log.time.toFixed(2)}[/time]`\n\t\t\t\t\tstr += \" \"\n\t\t\t\t\tstr += `[${style}]${log.msg?.toString ? log.msg.toString() : log.msg}[/${style}]`\n\t\t\t\t\tlogs.push(str)\n\t\t\t\t}\n\n\t\t\t\tgame.logs = game.logs\n\t\t\t\t\t.filter((log) => app.time() - log.time < (gopt.logTime || LOG_TIME))\n\n\t\t\t\tconst ftext = formatText({\n\t\t\t\t\ttext: logs.join(\"\\n\"),\n\t\t\t\t\tfont: DBG_FONT,\n\t\t\t\t\tpos: vec2(pad, -pad),\n\t\t\t\t\tanchor: \"botleft\",\n\t\t\t\t\tsize: 16,\n\t\t\t\t\twidth: width() * 0.6,\n\t\t\t\t\tlineSpacing: pad / 2,\n\t\t\t\t\tfixed: true,\n\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\"time\": { color: rgb(127, 127, 127) },\n\t\t\t\t\t\t\"info\": { color: rgb(255, 255, 255) },\n\t\t\t\t\t\t\"error\": { color: rgb(255, 0, 127) },\n\t\t\t\t\t},\n\t\t\t\t})\n\n\t\t\t\tdrawRect({\n\t\t\t\t\twidth: ftext.width + pad * 2,\n\t\t\t\t\theight: ftext.height + pad * 2,\n\t\t\t\t\tanchor: \"botleft\",\n\t\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\t\tradius: 4,\n\t\t\t\t\topacity: 0.8,\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\tdrawFormattedText(ftext)\n\t\t\t\tpopTransform()\n\n\t\t\t})\n\n\t\t}\n\n\t}\n\n\tfunction onLoading(action: (progress: number) => void) {\n\t\tgame.events.on(\"loading\", action)\n\t}\n\n\tfunction onResize(action: () => void) {\n\t\tapp.onResize(action)\n\t}\n\n\tfunction onError(action: (err: Error) => void) {\n\t\tgame.events.on(\"error\", action)\n\t}\n\n\tfunction handleErr(err: Error) {\n\n\t\tconsole.error(err)\n\n\t\taudio.ctx.suspend()\n\n\t\t// TODO: this should only run once\n\t\tapp.run(() => {\n\n\t\t\tframeStart()\n\n\t\t\tdrawUnscaled(() => {\n\n\t\t\t\tconst pad = 32\n\t\t\t\tconst gap = 16\n\t\t\t\tconst gw = width()\n\t\t\t\tconst gh = height()\n\n\t\t\t\tconst textStyle = {\n\t\t\t\t\tsize: 36,\n\t\t\t\t\twidth: gw - pad * 2,\n\t\t\t\t\tletterSpacing: 4,\n\t\t\t\t\tlineSpacing: 4,\n\t\t\t\t\tfont: DBG_FONT,\n\t\t\t\t\tfixed: true,\n\t\t\t\t}\n\n\t\t\t\tdrawRect({\n\t\t\t\t\twidth: gw,\n\t\t\t\t\theight: gh,\n\t\t\t\t\tcolor: rgb(0, 0, 255),\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\tconst title = formatText({\n\t\t\t\t\t...textStyle,\n\t\t\t\t\ttext: \"Error\",\n\t\t\t\t\tpos: vec2(pad),\n\t\t\t\t\tcolor: rgb(255, 128, 0),\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\tdrawFormattedText(title)\n\n\t\t\t\tdrawText({\n\t\t\t\t\t...textStyle,\n\t\t\t\t\ttext: err.message,\n\t\t\t\t\tpos: vec2(pad, pad + title.height + gap),\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\tpopTransform()\n\t\t\t\tgame.events.trigger(\"error\", err)\n\n\t\t\t})\n\n\t\t\tframeEnd()\n\n\t\t})\n\n\t}\n\n\tfunction onCleanup(action: () => void) {\n\t\tgc.push(action)\n\t}\n\n\tfunction quit() {\n\n\t\tgame.events.onOnce(\"frameEnd\", () => {\n\n\t\t\tapp.quit()\n\n\t\t\t// clear canvas\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT)\n\n\t\t\t// unbind everything\n\t\t\tconst numTextureUnits = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)\n\n\t\t\tfor (let unit = 0; unit < numTextureUnits; unit++) {\n\t\t\t\tgl.activeTexture(gl.TEXTURE0 + unit)\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, null)\n\t\t\t\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, null)\n\t\t\t}\n\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null)\n\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null)\n\t\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, null)\n\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null)\n\n\t\t\t// run all scattered gc events\n\t\t\tggl.destroy()\n\t\t\tgc.forEach((f) => f())\n\n\t\t})\n\n\t}\n\n\tlet isFirstFrame = true\n\n\t// main game loop\n\tapp.run(() => {\n\n\t\ttry {\n\n\t\t\tif (!assets.loaded) {\n\t\t\t\tif (loadProgress() === 1 && !isFirstFrame) {\n\t\t\t\t\tassets.loaded = true\n\t\t\t\t\tgame.events.trigger(\"load\")\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!assets.loaded && gopt.loadingScreen !== false || isFirstFrame) {\n\t\t\t\tframeStart()\n\t\t\t\t// TODO: Currently if assets are not initially loaded no updates or timers will be run, however they will run if loadingScreen is set to false. What's the desired behavior or should we make them consistent?\n\t\t\t\tdrawLoadScreen()\n\t\t\t\tframeEnd()\n\t\t\t} else {\n\t\t\t\tif (!debug.paused) updateFrame()\n\t\t\t\tcheckFrame()\n\t\t\t\tframeStart()\n\t\t\t\tdrawFrame()\n\t\t\t\tif (gopt.debug !== false) drawDebug()\n\t\t\t\tframeEnd()\n\t\t\t}\n\n\t\t\tif (isFirstFrame) {\n\t\t\t\tisFirstFrame = false\n\t\t\t}\n\n\t\t\tgame.events.trigger(\"frameEnd\")\n\n\t\t} catch (e) {\n\t\t\thandleErr(e)\n\t\t}\n\n\t})\n\n\t// update viewport based on user setting and fullscreen state\n\tfunction updateViewport() {\n\n\t\t// content size (scaled content size, with scale, stretch and letterbox)\n\t\t// view size (unscaled viewport size)\n\t\t// window size (will be the same as view size except letterbox mode)\n\n\t\t// canvas size\n\t\tconst pd = pixelDensity\n\t\tconst cw = gl.drawingBufferWidth / pd\n\t\tconst ch = gl.drawingBufferHeight / pd\n\n\t\tif (gopt.letterbox) {\n\n\t\t\tif (!gopt.width || !gopt.height) {\n\t\t\t\tthrow new Error(\"Letterboxing requires width and height defined.\")\n\t\t\t}\n\n\t\t\tconst rc = cw / ch\n\t\t\tconst rg = gopt.width / gopt.height\n\n\t\t\tif (rc > rg) {\n\t\t\t\tconst sw = ch * rg\n\t\t\t\tconst x = (cw - sw) / 2\n\t\t\t\tgfx.viewport = {\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: 0,\n\t\t\t\t\twidth: sw,\n\t\t\t\t\theight: ch,\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst sh = cw / rg\n\t\t\t\tconst y = (ch - sh) / 2\n\t\t\t\tgfx.viewport = {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: y,\n\t\t\t\t\twidth: cw,\n\t\t\t\t\theight: sh,\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn\n\n\t\t}\n\n\t\tif (gopt.stretch) {\n\t\t\tif (!gopt.width || !gopt.height) {\n\t\t\t\tthrow new Error(\"Stretching requires width and height defined.\")\n\t\t\t}\n\t\t}\n\n\t\tgfx.viewport = {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: cw,\n\t\t\theight: ch,\n\t\t}\n\n\t}\n\n\tfunction initEvents() {\n\n\t\tapp.onHide(() => {\n\t\t\tif (!gopt.backgroundAudio) {\n\t\t\t\taudio.ctx.suspend()\n\t\t\t}\n\t\t})\n\n\t\tapp.onShow(() => {\n\t\t\tif (!gopt.backgroundAudio && !debug.paused) {\n\t\t\t\taudio.ctx.resume()\n\t\t\t}\n\t\t})\n\n\t\tapp.onResize(() => {\n\t\t\tif (app.isFullscreen()) return\n\t\t\tconst fixedSize = gopt.width && gopt.height\n\t\t\tif (fixedSize && !gopt.stretch && !gopt.letterbox) return\n\t\t\tcanvas.width = canvas.offsetWidth * pixelDensity\n\t\t\tcanvas.height = canvas.offsetHeight * pixelDensity\n\t\t\tupdateViewport()\n\t\t\tif (!fixedSize) {\n\t\t\t\tgfx.frameBuffer.free()\n\t\t\t\tgfx.frameBuffer = new FrameBuffer(ggl, gl.drawingBufferWidth, gl.drawingBufferHeight)\n\t\t\t\tgfx.width = gl.drawingBufferWidth / pixelDensity\n\t\t\t\tgfx.height = gl.drawingBufferHeight / pixelDensity\n\t\t\t}\n\t\t})\n\n\t\tif (gopt.debug !== false) {\n\t\t\tapp.onKeyPress(\"f1\", () => debug.inspect = !debug.inspect)\n\t\t\tapp.onKeyPress(\"f2\", () => debug.clearLog())\n\t\t\tapp.onKeyPress(\"f8\", () => debug.paused = !debug.paused)\n\t\t\tapp.onKeyPress(\"f7\", () => {\n\t\t\t\tdebug.timeScale = toFixed(clamp(debug.timeScale - 0.2, 0, 2), 1)\n\t\t\t})\n\t\t\tapp.onKeyPress(\"f9\", () => {\n\t\t\t\tdebug.timeScale = toFixed(clamp(debug.timeScale + 0.2, 0, 2), 1)\n\t\t\t})\n\t\t\tapp.onKeyPress(\"f10\", () => debug.stepFrame())\n\t\t}\n\n\t\tif (gopt.burp) {\n\t\t\tapp.onKeyPress(\"b\", () => burp())\n\t\t}\n\n\t}\n\n\tupdateViewport()\n\tinitEvents()\n\n\t// the exported ctx handle\n\tconst ctx: KaboomCtx = {\n\t\tVERSION,\n\t\t// asset load\n\t\tloadRoot,\n\t\tloadProgress,\n\t\tloadSprite,\n\t\tloadSpriteAtlas,\n\t\tloadSound,\n\t\tloadBitmapFont,\n\t\tloadFont,\n\t\tloadShader,\n\t\tloadShaderURL,\n\t\tloadAseprite,\n\t\tloadPedit,\n\t\tloadBean,\n\t\tloadJSON,\n\t\tload,\n\t\tgetSprite,\n\t\tgetSound,\n\t\tgetFont,\n\t\tgetBitmapFont,\n\t\tgetShader,\n\t\tgetAsset,\n\t\tAsset,\n\t\tSpriteData,\n\t\tSoundData,\n\t\t// query\n\t\twidth,\n\t\theight,\n\t\tcenter,\n\t\tdt,\n\t\ttime: app.time,\n\t\tscreenshot: app.screenshot,\n\t\trecord,\n\t\tisFocused,\n\t\tsetCursor: app.setCursor,\n\t\tgetCursor: app.getCursor,\n\t\tsetCursorLocked: app.setCursorLocked,\n\t\tisCursorLocked: app.isCursorLocked,\n\t\tsetFullscreen: app.setFullscreen,\n\t\tisFullscreen: app.isFullscreen,\n\t\tisTouchscreen: app.isTouchscreen,\n\t\tonLoad,\n\t\tonLoading,\n\t\tonResize,\n\t\tonGamepadConnect: app.onGamepadConnect,\n\t\tonGamepadDisconnect: app.onGamepadDisconnect,\n\t\tonError,\n\t\tonCleanup,\n\t\t// misc\n\t\tcamPos,\n\t\tcamScale,\n\t\tcamRot,\n\t\tshake,\n\t\ttoScreen,\n\t\ttoWorld,\n\t\tsetGravity,\n\t\tgetGravity,\n\t\tsetBackground,\n\t\tgetBackground,\n\t\tgetGamepads: app.getGamepads,\n\t\t// obj\n\t\tadd,\n\t\tmake,\n\t\tdestroy,\n\t\tdestroyAll,\n\t\tget,\n\t\treadd,\n\t\t// comps\n\t\tpos,\n\t\tscale,\n\t\trotate,\n\t\tcolor,\n\t\topacity,\n\t\tanchor,\n\t\tarea,\n\t\tsprite,\n\t\ttext,\n\t\tpolygon,\n\t\trect,\n\t\tcircle,\n\t\tuvquad,\n\t\toutline,\n\t\tbody,\n\t\tdoubleJump,\n\t\tshader,\n\t\ttimer,\n\t\tfixed,\n\t\tstay,\n\t\thealth,\n\t\tlifespan,\n\t\tz,\n\t\tmove,\n\t\toffscreen,\n\t\tfollow,\n\t\tstate,\n\t\tfadeIn,\n\t\tmask,\n\t\tdrawon,\n\t\ttile,\n\t\tagent,\n\t\t// group events\n\t\ton,\n\t\tonUpdate,\n\t\tonDraw,\n\t\tonAdd,\n\t\tonDestroy,\n\t\tonClick,\n\t\tonCollide,\n\t\tonCollideUpdate,\n\t\tonCollideEnd,\n\t\tonHover,\n\t\tonHoverUpdate,\n\t\tonHoverEnd,\n\t\t// input\n\t\tonKeyDown: app.onKeyDown,\n\t\tonKeyPress: app.onKeyPress,\n\t\tonKeyPressRepeat: app.onKeyPressRepeat,\n\t\tonKeyRelease: app.onKeyRelease,\n\t\tonMouseDown: app.onMouseDown,\n\t\tonMousePress: app.onMousePress,\n\t\tonMouseRelease: app.onMouseRelease,\n\t\tonMouseMove: app.onMouseMove,\n\t\tonCharInput: app.onCharInput,\n\t\tonTouchStart: app.onTouchStart,\n\t\tonTouchMove: app.onTouchMove,\n\t\tonTouchEnd: app.onTouchEnd,\n\t\tonScroll: app.onScroll,\n\t\tonHide: app.onHide,\n\t\tonShow: app.onShow,\n\t\tonGamepadButtonDown: app.onGamepadButtonDown,\n\t\tonGamepadButtonPress: app.onGamepadButtonPress,\n\t\tonGamepadButtonRelease: app.onGamepadButtonRelease,\n\t\tonGamepadStick: app.onGamepadStick,\n\t\tmousePos: mousePos,\n\t\tmouseDeltaPos: app.mouseDeltaPos,\n\t\tisKeyDown: app.isKeyDown,\n\t\tisKeyPressed: app.isKeyPressed,\n\t\tisKeyPressedRepeat: app.isKeyPressedRepeat,\n\t\tisKeyReleased: app.isKeyReleased,\n\t\tisMouseDown: app.isMouseDown,\n\t\tisMousePressed: app.isMousePressed,\n\t\tisMouseReleased: app.isMouseReleased,\n\t\tisMouseMoved: app.isMouseMoved,\n\t\tisGamepadButtonPressed: app.isGamepadButtonPressed,\n\t\tisGamepadButtonDown: app.isGamepadButtonDown,\n\t\tisGamepadButtonReleased: app.isGamepadButtonReleased,\n\t\tgetGamepadStick: app.getGamepadStick,\n\t\tcharInputted: app.charInputted,\n\t\t// timer\n\t\tloop,\n\t\twait,\n\t\t// audio\n\t\tplay,\n\t\tvolume,\n\t\tburp,\n\t\taudioCtx: audio.ctx,\n\t\t// math\n\t\tLine,\n\t\tRect,\n\t\tCircle,\n\t\tPolygon,\n\t\tVec2,\n\t\tColor,\n\t\tMat4,\n\t\tQuad,\n\t\tRNG,\n\t\trand,\n\t\trandi,\n\t\trandSeed,\n\t\tvec2,\n\t\trgb,\n\t\thsl2rgb,\n\t\tquad,\n\t\tchoose,\n\t\tchance,\n\t\tlerp,\n\t\ttween,\n\t\teasings,\n\t\tmap,\n\t\tmapc,\n\t\twave,\n\t\tdeg2rad,\n\t\trad2deg,\n\t\tclamp,\n\t\ttestLineLine,\n\t\ttestRectRect,\n\t\ttestRectLine,\n\t\ttestRectPoint,\n\t\ttestCirclePolygon,\n\t\ttestLinePoint,\n\t\ttestLineCircle,\n\t\t// raw draw\n\t\tdrawSprite,\n\t\tdrawText,\n\t\tformatText,\n\t\tdrawRect,\n\t\tdrawLine,\n\t\tdrawLines,\n\t\tdrawTriangle,\n\t\tdrawCircle,\n\t\tdrawEllipse,\n\t\tdrawUVQuad,\n\t\tdrawPolygon,\n\t\tdrawFormattedText,\n\t\tdrawMasked,\n\t\tdrawSubtracted,\n\t\tpushTransform,\n\t\tpopTransform,\n\t\tpushTranslate,\n\t\tpushScale,\n\t\tpushRotate,\n\t\tpushMatrix,\n\t\tusePostEffect,\n\t\tmakeCanvas,\n\t\t// debug\n\t\tdebug,\n\t\t// scene\n\t\tscene,\n\t\tgo,\n\t\tonSceneLeave,\n\t\t// level\n\t\taddLevel,\n\t\t// storage\n\t\tgetData,\n\t\tsetData,\n\t\tdownload,\n\t\tdownloadJSON,\n\t\tdownloadText,\n\t\tdownloadBlob,\n\t\t// plugin\n\t\tplug,\n\t\t// char sets\n\t\tASCII_CHARS,\n\t\t// dom\n\t\tcanvas: app.canvas,\n\t\t// misc\n\t\taddKaboom,\n\t\t// dirs\n\t\tLEFT: Vec2.LEFT,\n\t\tRIGHT: Vec2.RIGHT,\n\t\tUP: Vec2.UP,\n\t\tDOWN: Vec2.DOWN,\n\t\t// colors\n\t\tRED: Color.RED,\n\t\tGREEN: Color.GREEN,\n\t\tBLUE: Color.BLUE,\n\t\tYELLOW: Color.YELLOW,\n\t\tMAGENTA: Color.MAGENTA,\n\t\tCYAN: Color.CYAN,\n\t\tWHITE: Color.WHITE,\n\t\tBLACK: Color.BLACK,\n\t\tquit,\n\t\t// helpers\n\t\tEvent,\n\t\tEventHandler,\n\t\tEventController,\n\t}\n\n\tif (gopt.plugins) {\n\t\tgopt.plugins.forEach(plug)\n\t}\n\n\t// export everything to window if global is set\n\tif (gopt.global !== false) {\n\t\tfor (const k in ctx) {\n\t\t\twindow[k] = ctx[k]\n\t\t}\n\t}\n\n\tif (gopt.focus !== false) {\n\t\tapp.canvas.focus()\n\t}\n\n\treturn ctx\n\n}\n","export function displayDialogue(text, onDisplayEnd) {\r\n    const dialogueUI = document.getElementById(\"textbox-container\");\r\n    const dialogue = document.getElementById(\"dialogue\");\r\n  \r\n    dialogueUI.style.display = \"block\";\r\n    let index = 0;\r\n    let currentText = \"\";\r\n    const intervalRef = setInterval(() => {\r\n      if (index < text.length) {\r\n        currentText += text[index];\r\n        dialogue.innerHTML = currentText;\r\n        index++;\r\n        return;\r\n      }\r\n  \r\n      clearInterval(intervalRef);\r\n    }, 1);\r\n  \r\n    const closeBtn = document.getElementById(\"close\");\r\n  \r\n    function onCloseBtnClick() {\r\n      onDisplayEnd();\r\n      dialogueUI.style.display = \"none\";\r\n      dialogue.innerHTML = \"\";\r\n      clearInterval(intervalRef);\r\n      closeBtn.removeEventListener(\"click\", onCloseBtnClick);\r\n    }\r\n  \r\n    closeBtn.addEventListener(\"click\", onCloseBtnClick);\r\n  \r\n    addEventListener(\"keypress\", (key) => {\r\n      if (key.code === \"Enter\") {\r\n        closeBtn.click();\r\n      }\r\n    });\r\n  }\r\n  \r\n  export function setCamScale(k) {\r\n    const resizeFactor = k.width() / k.height();\r\n    if (resizeFactor < 1) {\r\n      k.camScale(k.vec2(1));\r\n    } else {\r\n      k.camScale(k.vec2(1.5));\r\n    }\r\n  }"],"names":["n","$5cdc329eeebd56d0$export$392f53e92db1c5c1","pc","tv","bed","resume","projects","library","exit","$adc7cb3c45508c7c$var$yi","Object","defineProperty","$adc7cb3c45508c7c$var$i","e","value","configurable","$adc7cb3c45508c7c$var$gr","Uint8Array","o","c","length","g","m","P","I","charCodeAt","j","y","X","$adc7cb3c45508c7c$var$Ge","Math","PI","$adc7cb3c45508c7c$var$ot","$adc7cb3c45508c7c$var$Le","min","max","$adc7cb3c45508c7c$var$Ve","$adc7cb3c45508c7c$var$v","$adc7cb3c45508c7c$var$W","lerp","Error","$adc7cb3c45508c7c$var$_e","$adc7cb3c45508c7c$var$br","x","constructor","fromAngle","cos","sin","LEFT","RIGHT","UP","DOWN","clone","add","$adc7cb3c45508c7c$var$T","sub","scale","dist","len","sdist","slen","sqrt","dot","unit","normal","reflect","project","reject","cross","angle","atan2","angleBetween","slerp","isZero","toFixed","Number","transform","multVec2","eq","bbox","$adc7cb3c45508c7c$var$de","toString","Array","isArray","r","b","fromArray","fromHex","exec","parseInt","fromHSL","S","q","round","RED","GREEN","BLUE","YELLOW","MAGENTA","CYAN","WHITE","BLACK","lighten","darken","invert","mult","toHSL","toHex","slice","$adc7cb3c45508c7c$var$J","$adc7cb3c45508c7c$var$vr","$adc7cb3c45508c7c$var$oe","w","h","pos","$adc7cb3c45508c7c$var$ce","$adc7cb3c45508c7c$var$Ue","translate","rotateX","rotateY","rotateZ","rotate","getTranslation","getScale","getRotation","acos","getSkew","atan","E","K","Q","te","k","pe","C","Ae","$","Te","ye","$adc7cb3c45508c7c$var$In","$adc7cb3c45508c7c$var$bt","seed","gen","$adc7cb3c45508c7c$var$xi","genNumber","genVec2","genColor","genAny","$adc7cb3c45508c7c$var$Bn","Date","now","$adc7cb3c45508c7c$var$yr","$adc7cb3c45508c7c$var$xt","$adc7cb3c45508c7c$var$Ln","floor","$adc7cb3c45508c7c$var$xr","$adc7cb3c45508c7c$var$Ur","$adc7cb3c45508c7c$var$Er","width","height","$adc7cb3c45508c7c$var$Ei","p1","p2","$adc7cb3c45508c7c$var$it","$adc7cb3c45508c7c$var$Sr","$adc7cb3c45508c7c$var$vt","points","$adc7cb3c45508c7c$var$Ie","$adc7cb3c45508c7c$var$Cr","abs","EPSILON","$adc7cb3c45508c7c$var$Vn","center","radius","$adc7cb3c45508c7c$var$Ar","$adc7cb3c45508c7c$var$Tr","pts","$adc7cb3c45508c7c$var$_n","fromPoints","area","$adc7cb3c45508c7c$var$Ke","map","distToPoint","sdistToPoint","$adc7cb3c45508c7c$var$yt","$adc7cb3c45508c7c$var$Fn","radiusX","radiusY","MAX_VALUE","$adc7cb3c45508c7c$var$Or","$adc7cb3c45508c7c$var$Ut","Map","lastID","push","set","pushd","delete","$adc7cb3c45508c7c$var$ke","paused","cancel","join","forEach","get","$adc7cb3c45508c7c$var$be","handlers","addOnce","next","Promise","trigger","numListeners","size","clear","$adc7cb3c45508c7c$var$Ne","on","onOnce","remove","$adc7cb3c45508c7c$var$Wt","keys","$adc7cb3c45508c7c$var$Si","window","atob","buffer","$adc7cb3c45508c7c$var$Pr","split","$adc7cb3c45508c7c$var$Xt","document","createElement","href","download","click","$adc7cb3c45508c7c$var$kn","$adc7cb3c45508c7c$var$Dr","JSON","stringify","$adc7cb3c45508c7c$var$Nn","URL","createObjectURL","revokeObjectURL","$adc7cb3c45508c7c$var$jn","match","$adc7cb3c45508c7c$var$Mr","$adc7cb3c45508c7c$var$Ee","$adc7cb3c45508c7c$var$Gr","$adc7cb3c45508c7c$var$Br","message","String","$adc7cb3c45508c7c$var$Yt","_items","_compareFn","insert","moveUp","pop","moveDown","splice","swap","$adc7cb3c45508c7c$var$Ci","freeze","$adc7cb3c45508c7c$var$Fr","TypeError","$adc7cb3c45508c7c$var$Ai","$adc7cb3c45508c7c$var$Gi","$adc7cb3c45508c7c$var$Pi","$adc7cb3c45508c7c$var$Di","$adc7cb3c45508c7c$var$Bi","substring","$adc7cb3c45508c7c$var$Ti","$adc7cb3c45508c7c$var$Rr","$adc7cb3c45508c7c$var$Oi","$adc7cb3c45508c7c$var$Mi","indexOf","fromCodePoint","$adc7cb3c45508c7c$var$Ri","$adc7cb3c45508c7c$var$tt","$adc7cb3c45508c7c$var$Hn","codePointAt","includes","$adc7cb3c45508c7c$var$qn","buttons","sticks","left","right","default","$adc7cb3c45508c7c$var$at","pressed","Set","pressedRepeat","released","down","update","press","pressRepeat","release","$adc7cb3c45508c7c$var$$n","buttonState","stickState","$adc7cb3c45508c7c$var$zn","dts","timer","fps","tick","reduce","$adc7cb3c45508c7c$var$Ir","canvas","loopID","stopped","dt","time","realTime","fpsCounter","timeScale","skipTime","numFrames","mousePos","mouseDeltaPos","keyState","mouseState","mergedGamepadState","gamepadStates","gamepads","charInputted","isMouseMoved","lastWidth","offsetWidth","lastHeight","offsetHeight","events","toDataURL","l","style","cursor","requestPointerLock","catch","R","console","error","exitPointerLock","pointerLockElement","requestFullscreen","webkitRequestFullscreen","exitFullscreen","webkitExitFullScreen","fullscreenElement","webkitFullscreenElement","se","removeEventListener","le","ae","ge","disconnect","cancelAnimationFrame","L","visibilityState","requestAnimationFrame","he","z","Oe","maxFPS","ft","vn","navigator","maxTouchPoints","has","Se","st","Tt","Ot","Rt","Ye","an","un","cn","hn","ln","dn","Pt","Dt","Mt","Gt","Bt","fn","ct","mn","pn","Ft","gn","It","Lt","wn","ht","bn","lt","Pe","Vt","He","_t","index","isPressed","isDown","isReleased","getStick","ne","filter","getGamepads","id","$e","axes","Be","pixelDensity","devicePixelRatio","mousemove","offsetX","offsetY","movementX","movementY","innerWidth","innerHeight","De","Ce","We","mousedown","button","mouseup","yn","qe","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","keydown","key","preventDefault","toLowerCase","repeat","keyup","touchstart","changedTouches","getBoundingClientRect","touchToMouse","clientX","clientY","touchmove","touchend","touchcancel","wheel","deltaX","deltaY","contextmenu","visibilitychange","gamepadconnected","gamepad","gamepaddisconnected","addEventListener","ResizeObserver","target","observe","run","quit","setFullscreen","isFullscreen","setCursor","screenshot","getCursor","setCursorLocked","isCursorLocked","isTouchscreen","isKeyDown","isKeyPressed","isKeyPressedRepeat","isKeyReleased","isMouseDown","isMousePressed","isMouseReleased","isGamepadButtonPressed","isGamepadButtonDown","isGamepadButtonReleased","getGamepadStick","onResize","onKeyDown","onKeyPress","onKeyPressRepeat","onKeyRelease","onMouseDown","onMousePress","onMouseRelease","onMouseMove","onCharInput","onTouchStart","onTouchMove","onTouchEnd","onScroll","onHide","onShow","onGamepadButtonDown","onGamepadButtonPress","onGamepadButtonRelease","onGamepadStick","onGamepadConnect","onGamepadDisconnect","$adc7cb3c45508c7c$var$Re","ctx","src","glTex","gl","createTexture","onDestroy","free","linear","LINEAR","nearest","NEAREST","opts","texFilter","REPEAT","clampToEadge","CLAMP_TO_EDGE","wrap","bind","texImage2D","TEXTURE_2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","unbind","fromImage","texSubImage2D","pushTexture2D","popTexture2D","deleteTexture","$adc7cb3c45508c7c$var$rt","tex","glFramebuffer","glRenderbuffer","createFramebuffer","createRenderbuffer","renderbufferStorage","RENDERBUFFER","DEPTH_STENCIL","framebufferTexture2D","FRAMEBUFFER","COLOR_ATTACHMENT0","framebufferRenderbuffer","DEPTH_STENCIL_ATTACHMENT","toImageData","Uint8ClampedArray","readPixels","subarray","copyWithin","ImageData","getContext","putImageData","draw","pushFramebuffer","pushRenderbuffer","pushViewport","popFramebuffer","popRenderbuffer","popViewport","deleteFramebuffer","deleteRenderbuffer","$adc7cb3c45508c7c$var$Jt","glProgram","createShader","VERTEX_SHADER","FRAGMENT_SHADER","shaderSource","compileShader","createProgram","attachShader","bindAttribLocation","linkProgram","getProgramParameter","LINK_STATUS","getShaderInfoLog","deleteShader","pushProgram","popProgram","send","getUniformLocation","uniform1f","uniformMatrix4fv","Float32Array","uniform3f","uniform2f","deleteProgram","$adc7cb3c45508c7c$var$Qt","glVBuf","glIBuf","vqueue","iqueue","stride","maxVertices","maxIndices","vertexFormat","numDraws","curPrimitive","curTex","curShader","curUniform","createBuffer","pushArrayBuffer","bufferData","ARRAY_BUFFER","DYNAMIC_DRAW","popArrayBuffer","pushElementArrayBuffer","ELEMENT_ARRAY_BUFFER","popElementArrayBuffer","flush","bufferSubData","Uint16Array","setVertexFormat","drawElements","UNSIGNED_SHORT","deleteBuffer","$adc7cb3c45508c7c$var$nt","$adc7cb3c45508c7c$var$Kn","getExtension","loseContext","vertexAttribPointer","FLOAT","enableVertexAttribArray","bindTexture","bindBuffer","bindFramebuffer","bindRenderbuffer","viewport","useProgram","drawingBufferWidth","drawingBufferHeight","destroy","$adc7cb3c45508c7c$var$ve","loaded","data","onLoadEvents","onErrorEvents","onFinishEvents","then","finally","resolve","onLoad","onError","onFinish","$adc7cb3c45508c7c$var$je","assets","lastUID","addLoaded","progress","$adc7cb3c45508c7c$var$Yn","fetch","ok","$adc7cb3c45508c7c$var$Et","json","$adc7cb3c45508c7c$var$Lr","text","$adc7cb3c45508c7c$var$Vr","arrayBuffer","$adc7cb3c45508c7c$var$St","Image","crossOrigin","onload","onerror","$adc7cb3c45508c7c$var$kr","$adc7cb3c45508c7c$var$Nr","$adc7cb3c45508c7c$var$en","easeInSine","easeOutSine","easeInOutSine","easeInQuad","easeOutQuad","easeInOutQuad","pow","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInBack","$adc7cb3c45508c7c$var$_r","easeOutBack","easeInOutBack","$adc7cb3c45508c7c$var$Zt","easeInElastic","easeOutElastic","easeInOutElastic","easeInBounce","easeOutBounce","easeInOutBounce","$adc7cb3c45508c7c$var$At","textures","c2d","curHeight","gfx","clearRect","drawImage","$adc7cb3c45508c7c$var$Hr","$adc7cb3c45508c7c$var$zr","$adc7cb3c45508c7c$var$tn","$adc7cb3c45508c7c$var$nn","$adc7cb3c45508c7c$var$Wn","$adc7cb3c45508c7c$var$Qn","name","$adc7cb3c45508c7c$var$Ki","$adc7cb3c45508c7c$var$Zr","$adc7cb3c45508c7c$var$Wi","$adc7cb3c45508c7c$var$Xi","$adc7cb3c45508c7c$var$Xn","$adc7cb3c45508c7c$var$Jn","$adc7cb3c45508c7c$var$Ji","$adc7cb3c45508c7c$var$Qi","$adc7cb3c45508c7c$var$ut","$adc7cb3c45508c7c$var$Zi","$adc7cb3c45508c7c$var$eo","$4be214bf41451d42$export$342063e11d6c3cad","t1","s1","u","a1","h1","f","O","Js","root","body","margin","documentElement","appendChild","stretch","letterbox","parentElement","crisp","cssText","tabIndex","willReadFrequently","antialias","depth","stencil","alpha","preserveDrawingBuffer","background","clearColor","enable","BLEND","blendFuncSeparate","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","lastDrawCalls","defShader","defTex","frameBuffer","postShader","postShaderUniform","renderer","transformStack","bgTex","bgColor","bgAlpha","fixed","frames","anims","slice9","from","fromURL","packer","sliceX","sliceY","buf","fromArrayBuffer","decodeAudioData","AudioContext","webkitAudioContext","createGain","connect","destination","masterNode","burpSnd","urlPrefix","sprites","fonts","bitmapFonts","sounds","shaders","custom","objEvents","Un","gravity","scenes","logs","cam","shake","use","An","fontface","outline","color","FontFace","load","chars","b1","d1","$adc7cb3c45508c7c$var$Xr","$adc7cb3c45508c7c$var$Jr","A","getImageData","some","all","meta","frame","frameTags","to","speed","loop","pingpong","direction","font","check","gain","createBufferSource","seek","detune","playbackRate","onended","N","duration","volume","M1","currentTime","start","D","_","stop","M","play","onEnd","replace","groups","line","msg","trim","type","entries","uv","opacity","TRIANGLES","COLOR_BUFFER_BIT","we","xe","quad","flipY","shader","uniform","anchor","$adc7cb3c45508c7c$var$Qr","flipX","tiled","ceil","assign","sprite","offset","gradient","colors","horizontal","p3","end","resolution","unshift","fill","flat","indices","STENCIL_BUFFER_BIT","STENCIL_TEST","stencilFunc","NEVER","stencilOp","REPLACE","KEEP","disable","EQUAL","kt","NOTEQUAL","Zn","ch","er","es","matchAll","charStyleMap","xn","Xe","opt","Z","family","H","V","fe","U","textBaseline","textAlign","fillStyle","B","G","measureText","F","lineJoin","lineWidth","strokeStyle","strokeText","fillText","Y","lineSpacing","letterSpacing","ie","align","styles","tr","Je","ts","ns","Nt","nr","re","inspect","showLog","stepFrame","dr","drawCalls","clearLog","log","logMax","curRecording","numObjects","On","recursive","t","suspend","Me","rs","zt","ss","is","os","rr","sr","jt","parent","hidden","children","d","readd","removeAll","sort","mask","intersect","subtract","drawInspect","unuse","getOwnPropertyDescriptor","enumerable","require","exists","call","flatMap","liveUpdate","isAncestorOf","En","ir","findIndex","onAdd","onUpdate","onDraw","clearEvents","ze","as","gt","s","us","cs","hs","ls","Ht","ds","onClick","fs","onHover","ms","onHoverUpdate","ps","onHoverEnd","gs","ws","bs","vs","qt","moveBy","move","moveTo","worldPos","screenPos","pt","$t","scaleTo","scaleBy","mt","ys","rotateBy","rotateTo","xs","Us","fadeOut","$adc7cb3c45508c7c$var$Ct","Rn","Sn","Es","Ss","follow","obj","Cs","Ts","distance","isOffScreen","onExitScreen","onEnterScreen","hide","pause","Os","collisionIgnore","onCollideUpdate","localArea","shape","isClicked","isHovering","hasPoint","checkCollision","getCollisions","values","isColliding","isOverlapping","hasOverlap","onCollide","onCollideEnd","worldArea","resolveCollision","resolved","displacement","renderArea","screenArea","Qe","Cn","animSpeed","top","bottom","anim","Tn","curAnim","onAnimEnd","onAnimStart","Rs","textSize","textTransform","textStyles","a","Ps","Ds","Ms","Gs","Bs","wait","tween","p","finish","Ls","vel","jumpForce","gravityScale","isStatic","mass","reverse","source","onPhysicsResolve","isBottom","isFalling","isTop","isJumping","stickToPlatform","maxVelocity","onBeforePhysicsResolve","curPlatform","isGrounded","jump","onGround","onFall","onFallOff","onHeadbutt","Vs","numJumps","doubleJump","onDoubleJump","_s","ks","or","stay","scenesToStay","Ns","hurt","setHP","heal","hp","maxHP","setMaxHP","onHurt","onHeal","onDeath","js","fade","hr","Hs","enter","state","enterState","onStateTransition","onStateEnter","onStateUpdate","onStateDraw","onStateEnd","qs","$s","zs","Ks","Ys","pr","Ws","Xs","parse","localStorage","ar","ur","Ze","global","cr","isObstacle","cost","edges","tilePosOffset","tilePos","getLevel","tileWidth","tileHeight","invalidateNavigationMap","edgeMask","moveLeft","moveRight","Qs","pos2Tile","getSpatialMap","numRows","numColumns","ee","ue","me","spawn","tiles","wildcardTile","levelWidth","levelHeight","tile2Pos","onSpatialMapChanged","onNavigationMapInvalid","getAt","onNavigationMapChanged","getTilePath","Fe","Mn","node","et","allowDiagonals","Gn","Dn","wt","vi","getPath","Zs","agentSpeed","getDistanceToTarget","getNextLocation","getTarget","isNavigationFinished","isTargetReachable","isTargetReached","setTarget","onNavigationStarted","onNavigationNext","onNavigationEnded","onTargetReached","path","ei","captureStream","createMediaStreamDestination","MediaRecorder","ondataavailable","getTracks","onstop","Blob","ti","activeElement","ni","None","Left","Top","LeftTop","Right","Horizontal","RightTop","HorizontalTop","Bottom","LeftBottom","Vertical","LeftVertical","RightBottom","HorizontalBottom","RightVertical","All","ri","si","ii","lr","oi","ai","ui","comps","Pn","isLeft","isRight","preventResolution","ci","hashGridSize","hi","li","fr","di","logTime","info","fi","mi","pi","gi","wi","bi","DEPTH_BUFFER_BIT","getParameter","MAX_TEXTURE_IMAGE_UNITS","activeTexture","TEXTURE0","TEXTURE_CUBE_MAP","Kt","mr","backgroundAudio","debug","burp","loadingScreen","VERSION","loadRoot","loadProgress","loadSprite","loadSpriteAtlas","loadSound","loadBitmapFont","loadFont","loadShader","loadShaderURL","loadAseprite","loadPedit","loadBean","loadJSON","getSprite","getSound","getFont","getBitmapFont","getShader","getAsset","Asset","SpriteData","SoundData","record","isFocused","onLoading","onCleanup","camPos","camScale","camRot","toScreen","toWorld","setGravity","getGravity","setBackground","getBackground","make","destroyAll","polygon","rect","circle","uvquad","health","lifespan","offscreen","fadeIn","drawon","tile","agent","audioCtx","Line","Rect","Circle","Polygon","Vec2","Color","Mat4","Quad","RNG","rand","randi","randSeed","vec2","rgb","hsl2rgb","choose","chance","easings","mapc","wave","deg2rad","rad2deg","clamp","testLineLine","testRectRect","testRectLine","testRectPoint","testCirclePolygon","testLinePoint","testLineCircle","drawSprite","drawText","formatText","drawRect","drawLine","drawLines","drawTriangle","drawCircle","drawEllipse","drawUVQuad","drawPolygon","drawFormattedText","drawMasked","drawSubtracted","pushTransform","popTransform","pushTranslate","pushScale","pushRotate","pushMatrix","usePostEffect","makeCanvas","scene","go","onSceneLeave","addLevel","getData","setData","downloadJSON","downloadText","downloadBlob","plug","ASCII_CHARS","addKaboom","Event","EventHandler","EventController","plugins","focus","getElementById","$820877bea407f5fe$export$b4f6f748c3874b15","resizeFactor","layers","mapData","player","isInDialogue","layer","boundary","objects","onDisplayEnd","dialogueUI","dialogue","display","currentText","intervalRef","setInterval","innerHTML","clearInterval","closeBtn","onCloseBtnClick","code","entity","stopAnims","mouseBtn","worldMousePos","mouseAngle","keyMap","nbOfKeyPressed","deg","__name","rad","val","v","l1","l2","h2","_Vec2","args","dest","other","_Color","arr","hex","result","hue2rgb","_Quad","_Mat4","m0","m1","m4","m5","out","i","det","f00","f01","f02","f03","f04","f05","f06","f07","f08","f09","f10","f11","f12","f13","f14","f15","f16","f17","f18","lo","defRNG","list","r1","r2","testLineLineT","denom","ua","ub","v1","v2","centerToOrigin","dis","t2","testCirclePoint","prev","cur","testPolygonPoint","poly","_Line","_Rect","dx","dy","_Circle","Ellipse","_Ellipse","rx","ry","_Polygon","total","sat","overlap","axisProj","min1","max1","min2","max2","o1","o2","Registry","_EventController","ev","action","res","deepEq","k1","k2","base64ToArrayBuffer","base64","binstr","bytes","dataURLToArrayBuffer","url","filename","blob","isDataURL","str","getFileName","overload2","fn1","fn2","al","uid","getErrorMessage","BinaryHeap","compareFn","item","lastItem","child","index1","index2","GRAPHEMES","runes","string","increment","nextUnits","isGrapheme","isVariationSelector","isDiacriticalMark","isZeroWidthJoiner","current","isFirstOfSurrogatePair","currentPair","nextPair","isRegionalIndicator","isSubdivisionFlag","isSupplementarySpecialpurposePlane","isFitzpatrickModifier","betweenInclusive","codePointFromSurrogatePair","codePoint","pair","highOffset","lowOffset","lower","upper","gamepad_default","ButtonState","btn","GamepadState","FPSCounter","app_default","enterFullscreen","el","getFullscreenElement","canvasEvents","docEvents","winEvents","resizeObserver","accumulatedDt","loopTime","realDt","desiredDt","processInput","resetInput","mouse","stick","processGamepad","registerGamepad","browserGamepad","removeGamepad","gamepadState","stickName","pd","cw","ww","wh","rw","rc","ratio","MOUSE_BUTTONS","PREVENT_DEFAULT_KEYS","KEY_ALIAS","touches","box","kbGamepad","entry","Texture","_Texture","img","FrameBuffer","bytesPerRow","temp","topOffset","bottomOffset","Shader","vert","frag","attribs","vertShader","fragShader","prog","attrib","vertError","fragError","loc","BatchRenderer","format","sum","primitive","verts","indexOffset","genStack","setFunc","stack","initGfx","gc","curVertexFormat","fmt","_Asset","loader","err","asset","AssetBucket","handle","fetchURL","fetchJSON","fetchText","fetchArrayBuffer","loadImg","c2","c3","c4","c5","easings_default","TexPacker","DEF_ANCHOR","BG_GRID_SIZE","DEF_FONT","DBG_FONT","DEF_TEXT_SIZE","DEF_TEXT_CACHE_SIZE","MAX_TEXT_CACHE_SIZE","FONT_ATLAS_WIDTH","FONT_ATLAS_HEIGHT","SPRITE_ATLAS_WIDTH","SPRITE_ATLAS_HEIGHT","UV_PAD","DEF_HASH_GRID_SIZE","DEF_FONT_FILTER","LOG_MAX","LOG_TIME","VERTEX_FORMAT","STRIDE","MAX_BATCHED_QUAD","MAX_BATCHED_VERTS","MAX_BATCHED_INDICES","VERT_TEMPLATE","FRAG_TEMPLATE","DEF_VERT","DEF_FRAG","COMP_DESC","COMP_EVENTS","anchorPt","orig","alignPt","createEmptyAudioBuffer","kaboom_default","gopt","gscale","fixedSize","fontCacheCanvas","fontCacheC2d","app","ggl","makeShader","emptyTex","audio","burp_default","fixURL","game","prom","buckets","bucket","FontData","face","gw","gh","makeFont","qw","qh","rej","atlas","spr","createSpriteSheet","images","merged","imgSrc","jsonSrc","resolveJSON","resolveUrl","vcode","fcode","bean_default","resolveSprite","resolveSound","snd","resolveShader","resolveFont","bfont","srcNode","onEndEvents","gainNode","startTime","stopTime","started","getTime","cloneNode","oldNode","newNode","vertSrc","fragSrc","ty","cols","charMap","drawRaw","shaderSrc","vv","screen2ndc","frameStart","drawUnscaled","frameEnd","ow","oh","drawTexture","uvPadX","uvPadY","qx","qy","repX","repY","getArcPts","nverts","step","minSLen","polyOpt","npts","drawStenciled","content","test","getViewportScale","applyCharTransform","fchar","TEXT_STYLE_RE","compileStyledText","renderText","idxOffset","origIdx","fontAtlases","fontName","curX","tw","th","lines","curLine","lastSpace","lastSpaceWidth","fchars","ox","idx","ftext","windowToContent","contentToView","debugPaused","updateFrame","intensity","calcTransform","compStates","cleanups","inputEvents","onCurCompCleanup","tag","maskFunc","comp","prop","func","checkDeps","dep","recurse","isChild","ctrl","cb","evs","event","col","forAllCurrentAndFuture","diff","isFixed","easeFunc","dir","DEF_OFFSCREEN_DIS","isOut","screenRect","colliding","collidingThisFrame","mpos","hovering","getRenderProps","spriteData","curAnimDir","spriteLoadedEvent","calcTexScale","iw","ih","w1","w3","w2","h3","quads","setSpriteData","prevAnim","nt","actions","curTimer","newAction","setValue","curTime","DEF_JUMP_FORCE","MAX_VEL","lastPlatformPos","wantFall","tmass","col2","prevVelY","force","jumpsLeft","origHP","initState","stateList","transitions","initStateEvents","didFirstEnter","oldState","available","done","def","initEvents","plugin","funcs","funcsObj","EdgeMask","getEdgeMask","loopup","level","spatialMap","costMap","edgeMap","connectivityMap","tile2Hash","hash2Tile","hash","createSpatialMap","insertIntoSpatialMap","removeFromSpatialMap","updateSpatialMap","spatialMapChanged","createCostMap","createEdgeMap","createConnectivityMap","traverse","frontier","getNeighbours","getCost","neighbour","getHeuristic","goal","diagonals","levelComp","hasPos","hasTile","cameFrom","costSoFar","neighbours","newCost","row","navMapChangedEvent","frameRate","stream","audioDest","recorder","chunks","boom","kaSprite","ka_default","boomSprite","boom_default","kaboom","ka","Collision","checkFrame","grid","cellSize","checkObj","aobj","xmin","ymin","xmax","ymax","checked","cell","col1","drawFrame","drawLoadScreen","drawInspectText","txt","pad","ftxt","bw","bh","drawDebug","inspecting","flipped","handleErr","textStyle","title","numTextureUnits","isFirstFrame","updateViewport","rg","sw","sh"],"version":3,"file":"index.b5029828.js.map"}